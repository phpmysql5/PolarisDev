!function(a){function b(b,c){var d=b.row.skuid__Adapter_Name__c,e="datasource__"+d,f=e;a.region.get(f)||(f="datasource__DefaultDataSourceWizard");var g=a.snippet.get(e);g&&g({context:b}),a.region.setContentByIds(c,f)}function c(a){var b=e.Deferred();return e.ajax({type:"POST",url:window.top.location.protocol+"//"+window.top.location.hostname+"/services/Soap/m/35.0",beforeSend:function(a){a.setRequestHeader("SOAPAction",'""'),a.setRequestHeader("Content-Type","text/xml")},data:'<?xml version="1.0" encoding="utf-8"?><env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><env:Header><urn:SessionHeader xmlns:urn="http://soap.sforce.com/2006/04/metadata"><urn:sessionId>'+sforce.connection.sessionId+"</urn:sessionId></urn:SessionHeader></env:Header><env:Body>"+a+"</env:Body></env:Envelope>"}).done(function(a,c,d){var f="",h=g.makeXMLDoc(d.responseText),i=h.find("errors");i.length&&e.each(i,function(){f+=e(this).children("message").text()+"\n"}),f?b.reject(f):b.resolve()}).fail(function(a,c,d){b.reject(d.status)}),b.promise()}function d(a){var b=a.split("/");return b[0]+"//"+b[2]}var e=a.$,f=a.snippet.register,g=a.utils,h=a.ui.renderers,i=a.ui.fieldRenderers,j=g.decodeHTML,k=a.constants.SALESFORCE,l=a.platform.getEntityFieldNames,m=l("theme"),n=l("data_source"),o=l("auth_provider"),p=function(b){var c,d=b.field,f=j(b.value),g=b.filterFunction,k=b.isRequired,l=b.model,m=b.renderas;if("edit"===d.mode)if(c=g?l.getRows().filter(g):l.getRows(),"COMBOBOX"===m){var n=e('<div style="position: relative;">'),o=function(){return n.parent().find(".nx-property-error")},p=h.COMBOBOX.edit({value:f,parentElem:n,onChange:function(a,b){d.model.updateRow(d.row,d.id,b.item.value,{initiatorId:d._GUID})},onBlur:function(){o().hide(),f!==p.val()&&p.val("")},source:function(a,b,d,f){d();var g=new RegExp(e.ui.autocomplete.escapeRegex(a.term),"i");b(e.map(c,function(b){var c=l.getRowName(b),d=b.value||c;if(!a.term||g.test(c))return f(),{label:c,value:d}}))},appendDropdown:!1}).appendTo(n);d.element.html(n)}else d.element.html(h.PICKLIST.edit({value:f,required:k,onChange:function(a){d.model.updateRow(d.row,d.id,a,{initiatorId:d._GUID})},entries:e.map(c,function(a){var b=l.getRowName(a);return{label:b,value:b}}),renderas:m}));else i[d.metadata.displaytype][d.mode](d,f);if(!d._mspSubscriptions){d._mspSubscriptions=a.events.subscribe(["models.saved","models.cancelled","models.loaded"],function(a){l.id in a.models&&d.render()});var q=d.unregister;d.unregister=function(){e.each(d._mspSubscriptions,function(){a.events.unsubscribe(this)}),q()}}},q=function(a){var b=a.field,c=a.value,d=a.entries,f=a.onChange;"edit"===b.mode?b.element.html(h.PICKLIST.edit({value:c,required:!0,onChange:function(c){b.model.updateRow(b.row,b.id,c,{initiatorId:b._GUID}),f&&a.onChange(c)},entries:d})):(e.each(d,function(){if(c===this.value)return c=this.label,!1}),i[b.metadata.displaytype][b.mode](b,c))},r=function(a,b,c){b=j(arguments[1]);var d={};e.extend(!0,d,a.metadata),a.metadata=d,d.picklistEntries=c,i.MULTIPICKLIST[a.mode](a,b)},s=function(a,b,c,d){b=j(b);var f=a.metadata;if("edit"==a.mode){f={},e.extend(!0,f,a.metadata),a.metadata=f;var g=[],h={};if(e.each(f.referenceTo,function(a,b){if(-1!=e.inArray(b.objectName,c)&&!h[b.objectName]&&(g.push(b),h[b.objectName]=1,g.length==c.length))return!1}),g.length){d&&(a.options.type="REFPICK"),f.referenceTo.length=0;var k=[];e.each(g,function(){k.push(this.objectName)}),f.ref=k.join(),f.referenceTo=g}}i[f.displaytype][a.mode](a,b),d&&(a.options.type="CUSTOM")},t=function(a){var b=a.field,c=a.value;if("edit"===b.mode){b.element.css({height:a.height||"300px",width:"100%"}),c||(c="{}");var d=new JSONEditor(b.element.get(0),{change:function(){b.model.updateRow(b.row,b.id,d.getText(),{initiatorId:b._GUID})}},c&&g.isString(c)?JSON.parse(c):c)}else i[b.metadata.displaytype][b.mode](b,c)},u=function(b,c,d){var f,g,h;return e.each(b,function(a,b){if(b.Name===c&&(b.NamespacePrefix===d||!d&&!b.NamespacePrefix))return f=b,!1}),h=f?a.time.parseSFDateTime(f.SystemModstamp).getTime()+"/":"",f&&(g=f.NamespacePrefix),"/resource/"+h+(g?g+"__":"")+c+"/"},v=function(a){var b=a.field,c=a.value,d=a.themes,f=a.themeResources,g=a.dialogTitle||"Choose Theme";if("edit"===b.mode){var h=function(){var a=e("<div>"),h=e('<div class="themes-wrapper">');e.each(d,function(a,b){var d=e('<div data-theme="'+b.Name+'">').addClass("theme-card");b.Name===c&&d.addClass("selected");var g=e('<div class="theme-label">').text(b.Name),i=b.skuid__Resource_Namespace__c,j=b.skuid__Resource_Name__c,k=u(f,j,i)+"screenshot.png",l=e('<div class="theme-screenshot">').append(e("<img>").attr({src:k,width:"350"}));d.append(l,g),h.append(d)}),h.on("click",".theme-card",function(){var c=e(this),d=c.data("theme");b.model.updateRow(b.row,b.id,d,{initiatorId:b._GUID}),a.dialog("close")}),a.append(h),a.dialog({width:"90%",height:600,modal:!0,title:g,close:function(){j||(b.mode="read"),b.render()}})},j=b.item.list.editor.element.is(".nx-skootable");j?b.element.append(e('<div class="nx-fieldtext">').text(c).append(e("<button>").css({cursor:"pointer","margin-left":"10px","vertical-align":"middle"}).append(e('<div class="sk-icon inline sk-icon-photoview">')).skootip("Click to change Theme").on("click",h))):h()}else i[b.metadata.displaytype][b.mode](b,c)};f("AuthRequestBodyContentTypes",function(){q({field:arguments[0],value:j(arguments[1]),entries:[{label:"Form Data (application/x-www-form-urlencoded)",value:"application/x-www-form-urlencoded"},{label:"JSON (application/json)",value:"application/json"}]})}),f("JSONEditor",function(){return t({field:arguments[0],value:j(arguments[1])})}),f("JSONEditor_Short",function(){return t({field:arguments[0],value:j(arguments[1]),height:"150px"})}),f("NameFieldNoLink",function(a,b){a.options.noLink=!0,i[a.metadata.displaytype][a.mode](a,j(b))}),f("PasswordInput",function(a,b){i[a.metadata.displaytype][a.mode](a,j(b)),"edit"===a.mode&&a.element.find(":input").attr({type:"password",maxlength:"140"})}),f("MaxLengthInput",function(a,b){i[a.metadata.displaytype][a.mode](a,j(b)),"edit"===a.mode&&a.element.find(":input").attr({maxlength:"140"})}),f("ThemePicker_Composer_Desktop",function(b,c){v({field:b,value:c,themes:a.$M("stng__Themes_Desktop").getRows([{field:m.name,operator:"in",values:["Composer Light","Composer Dark","Builder Light","Builder Dark"],type:"multiple"}]),themeResources:a.$M("stng__DesktopThemeResources").getRows(),dialogTitle:"Choose Desktop Composer Theme"})}),f("ThemePicker_Composer_Mobile",function(b,c){return p({field:b,value:c,isRequired:!0,model:a.$M("stng__Themes_Mobile"),filterFunction:function(a){return"Mobile"===a.skuid__Type__c&&-1!==e.inArray(a.Name,["MobileClassic"])}})}),f("ThemePicker_Desktop",function(b,c){v({field:b,value:c,themes:a.$M("stng__Themes_Desktop").getRows([{field:a.platform.getEntityFieldName("theme","name"),operator:"not in",values:["Composer Light","Composer Dark"],type:"multiple"},{field:a.platform.getEntityFieldName("theme","active"),value:!0}]),themeResources:a.$M("stng__DesktopThemeResources").getRows()})}),f("ThemePicker_Mobile",function(b,c){v({field:b,value:c,themes:a.$M("stng__Themes_Mobile").getRows([{field:a.platform.getEntityFieldName("theme","active"),value:!0}]),themeResources:a.$M("stng__MobileThemeResources").getRows()})}),f("ThemeTypePicklist",function(){var a=arguments[0],b=j(arguments[1]);"edit"===a.mode?a.element.html(h.PICKLIST.edit({value:b,required:!0,onChange:function(b){a.model.updateRow(a.row,a.id,b)},entries:[{label:"Desktop",value:"Desktop"},{label:"Mobile",value:"Mobile"}]})):i[a.metadata.displaytype][a.mode](a,b)}),f("ModelDataSourcePrepareAdvSettingsRegion",function(a){b(a.context,"region_datasource_advsettings")}),f("ModelDataSourcePrepareNewRegion",function(a){b(a,"region_datasource_new")}),f("ModelDataSourceTypePicker",function(b,c){return p({field:b,value:c,isRequired:!0,model:a.$M("stng__ModelDataSourceTypes")})}),f("ModelDataSourceTypePicker_Combobox",function(b,c){return p({field:b,value:c,isRequired:!0,model:a.$M("stng__ModelDataSourceTypes")||a.$M("stng__DataSourceTypes"),renderas:"COMBOBOX"})}),f("ServiceAccessMethod",function(){var a=arguments[0],b=a.row,c=a.model,d=[{label:"Unrestricted (Anyone can use)",value:"any"}];c.getFieldValue(b,"skuid__Use_Apex_Proxy__c")&&d.push({label:"Require Named Permission",value:"namedperm"}),q({field:arguments[0],value:j(arguments[1]),entries:d})}),f("stng__CustomPermissionsPicklist",function(){var b=[];e.each(a.$M("stng__CustomPermissions").data,function(a,c){var d=(c.NamespacePrefix?c.NamespacePrefix+"__":"")+c.DeveloperName,e=c.MasterLabel+(c.NamespacePrefix?" ("+c.NamespacePrefix+")":"");b.push({value:d,label:e,active:!0,defaultValue:0===a})}),q({field:arguments[0],value:j(arguments[1]),entries:b,required:!0})});var w='{"Authorization":"Bearer {{$Auth.Response.Body.access_token}}"}',x={salesforce:{label:"Salesforce",value:k,authorizationUrl:"https://<My Domain>.my.salesforce.com/services/oauth2/authorize",tokenUrl:"https://<My Domain>.my.salesforce.com/services/oauth2/token",requestHeaders:w,tokenRequestBodyParams:"{}"},sharepointonline:{label:"SharePoint Online",value:"sharepointonline",authorizationUrl:"https://<Company Name>.sharepoint.com/<Site Collection Path>_layouts/15/OauthAuthorize.aspx",tokenUrl:"https://accounts.accesscontrol.windows.net/<Company Name>.onmicrosoft.com/tokens/OAuth/2",tokenRequestBodyParams:'{"resource":"00000003-0000-0ff1-ce00-000000000000/<Company Name>.sharepoint.com@<Company Name>.onmicrosoft.com"}',requestHeaders:w},google:{label:"Google",value:"google",authorizationUrl:"https://accounts.google.com/o/oauth2/auth",tokenUrl:"https://accounts.google.com/o/oauth2/token",requestHeaders:w,tokenRequestBodyParams:"{}",defaultScopes:"https://www.googleapis.com/auth/drive,https://www.googleapis.com/auth/calendar"},outlook:{label:"Outlook",value:"outlook",authorizationUrl:"https://login.microsoftonline.com/common/oauth2/authorize?resource=https%3A%2F%2Foutlook.office.com%2F",tokenUrl:"https://login.microsoftonline.com/common/oauth2/token",requestHeaders:w,tokenRequestBodyParams:"{}",defaultScopes:"https://outlook.office.com/mail.send,https://outlook.office.com/mail.readwrite.all,https://outlook.office.com/calendars.readwrite.all,https://outlook.office.com/tasks.readwrite.all"},github:{label:"Github",value:"github",authorizationUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token",requestHeaders:w,tokenRequestBodyParams:"{}"},facebook:{label:"Facebook",value:"facebook",authorizationUrl:"https://www.facebook.com/dialog/oauth/",tokenUrl:"https://graph.facebook.com/oauth/access_token",requestHeaders:w,tokenRequestBodyParams:"{}"},dropbox:{label:"Dropbox",value:"dropbox",authorizationUrl:"https://www.dropbox.com/1/oauth2/authorize",tokenUrl:"https://api.dropbox.com/1/oauth2/token",requestHeaders:w,tokenRequestBodyParams:"{}"},slack:{label:"Slack",value:"slack",authorizationUrl:"https://slack.com/oauth/authorize",tokenUrl:"https://slack.com/api/oauth.access",requestHeaders:'{"Authorization":"Bearer {{$Auth.Response.Body.token}}"}',defaultScopes:"channels:history,channels:read,channels:write,chat:write:user,groups:history,groups:read,groups:write,im:history,im:read,im:write,mpim:history,mpim:read,mpim:write,users:read",tokenRequestBodyParams:"{}"},onedrive:{label:"Microsoft OneDrive",value:"onedrive",authorizationUrl:"https://login.microsoftonline.com/common/oauth2/authorize?resource=https://<My Domain>-my.sharepoint.com",tokenUrl:"https://login.microsoftonline.com/common/oauth2/token",requestHeaders:w,defaultScopes:"MyFiles.Read,MyFiles.Write",tokenRequestBodyParams:"{}"},msexcel:{label:"Microsoft Excel",value:"msexcel",authorizationUrl:"https://login.microsoftonline.com/common/oauth2/authorize?resource=https://graph.microsoft.com",tokenUrl:"https://login.microsoftonline.com/common/oauth2/token",requestHeaders:w,defaultScopes:"MyFiles.Read,MyFiles.Write",tokenRequestBodyParams:"{}"},other:{label:"Other",value:"other",authorizationUrl:"",tokenUrl:"",requestHeaders:w,tokenRequestBodyParams:"{}"}};f("AuthProviderTypesPicklist",function(){var a=arguments[0];q({field:a,value:j(arguments[1]),entries:e.map(x,function(a){return{value:a.value,label:a.label}}),onChange:function(b){var c=x[b],d={};e.each({authorizationUrl:o.authorize_endpoint_url,tokenUrl:o.token_endpoint_url,requestHeaders:o.request_headers,tokenRequestBodyParams:o.token_request_body_parameters,clientId:o.client_id,defaultScopes:o.default_scopes},function(a,b){b&&(d[b]=c.hasOwnProperty(a)?c[a]:"")}),g.size(d)&&a.model.updateRow(a.row,d,{initiatorId:a._GUID})}})}),f("AuthProviderApexClasses",function(){var a=arguments[0],b=j(arguments[1]);s(a,b,["ApexClass"],!1)}),f("AuthProviderPicklist",function(b,c,d){var e=b.row,f=e[n.authentication],g=e[n.type];return p({field:b,value:j(c),isRequired:!1,model:a.$M("stng__AuthProviders"),filterFunction:function(a){var b=a[o.auth_method]||"oauth2";return g===k?a[o.oauth_provider_type]===k:"provider"===f&&("apex"!==b||"Sharepoint"===g&&"apex"===b)},renderas:d?d.renderas:null})}),f("AuthProviderPicklist_Radio",function(){a.snippet.get("AuthProviderPicklist")(arguments[0],arguments[1],{renderas:"RADIO_BUTTONS"})}),f("PackagesMultipicklist",function(b,c){var d=[];e.each(a.$M("stng__Packages").data,function(a,b){d.push({value:b.NamespacePrefix,label:b.NamespacePrefix,active:!0,defaultValue:0===a})}),r(b,c,d)}),f("stng__PermissionSetsMultipicklist",function(b,c){var d=[];e.each(a.$M("stng__PermissionSets").data,function(a,b){var c=(b.NamespacePrefix?b.NamespacePrefix+"__":"")+b.Name,e=b.Label+(b.NamespacePrefix?" ("+b.NamespacePrefix+")":"");d.push({value:c,label:e,active:!0,defaultValue:0===a})}),r(b,c,d)}),f("ProfileLookup",function(a,b){s(a,b,["Profile"],!1)}),f("UserOrProfileLookup",function(a,b){s(a,b,["User","Profile"],!1)}),f("skuid.settings.dataSourceCreds.profileSelector",function(b,c){var d,f=b.mode,g=b.metadata.displaytype,j=a.$M("_inline_Profiles"),k=[],l=e.Deferred();j===undefined?(j=a.model.registerModel("_inline_Profiles",{id:"_inline_Profiles",objectName:"Profile",fields:[{id:"Id"},{id:"Name"}],doQuery:!0,orderByClause:"Name"}),j.updateData(function(){l.resolve()})):l.resolve(),l.done(function(){k=e.map(j.getRows(),function(a){var b=j.getFieldValue(a,"Name"),e=j.getFieldValue(a,"Id");return e===c&&(d=b),{label:b,value:e}}),"edit"!==f?i[g][f](b,d||c):b.element.append(h.PICKLIST.edit({value:c,entries:k,required:!0,onChange:function(a,c){a!==c&&b.model.updateRow(b.row,b.id,a,{initiatorId:b._GUID})}}))})});var y=function(a){return JSON.stringify(a,undefined,3)};f("skuid.loadJSZip",function(){var b=e.Deferred();return"undefined"!=typeof JSZip?b.resolve():g.loadJS(a.platform.getResourceUrl({name:"lib/jSZip.js",namespace:"skuid"}),function(){b.resolve()}),b.promise()}),f("skuid.newComponentPackPreSave",function(){var b=arguments[0],c=e.Deferred(),d=b.row,f=b.model,g=d.skuid__Resource_Name__c,h=d.Name,i="Mobile"==d.skuid__Type__c,j=h+(i?"Mobile":"")+"Components",k=1,l=!1;if(e.each(f.getRows(),function(){this.skuid__Load_Order__c&&this.skuid__Load_Order__c>k&&(k=this.skuid__Load_Order__c+1)}),f.updateRow(d,{skuid__Load_Order__c:k}),e.each(f.registeredLists,function(a,b){if(b.validateRequiredFields().length)return l=!0,!1}),l)return c.reject(),!1;var m={id:h,components:[{id:"sayhello"}],js:[{path:"runtime.js"}],css:[{path:"runtime.css"}]},n={id:h,components:[{id:"sayhello",folderId:h}],folders:[{id:h,name:g,icon:"sk-icon-component-pack"}],js:[{path:"builders.js"}],css:[{path:"builders.css"}]},o='(function(skuid){\n\tskuid.componentType.register("'+h+'__sayhello",function(element,xmlDef){\n\t\telement.addClass("hello-content").html("<b>Hello " + xmlDef.attr("person") + "</b>");\n\t});\n})(skuid);',p='(function($) {\n\tskuid.builder.core.registerBuilder(new skuid.builder.core.Builder({\n\t\tid: "'+h+'__sayhello",\n\t\tname: "Say Hello",\n\t\ticon: "sk-icon-contact",\n\t\tdescription: "This component says Hello to someone",\n\t\tcomponentRenderer: function(component) {\n\t\t\tcomponent.setTitle(component.builder.name);\n\t\t\tcomponent.body.html(\n\t\t\t\t"<div class=\'hello-content\'>Hello " + component.state.attr("person") + "!</div>"\n\t\t\t);\n\t\t},\n\t\tmobileRenderer: function(component) {\n\t\t\tcomponent.setTitle(component.builder.name);\n\t\t\tcomponent.body.html(\n\t\t\t\t"<div class=\'hello-content\'>Hello " + component.state.attr("person") + "!</div>"\n\t\t\t);\n\t\t},\n\t\tpropertiesRenderer: function (propertiesObj,component) {\n\t\t\tpropertiesObj.setTitle("Say Hello Component Properties");\n\t\t\tvar state = component.state;\n\t\t\tvar propCategories = [];\n\t\t\tvar propsList = [\n\t\t\t\t{\n\t\t\t\t\tid: "person",\n\t\t\t\t\ttype: "string",\n\t\t\t\t\tlabel: "Person to say Hello to",\n\t\t\t\t\thelptext: "Pick a name, any name!",\n\t\t\t\t\tonChange: function(){\n\t\t\t\t\t\tcomponent.refresh();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t\tpropCategories.push({\n\t\t\t\tname: "",\n\t\t\t\tprops: propsList,\n\t\t\t});\n\t\t\tif(skuid.mobile) propCategories.push({ name : "Remove", props : [{ type : "remove" }] });\n\t\t\tpropertiesObj.applyPropsWithCategories(propCategories,state);\n\t\t},\n\t\tdefaultStateGenerator : function() {\n\t\t\treturn skuid.utils.makeXMLDoc("<'+h+"__sayhello person='"+a.utils.userInfo.firstName+"' />\");\n\t\t}\n\t}));\n})(skuid);\n",q=new JSZip;q.file("skuid_runtime.json",y(m)),q.file("skuid_builders.json",y(n)),q.file("runtime.js",o),q.file("builders.js",p),q.file("runtime.css",".hello-content {\n\tcolor: black;\n\tfont-size: 18pt;\n}"),q.file("builders.css",".hello-content {\n\tcolor:black;\n\tfont-size: 18pt;\n}");var r=q.generate({type:"base64",compression:"DEFLATE"}),s={Name:j,ContentType:"application/zip",Body:r,CacheControl:"Public"};return e.ajax({type:"POST",url:"/services/data/v34.0/sobjects/StaticResource",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.utils.userInfo.sessionId},data:JSON.stringify(s),dataType:"json",success:function(){f.updateRow(d,{skuid__Resource_Name__c:j}),c.resolve()},error:function(){c.reject()}}),c.promise()}),f("skuid.settings.newModelDataSource.checkForRemoteSite",function(){var b=arguments[0],f=b.model,h=b.row;f&&"stng__ModelDataSources"===f.id||(f=a.$M("stng__ModelDataSources")),h&&f.getRowById(f.getRowId(h))||(h=f.getFirstRow());var i=f.getFieldValue(h,"skuid__URL__c",!0),j=f.getFieldValue(h,"skuid__Use_Apex_Proxy__c",!0),k=!1,l=d(i);if(e.each(a.$M("stng__AuthProviders").getRows(),function(a,b){var c=b.skuid__Authorize_Endpoint_URL__c,d=b.skuid__Token_Endpoint_URL__c;if(g.startsWith(c,l)||g.startsWith(d,l))return k=!0,!1}),j&&!k){if(window.confirm("In order for this Data Source to be accessible by Skuid, you will need to create a Remote Site Setting corresponding to this Data Source's URL:\n\n - "+i+" \n\nWould you like Skuid to try to see if a Remote Site Setting corresponding to this URL already exists, and if not, create one for you?")){var m=f.getFieldValue(h,"Name",!0),n="For Skuid to access data from Data Source "+m,o=l.substring(l.indexOf("://")+3),p=m.replace(/[\W]+/g,"")+"_"+o.replace(/[\W]+/g,"");return p.length>40&&(p=p.substring(0,40)),e.blockUI({message:'Attempting to create a Remote Site Setting for URL: "'+i+'"'}),c('<createMetadata><metadata xsi:type="RemoteSiteSetting"><fullName>'+p+"</fullName><description>"+n+"</description><disableProtocolSecurity>false</disableProtocolSecurity><isActive>true</isActive><url>"+l+"</url></metadata></createMetadata>").done(function(){e.blockUI({message:"A Remote Site Setting has successfully been created!",timeout:2e3})}).fail(function(a){e.blockUI({message:"There was a problem creating the Remote Site for this URL:<br/><br/>"+a,timeout:3e3})})}return e.unblockUI(),!0}return e.unblockUI(),!0}),f("skuid.settings.newAuthProvider.checkForRemoteSites",function(){var b=arguments[0],f=b.model,g=b.row;f&&"stng__AuthProviders"===f.id||(f=a.$M("stng__AuthProviders")),g&&f.getRowById(f.getRowId(g))||(g=f.getFirstRow());var h={},i=e.map(["skuid__Authorize_Endpoint_URL__c","skuid__Token_Endpoint_URL__c","skuid__User_Info_Endpoint_URL__c"],function(a){var b=f.getFieldValue(g,a,!0),c=!!b&&d(b);if(c&&!h[c])return h[c]=1,c});if(!i.length||!window.confirm("In order for Skuid to authenticate using this Auth Provider, you will need to create Salesforce Remote Site Settings for the following URL(s):\n\n - "+i.join("\n - ")+"\n\nWould you like Skuid to try to see if the necessary Remote Site Settings corresponding to these URL(s) already exist, and if not, create them for you?"))return e.unblockUI(),!0;var j=f.getFieldValue(g,"Name",!0);j&&(j=j.replace(/[\W]+/g,""));var k="For Skuid to authenticate using Auth Provider "+j,l=[];e.each(i,function(a,b){var d=b.substring(b.indexOf("://")+3),e=j+"_"+d.replace(/[\W]+/g,"");e.length>40&&(e=e.substring(0,40)),l.push(c('<createMetadata><metadata xsi:type="RemoteSiteSetting"><fullName>'+e+"</fullName><description>"+k+"</description><disableProtocolSecurity>false</disableProtocolSecurity><isActive>true</isActive><url>"+b+"</url></metadata></createMetadata>"))}),e.blockUI({message:"Attempting to create Remote Site Settings for "+i.length+" URL(s) ..."}),e.when.all(l).done(function(){e.blockUI({message:i.length+" Remote Site Setting(s) have successfully been created!",timeout:2e3})}).fail(function(a){e.blockUI({message:"There was a problem creating the Remote Site Setting(s) for these URL(s):<br/><br/>"+a,timeout:3e3})})}),f("skuid.updateCache",function(b){var c=b.item.row,d=c.skuid__Resource_Name__c,e=c.skuid__Resource_Namespace__c,f=c.skuid__Runtime_Definition_File__c||"skuid_runtime.json",h=a.component.getByType("pagetitle")[0].element.data("object").editor;g.getJSONBodyOfZIPResourceFile(d,e,f).done(function(a){if(a){var e,f,g,i,j=[],k={};for(e=JSON.stringify(a);e;){if(e.length<255){j.push(e);break}j.push(e.substr(0,255)),e=e.substr(255)}if(j.length<20){for(i=0;i<20;i++)f=i<20?"0"+(i+1):i+1,g=j[i]||"",k["skuid__Package_Cache"+f+"__c"]=g;b.model.updateRow(c,k)}else h.handleMessages([{message:"Your package definition is too large to be cached.",severity:"ERROR"}])}else h.handleMessages([{message:'Unable to retrieve "'+d+'" Component Pack definition',severity:"ERROR"}])})}),f("skuid.importComponentPack",function(){var b,c=a.$,d=arguments[0],e=c.Deferred(),f=d.apiExtensions.$Result.body;return c.ajax({url:"/files/"+f.name+"/skuid_builders.json",type:"GET",contentType:"application/json"}).fail(function(){return e.reject("The uploaded file is not a valid Skuid Component Pack. skuid_builders.json not found.")}).then(function(a){return a.id?(b=a.id,c.ajax({url:"/files/"+f.name+"/skuid_runtime.json",type:"GET",contentType:"application/json"}).fail(function(){return e.reject("The uploaded file is not a valid Skuid Component Pack. skuid_runtime.json not found.")})):e.reject("Property id required in skuid_builders.json for import")}).then(function(c){if(!c.id)return e.reject("Property id required in skuid_runtime.json for import");if(c.id!==b)return e.reject("Property id must be consistant between skuid_runtime.json and skuid_builders.json");var d=a.$M("stng__ComponentPacks_Existing");return d.setCondition(d.getConditionByName("packName"),c.id),b=c.id,d.updateData()}).then(function(){var c=a.$M("stng__ComponentPacks_Existing"),d=a.$M("stng__ComponentPacks"),e=c.getFirstRow(),g=d;if(e)g=c,g.updateRow(e,{file_id:f.id,resource_name:f.name});else{var h=0;d.getRows().length&&d.getRows().forEach(function(a){var b=d.getFieldValue(a,"load_order",!0);b>h&&(h=b)}),g.updateRow(d.createRow(),{name:b,file_id:f.id,resource_name:f.name,active:!0,load_order:h+1})}return g.save()}).then(function(b){if(b.messages&&b.messages.length){var d=c('<div id="componentImportErrors" class="nx-error">');return d.prependTo(c("#importUploadTitle")),d.empty(),c.each(b.messages,function(a,b){d.append("<div>"+b+"</div>")}),a.$M("stng__ComponentPacks").cancel(),e.reject()}e.resolve()}),e}),f("skuid.settings.copyPrefsFromOrgDefault",function(){var b=arguments[0],c=b.row,d=b.model,f=a.$M("stng__OrgPreferences"),h=f.getFirstRow(),i={};e.each(f.fields,function(){g.startsWith(this.id,"skuid__")&&"skuid__Use_Component_Packs__c"!==this.id&&(i[this.id]=f.getFieldValue(h,this.id,!0))}),d.updateRow(c,i,{initiatorId:b.initiatorId})}),f("skuid.crypt.generateKey",function(b){var c=b.model,d=b.row,f=e.Deferred();return a.SkuidSettingsController.generateNewSkuidCryptKey(function(a){a&&"string"==typeof a?(c.updateRow(d,"skuid__Key__c",a),f.resolve()):f.reject()}),f.promise()});var z={};f("skuid.settings.changeDataSourceWithCreds",function(a){var b=a.model,c=a.row,d=b.getFieldValue(c,"Id"),f=b.getFieldValue(c,"StoredCredCount__ui"),h={};e.each(a.updates,function(a,c){!0!==b.getField(a).uiOnly&&(h[a]=c)}),z[d]===undefined&&g.size(h)&&f&&(z[d]=!0,window.confirm("WARNING: This Data Source has stored Data Source Credentials. For security reasons, Data Sources with stored credentials cannot be changed. If you proceed, the records will automatically be deleted, but your changes will not be saved and the Data Source will be unavailable until the process completes. \n\nWould you like proceed?")||(b.cancelRowChanges(c),delete z[d]))}),f("skuid.settings.clearDataSourceChangeWarnings",function(){z={}}),f("skuid.settings.newDataSourceWizard.navigateToStep.newAuthProvider",function(){var b=a.$C("salesforce_NewModelDataSourceWizard")||a.$C("NewModelDataSourceWizard");b&&b.navigate("newAuthProvider_salesforce")}),f("skuid.settings.dataSourceMetadata.enableCache",function(b){function c(b){e.each(b,function(b,c){var e=a.dataSource.get(b);e||(e=d(c)),f(e)})}function d(b){return new a.dataSource.DataSource(b)}function f(a){var b=a.name;return delete a._metadataCacheVersion,delete a.metadata,a.dataSourceType.authenticateAndGetMetadata({dataSource:a,minimalOnly:!0}).then(function(a){return h(b,a)}).then(function(a){j.resolve(a)},function(a){var b;g.isString(a)?b=a:a&&a.response&&a.response.body&&(b=a.response.body),j.reject({$PreviousAction:{Error:b}})})}function h(a,b){return e.blockUI({message:"Parsing and caching metadata..."}),e.ajax({url:"/api/v1/datasource-metadata?datasource="+a,method:"POST",data:JSON.stringify(b),contentType:"application/json"})}var i,j=e.Deferred(),k=[];if(b.row?k.push(b.row):b.insertResults&&b.insertResults.length&&b.insertResults[0].success&&k.push(b.insertResults[0].record),!k.length)return j.reject().promise();var l=k.filter(function(a){return a.name&&a.type&&!0===a.ODataBase__ui});if(!l.length)return j.reject().promise();var m=setTimeout(function(){e.blockUI({message:"Loading OData metadata for Data Source..."})},10);i=l[0];var n={dataSources:{},personalization:!1};return n.dataSources[i.name]={},a.RemotingStubs.metaService(JSON.stringify(n),function(b){if(!b||!g.size(b.dataSourceTypes))return clearTimeout(m),j.reject({$PreviousAction:{Error:"You do not have access to this Data Source."}});e.each(b.dataSourceTypes,function(b,d){a.dataSource.getDataSourceType(b)?c(d.dataSources):g.loadJS(d.js).done(function(){c(d.dataSources)})})}),j.promise()}),f("skuid.settings.dataSourceMetadata.disableCache",function(){var b=arguments[0],c=a.$,d=b.row;return c.ajax({url:"/api/v1/datasource-metadata?datasource="+d.name,method:"DELETE"})})}(skuid);