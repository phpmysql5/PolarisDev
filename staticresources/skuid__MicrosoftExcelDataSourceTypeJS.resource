!function(a){var b=a.$,c=b.map,d=b.each,e=b.Deferred,f=a.utils,g=a.dataSource,h=a.constants,i=h.DISPLAY_TYPES,j=h.MIME_TYPES,k=h.HTTP_VERBS,l=a.ui.fieldRenderers,m=j.JSON,n=i.DATETIME,o=i.NUMBER,p=i.OBJECT,q=i.STRING,r=i.BOOLEAN,s=k.GET,t=k.POST,u=k.PATCH,v=k.DELETE,w="https://graph.microsoft.com/v1.0",x=function(a,b){var c={};return d(a,function(a,d){d.inactive||(c[d.sourceParam||d.name]=b?f.mergeAsTextInContext(d.value,b):d.value)}),c},y=function(a){var b=a.model,c=b.conditions,d=x(c,a),e=d.parent;"parent"in d&&e?-1!==e.indexOf(".")?(a.request.url="/me/drive/root:"+e,a.request.pathToContent=""):(a.request.url="/me/drive/root:"+e+":/children",a.request.pathToContent="value"):"parent"in d&&(a.request.url="/me/drive/root/children",a.request.pathToContent="value")},z=function(a,c){var d=a.model,e=d.conditions,f=x(e,a),g=c.getEntityMetadataCacheKey(d),h=f.file,i=f.worksheet,j=a.row.rowRange;if("TableRange"===g||"Range"===g){var k=a.row.formulas,l=[];b.each(a.request.data,function(a,b){k[a]=b}),b.each(k,function(a,b){l.push(b)}),a.request.data={formulas:[l]},a.request.url="/me/drive/items/"+h+"/workbook/worksheets('"+i+"')/range(address='"+j+"')"}},A=function(a,c,d){b.each(a.picklistEntries,function(a,e){d===e.value&&e.args&&b.each(e.args,function(a,b){c.push(b)})})};g.getDataSourceType("MicrosoftExcel")||new g.core.RESTDataSourceTypeBase({name:"MicrosoftExcel",coerceRequest:function(a){var b=a.type;"query"===b?y(a):"update"===b&&z(a,this),a.request.headers={Accept:m,"Content-Type":"application/json","Content-Length":0}},parseSuccessfulLoadResponse:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s=this,t=s.parseResponseBodyAsJSON(a.body),u=e.conditions,v=x(u),w=v.hasHeader,y=c.pathToContent,z=y?f.getObjectProperty(t,y):t,A=this.getEntityMetadataCacheKey(e),B=[];if("Workbook"===A)if(z.value&&b.isArray(z.value))b.each(z.value,function(a,b){if(-1===b.name.split(".").slice(-1)[0].indexOf("xlsx"))delete z[a];else{var c=b.parentReference.path,d=c?c.split(":")[1]:b.parentReference.id;b.createdByUserName=f.getObjectProperty(b,"createdBy.user.displayName"),b.lastModifiedByUserName=f.getObjectProperty(b,"lastModifiedBy.user.displayName"),b.parentDirectory=d,b.oneUp=d.substring(0,d.lastIndexOf("/")),B.push(b)}}),d.data=z=B;else{var C=z.parentReference.path,D=C?C.split(":")[1]:z.parentReference.id;z.createdByUserName=f.getObjectProperty(z,"createdBy.user.displayName"),z.lastModifiedByUserName=f.getObjectProperty(z,"lastModifiedBy.user.displayName"),z.parentDirectory=D,z.oneUp=D.substring(0,D.lastIndexOf("/")),d.data=z=[z]}else d.isRangeEntity?(i=t.formulas,j=t.values,h=[],k=t.address.split("!"),l=k[1],"true"===w?(h=z[0],z.shift()):(g.sort(function(a,b){return a.column-b.column}),b.each(g,function(a,b){h.push(b.label)})),m=l.split(":"),n=[],o=[],p=0,r=0,b.each(m,function(a,b){o[a]=b.replace(/[^0-9]/,""),n[a]=b.replace(/[0-9]/g,"")}),b.each(j,function(a,c){var d="true"===w?i[a+1]:i[a],e={};0===r&&(q=parseInt(o[0],10)),"true"===w&&0===r&&(q+=1),p!==a&&(q+=1),b.each(c,function(a){e[h[a].replace(" ","")]=d[a]});var f=-1===l.indexOf(":")?n[0]+q:n[0]+q+":"+n[1]+q;B[a]={rowRange:f,formulas:e},b.each(c,function(b,c){B[a][h[b].replace(" ","")]=c}),p!=a&&(p=a),r=1}),z=B,d.data=z):d.data=z},parseSuccessfulSaveResponse:function(a,c){var d="string"==typeof a.body?JSON.parse(a.body):a.body,e=c.model,f=e.fields;if(e.isRangeEntity){var g=d.address.split("!"),h={formulas:{},rowRange:g[1]};f.sort(function(a,b){return a.column-b.column}),b.each(f,function(a,b){h[b.id]=d.values[0][a],h.formulas[b.id]=d.formulas[0][a]}),a.body=h}},getEntityList:function(){var a=b.Deferred(),d=this.prop("x-metadata");return a.resolve(c(d,function(a,b){return{value:b,label:a.label}})).promise()},queryEntityMetadata:function(a){var c=this,d=b.Deferred(),e=this.getEntityMetadataCacheKey(a),f=this.prop("x-metadata")[e],g=f.methods.query,h={url:g.url,method:g.verb,contentType:g.contentType,scopes:g.scopes,headers:{Accept:m}},i={type:"query",method:g,model:a,request:h},j=a.conditions,k=j?x(j,i):{},l=k.hasHeader;return f.isRangeEntity?"string"==typeof a?d.resolve(f):c.makeRequest(a,i).then(function(a){var e=c.parseResponseBodyAsJSON(a.body);if("true"===l)b.each(e.values[0],function(a,b){f.fields[a]={id:b.replace(" ",""),label:b,column:a,displaytype:"FORMULA",accessible:!0,createable:!1,editable:!0,"x-alwaysinclude":!0}});else{var g,h=e.values,i=e.address.split("!"),j=i[1],k=j.split(":"),m=[],n=[],o=0;b.each(k,function(a,b){n[a]=b.replace(/[^0-9]/,""),m[a]=b.replace(/[0-9]/g,"")}),b.each(h[0],function(a){g&&0!==o||(g=m[0]),f.fields[a]={id:"Column"+g,label:"Column "+g,column:a,displaytype:"FORMULA",accessible:!0,createable:!1,editable:!0,"x-alwaysinclude":!0},g=g.substring(0,g.length-1)+String.fromCharCode(g.charCodeAt(g.length-1)+1),o++})}return d.resolve(f)}):d.resolve(f)},getActions:function(a,b,c){var d=e(),f=this;return d.resolve(f.createActions(a,b,c)),d.promise()},createActions:function(c,d,f){function g(a,b){return a||b.getFirstRow().id}f=f||{};var h={label:"Number",id:"arg1",name:"number",type:"string",valueType:"number"},i={label:"Range",id:"arg1",name:"range",type:"string",valueType:"range"},j={label:"Workbook ID",id:"workbook",type:"text"},k=[{value:"abs",label:"ABS()",args:[h]},{value:"acos",label:"ACOS()",args:[h]},{value:"acosh",label:"ACOSH()",args:[h]},{value:"acot",label:"ACOT()",args:[h]},{value:"acoth",label:"ACOTH()",args:[h]},{value:"asin",label:"ASIN()",args:[h]},{value:"asinh",label:"ASINH()",args:[h]},{value:"atan",label:"ATAN()",args:[h]},{value:"atanh",label:"ATANH()",args:[h]},{value:"average",label:"AVERAGE()",args:[i]},{value:"cos",label:"COS()",args:[h]},{value:"cosh",label:"COSH()",args:[h]},{value:"cot",label:"COT()",args:[h]},{value:"coth",label:"COTH()",args:[h]},{value:"csc",label:"CSC()",args:[h]},{value:"csch",label:"CSCH()",args:[h]},{value:"max",label:"MAX()",args:[i]},{value:"median",label:"MEDIAN()",args:[i]},{value:"min",label:"MIN()",args:[i]},{value:"mode",label:"MODE()",args:[i]},{value:"pi",label:"PI()"},{value:"sin",label:"SIN()",args:[h]},{value:"sinh",label:"SINH()",args:[h]},{value:"sqrt",label:"SQRT()",args:[h]},{value:"sqrtpi",label:"SQRTPI()"},{value:"sum",label:"SUM()",args:[i]},{value:"round",label:"ROUND()",args:[h]},{value:"rounddown",label:"ROUNDDOWN()",args:[h]},{value:"roundup",label:"ROUNDUP()",args:[h]}];if(a.builder){var l=f.component,n=[j,{label:"Function Name",id:"function",type:"picklist",picklistEntries:k,onChange:function(a){n.splice(2),A(this,n,a),l.rebuildProps()}}],o=[j,{label:"Range",id:"range",name:"range",type:"string"},{label:"Has Headers",id:"headers",type:"boolean"}],p=[j,{label:"Worksheet Name or ID",id:"worksheet",type:"text"},{label:"Chart Type",id:"charttype",type:"picklist",picklistEntries:[{value:"ColumnClustered",label:"Clustered Column"},{value:"ColumnStacked",label:"Stacked Column"},{value:"ColumnStacked100",label:"100% Stacked Column"},{value:"Line",label:"Line"},{value:"LineStacked",label:"Stacked Line"},{value:"LineStacked100",label:"100% Stacked Line"},{value:"LineMarkers",label:"Line with Markers"},{value:"LineMarkersStacked",label:"Stacked Line with Markers"},{value:"LineMarkersStacked100",label:"100% Stacked Line with Markers"},{value:"PieOfPie",label:"Pie"},{value:"Doughnut",label:"Doughnut"},{value:"BarClustered",label:"Clustered Bar"},{value:"BarStacked",label:"Stacked Bar"},{value:"BarStacked100",label:"100% Stacked Bar"},{value:"Area",label:"Area"},{value:"AreaStacked",label:"Stacked Area"},{value:"AreaStacked100",label:"100% Stacked Area"},{value:"XYScatter",label:"Scatter with only Markers"},{value:"XYScatterSmooth",label:"Scatter with Smooth Lines and Markers"},{value:"XYScatterSmoothNoMarkers",label:"Scatter with Smooth Lines"},{value:"XYScatterLines",label:"Scatter with Straight Lines and Markers"},{value:"XYScatterLinesNoMarkers",label:"Scatter with Straight Lines"},{value:"Radar",label:"Radar"},{value:"RadarFilled",label:"Filled Radar"},{value:"RadarMarkers",label:"Radar with Markers"}]},{label:"Source Data",id:"sourcedata",type:"text"},{label:"Chart Series By",id:"seriesby",type:"picklist",defaultValue:"Auto",picklistEntries:[{value:"Auto",label:"Auto"},{value:"Columns",label:"Columns"},{value:"Rows",label:"Rows"}]}];A(n[1],n,d.attr("function"))}return{"function":{label:"Excel Function",builderProps:n||"",runnableFunction:function(c,d,f,h){var i=e(),j={},l=g(c.attr("workbook"),a.$M(c.attr("model")));return b.each(k,function(a,d){d.value===c.attr("function")&&d.args&&b.each(d.args,function(a,d){var e=c.attr(d.id);"number"===d.valueType?j[d.name]=e:"range"===d.valueType&&(j.values=[],-1!==e.indexOf(",")?b.each(e.split(","),function(a,b){b.match(/[a-z]/i)?j.values.push({address:b}):j.values.push(b)}):j.values.push({address:e}))})}),b.ajax({url:w+"/me/drive/items/"+l+"/workbook/functions/"+c.attr("function"),headers:{Authorization:"Bearer "+h.authentication.responseBody.access_token,"Content-Type":"application/json",Accept:"application/json"},method:"POST",dataType:"json",data:JSON.stringify(j),success:function(a){i.resolve({$Excel:a})},error:function(a){i.reject(a)}}),i.promise()}},"create-table":{label:"Create Excel Table",builderProps:o||"",runnableFunction:function(c,d,f,h){var i=e(),j={address:c.attr("range"),hasHeaders:"true"===c.attr("headers")},k=g(c.attr("workbook"),a.$M(c.attr("model")));return b.ajax({url:w+"/me/drive/items/"+k+"/workbook/tables/add",headers:{Authorization:"Bearer "+h.authentication.responseBody.access_token,"Content-Type":m,Accept:m},method:t,dataType:"json",data:JSON.stringify(j),success:function(a){i.resolve({$Excel:a})},error:function(a){i.reject(a)}}),i.promise()}},"create-chart":{label:"Create Chart",builderProps:p||"",runnableFunction:function(c,d,f,h){var i=e(),j={type:c.attr("charttype"),sourceData:c.attr("sourcedata"),seriesBy:c.attr("seriesby")},k=g(c.attr("workbook"),a.$M(c.attr("model")));return b.ajax({url:w+"/me/drive/items/"+k+"/workbook/worksheets('"+c.attr("worksheet")+"')/charts/add",headers:{Authorization:"Bearer "+h.authentication.responseBody.access_token,"Content-Type":m,Accept:m},method:t,dataType:"json",data:JSON.stringify(j),success:function(a){i.resolve({$Excel:a})},error:function(a){i.reject(a)}}),i.promise()}}}},runAction:function(a,c,d,e,f){var g=b.Deferred();return f.getActions(f).then(function(b){b[a]&&b[a].runnableFunction(c,d,e,f).then(function(a){g.resolve(a)},function(a){g.reject(a)})}),g.promise()},fieldRenderers:function(){return{FORMULA:{read:function(a,b){l.TEXT.read(a,b)},readonly:function(a,b){l.TEXT.readonly(a,b)},edit:function(a){l.TEXT.edit(a,a.row.formulas[a.id])}}}},extendedProperties:{composer:{unomittableFields:!0,hasEntityOptions:!0},validConditionTypes:["fieldvalue","multiple","param","boolean"],canFieldsBeIndividuallySearched:!0,canServerSearch:!0,"x-metadata":{Workbook:{idFields:["id"],nameField:"name",label:"Workbook",labelPlural:"Workbooks",fields:[{id:"id",label:"Id",displaytype:q,inlineHelpText:"Identifier of the drive.",accessible:!0,createable:!1,editable:!1,"x-alwaysinclude":!0},{id:"name",label:"Name",displaytype:q,inlineHelpText:"Name of the drive.",accessible:!0,createable:!1,editable:!0},{id:"createdByUserName",label:"Created By",displaytype:q,accessible:!0,createable:!1,editable:!1},{id:"createdDateTime",label:"Created Date Time",displaytype:n,accessible:!0,createable:!1,editable:!1},{id:"lastModifiedByUserName",label:"Last Modified By",displaytype:q,accessible:!0,createable:!1,editable:!1},{id:"lastModifiedDateTime",label:"Last Modified",displaytype:n,accessible:!0,createable:!1,editable:!1},{id:"webUrl",label:"Web Url",displaytype:q,accessible:!0,createable:!1,editable:!1},{id:"parentReference",label:"Parent Reference",displaytype:p,accessible:!1,createable:!1,editable:!1},{id:"size",label:"Size",displaytype:o,accessible:!0,createable:!1,editable:!1},{id:"parentDirectory",label:"Parent Directory",displaytype:q,accessible:!0,createable:!1,editable:!0},{id:"oneUp",label:"Directory Up",displaytype:q,accessible:!0,createable:!1,editable:!1}],methods:{query:{url:"",verb:s,contentType:m,pathToContent:""}},defaultConditions:[{sourcetype:"param",sourceparam:"parent",name:"parent",label:"Path to Folder or File",state:"filterableon",value:""}]},Worksheet:{idFields:["id"],nameField:"name",label:"Worksheet",labelPlural:"Worksheets",fields:[{id:"id",label:"Id",displaytype:q,inlineHelpText:"Identifier of the worksheet.",accessible:!0,createable:!1,editable:!1,"x-alwaysinclude":!0},{id:"name",label:"Name",displaytype:q,inlineHelpText:"Name of the worksheet.",accessible:!0,createable:!0,editable:!0,"x-alwaysinclude":!0},{id:"position",label:"Position",displaytype:o,inlineHelpText:"Position of the worksheet in the workbook.",accessible:!0,createable:!1,editable:!0,"x-alwaysinclude":!0},{id:"visibility",label:"Visibility",displaytype:q,inlineHelpText:"Whether the worksheet is visible.",accessible:!0,createable:!1,editable:!0,"x-alwaysinclude":!0}],methods:{query:{url:"/me/drive/items/{{file}}/workbook/worksheets",verb:s,contentType:m,pathToContent:"value"},insert:{url:"/me/drive/items/{{file}}/workbook/worksheets/add",verb:t,contentType:m,receiveDataAs:"recordinbody",successIf:"responsefieldequals",successField:"status",successValue:"Created"},update:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{id}}')",verb:u,contentType:m,receiveDataAs:"recordinbody",successIf:"responsefieldispresent"},"delete":{url:"/me/drive/items/{{file}}/workbook/worksheets('{{id}}')",verb:v,contentType:m,successIf:"responsefieldisempty"}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""}]},Range:{label:"Range",labelPlural:"Ranges",isRangeEntity:!0,fields:[],methods:{query:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/range(address='{{range}}')",verb:s,contentType:m,pathToContent:"values"},update:{url:"",verb:u,contentType:m,pathToContent:""}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"worksheet",name:"worksheet",label:"Worksheet Name or ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"range",name:"range",label:"Cell Range",state:"filterableon",type:"fieldvalue",value:""},{sourcetype:"param",sourceparam:"hasHeader",name:"hasHeader",label:"Has Headers",state:"fixed",type:"boolean",required:!0,value:!1}]},Table:{idFields:["id"],nameField:"name",label:"Table",labelPlural:"Tables",fields:[{id:"id",label:"Id",displaytype:q,inlineHelpText:"Identifier of the table.",accessible:!0,createable:!1,editable:!1,"x-alwaysinclude":!0},{id:"name",label:"Name",displaytype:q,inlineHelpText:"Name of the table.",accessible:!0,createable:!0,editable:!0},{id:"highlightFirstColumn",label:"Highlight First Column",displaytype:r,accessible:!0,createable:!0,editable:!0},{id:"highlightLastColumn",label:"Highlight Last Column",displaytype:r,accessible:!0,createable:!0,editable:!0},{id:"showBandedColumns",label:"Show Banded Columns",displaytype:r,accessible:!0,createable:!0,editable:!0},{id:"showBandedRows",label:"Show Banded Rows",accessible:!0,createable:!0,editable:!0},{id:"showFilterButton",label:"Show Filter Button",accessible:!0,createable:!0,editable:!0},{id:"showHeaders",label:"Show Headers",accessible:!0,createable:!0,editable:!0},{id:"showTotals",label:"Show Totals",accessible:!0,createable:!0,editable:!0},{id:"style",label:"Table Style",accessible:!0,createable:!0,editable:!0}],methods:{query:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/tables",verb:s,contentType:m,pathToContent:"value"},update:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/tables('{{id}}')",verb:u,contentType:m}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"worksheet",name:"worksheet",label:"Worksheet Name or ID",state:"filterableon",type:"fieldvalue",required:!0,value:""}]},TableRange:{label:"TableRange",labelPlural:"TableRanges",isRangeEntity:!0,fields:[],methods:{query:{url:"/me/drive/items/{{file}}/workbook/tables('{{table}}')/Range",verb:s,contentType:m,pathToContent:"values"},update:{url:"",verb:u,contentType:m,pathToContent:""}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"worksheet",name:"worksheet",label:"Worksheet Name or ID",state:"filterableon",type:"fieldvalue",value:""},{sourcetype:"param",sourceparam:"table",name:"table",label:"Table Name or ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"hasHeader",name:"hasHeader",label:"Has Headers",state:"fixed",type:"boolean",required:!0,value:!0}]},Chart:{idFields:["id"],nameField:"name",label:"Chart",labelPlural:"Charts",fields:[{id:"id",label:"Id",displaytype:q,inlineHelpText:"Identifier of the chart.",accessible:!0,createable:!1,editable:!1,"x-alwaysinclude":!0},{id:"name",label:"Name",displaytype:q,inlineHelpText:"Name of the chart.",accessible:!0,createable:!0,editable:!0},{id:"height",label:"Height",displaytype:o,accessible:!0,createable:!1,editable:!1},{id:"width",label:"Width",displaytype:o,accessible:!0,createable:!1,editable:!1},{id:"top",label:"Top",displaytype:o,accessible:!0,createable:!1,editable:!1},{id:"left",label:"Left",displaytype:o,accessible:!0,createable:!1,editable:!1}],methods:{query:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/charts",verb:s,contentType:m,pathToContent:"value"},update:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/charts('{{name}}')",verb:u,contentTYpe:m},"delete":{url:"/me/drive/items/{{file}}/workbook/charts('{{name}}')/delete",verb:t,contentType:m,successIf:"responsebodyisempty"}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"worksheet",name:"worksheet",label:"Worksheet Name or ID",state:"filterableon",type:"fieldvalue",value:""}]}}}})}(skuid);