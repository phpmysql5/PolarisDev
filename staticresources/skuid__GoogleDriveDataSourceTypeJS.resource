!function(a){var b=a.$,c=b.map,d=b.each,e=b.Deferred,f=a.utils,g=f.mergeAsTextInContext,h=a.dataSource,i=a.constants,j=i.DISPLAY_TYPES,k=i.HTTP_VERBS,l="https://www.googleapis.com/auth/drive",m=j.ARRAY,n=j.BOOLEAN,o=j.DATETIME,p=j.NUMBER,q=j.STRING,r=k.GET,s=k.POST,t=k.DELETE,u="Parent Folder",v={File:{displaytype:q,inlineHelpText:"This is always drive#user.",writeable:!1,filterable:!1}};h.getDataSourceType("GoogleDrive")||new h.core.RESTDataSourceTypeBase({name:"GoogleDrive",coerceRequest:function(a){var b,c,e,f,h,i=a.model,j=i.conditions,k={},l={},m="?q=trashed+%3D+false";"query"!==a.type&&"search"!==a.type||(d(j,function(a,b){k[b.sourceParam||b.name]=b}),d(k,function(b,c){c.value&&!c.inactive&&(l[b]=g(c.value,a))}),b=l[u],c=l.Title,e=l.Mimetype,f=l.__default_searchbox,h=l.search,b&&(m+=encodeURIComponent(" and '"+b+"' in parents")),c&&(m+=encodeURIComponent(" and title contains '"+c+"'")),e&&(-1!==e.indexOf("/")?m+=encodeURIComponent(" and mimeType = '"+e+"'"):m+=encodeURIComponent(" and mimeType contains '"+e+"'")),"search"===a.type&&(m+=encodeURIComponent(" and title contains '"+h+"'")),f&&(m+=encodeURIComponent(" and fullText contains '"+f+"'")),a.request.url="/files"+m.replace(/%20/g,"+"))},parseSuccessfulLoadResponse:function(a,c,d){var e=f.isString(a.body)?JSON.parse(a.body):a.body,g=c.pathToContent,h=g?f.getObjectProperty(e,g):e;d.data=h,b.isArray(h)&&b.each(h,function(a,b){b.downloadlink=b.webContentLink||b.embedLink,b.lastModifyingUserPicture=f.getObjectProperty(b,"lastModifyingUser.picture.url"),b.lastModifyingUserName=f.getObjectProperty(b,"lastModifyingUser.displayName"),b.lastModifyingUserEmail=f.getObjectProperty(b,"lastModifyingUser.email"),b.starred=f.getObjectProperty(b,"labels.starred"),b.haveViewed=f.getObjectProperty(b,"labels.viewed"),b.userPermissionRole=f.getObjectProperty(b,"userPermission.role")})},getEntityList:function(){var a=b.Deferred(),d=this.prop("x-metadata");return a.resolve(c(d,function(a,b){return{value:b,label:a.label}})).promise()},getUploadMethods:function(){function b(b,c,e,h,i){var j=e.model,k=f.renameFileWhileKeepingExtension(b.name,g(e.filename,e)),l=c.options.xmlDef,m=j?j.getDataSource():a.dataSource.get(l.attr("datasource")),n="-------314159265358979323846",o=new FileReader;o.readAsBinaryString(b),o.onload=function(){var a,c=b.type||"application/octet-stream",f={title:k,mimeType:c};j?d(j.conditions,function(b,c){if(c.sourceParam===u&&c.value)return a=g(c.value,{model:j}),-1}):a=g(l.attr("folder"),e),a&&(f.parents=[{id:a}]);var p=btoa(o.result),q="\r\n--"+n+"\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(f)+"\r\n--"+n+"\r\nContent-Type: "+c+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+p+"\r\n--"+n+"--",r={path:"/upload/drive/v2/files",method:s,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+n+'"'},body:q},t=new XMLHttpRequest,v=!1;t.open("POST","https://www.googleapis.com/upload/drive/v2/files?uploadType=multipart",!0),h({fileName:b.name}),t.onreadystatechange=function(a){a&&(!v&&a.target.response&&200===a.target.status?(v=!0,i()):a.target.status>=400&&i({message:"Had an Error!"}))},t.setRequestHeader("Authorization","Bearer "+m.authentication.responseBody.access_token),t.setRequestHeader("Content-Type",r.headers["Content-Type"]),t.send(r.body)}}return{"Direct Upload":{label:"Direct Upload",canRunPostUploadSnippet:!0,upload:b,needsModelInContext:!0,hasDescription:!1,builderProps:function(a,b){var c=[];return b.attr("model")||c.push({id:"folder",type:"template",label:"Parent Folder ID",helptext:"The ID of the folder you want this file to be placed within",location:"attribute",displayAs:"input"}),c}}}},queryEntityMetadata:function(a){var c=this.getEntityMetadataCacheKey(a),f=this.prop("x-metadata")[c],g=e();return f?(d(f.fields,function(a,d){d=f.fields[a]=b.extend({},v[c],d),d.createable=d.writeable,d.editable=d.writeable}),g.resolve(f)):g.reject()},getConditionSourceProperties:function(b,c){var d=a.builder.core,e=b.state;return[{label:"Query Parameter",deleteable:!1,linkedComponent:b,summaryFunction:function(a){return d.conditionDescriptionRenderers.parameter(a)},propsFunction:function(a){return[{id:"sourceparam",label:"Query Parameter Name",onChange:function(d,f){"param"!==e.attr("sourcetype")&&(e.attr("sourcetype","param"),e.attr("sourceparam",f),b.save()),b.refresh(),c.handleChange&&c.handleChange(a)()},type:"picklist",picklistEntries:[{value:"Title",label:"Title"},{value:u,label:u},{value:"Mimetype",label:"Mimetype"}]}]}}]},getActions:function(a,b){var c=e(),d=this;return c.resolve(d.createActions(a,b)),c.promise()},createActions:function(b){function c(b,c,g,h,i){var j,k=new XMLHttpRequest,l=a.$M(b.attr("model")),m="root",n=f.mergeAsTextInContext(b.attr("foldername"),g),o=e();return d(l.conditions,function(a,b){b.sourceParam===u&&(m=f.mergeAsTextInContext(b.value,g)||m)}),j={parents:[{id:m}],title:n,mimeType:i},k.open("POST","https://www.googleapis.com/drive/v2/files",!0),k.setRequestHeader("Authorization","Bearer "+h.authentication.responseBody.access_token),k.setRequestHeader("Content-Type","application/json"),k.send(JSON.stringify(j)),k.onreadystatechange=function(a){a&&(a.target.response&&200===a.target.status?o.resolve(a):a.target.status>=400&&o.reject(a))},o.promise()}return{"create-file":{label:"Create New",builderProps:[{label:"Model with Parent Folder Condition",id:"model",type:"model",helptext:"Will take the value in this model's parent folder condition, and use it as the parent folder for the new folder",entryFilter:f.filterByDataSourceAndEntity(b.name,"File")},{label:"Name",id:"foldername",type:"string"},{label:"Type",id:"mimetype",type:"picklist",picklistEntries:[{value:"-",label:"New Folder",disabled:!0},{label:"Folder",value:"application/vnd.google-apps.folder",defaultValue:!0},{value:"-",label:"",disabled:!0},{value:"-",label:"Standard Files",disabled:!0},{label:"Document",value:"application/vnd.google-apps.document",defaultValue:!0},{label:"Spreadsheet",value:"application/vnd.google-apps.spreadsheet",defaultValue:!1},{label:"Slides",value:"application/vnd.google-apps.presentation",defaultValue:!1},{value:"-",label:"",disabled:!0},{value:"-",label:"Extra",disabled:!0},{label:"Form",value:"application/vnd.google-apps.form",defaultValue:!1},{label:"Drawing",value:"application/vnd.google-apps.drawing",defaultValue:!1}]}],runnableFunction:function(a,b,d,e){return c(a,b,d,e,a.attr("mimetype"))}}}},runAction:function(a,b,c,d,f){var g=e();return f.getActions(f).then(function(e){e[a]&&e[a].runnableFunction(b,c,d,f).then(function(a){g.resolve(a)},function(a){g.reject(a)})}),g.promise()},extendedProperties:{composer:{unomittableFields:!0,hasEntityOptions:!0},hasDefaultSearch:!0,canServerSearch:!0,hasGlobalSearchEntities:!0,"x-metadata":{File:{idFields:["id"],nameField:"title",label:"File",labelPlural:"Files",fields:[{id:"id",label:"Id",inlineHelpText:"The ID of the file.","x-alwaysinclude":!0},{id:"etag",label:"Etag",inlineHelpText:"ETag of the file."},{id:"title",label:"Title",inlineHelpText:"The title of the file. Used to identify file or folder name."},{id:"mimeType",label:"Mime Type",inlineHelpText:"The MIME type of the file. This is only mutable on update when uploading new content. This field can be left blank, and the mimetype will be determined from the uploaded content's MIME type."},{id:"downloadlink",label:"Download/Preview Link",inlineHelpText:"For google native file types, will link to the file in google drive, otherwise the link will be a download link."},{id:"description",label:"Description",inlineHelpText:"A short description of the file."},{id:"createdDate",label:"Created Date",displaytype:o,inlineHelpText:"Create time for this file (formatted RFC 3339 timestamp)."},{id:"modifiedDate",label:"Modified Date",displaytype:o,inlineHelpText:"Last time this file was modified by anyone (formatted RFC 3339 timestamp). This is only mutable on update when the setModifiedDate parameter is set."},{id:"modifiedByMeDate",label:"Modified By Me Date",displaytype:o,inlineHelpText:"Last time this file was modified by the user (formatted RFC 3339 timestamp). Note that setting modifiedDate will also update the modifiedByMe date for the user which set the date."},{id:"fileExtension",label:"File Extension",inlineHelpText:"The final component of fullFileExtension with trailing text that does not appear to be part of the extension removed. This field is only populated for files with content stored in Drive; it is not populated for Google Docs or shortcut files."},{id:"md5Checksum",label:"Md5 Checksum",inlineHelpText:"An MD5 checksum for the content of this file. This field is only populated for files with content stored in Drive; it is not populated for Google Docs or shortcut files."},{id:"fileSize",label:"File Size",displaytype:p,inlineHelpText:"The size of the file in bytes. This field is only populated for files with content stored in Drive; it is not populated for Google Docs or shortcut files."},{id:"sharedWithMeDate",label:"Shared With Me Date",displaytype:o,inlineHelpText:"Time at which this file was shared with the user (formatted RFC 3339 timestamp)."},{id:"originalFilename",label:"Original Filename",inlineHelpText:"The original filename of the uploaded content if available, or else the original value of the title field. This is only available for files with binary content in Drive."},{id:"ownerNames",label:"Owner Names",displaytype:m,inlineHelpText:"Name(s) of the owner(s) of this file."},{id:"lastModifyingUserName",label:"Last Modifying User Name",inlineHelpText:"Name of the last user to modify this file."},{id:"editable",label:"Editable",displaytype:n,inlineHelpText:"Whether the file can be edited by the current user."},{id:"writersCanShare",label:"Writers Can Share",displaytype:n,inlineHelpText:"Whether writers can share the document with other users."},{id:"thumbnailLink",label:"Thumbnail Link",inlineHelpText:"A short-lived link to the file's thumbnail. Typically lasts on the order of hours."},{id:"lastViewedByMeDate",label:"Last Viewed By Me Date",displaytype:o,inlineHelpText:"Last time this file was viewed by the user (formatted RFC 3339 timestamp)."},{id:"webViewLink",label:"Web View Link",inlineHelpText:"A link only available on public folders for viewing their static web assets (HTML, CSS, JS, etc) via Google Drive's Website Hosting."},{id:"iconLink",label:"Icon Link",inlineHelpText:"A link to the file's icon."},{id:"shared",label:"Shared",displaytype:n,inlineHelpText:"Whether the file has been shared."},{id:"lastModifyingUserName",label:"Last Modifying User Name",inlineHelpText:"A plain text displayable name for this user."},{id:"lastModifyingUserPicture",label:"Last Modifying User  Picture URL",inlineHelpText:"A URL that points to a profile picture of this user."},{id:"copyable",label:"Copyable",displaytype:n,inlineHelpText:"Whether the file can be copied by the current user."},{id:"properties",label:"Properties",displaytype:m,inlineHelpText:"The list of properties."},{id:"lastModifyingUserEmail",label:"Last Modifying User Email Address",inlineHelpText:"The email address of the user. This field is returned only if the last modifying user is an owner of the file, the requesting user is an owner or can modify the file, or if the last modifying user's email address is visible."},{id:"markedViewedByMeDate",label:"Marked Viewed By Me Date",displaytype:o,inlineHelpText:"Deprecated."},{id:"version",label:"Version",displaytype:p,inlineHelpText:"A monotonically increasing version number for the file. This reflects every change made to the file on the server, even those not visible to the requesting user."},{id:"folderColorRgb",label:"Folder Color Rgb",inlineHelpText:"Folder color as an RGB hex string if the file is a folder. The list of supported colors is available in the folderColorPalette field of the About resource. If an unsupported color is specified, it will be changed to the closest color in the palette."},{id:"fullFileExtension",label:"Full File Extension",inlineHelpText:'The full file extension; extracted from the title. May contain multiple concatenated extensions, such as "tar.gz". Removing an extension from the title does not clear this field; however, changing the extension on the title does update this field. This field is only populated for files with content stored in Drive; it is not populated for Google Docs or shortcut files.'},{id:"starred",label:"Starred",inlineHelpText:"Whether or not the file has been starred."},{id:"haveViewed",label:"Have Viewed",inlineHelpText:"Whether or not the current user has viewed the file."},{id:"userPermissionRole",label:"Permission Role",inlineHelpText:"The current user's permission role for the file."},{id:"ownedByMe",label:"Owned By Me",displaytype:n,inlineHelpText:"Whether the file is owned by the current user."},{id:"canComment",label:"Can Comment",displaytype:n,inlineHelpText:"Whether the current user can comment on the file."},{id:"shareable",label:"Shareable",displaytype:n,inlineHelpText:"Whether the file's sharing settings can be modified by the current user."},{id:"spaces",label:"Spaces",displaytype:m,inlineHelpText:"The list of spaces which contain the file. Supported values are 'drive', 'appDataFolder' and 'photos'."},{id:"canReadRevisions",label:"Can Read Revisions",displaytype:n,inlineHelpText:"Whether the current user has read access to the Revisions resource of the file."}],methods:{query:{pathToContent:"items",url:"/files",verb:r,scopes:[l],contentType:"application/json"},"delete":{url:"/files/{{id}}",verb:t,scopes:[l],successIf:"requestsucceeds"},search:{url:"/files",verb:r,scopes:[l],contentType:"application/json",pathToContent:"items"}},defaultConditions:[{sourcetype:"param",sourceparam:u,name:u,label:u,state:"filterableon",value:"root"},{sourcetype:"param",sourceparam:"Title",name:"title",label:"Title",state:"filterableon",value:""},{sourcetype:"param",sourceparam:"Mimetype",name:"mimetype",label:"Mimetype",state:"filterableon",value:""}]}}}})}(skuid);