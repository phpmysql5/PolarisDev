!function(a){var b=a.$,c=a.utils,d=c.startsWith,e=c.endsWith,f=c.contains,g=c.isString,h=c.getObjectProperty,i=c.hasObjectProperty,j=c.makeXMLDoc,k=window.encodeURIComponent,l=function(){return a.builder?a.builder.core:null},m=function(a){var b=[];return g(a)?b.push(a):(a.error&&b.push(a.error),a.message&&b.push(a.message)),b.join(": ")},n=function(a,c){c=c||{};var d,e=a.body,h=!1===c.showStatus?null:a.status;if("OK"===h&&(h=""),e){if(g(e))try{e=JSON.parse(e)}catch(l){}if(b.isPlainObject(e))d=m(e.errors&&b.isArray(e.errors)&&e.errors.length?e.errors[0]:e);else if(b.isArray(e)&&e.length)d=m(e[0]);else if(e&&f(e,"/html")){var i,j=e.toLowerCase().indexOf("<body"),k=e.toLowerCase().indexOf("</body>",j);i=b(j&&k?e.substring(j,k+7):e),d=b.trim(i.text()||"")}else d=e}return h&&d?h+": "+d:d},o=c.combineUrls,p=function(b,c){var d=a.builder.core;return"propsonly"===c.renderMode?d.getConditionParameterProperties(b,{url:c.url}):[{label:"URL Merge Parameter",deleteable:!1,linkedComponent:b,summaryFunction:function(a){return d.conditionDescriptionRenderers.parameter(a)},propsFunction:function(a){return d.getConditionParameterProperties(b,{handleChange:c.handleChange(a),handleRefresh:c.handleRefresh(a)})}}]},q=function(a){var c,d;return c=a&&a.fields?a:a&&a.model?a.model:{},c.nameField?c.nameField:(d=r(c),b.isArray(d)?d[0]:d)},r=function(a){var b=a?a.idFields:null;return b&&b.length?b.length>1?b:b[0]:"id"},s=function(a,b){return b.getFieldValue(a,q(b),!0)},t=function(a,c){var d=r(c);return b.isArray(d)&&d.length>1?c.getFieldValues(a,d,!0).join(","):c.getFieldValue(a,d,!0)},u=function(a,c){var d,e=c.methods;return e&&e.length&&b.each(e,function(b,c){if(c.type===a)return d=c,!1}),d},v=function(a,b){var c=u(a,b);return c||{type:a,verb:b.verb,endpoint:b.endpoint}},w=function(a,b){return!!u(a,b)},x=function(a){if(a)try{a=JSON.parse(a)}catch(b){}return a},y=function(a,c,d){var e=b.Deferred();return function(a,c,d){d=d||{},c||(c={method:a.verb,dataType:a.dataType,url:a.serviceUrl,type:"query",scopes:a.scopes});var e=a.getDataSource(),f=e.serviceUrl||"",g=c.url||"",h=d.dfd;e.authenticate(a,c).done(function(){var i,j={},l=!1;!d.isSample&&a.conditions&&b.each(a.conditions,function(b,c){if(!1===c.inactive&&c.sourceParam){var d,e=a.getConditionValueResult(c),f=e.status;if(f){if("deactivate"===f)return!0;if("noquery"===f)return l=!0,h.reject("Could not perform this query because no value could be found for merge variable  '"+c.sourceParam+"'"),!1}else d=e.value,j[c.sourceParam]=d?k(d):d}}),l||(i=b.extend({},c,{apiExtensions:j,url:o(f,g),method:c.method||"GET",contentType:c.dataType||"application/json"}),c.data&&(i.body=c.data),i=e.createHTTPRequest(i),a.soql=a.debug=i.url,e.makeRequest(i).done(function(a){var c,d=i.method,e=a.statusCode;"POST"===d?201!==e&&200!==e&&(c=n(a)):-1!==b.inArray(d,["PUT","PATCH","DELETE"])?204!==e&&200!==e&&(c=n(a)):200!==e&&(c=n(a)),c?h.reject(c):h.resolve(a)}).fail(function(a){var b=a.statusCode,c=a.error;404===b?(c=n(a))||(c='The requested resource for data source "'+e.name+'" could not be found:\n\n'+g):401===b&&(c=n(a)),c||(c=n(a,{showStatus:!1})),b>=400&&b<500&&c?h.reject(c):h.reject('Request to data source "'+e.name+'" failed'+(c?": "+c:a.status))}))}).fail(function(a){h.reject('Unable to authenticate to data source "'+e.name+'": '+a)}),h.promise()}(a,c,b.extend(d,{dfd:e})),e.promise()},z=function(a,b,c,d){return o(a,b)+"__"+c+(d?"__"+d:"")},A=function(a){var b=c.getDisplayTypeOfEntity(a);return"INTEGER"===b?"DOUBLE":b},B=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},C=function(a){return c.getUnescapedParts(a).map(function(a){return B(a)}).join(" ")},D=function(a,b){var d,e=A(b),f=c.escapeFieldName(a),g={id:f,label:C(a),isPolymorphic:!1,isNamePointing:!1,displaytype:e};if("ARRAY"===e){var h=null;b.length&&(h=A(b[0])),g.rel=f,g.ref=f,g.referenceTo=[{objectName:f,displaytype:h,label:a,relationshipName:f}]}else if("OBJECT"===e)g.rel=f,g.ref=f,g.referenceTo=[{objectName:f,label:a,relationshipName:f}];else if("DOUBLE"===e)if(d=""+b,b%1==0)g.precision=d.length,g.scale=0;else{var i=d.split(".");g.precision=i[0].length,g.scale=2===i.length?i[1].length:0}return g},E={},F=function(d,e){e||(e={});var f,g,h,i,j,k=b.Deferred(),m=K(d),n=d.dataSource,p=d.scopes;if(m&&(f=m.endpoint||m.serviceUrl,g=m.verb,h=m.dataType,p=m.scopes,i=m.pathToContent),!f||!g||!n)return k.reject("Cannot retrieve metadata for Model without a valid Data Source, Service Url, and Request Method.").promise();if(m&&"query"!==m.type){if(d&&d.fields&&d.fields.length){var q={};return b.map(d.fields,function(a){var b,c=a.displaytype;b="BOOLEAN"===c||("DATE"===c||"DATETIME"===c?new Date:"DOUBLE"===c||"NUMBER"===c||"PERCENT"===c?2.2:"INTEGER"===c?2:"PHONE"===c?"(800) 222-3333":"EMAIL"===c?"j@g.co":"ARRAY"===c?[]:"OBJECT"===c?{}:"a"),q[a.id]=b}),k.resolve(q).promise()}return k.reject('Unable to retrieve metadata for this Model. If a query method cannot be defined for this Model (i.e. if its purpose is purely for creating/modifying/deleting records, then please click "Add Field" to manually add the fields that you would like to use.').promise()}if(j=z(n.serviceUrl,f,g,i),E[j])return E[j];var r,s,t=a.utils.extractFieldsFromTemplate(f,{ignoreFunctions:!0}),u={},v={},w={},A=e.performingSearch,B=function(a,c){var d=a.split("."),e=w;b.each(d,function(a,b){a===d.length-1?e[b]=c:(e[b]||(e[b]={}),e=e[b])})},C=function(a){var c=b.Deferred(),e=y(d,{url:a,verb:g,dataType:h,type:"query",scopes:p},{isSample:!0});return E[j]=k.promise(),e.done(function(a){c.resolve(x(a.body))}).fail(function(a){c.reject(a)}).always(function(){delete E[j]}),c.promise()},D=function(e,g){var h,i,j,l,m,n,o,p,q,s=c.generateUniqueId(),t=[],u={};b.each(e,function(a,b){var c={};c.uiOnly=!0,c.id=b.key,c.label=a,c.displaytype="TEXT",c.createable=c.editable=c.accessible=!0,t.push(c),"undefined"!=typeof b.data&&(u[c.id]=b.data)}),i=new a.model.Model({id:s,accessible:!0,createable:!0,fields:t,doClone:!1,dataSourceName:"Ui-Only"}),i.initialize().register(),j=i.createRow(),c.size(u)&&i.updateRow(j,u),h=b.map(t,function(b){return new a.ui.Field(j,i,null,{fieldId:b.id,mode:"edit"})}),l=b('<div title="Please provide sample values for Merge Variables needed for this Model Data Source" class="nx-editor"/>'),m=new a.ui.Editor(l,{showSaveCancel:!1});var v=f;b.each(t,function(a,b){v=v.replace(b.label,"<b>"+b.label+"</b>")}),m.header.append(b('<div class="nx-editor-header-title">').html("<b>Model: </b>"+d.id+"<br/><b>Service URL:</b> "+v).css({color:"black","font-size":"1.2em","font-weight":"400","word-break":"break-all"})),l.append(a.ui.createFieldSet(h,{editor:m})),g&&g.error&&m.handleMessages([{severity:"ERROR",message:g.error}]),n=function(){k.reject("All parameters for Model URL not provided --- unable to retrieve metadata for Model"),l.dialog("destroy").remove(),i.unregister()},o=function(){var a={};b.each(t,function(b,c){var d=c.label,e=c.id,f=i.getFieldValue(j,e,!0);B(d,f),a[d]=f}),r.updateSettings(a),b.blockUI({message:"Retrieving metadata from REST Data Source..."}),C(c.mergeAsText("global",f,{apiExtensions:w})).done(function(a){k.resolve(a),b.unblockUI(),n()}).fail(function(a){b.blockUI({message:a,timeout:5e3})})},p=[{text:"Retrieve metadata",icons:{primary:"ui-icon-check"},click:o},{text:"Cancel",icons:{primary:"ui-icon-close"},click:n}],q=function(){b(this).click().find(":input").first().focus()},l.dialog({resizable:!0,modal:!0,width:"50%",open:q,close:function(){n()},buttons:p}),b.unblockUI()};return t&&t.length?(a.builder&&!A&&(r=l().createModelSettingsService(d.id)),s=r?r.getSettings():{},b.each(t,function(a,b){var c,d="var"+a;!0!==e.ignoreCache&&(c=s[b]),v[b]={key:d,data:c},void 0!==c?B(b,c):u[b]={key:"var"+a}}),c.size(u)&&!A?D(u):C(c.mergeAsText("global",f,{apiExtensions:w})).done(function(a){k.resolve(a)}).fail(function(a){D(v,{error:"Unable to retrieve metadata for Model: "+a+". Please check that sample parameters for the Model URL are valid, and then re-request metadata."})})):C(f).done(function(a){k.resolve(a)}).fail(function(a){k.reject('Error connecting to REST Data Source at URL "'+o(n.serviceUrl,f)+'": '+a)}),k.promise()},G=function(a){var b=a.crumb,c=a.dataSource,d=a.modelXML;if(0===a.index){var e=d.attr("verb");b.rel=b.ref=c.name+(e?": "+e:"")}return b},H=function(a){var d,f,g=a.entity,i=a.result,j=g.path,k=[],l=[],m={fields:k,childRelationships:l,methods:g.methods,endpoint:g.serviceUrl},n=!0,o=g.pathToContent;return b.isPlainObject(i)&&c.size(i)>=1&&(b.each(i,function(a,c){if(!b.isPlainObject(c))return n=!1,!1;d||(d=c)}),n&&(i=d)),o&&(i=h(i,o)),j&&(e(j,".")||e(j,":"))&&(j=j.substring(0,j.length-1)),f=j?h(i,j):i,b.isArray(f)&&f.length&&(f=f[0]),f&&b.each(Object.keys(f),function(a,b){var c=f[b],d=D(b,c);k.push(d)}),N(m),m},I=function(c){var d=c.model,e=new a.model.Model(d);return c.ignorePathToContent&&delete e.pathToContent,b.extend(e,{path:c.path||""}),e},J=function(){return"Loading sample body for REST Data Source..."},K=function(a){var b,c;return"readwrite"===a.type&&(c=a.methods.filter(function(a){return"query"===a.type}),b=c.length?c[0]:!(!a.methods||!a.methods.length)&&a.methods[0]),b||(b={endpoint:a.serviceUrl||a.endpoint,verb:a.verb,scopes:a.scopes,pathToContent:a.pathToContent,type:"query"}),b},L=function(a){var b=K(a);return z(a.dataSource.serviceUrl,b.endpoint||b.serviceUrl,b.verb,c.combineStrings(b.pathToContent,a.path,"."))},M=function(a){a||(a={});var c=b.Deferred(),d=a.entities,e=a.dataSource,f=[],g=[],h={};return b.each(d,function(b,c){e&&!c.dataSource&&(c.dataSource=e);var d=F(c,{ignoreCache:a.ignoreCache,performingSearch:a.performingSearch});d.done(function(a){h[b]=a}),g.push(d)}),b.when.all(g).done(function(){b.each(d,function(a){f.push(h[a])}),c.resolve(f)}).fail(function(a){c.reject(a)}),c.promise()},N=function(c){c.fields||(c.fields=[]);var d=w("query",c)||"GET"===c.verb,e=w("insert",c)||"POST"===c.verb,f=w("update",c)||"PATCH"===c.verb||"PUT"===c.verb,g=w("delete",c)||"DELETE"===c.verb;b.each(c.fields,function(b,c){c.accessible=!0,c.uiOnly||(c.createable&&!e&&(c.createable=!1),c.editable&&!f&&(c.editable=!1)),c.displaytype||(c.displaytype=a.constants.DISPLAY_TYPES.TEXT),!1!==c.filterable&&(c.filterable=!0)}),c.accessible=!0,c.createable=e,c.updateable=f,c.deleteable=g,c.queryable=c.filterable=d},O=function(c,d){var e=b.Deferred(),f=[];return b.each(c,function(c,e){var g,i=b.Deferred(),j=K(e);if(f.push(i.promise()),!j||"query"!==j.type)return i.resolve({data:[],lastLoadTime:(new Date).getTime()}),!0;g={url:j.endpoint||j.serviceUrl,verb:j.verb,dataType:j.dataType,scopes:j.scopes,type:j.type},y(e,g).done(function(c){var f,j=x(c.body),k={};if(j&&e.pathToContent?f=h(j,e.pathToContent):j&&(f=j),f)if(b.isPlainObject(f)){var l=!0,m=[],n=[];b.each(f,function(a,c){if(!b.isPlainObject(c))return l=!1,!1;m.push(c),n.push([e,c,a])}),l?(f=m,n.forEach(function(b){new a.model.Record(b[0],b[1],b[2])})):f=[f]}else b.isArray(f)||(f=[f]);d.performingSearch?i.resolve({request:{dataSource:e.dataSource},results:[{label:e.label,objectName:e.objectName,objectMapKey:e.objectMapKey,modelName:e.id,records:f}]}):(k.lastLoadTime=(new Date).getTime(),k.data=f,k.debug=e.debug,k.soql=g.url,i.resolve(k))}).fail(function(a){i.reject(a)})}),b.when.all(f).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},P=function(d){function e(b,d,e){var f=b.sendChanges||"asjsoninbody";"asjsoninbody"===f?d.data=e:"asnestedjsoninbody"===f?(d.data={},c.setObjectProperty(d.data,b.pathToContent,e)):"custompayloadinbody"===f&&(d.data=a.snippet.get(b.payloadSnippet)({changes:e,model:d.context.model}),d.dataType=b.contentType)}function j(d,e,g){var h="autoprefix"===d.changeMapping,i={},j=d.sendChanges||"asjsoninbody";b.each(g,function(a,b){i[(h?d.changeMappingPrefix:"")+a]=b}),"asjsoninbody"===j?e.data=i:"asnestedjsoninbody"===j?(e.data={},c.setObjectProperty(e.data,d.pathToContent,i)):"custompayloadinbody"===j?(e.data=a.snippet.get(d.payloadSnippet)({changes:i,model:e.context.model}),e.dataType=d.contentType):"asformdatainbody"===j?(e.dataType="application/x-www-form-urlencoded",e.data=b.map(i,function(a,b){return k(b)+"="+k(a)}).join("&")):"inheaderperfield"===j?e.headers=i:"inqueryparamperfield"===j&&(e.url+=f(e.url,"?")?"&":"?",e.url+=b.map(i,function(a,b){return k(b)+"="+k(a)}).join("&"))}var l=b.Deferred();return b.each(d.operations,function(d,f){var k=a.$M(f.id),m=[],o=v("insert",k),p=v("update",k),q=v("delete",k),r=function(a,b,c){var d,e={key:a,item:b};return c.isBatch||(d={url:c.endpoint,method:c.verb,context:{model:k,row:k.getRowById(a)},scopes:c.scopes},e.httpRequest=d,e.request={type:c.type,originalRecordId:a,originalRecord:k.getRecordById(a).get(),request:d,method:c}),e},s=b.map(f.deletes,function(a,b){return r(b,a,q)}),u=b.map(f.updates,function(a,b){return r(b,a,p)}),w=b.map(f.inserts,function(a,b){return r(b,a,o)});[{entries:s,method:q,type:"delete"},{entries:u,method:p,type:"update"},{entries:w,method:o,type:"insert"}].forEach(function(a){var c=a.entries,d=a.method;if(c.length)if(d.isBatch){var f={type:a.type,originalRecordIds:b.map(c,function(a){return a.key}),request:{url:d.endpoint,method:d.verb,context:{model:k},scopes:d.scopes},method:d},g={};b.each(c,function(a,b){g[b.key]=b.item}),e(d,f.request,g),m.push(f)}else c.forEach(function(b){"delete"!==a.type&&j(d,b.httpRequest,b.item),m.push(b.request)})});var z,A=[],B=[],C=[],D=[],E=[],F=function(a){var d,e,j=a.request,l=j.type,m=j.method,o=a.response,p=o?o.body:null,q=o?o.headers:null,r=a.error,s=[],u=[],v={errors:s,messages:u,source:f.id},w=a.isSuccess,y=m.successIf,A=m.successField,F=m.successValue,G="insert"===l;if(p&&g(p)&&(p=x(p)),w&&("responsefieldispresent"===y?w=i(p,A):"responsefieldistrue"===y?w=!0===h(p,A,!0):"responsefieldequals"===y?w=h(p,A,!0)==F:"responseheaderispresent"===y?w=i(q,A,!0):"responseheaderequals"===y?w=h(q,A)==F:"responsebodyequals"===y&&(w=p===F)),v.success=w,w||(z=!0,r?s.push({message:r,severity:"ERROR"}):(d=n(o))&&s.push({message:d,severity:"ERROR"})),m.isBatch)e="delete"===l?B:G?C:D,b.each(j.originalRecordIds,function(a,b){var c={success:v.success,errors:[],messages:[],source:f.id};G?c.oldId=b:!G&&b&&(c.id=b),e.push(c)}),s.length&&Array.prototype.push.apply(E,s);else if(G){if(v.oldId=j.originalRecordId,w){var H,I=m.insertResponse||"recordinbody",J=m.createdRecordIdLocation,K={},L=j.originalRecord;b.extend(K,L),"recordinbody"===I?(b.extend(K,p),H=t(K,k)):"idinbodyfield"===I?H=h(p,J):"idinheader"===I&&(H=h(q,J)),c.isUndefined(H)||(v.id=H),v.record=K}C.push(v)}else"update"===l?(v.id=j.originalRecordId,D.push(v)):"delete"===l&&(v.id=j.originalRecordId,B.push(v))};b.each(m,function(a,b){var c=y(k,b.request);c.done(function(a){F({request:b,response:a,isSuccess:!0})}).fail(function(a){F({request:b,error:a,isSuccess:!1})}),A.push(c)}),b.when.all(A).always(function(){l.resolve({deleteResults:B,globalErrors:E,insertResults:C,totalsuccess:!z,updateResults:D})})}),l.promise()},Q=function(a){return{conditions:[{name:"param",sourceType:"param",sourceParam:"param",value:a.attr("param"),operator:"=",encloseValueInQuotes:!1,inactive:!1},{name:"fieldsParam",sourceType:"param",sourceParam:"fieldsParam",value:a.attr("fieldsParam"),operator:"=",encloseValueInQuotes:!1,inactive:!1}],properties:[{id:"param",label:"Search Parameter",type:"text"},{id:"fieldsParam",label:"Fields Parameter",type:"text"}]}},R=function(c,d,e){var f=this,g=c.returning.map(function(a,g){var h,i=!1,j=!1,k=d&&d[g],l=e[a.modelName],m=l.fields,n="";return b.each(m,function(a,b){var c="object"==typeof b?b.id:b;n+=c+","}),n=n.substring(0,n.length-1),h=-1===a.objectName.indexOf("?")?a.objectName+"?{{param}}={{search}}{{#fieldsParam}}&{{fieldsParam}}={{fields}}{{/fieldsParam}}":a.objectName+"&{{param}}={{search}}{{#fieldsParam}}&{{fieldsParam}}={{fields}}{{/fieldsParam}}",l.type="readwrite",l.methods=[{serviceUrl:h,verb:"GET",scopes:[],type:"query",dataType:"application/json"}],b.each(l.conditions,function(a,b){"__global_search"===b.name?(i=!0,b.value!==c.query&&(b.value=c.query)):"__fields"===b.name&&(j=!0,b.value!==n&&(b.value=n))}),i||l.addCondition({name:"__global_search",sourceType:"param",sourceParam:"search",value:c.query,operator:"=",encloseValueInQuotes:!1,inactive:!1}),j||l.addCondition({name:"__fields",sourceType:"param",sourceParam:"fields",value:n,operator:"=",encloseValueInQuotes:!1,inactive:!1}),f.searchProperties&&k&&b.each(f.searchProperties(k).conditions,function(a,b){l.addCondition(b)}),l});return f.load(g,{dataSource:a.dataSource.getDataSource(c.dataSourceName),loadAllMetadata:!0,performingSearch:!0,ignoreCache:!0}).then(function(a){return a})},S=function(){return{getOverrideSearchProperties:function(){return[{type:"helptext",html:"Specify a route to search for related records. Your URL must include a {{search}} merge as a placeholder for a string containing the user's entered search text."},{id:"searchroute",type:"string",placeholder:"e.g. /api/users?query={{search}}",label:"Search Route"}]},getOverrideBatchProperties:function(){return[{type:"helptext",html:"Specify a route to get the labels for related records in a single batch. The URL must include an {{ids}} merge as a placeholder for a comma-separated list of keys to load.<br/><br/>(This is not needed if the related records are from the same Data Source as this Model and if your Model's query method returns the related record's labels as well as ids.)"},{id:"batchlabelroute",type:"string",placeholder:"e.g. /api/users?ids={{ids}}",label:"Item Labels Route"}]},getOverrideBatchFieldChildrenFunction:function(){return function(){return null}},getMetadataHandler:function(c,d,e,f){var g=c.children("batchfields").first(),h=g&&g.attr("batchlabelroute"),i=c.attr("ogdisplaytype"),j=c.attr("keyfield");if(d.rel=c.attr("rel"),d.searchRoute=c.attr("searchroute"),d.keyField=j,d.originalDisplayType=i,g&&h){var k=a.dataSource.getDataSourceFromXML(c),l=new a.model.Model({dataSource:k}),m=g.children("batchfield");l.id="_ReferenceLabelModel_"+(new Date).getTime()+d.rel,m&&m.length?l.fields=b.map(m,function(a){return{id:b(a).attr("field")}}):l.fields=[{id:j}],l.doQuery=!0,l.doClone=!1,l.serviceUrl=h,l.verb="GET",l.initialize();var n=new a.model.Condition;n.name="__reference_batch",n.sourceParam="ids",l.addCondition(n),e.batchLabelModels||(e.batchLabelModels={}),e.batchLabelModels[f]=l}},getReferenceValue:function(a,c){var d,e=c.keyField;return e?a[e]:(d=r(),a[b.isArray(d)?d[0]:d])},getRowFromReferenceValue:function(a,c,d){var e=r(a),f=a.getRows([{field:d.keyField||(b.isArray(e)?e[0]:e),value:c}]);return f&&f.length?f[0]:{}},processReferenceLookupModel:function(b,c){b.serviceUrl=c.metadata.searchRoute,b.verb="GET",b.label=c.id,b.labelPlural=c.id;var d=new a.model.Condition;d.name="__default_searchbox",d.sourceParam="search",b.addCondition(d)}}},T=function(){return{uploadfile:{label:"Generic REST Upload",upload:function(d,e,f,g,h){var i=f.uploadMethod.dataSource,j=f.filename||d.name;g({fileName:j}),c.readFileAsBase64(d).then(function(c){var f=i.createHTTPRequest({url:(i.serviceUrl||"")+e.options.xmlDef.attr("url"),method:"POST"});f.headers.Accept="application/json",f.headers["Content-Type"]="application/json",b.extend(f,{body:{FileName:j,Body:c,ContentType:d.type}}),i.makeRequest(f).then(function(a){h(a)},function(b){h({message:a.ajax.getErrorMessage(b)})})})},builderProps:[{id:"url",type:"text",label:"Upload URL"}]}}},U=function(a){a.sourceType="param",a.operator="=",a.encloseValueInQuotes=!0},V=function(f){f||(f={});var g,h,i=f.component,j=i.state,k=f.propertiesViewer,m=f.onChange||function(){i.rebuildProps(k)},n=[],o=[{name:"Method",props:n}],p=f.type,q="delete"===p,r=j.closest("model"),s=r.attr("datasource")||r.attr("service"),t=r.attr("id"),u=-1!==b.inArray(p,["update","insert"]),v=j.attr("sendchanges"),w=j.attr("successif"),x="true"===j.attr("batch"),y=[],z=p+"s",A={value:"custompayloadinbody",label:"As custom payload format in request body"};if(x?"update"===p?y.push({value:"asjsoninbody",label:"As JSON Object in request body"},{value:"asnestedjsoninbody",label:"As nested JSON Object in request body"},A):y.push({value:"asjsoninbody",label:"As JSON Array in request body"},{value:"asnestedjsoninbody",label:"As nested JSON Array in request body"},A):y.push({value:"asjsoninbody",label:"As JSON in request body"},{value:"asnestedjsoninbody",label:"As nested JSON in request body"},{value:"asformdatainbody",label:"As URL-Encoded Form data in request body"},{value:"inheaderperfield",label:"In request headers - one per changed field"},{value:"inqueryparamperfield",label:"In URL parameters - one per changed field"},A),n.push({id:"endpoint",type:"template",location:"attribute",displayAs:"textarea",modelName:x?null:t,label:"Data Source URL",helptext:"The relative URL to access on the Data Source. May contain merge syntax, e.g. /products/list , /product/{{Id}} ."}),g=s?a.dataSource.getDataSource(s):null,g&&g.authentication&&"oauth"===g.authentication.method&&n.push({id:"scopes",type:"string",label:"OAuth Scopes Needed",helptext:'Skuid will connect to this Data Source via OAuth. If the specific Service URL you are connecting to requires additional OAuth Scopes, enter them here, comma-separated, e.g. "profile,email" or "https://www.googleapis.com/auth/calendar".'}),n.push(l().getDataSourceAccessMethodProperty({onChange:m,type:f.type,state:j})),(u||q)&&n.push({id:"batch",type:"boolean",label:"URL expects batch "+z,helptext:"If true, then Skuid will send all "+z+" in a single batch request. Otherwise, a separate HTTP request will be made for each "+p+"d row",onChange:function(){j.removeAttr("insertresponse createdrecordidlocation pathtocontent").attr("sendchanges","asjsoninbody"),i.save(),m()}}),"query"===p&&n.push(l().getPathToContentProperty({component:i})),(u||x&&q)&&(n.push({id:"sendchanges",label:"Send "+("update"===f.type?"updated":"new")+" field values...",type:"picklist",defaultValue:y[0].value,picklistEntries:y,onChange:m}),"asnestedjsoninbody"===v?(h={id:"pathtocontent",type:"string"},x?(h.helptext="Skuid will generate an Array of",q?(h.label="Location of Array of deleted row keys",h.helptext+="the primary keys of deleted rows "):"insert"===p?(h.label="Location of Array of new rows",h.helptext+="each new row's field values "):"update"===p&&(h.label="Location of Array of updated rows",h.helptext+="each changed row's field values"),h.helptext+='and place this within a wrapper object at a location you specify.For instance, if this property is set to "data", then the request body will be \' { "data": [...] } \'.'):(h.label="Location of nested changes",h.helptext='Skuid will nest row changes at this locationwithin the JSON request body. For instance, if this property is set to "data", then the request body will be \'{ "data": { "field":"value"  } }\'.'),n.push(h)):"custompayloadinbody"===v&&n.push({id:"payloadsnippet",type:"string",label:"Payload Generation Snippet",helptext:"The name of the Snippet to run. Will be handed an object containing the new/changed data.Must return a payload, which will be inserted into the request body."},{id:"contenttype",type:"string",label:"Payload Content Type",defaultValue:"application/json",helptext:"The content type of the payload returned by the Payload Generation Snippet, e.g. application/xml, text/plain, application/soap+xml"})),u&&e(v,"perfield")){var B="inheaderperfield"===v?"header":"parameter";n.push({id:"changemapping",label:"Field name to "+B+" name mapping",type:"picklist",defaultValue:"auto",picklistEntries:[{value:"auto",label:"Same names"},{value:"autoprefix",label:"Same names, with added prefix"}],onChange:m}),"autoprefix"===j.attr("changemapping")&&n.push({id:"changemappingprefix",type:"string",label:c.capitalizeFirst(B)+" name prefix"})}return(u||x&&q)&&(n.push({id:"successif",label:"Method succeeds if...",type:"picklist",defaultValue:"requestsucceeds",picklistEntries:[{value:"requestsucceeds",label:"Request succeeds"},{value:"responsefieldispresent",label:'"Success" Field in response body is present'},{value:"responsefieldistrue",label:'"Success" Field in response body is true'},{value:"responsefieldequals",label:'"Success" Field in response body equals a value'},{value:"responsebodyequals",label:"Response body equals a value"},{value:"responseheaderispresent",label:'"Success" Header is present in response'},{value:"responseheaderequals",label:'"Success" Header in response equals a value'}],onChange:m}),d(w,"responsefield")?n.push({id:"successfield",type:"string",label:"Success Field Name"}):d(w,"responseheader")?n.push({id:"successfield",type:"string",label:"Success Header Name",helptext:"The name of a Header in the response which, if present, indicates that this request succeeded, e.g. X-Record-Created"}):e(w,"equals")&&n.push({id:"successvalue",type:"string",label:"Contents of response body if request succeeds"})),"insert"!==p||x||(n.push({id:"insertresponse",label:"Response handling",type:"picklist",defaultValue:"recordinbody",picklistEntries:[{value:"recordinbody",label:"Created record will be returned in response body"},{value:"idinbodyfield",label:"Id of created record will be returned in field in response body"},{value:"idinheader",label:"Id of created record will be returned in response header"},{value:"none",label:"No information about created record will be returned"}],onChange:m}),"idinbodyfield"===j.attr("insertresponse")?n.push({id:"createdrecordidlocation",type:"string",label:"Name of Field containing created record's Id",helptext:"What is the name of / path to the Field in the expected response that will contain the created record's id? e.g. id, recordId"}):"idinheader"===j.attr("insertresponse")&&n.push({id:"createdrecordidlocation",type:"string",label:"Name of Header containing created record's Id",helptext:"What is the name of the Header expected in the response that will contain the created record's id? e.g. X-Record-Id, X-New-Record-Id"})),o},W=function(b,c){var d,e,f=a.builder.core,g=b.state,h=!1,i=g.children("methods"),k="readwrite"===g.attr("type"),l=f.getUnsavedChangesWarningProperty({component:b}),m=f.getCoreModelBasicProperties({component:b,propViewer:c}),n=[];return i.length&&(d=i.children('[type="query"]').first(),d.length&&(h=!0)),m.push({id:"type",type:"picklist",label:"Model Behavior",defaultValue:"",picklistEntries:[{value:"",label:"Read-Only"},{value:"readwrite",label:"Read/Write"}],onChange:function(a,e){var f,h,k;"readwrite"!==a||e?a||"readwrite"!==e||(i=g.children("methods"),i.length&&(d=i.children('[type="query"]').first(),d.length&&(f=d.attr("pathtocontent"),h=d.attr("verb"),k=d.attr("endpoint"),g.attr({pathtocontent:f,verb:h,endpoint:k}),i.remove(),b.save()))):(f=g.attr("pathtocontent"),h=g.attr("verb"),k=g.attr("endpoint"),i=g.children("methods"),i.length||(i=j("<methods/>").appendTo(g)),d=j("<method/>").attr({type:"query",verb:h,endpoint:k,pathtocontent:f}).appendTo(i),g.removeAttr("verb endpoint pathtocontent"),b.save()),b.refresh().rebuildProps(c)}}),k||(e=V({component:b,propertiesViewer:c,type:"query"}))&&e.length&&(e[0].props?Array.prototype.push.apply(m,e[0].props):Array.prototype.push.apply(m,e)),Array.prototype.push.apply(m,f.getModelLabelProperties()),!k||h?m.push(f.getModelQueryOnPageLoadProperty({component:b,propViewer:c})):!h&&k&&"true"===g.attr("query")&&(g.attr("query","false"),b.save()),m.push(f.getCreateDefaultRowProperty(),f.getModelIdFieldProperty(),f.getModelNameFieldProperty()),l&&n.push(l),[{name:"Basic",props:m},{name:"Advanced",props:n}]},X=function(a,b){a.extensions={rest:{pathToContent:b.attr("pathtocontent"),methods:a.methods,serviceUrl:b.attr("serviceurl")||b.attr("endpoint"),verb:b.attr("verb"),scopes:b.attr("scopes")}}},Y=function(d){var e={};return d&&a.platform.getName()===a.constants.NATIVE&&d.name===a.platform.getDefaultDataSourceName()&&(e.resource={label:a.$L("file_resource"),builderProps:function(b,c,d){var e=[],f=d.prefix||"",g=f+"resource",h=f+"path",i=f+"resourceContentType",j=!0,k={};return k[g]="{{{name}}}",k[i]="{{{content_type}}}",c.attr(i)&&(j=c.attr(i)===a.constants.MIME_TYPES.ZIP),e.push(a.platform.builder.getStaticResourceProperty({id:g,valueTemplates:k,helptext:"The name of the File where the Image is stored.",onChange:function(){c.attr(h)&&(c.removeAttr(h),b.save()),b.refresh().rebuildProps()}})),c.attr(g)&&j&&e.push(a.platform.builder.getNestedPathProperty({id:h,state:c,nameProperty:g,namespaceProperty:a.platform.getEntityFieldName("static_resource","namespace"),onChange:function(){b.refresh()}})),e},getSrc:function(d){var e=b.Deferred(),f=d.prefix,g=f?f+"resource":"resource",h=f?f+"path":"path",i=d.xmlDef.attr(g),j=d.xmlDef.attr(h),k=d.context,l=d.mergeSettings;if(j&&(j=c.mergeAsTextInContext(j,k,l)),i&&(i=c.mergeAsTextInContext(i,k,l)),i){var m=a.platform.getSiteResourceUrl({name:i,path:j||null});e.resolve(m)}else e.reject("No Resource Provided");return e.promise()}}),e},Z={runtime:{metadataSource:"local"},composer:{modelConditionLabel:"URL Merge Condition",modelConditionsLabel:"URL Merge Conditions",canFieldsBeSelected:function(a){var b,c=a.model,d="readwrite"===c.attr("type"),e=c.attr("datasource")||c.attr("service"),f=e&&(d?c.children("methods").children("method[verb][verb!=''][endpoint][endpoint!='']").length:c.attr("verb")&&c.attr("endpoint"));return"components"===a.mode?(b=c.children("fields").children().length,!(!f&&!b)||"Please either Select a valid Service URL Endpoint and access method, or manually add and define expected fields to this Model."):!!f||"Please Select a valid Service URL Endpoint and access method."}},canAutoGenerateConditionsFromFields:!1,validConditionTypes:["fieldvalue","param","userinfo","blank","modelmerge"],canConditionsBeGrouped:!1,canFieldsBeIndividuallySearched:!1,hasGlobalSearchEntities:!0};new a.dataSource.DataSourceType({buildEntityMetadataRequest:I,getConditionSourceProperties:p,getEntityMetadata:M,getEntityMetadataCacheKey:L,getEntityMetadataLoadingMessageFromBreadcrumb:J,getMethodProperties:V,getModelProperties:W,getNameField:q,getIdField:r,getRowName:s,getRowId:t,getUploadMethods:T,getReferenceHandler:S,initialize:N,load:O,makeRequest:y,name:"REST",populateBreadcrumbFromEntityMetadata:G,processEntityMetadataRequest:H,properties:Z,save:P,setDefaultConditionState:U,processModelXMLExtensions:X,getImageSources:Y,searchProperties:Q,search:R})}(skuid);