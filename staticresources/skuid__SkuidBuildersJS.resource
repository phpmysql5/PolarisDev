/*! Skuid Rockaway 8.13.0 14-06-2016 */
!function(a){function b(a){var b=a.starter,c=a.isUnique;b||(b="NewValue");var d,e,f=b.substring(b.length-1,b.length);for(ma.isNumber(f)?(e=parseInt(f,10)-2+3,b=b.substring(0,b.length-1),d=b+e):(d=b,e=1);!c(d);)d=b+""+e++;return d}function c(a){return b({starter:a||"NewModel",isUnique:function(a){return 0===L(a).length}})}function d(a,c){return b({starter:a||"NewField",isUnique:function(a){return 0===c.children("groupby, fields").children('[id="'+a+'"]').length}})}function e(a,b){var c,d=a.split("."),e=d.shift(),f=e.charAt(0),g=(b?b.toLowerCase()+f.toUpperCase():f.toLowerCase())+e.slice(1);if(d.length)for(c=0;c<d.length;c++)e=d[c],g+=e.charAt(0).toUpperCase()+e.slice(1);return g.replace(/_/g,"").substring(0,25)}function f(a){var b,c,d,e;return a.jquery&&a.attr?(b=a.attr("name"),c=a.attr("function"),d=a.attr("id"),e="true"===a.attr("uionly")):(b=a.name,c=a["function"],d=a.id,e=a.uiOnly),(b?b+" - "+(c?c+"("+d+")":d):d)+(e?" (Ui-Only)":"")}function g(a){ja.extend(this,a)}function h(b){b.setTitle(b.builderId),b.body.css("padding","8px").text(a.$L("pb_no_component_renderer"))}function i(b,c){b.clear(),b.setTitle(c.builderId+" "+a.$L("properties")),b.body.append(ja("<div>").addClass("nx-pagebuilder-infotext").text(a.$L("pb_no_properties_renderer")))}function j(b){return b._GUID=a.utils.generateGUID(),Ya[b._GUID]=b,b}function k(a){delete Ya[a._GUID]}function l(){return ja.map(Ya,function(a){return a})}function m(a){ta[a.id]=a}function n(a){ja.each(a,function(){m(this)})}function o(a){return ta[a]}function p(){return ta}function q(a,b){b||(b={location:Qa});var c,d=b.storeAs,e=b.location,f=b.isStateless===!0,g=b.id,h=b.defaultValue;if(e||(e=g?Ra:Qa),f===!0)c=b.value||b.valueFunction&&b.valueFunction();else if(d){if(d.type===Qa&&d.name){var i=a.children(g).first().children(d.name);1===i.length?c=i.first().text():i.length>1&&(c=[],ja.each(i,function(){c.push(ja(this).text())}))}}else c=e===Ra?a.attr(g):g?a.children(g).first().text():a.text();return ja.isArray(c)&&0===c.length?c.push(h):"undefined"==typeof c&&(c=h),c}function r(a,b,c){var d={value:c},e=b.location||Qa;return e===Qa&&b.id?d.childNodeName=b.id:b.location===Ra&&(d.key=b.id),s(a,d)}function s(b,c){c||(c={});var d=!1;if(b){var e,f=b;c.selector?f=b.find(c.selector):c.childNodeName&&(f=b.children(c.childNodeName),f.length<1&&(f=pa("<"+c.childNodeName+"/>").appendTo(b))),c.storeAs&&c.storeAs.type&&"node"===c.storeAs.type?(f.empty(),ja.each(c.value,function(a,b){f.append(pa("<"+c.storeAs.name+"/>").text(b))}),d=!0):c.key?(e=f.attr(c.key),d="undefined"!=typeof c.value&&c.value!==e,d&&f.attr(c.key,c.value)):(d=c.value!==f.text(),d&&f.text(c.value)),!c.childNodeName||"undefined"!=typeof c.value&&""!==c.value||f.remove()}d&&a.events.publish("skuidBuilderSave")}function t(a,b){var c,d=null,e={};a.hasChanged&&(d=a.getField("skuid__Last_Modified_Date_Check__c"),c=a.getFieldValue(b,"LastModifiedDate"),d&&c&&(e[d.id]=c,a.updateRow(b,e)))}function u(a,b,c){ma.writeXmlToPageLayoutFields(a,b,c),t(b,c);var d=ma.size(va);d>0&&ja.each(va,function(a,b){return d>0?(b&&b.refresh&&b.refresh(),delete va[a],d--,void 0):!0})}function v(a){var b,c=a.index()+1,d=c+": ",e=a.attr("type"),f="search"===e,g=a.attr("value"),h=a.attr("sourcetype"),i=a.attr("fieldfunction"),j="false"!==a.attr("enclosevalueinquotes");if("param"===h)b=a.attr("sourceparam"),d+=b?"(param) '"+b+"'":"[No Parameter]";else{if("snippet"===h)return b=a.attr("sourcesnippet"),b?"Snippet '"+b+"' returns true":"[No Snippet]";if("userinfo"===h)b=a.attr("sourceuserinfotype"),d+=b?"(userinfo) "+b:"[No Property]";else if("modelproperty"===h||"rowproperty"===h){if(b=a.attr("sourceproperty"),!b)return d+"[No Property selected]";var k,l=a.attr("fieldmodel");if(k=l?l+" Model ":"Context Model ","modelproperty"===h){if("hasRows"===b||"hasNoRows"===b)return d+k+"has"+("hasNoRows"===b?" no":"")+" data rows";if("hasChildRows"===b||"hasNoChildRows"===b)return d+"Context row in the "+k+"has"+("hasNoRows"===b?" no":"")+(a.attr("childrel")||"[No Child Relationship]")+" data rows";d+="data.length"===b?"# of rows in the "+k:"hasChanged"===b?k+" has unsaved changes":k+" "+b}else{if(k="Context Row in "+k,"isNew"===b)return d+k+" is new";if("isCloned"===b)d+=k+" is clone of existing record";else if("hasChanged"===b)d+=k+" has unsaved changes";else if("isSaved"===b)return d+k+" already exists in database"}}else{d+=(i&&!f?i+"(":"")+(a.attr("field")||"[No Field]");var m=a.attr("locationsource"),n=a.attr("latitudefield"),o=a.attr("longitudefield");if(m)if(d+=",","userlocation"===m)d+="User Location";else if("param"===m)d+="("+(n?"(param) '"+n+"'":"[No Latitude Parameter]")+","+(o?"(param) '"+o+"'":"[No Longitude Parameter]")+")";else if("modelmerge"===m){var p=a.attr("locationmodel")||"[No Location Model]";d+="("+p+")("+(n?n:"[No Latitude Field]")+","+(o?o:"[No Longitude Field]")+")"}d+=i&&!f?")":""}}if(d+=" "+cb[a.attr("operator")||""].name+" ","param"==e)d+="(param) ";else if("userinfo"==e){var q=db[a.attr("userinfotype")],r=q?q.label:"User Id";d+="(userinfo) "+r}else if("join"==e){d+="(SELECT "+(a.attr("joinfield")||"")+" FROM "+(a.attr("joinobject")||"");var s=a.children("condition");s.length&&(d+=" WHERE (<Sub Conditions>)"),d+=")"}else if("modelmerge"===e)d+="("+(a.attr("model")||"")+")("+(a.attr("mergefield")||"")+")";else if("multiple"===e){d+="(";var t=a.children("values").children();t.length&&(t.each(function(){d+=(j?"'":"")+ja(this).text()+(j?"',":",")}),d=d.substring(0,d.length-1)),d+=")"}else if("dependent"===e){var u=a.attr("depfield")||"<Unspecified>";d+="the value of the '"+u+"' field from the current row"}else f&&(d+="the search of "+i+" for '"+g+"'");if(("param"===e||"userinfo"===e)&&(j=!1),"fieldvalue"===e||"param"===e||"userinfo"===e||"blank"===e){j&&(d+="'"),d+=g||"";var v=a.attr("units");v&&(d+=" "+v),j&&(d+="'")}return"filterableon"!==a.attr("state")&&"filterableoff"!==a.attr("state")||!a.attr("name")||(d+=" (filterable as "+a.attr("name")+")"),"true"===a.attr("inactive")&&(d+=" (inactive)"),d}function w(b,c,d,e){e||(e={});var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=!1,v=e.readMetadataFromFieldNode!==!1,w="";if(b&&(na(b)?f=L(b):b.length&&(f=b,b=f.attr("id"))),f&&(r=wb(f),q=(r?r+".":"")+c,j=f.children("fields,groupby").children('[id="'+oa(c)+'"]')),q||(q=c),g=f&&f.attr("adapter")?f.attr("adapter"):"salesforce",h=a.adapter.getAdapter(g),i=N(f),j&&j.length){if("true"===j.attr("uionly")||"local"===h.prop("runtime.metadataSource")&&v)return new a.model.Field({xml:j,adapter:h,model:{pathToContent:r,id:b}});"childRelationship"===j.attr("type")&&(u=!0)}return d||(d=b&&B(b)),m=q.split("."),n=m.pop(),o=j&&j.attr("targetobjects"),p=o&&o.split(","),u||m.length&&ja.each(m,function(a,b){if(w+=b+".",s=i.buildEntityMetadataRequest({model:f,targetEntity:d,path:w,ignorePathToContent:!0}),k=i.getCachedEntityMetadata({entities:s}),k&&ja.each(k.getFieldsList(),function(a,c){return c.rel===b?(d=c.ref,!1):void 0}),t=d?d.split(","):[],t.length>0)if(p){var c=p.shift();d=t.indexOf(c)?c:t[0]}else d=t.length>1?"Name":t[0]}),s=i.buildEntityMetadataRequest({model:f,targetEntity:d,path:w,ignorePathToContent:!0}),k=i.getCachedEntityMetadata({entities:s}),l=null,k&&(l=k["get"+(u?"ChildRelationship":"Field")](n)),j&&j.length&&l&&"true"===j.attr("overridemetadata")&&v?new a.model.Field({xml:j,field:ja.extend({},l),adapter:h,model:{pathToContent:r,id:b}}):l}function x(a,b){b||(b={});var c,d,e=a.state,f=e.attr("field"),g=b.modelName;if(e.is("field")?(c=e.attr("id"),g=e.closest("model").attr("id")):f&&(c=f,g||e.is("condition")&&(g=e.closest("model").attr("id"))),ja.inArray(e.attr("sourcetype"),["modelproperty","rowproperty"])>-1)d={displaytype:bb[e.attr("sourceproperty")]||"STRING"};else if(c){var h={},i="readMetadataFromFieldNode";b[i]===!1&&(h[i]=!1),d=w(g,c,z(a),h)}return d||(d=!1),d}function y(a,b){var c,d=a.state,e=x(a,b),f=d.attr("sourcetype"),g=d.attr("type");e&&(c=e.displaytype),"blank"===g||ja.inArray(f,["modelproperty","rowproperty"])>-1&&bb[d.attr("sourceproperty")]||c&&-1!==ja.inArray(c,Za)?d.attr("enclosevalueinquotes","false"):d.attr("enclosevalueinquotes","true")}function z(b){var c,d=b.state;if(d.is("field"))c=d.closest("model").attr("sobject");else if(b.isSubcondition)c=d.parent().closest("condition").attr("joinobject");else if(b.isChildRelationshipCondition){var e=Q(d.closest("model").attr("id"),d.closest(a.mobile?"mobilefield":"field").attr("id"));c=e.childSObject}else if(b.isLookupFilterCondition){var f=w(d.parent().closest("[model]").attr("model"),d.closest(a.mobile?"mobilefield":"field").attr("id"));c=f?-1!==f.ref.indexOf(",")&&d.attr("fieldtargetobjects")?d.attr("fieldtargetobjects"):f.ref:null}else c=b.isRenderCondition||b.isUpdateAction?B(d.attr("fieldmodel")?d.attr("fieldmodel"):d.closest("[model]").attr("model")):b.isContextCondition?B(d.closest("[model]").attr("model")):d.closest("model").attr("sobject");return c}function A(a,b){return-1!==ja.inArray("User",b)||(-1!==ja.inArray("Contact",b)||-1!==ja.inArray("Lead",b))&&-1!==ja.inArray(a.id,gb)||-1!==ja.inArray(a.id,fb)}function B(a){return L(a).attr("sobject")}function C(){var a=la.pageModel.getFieldValue(la.pageRow,hb,!0);return a=a?JSON.parse(a):{}}function D(a){la.pageModel.updateRow(la.pageRow,hb,JSON.stringify(a))}function E(a){return new ma.KeyValueService({id:a,type:"model",get:C,set:D})}function F(a){return new ma.KeyValueService({id:a,type:"component",get:C,set:D})}function G(){return la.pageXML}function H(){return la.masterPageXML}function I(a){return la.masterPage&&a&&a[0]&&a[0].ownerDocument.firstElementChild===la.getMasterPageXML()[0]?!0:!1}function J(){var a=H();return a&&a.children("models").length?a.children("models").clone().append(G().children("models").children("model").clone()):G().children("models")}function K(){return G().children("models")}function L(a){var b,c=G().children("models").children('model[id="'+a+'"]');return c.length||(b=H(),b&&(c=b.children("models").children('model[id="'+a+'"]'))),c}function M(b){var c=L(b);return c?a.adapter.getAdapter(c.attr("adapter")||"salesforce"):null}function N(b){return a.service.getService(b&&b.attr("service")||"salesforce")}function O(){return K().children("model").first()}function P(a,b){var c;return na(b)?(c=L(b),c&&(c=c.children("conditions"))):b&&b.jquery&&"conditions"===b.prop("nodeName")&&(c=b),c?c.find('condition[name="'+a+'"]'):null}function Q(a,b,c){c||(c=a&&B(a));var d=L(a),e=N(d),f=e.getCachedEntityMetadata({entities:[{objectName:c}]});return f?f.getChildRelationship(b):null}function R(a,b,c){if(!a||!b)return!1;c||(c={searchByName:!1});var d,e=c.searchByName;if(na(a)===!0)d=L(a);else{if(!a.jquery)return!1;d=a}var f=e===!0?"name":"id",g=d.children("fields,groupby").find("field["+f+'="'+oa(b)+'"]');return g&&g.length>0?!0:!1}function S(b){b||(b={});var c,d=b.fieldId,e=b.view,f=b.isChildRelationship||e&&"childonly"===e,g=b.model,h=b.fieldBuilder||a.builder.fieldBuilder;if(c=h&&!a.mobile?function(a){return h.getDefaultState(a)}:la.defaultStateGenerators.field,d&&g){var i,j=b.fieldsNode,k=b.fieldsElement,l=b.targetObjects;j||(j=g.children("fields")),k||(i=xb(j),k=i&&i.element.find(".nx-pagebuilder-fieldschildren"));var m=j.children('[id="'+oa(d)+'"]'),n="aggregate"===g.attr("type"),o=n?j.is("groupby"):!1,p=g.attr("id"),q=w(p,d),r=q?q.displaytype:null,s=[],t=a.adapter.getAdapter(g.attr("adapter")||"salesforce"),u="local"===t.prop("runtime.metadataSource");if(n||0===m.length){var v,x,y={id:d,needsAlias:n};if(n&&(o?r===Ba&&(v="CALENDAR_YEAR"):v=q&&ja.inArray(r,["NUMBER",za,Ca,Ea])>-1?"SUM":q&&r===Ha?"AVG":!q||r!==Aa&&r!==Ba?"COUNT":"MAX"),v&&(y.functionName=v),f&&(y.isRelationship=!0),x="Id"!==d&&r===Ka,s.push(c(y)),x&&(!n||o)&&q.referenceTo&&q.referenceTo.length&&q.rel&&"null"!==q.rel){var z,A=q.referenceTo[0].objectName,B=1===q.referenceTo.length?A:"Name",C=N(g);if(!B||B in C.getCachedEntityMetadata()||C.getEntityMetadata({entities:B,ignoreMetadataOverrides:!0}),q.referenceTo.length<2?(z=ma.getFieldReference(d,q),0===j.children('[id="'+oa(z)+'"]').length&&s.push(c({id:z,needsAlias:n}))):(z=ma.getFieldRelationshipName(d,q)+".Name",0===j.children('[id="'+oa(z)+'"]').length&&s.push(c({id:z,needsAlias:n}))),"skuid__Image__c"===A){var D=ma.getFieldRelationshipName(d,q)+".skuid__AttachmentId__c";0===j.children('[id="'+oa(D)+'"]').length&&s.push(c({id:D,needsAlias:n}))}}ja.each(s,function(a,b){if(l&&b.attr("targetobjects",l),u){var c=w(p,b.attr("id"),null,{readMetadataFromFieldNode:!1});c&&ja.each(c,function(a,c){"undefined"!=typeof c&&null!==c&&"id"!==a&&b.attr(a.toLowerCase(),c)})}j.append(b),k&&h&&k.append(la.componentFactory(b,h).element)})}if(s.length)return s}return!1}function T(a){return-1!==ja.inArray(a,["LOCATION","ADDRESS"])}function U(a){var b,c,d={},e=arguments;return a&&!na(a)&&1===e.length?(b=a.type,c=a.displayType):(b=e[0],c=e[1]),ja.each(la.operatormap,function(a,e){if(a&&-1!==ja.inArray(b||"fieldvalue",e.validFor)){var f=e.validForDisplayTypes,g=!0;f&&f.length&&c&&-1===ja.inArray(c,f)&&(g=!1),g&&(d[a]=e)}}),d}function V(b,c,d,e){var f,g,h,i,j,k,l,m,n,o=b.isStateless===!0,p=function(){return e?e.text():d?c.attr(d):b.value||b.valueFunction&&b.valueFunction()||b.defaultValue||""},q=function(a,c){b.beforeChange&&b.beforeChange(a,c),o||s(i,{key:j,value:a}),b.onChange&&b.onChange(a,c)},r=b.validator,t="currentValue";if(b.metadata&&(g=b.metadata.displaytype,l=g===Aa||g===Ba),e?(i=e,j=void 0):d?(i=c,j=d):(i=void 0,j=void 0),h=p(),g===xa)f={value:"true"===h,onChange:function(a){var b=a?"true":"false",c=a?"false":"true";q(b,c)}};else if(g===Ja&&b.metadata.picklistEntries)q=function(a,c){b.beforeChange&&b.beforeChange(a,c),o||s(i,{key:j,value:a,required:!0}),b.onChange&&b.onChange(a,c)},f={value:ma.decodeHTML(h),onChange:function(a,b){q(a,b)},entries:b.metadata.picklistEntries};else if(l){if(m=h,n="",h&&-1!==h.indexOf(":")){var u=h.split(":");m=u[0],n=u[1]}f={value:ma.decodeHTML(h),onChange:function(a,b){q(a,b)}}}else g=Na,h=h||b.defaultValue||"",f={value:h,onChange:function(a,b){if(a!==b){var c=!0,d=k.parent().find(".nx-property-error");r&&(c=r(a)),c===!0?(d.length&&d.hide(),q(a,p())):(d.length?d.show():d=ja('<div class="nx-property-error">').insertAfter(k),d.text(c))}}};if(r&&(f.dataPropertyName=t),k=a.ui.renderers[g].edit(f),r){var v,w="skuid.pageComposer.propertyPanel.beforeRender",x="blur.skuid",y=function(){if(!k.closest(".nx-pagebuilder-toolbarpanel").length)return void a.events.unsubscribe(v);var b,c=k.val(),d=r(c);d!==!0&&(b=p(),b!==c&&(k.val(b),k.data(t,b),k.parent().find(".nx-property-error").hide()))};k.off(x).on(x,y),v&&a.events.unsubscribe(v),v=a.events.subscribe(w,y)}if("BOOLEAN"==g){var z="sk-builder-check-meta",A=ja("<div>");k.attr("id",z),A.append(k,'<label for="'+z+'"></label>'),k=A}if(l){var B,C,D,E,F=function(){"NONE"===B?C.show():C.hide(),n?E.show():E.hide()},G=la.dateliteralmap[m],H=[];H.push({label:"Specific Date",value:"NONE"}),ja.each(la.dateliteralmap,function(a){H.push({label:this.label,value:a})}),G?B=m:(B="NONE",n=""),C=k,D=a.ui.renderers.PICKLIST.edit({value:B,onChange:function(a){var c;a?(G=la.dateliteralmap[a],G?(B=a,G.merge?(n="1",E.val(n),c=B+":"+n):(c=B,n="")):(B="NONE",c="",n="")):(c="",B="NONE",n=""),C.is(".hasDatepicker")?C.datepicker("setDate",""):C.find(".hasDatepicker").datepicker("setDate",""),s(i,{key:j,value:c}),b.onChange&&b.onChange(c),F()},entries:H,required:!0}),E=a.ui.renderers.TEXT.edit({value:n,onChange:function(a){var c=D.val()+":"+a;s(i,{key:j,value:c}),b.onChange&&b.onChange(c)}}),F(),k=ja("<div>").append(D,C,E)}else b.placeholder&&k.attr("placeholder",b.placeholder);return k}function W(){return[{value:"-",label:"Model Conditions / Querying",disabled:!0},{value:"setCondition",label:function(a){var b=nb(a,"model"),c=nb(a,"condition");return b?"Activate & Set Model Condition: "+b+(c?" > "+c:""):"Activate & Set value of Model Condition"}},{value:"activateCondition",label:function(a){var b=nb(a,"model"),c=nb(a,"condition");return"Activate Model Condition"+(b?": "+b+(c?" > "+c:""):"")}},{value:"deactivateCondition",label:function(a){var b=nb(a,"model"),c=nb(a,"condition");return"Deactivate Model Condition"+(b?": "+b+(c?" > "+c:""):"")}},{value:"requeryModel",label:function(a){var b=nb(a,"model");return"Query Model"+(b?": "+b:"")}},{value:"requeryModels",label:function(a){var b=a&&a.children?a.children("models").children():0;return b&&b.length?1===b.length?"Query Model: "+b.first().text():"Query "+b.length+" Models":"Query Models"}},{value:"-",label:"",disabled:!0},{value:"-",label:"Model data changes",disabled:!0},{value:"createRow",label:function(a){var b=nb(a,"model");return(b?b+": ":"")+"Create new row(s)"}},{value:"updateRow",label:function(a){var b=nb(a,"fieldmodel"),c=nb(a,"field");return b&&c?b+": Update "+c+" field":"Update a field on row(s)"}},{value:"markRowsForDeletion",label:"Mark row(s) for deletion"},{value:"unmarkRowsForDeletion",label:"Unmark row(s) for deletion"},{value:"emptyModelData",label:function(a){var b=a&&a.children?a.children("models").children():0;return b&&b.length?1===b.length?"Remove all rows in Model: "+b.first().text():"Remove all rows in "+b.length+" Models":"Remove all rows from Model"}},{value:"abandonRows",label:function(a){var b=nb(a,"model");return"Remove context row(s) from Model"+(b?": "+b:"")}},{value:"cancel",label:function(a){var b=a&&a.children?a.children("models").children():0;return b&&b.length?1===b.length?"Cancel changes in Model: "+b.first().text():"Cancel changes in "+b.length+" Models":"Cancel Model changes"}},{value:"save",label:function(a){var b=a&&a.children?a.children("models").children():0;return b&&b.length?1===b.length?"Save changes in Model: "+b.first().text():"Save changes in "+b.length+" Models":"Save Model changes"}},{value:"adoptRows",label:function(a){var b=nb(a,"sourcemodel"),c=nb(a,"targetmodel");return"Adopt rows into "+(c&&b?c+" from "+b:"Model")}},{value:"-",label:"",disabled:!0},{value:"-",label:"Salesforce Actions",disabled:!0},{value:"sfdc-custom-apex",label:"Run Custom Apex Action"},{value:"-",label:"",disabled:!0},{value:"-",label:"Advanced",disabled:!0},{value:"custom",label:function(a){var b=nb(a,"snippet");return b?"Run Snippet: "+b:"Run a Skuid JavaScript Snippet"}},{value:"publish",label:function(a){var b=nb(a,"event");return"Publish Event"+(b?": "+b:"")}}]}function X(a){ja.each(a,function(){mb.push(this)})}function Y(){return mb}function Z(a,b){var c,d=a.attr("type"),e=function(b){var c;return b&&ja.each(b,function(b,e){return e.value===d?(c="function"==typeof e.label?e.label(a):e.label,!1):void 0}),c};return c=e(mb)||e(b),c||d}function $(a){var b=a.attr("location"),c={};return"external"===b?ja.extend(c,{prefix:"(External)",name:a.attr("name")||a.attr("url")}):(c.name=a.attr("name"),c.prefix="(","inlinesnippet"===b?c.prefix+="Snippet":"inlinecomponent"===b?c.prefix+="Component":"inline"===b?c.prefix+="Inline":"staticresource"===b&&(c.prefix+="Static Resource"),c.prefix+=")"),c}function _(a){var b=a.attr("location"),c={};return"external"===b?ja.extend(c,{prefix:"(External)",name:a.attr("name")||a.attr("url")}):(c.name=a.attr("name"),c.prefix="(","inline"===b?c.prefix+="Inline":"staticresource"===b&&(c.prefix+="Static Resource"),c.prefix+=")"),c}function aa(a){var b,c;switch(a.attr("type")){case"multiselect":case"select":c=a.attr("filteroffoptionlabel");var d=a.attr("conditionfield");return b="auto"===a.attr("conditionsource")?d?c?c:d:"(No field selected)":("true"===a.attr("createfilteroffoption")&&c?c:"Filter")+(a.attr("condition")?" - "+a.attr("condition"):"");case"toggle":return a.attr("label")||"Filter";case"daterange":return b="Range: ","auto"===a.attr("conditionsource")?b+=a.attr("conditionfield")||"(No field selected)":a.attr("startcondition")&&a.attr("endcondition")&&(b+=a.attr("startcondition")+" <-> "+a.attr("endcondition")),b}}function ba(a){var b,c=a.attr("action");return b="set"===c?(a.attr("condition")||"[No Condition]")+" --> "+a.attr("value"):("activate"===c?"Activate ":"Deactivate ")+(a.attr("condition")||"[No Condition]")}function ca(){var a=[],b=H();return b&&b.length&&b.children("components").find("pageregion").each(function(){a.push(this)}),la.getPageXML().children("components").find("pageregion").each(function(){a.push(this)}),a}function da(a){if(!a)return!1;var b=a.indexOf("("),c=a.indexOf(")");if(!b&&c)return!1;var d=a.substring(b+1,c).trim();return d.split(",")}function ea(a){var b,c,d=a.css("background-color");return!d||"rgba(0, 0, 0, 0)"===d||"transparent"===d||(b=da(d),c=b[3],b&&c&&parseFloat(c)<.2)?a&&a.length&&a[0]!==document.body?ea(a.parent()):!1:d}function fa(a){var b=da(a);return b?(299*b[0]+587*b[1]+114*b[2])/1e3:!1}function ga(a){a||(a={});var b,c=pa("<conditions/>"),d=a.isMultiRow===!0,e=a.state;return b=pa(d===!0?'<condition type="contextrows" field="Id" mergefield="Id" operator="in" autocreated="true"/>':'<condition type="contextrow" field="Id" mergefield="Id" autocreated="true"/>'),c.append(b),e&&e.append(c),c}function ha(a){return a.replace(/__.$/g,"").replace(/^.+__/g,"").replace("_"," ")}function ia(){return ma.getLayoutFields()}var ja=a.$,ka=a.builder={},la=ka.core={},ma=a.utils,na=ma.isString,oa=ma.escapeSelector,pa=ma.makeXMLDoc,qa=a.snippet,ra=a.model,sa=a.events.publish,ta={},ua=ja(),va={},wa="BASE64",xa="BOOLEAN",ya="COMBOBOX",za="CURRENCY",Aa="DATE",Ba="DATETIME",Ca="DOUBLE",Da="EMAIL",Ea="INTEGER",Fa="NUMBER",Ga="MULTIPICKLIST",Ha="PERCENT",Ia="PHONE",Ja="PICKLIST",Ka="REFERENCE",La="STRING",Ma="TEXTAREA",Na="TEXT",Oa="TIME",Pa="URL",Qa="node",Ra="attribute";la.fonts={webFontsLoaded:!1,web:[],standard:["Arial/Arial, Helvetica, sans-serif",'Comic Sans MS/"Comic Sans MS", cursive, sans-serif','Courier New/"Courier New", Courier, monospace',"Georgia/Georgia, serif",'Lucida Sans Unicode/"Lucida Sans Unicode", "Lucida Grande", sans-serif',"Tahoma/Tahoma, Geneva, sans-serif",'Times New Roman/"Times New Roman", Times, serif','Trebuchet MS/"Trebuchet MS", Helvetica, sans-serif',"Verdana/Verdana, Geneva, sans-serif"]},la.prefillMetadataForObject=function(b,c,d){a.service.getService(c).prefillMetadataForObject(b,d)};var Sa=/[^A-Za-z0-9_]+/g,Ta=/[^A-Za-z0-9_.\[\]]+/g,Ua=/[^A-Za-z0-9_]+/g,Va=/[^A-Za-z0-9_]+/g;la.validators={modelId:function(a,b){if(Sa.test(a))return"Model Ids can only contain letters, numbers, or underscores.";var c=L(a);return c.length&&c[0]!==b[0]?"There is already another Model with this name.":!0},fieldId:function(a){var b,c=a.field,d=a.model,e=a.newFieldId;return Ta.test(e)?"Field Ids can only contain letters, numbers, underscores, periods or square brackets.":(b=d?d.children("fields, groupby").children('[id="'+oa(e)+'"]'):null,b&&b.length&&b.index()!==c.index()?"There is already another Field in this Model with this id.":!0)},conditionName:function(a,b){if(Ua.test(a))return"Condition Names can only contain letters, numbers, or underscores.";var c=P(a,b.state.closest("model").attr("id"));return c.length&&c[0]!==b[0]?'There is already another Condition with the name "'+a+'" on this Model."':!0},alphaNumericUnder:function(a,b){b||(b={});var c=b.description||"Input";return Va.test(a)?c+" may only contain letters, numbers, or underscores.":!0},uniqueAttribute:function(a,b,c){c||(c={}),c.hasOwnProperty("attribute")===!1&&(c.attribute="id");var d=!0,e=c.description||"item",f=c.attributeDescription||"value";return c.hasOwnProperty("nodeList")===!0&&ja.each(c.nodeList,function(){var g=ja(this);return g.attr(c.attribute)===a&&g!==b.state?(d="There is already another "+e+" with the "+f+" of "+a,!1):void 0}),d},numericOnly:function(a){return ma.isNumber(a)===!1?"Must contain a numeric value":!0}};var Wa={inline:"(function(skuid){\n	var $ = skuid.$;\n	$(document.body).one('pageload',function(){\n		var myModel = skuid.model.getModel('MyModelId');\n		var myComponent = skuid.component.getById('MyComponentUniqueId');\n	});\n})(skuid);",inlinesnippet:"var params = arguments[0],\n	$ = skuid.$;\n",inlinecomponent:"var element = arguments[0],\n	$ = skuid.$;\n\nelement.html('Hello <b>world!</b>');"},Xa={inline:"newInlineJS",inlinesnippet:"newSnippet",inlinecomponent:"newComponent"};la.defaultJavaScriptResourceNames=Xa,la.defaultJavaScriptResourceBodies=Wa,la.defaultStateGenerators={model:function(){return pa('<model id="'+c()+'" limit="20" query="true" createrowifnonefound="false"/>')},field:function(a){var b="string"==typeof a,c=b?a:a.id,d=pa('<field id="'+c+'"/>');if(!b&&a.needsAlias){var f=a.functionName;d.attr("name",a.alias?a.alias:e(c,f)),f&&d.attr("function",f)}return a.isRelationship&&d.attr({type:"childRelationship",limit:"10"}),d},label:function(a){return pa("<label"+(a?' id="'+a+'"':"")+"/>")},jsitem:function(){return pa('<jsitem location="inlinesnippet" name="newSnippet" cachelocation="false"/>').text(Wa.inlinesnippet)},cssitem:function(){return pa('<cssitem location="inline" name="newcss" cachelocation="false"/>')},javascript:function(){return pa("<javascript/>")},labels:function(){return pa("<labels/>")},css:function(){return pa("<css/>")}},la.coreProps={uniqueIdProp:function(a){var b=a&&a.component,c=a.isSubComponent;if(!b&&c!==!0)throw"A component param is required to use uniqueIdProp";var d={id:"uniqueid",type:"string",label:a.label||"Unique Id",helptext:a.helptext||"Required parameter that uniquely identifies this component within the Skuid framework.",validator:function(d){if(a.validator){var e=a.validator(d);if(e!==!0)return e}if(c===!0)return!0;if("string"!=typeof d||null===d||0===d.trim().length)return"Unique Id is a required field. Please provide a non-empty value.";var f,g=[],h=p();for(f in h)h[f].hideFromComponentsList!==!0&&g.push(f);var i=G().find("> components").find(g.join(","));return la.validators.uniqueAttribute(d,b,{attribute:"uniqueid",description:"component",attributeDescription:"Unique Id",nodeList:i})},onChange:function(b,d){c!==!0&&qb({type:"component.uniqueIdChange",oldId:d,newId:b}),a.onChange&&a.onChange(b,d)}};return d},domIdProp:function(a){var b={id:"domid",type:"string",label:"DOM Id",helptext:"Optional parameter that gives this component's DOM element an id attribute."};return ja.extend(b,a||{})},cssClassProp:function(a){var b={id:"cssclass",type:"string",label:"CSS Class",helptext:"Optional parameter that gives this component's DOM element a CSS class."};return ja.extend(b,a||{})}},qa.registerSnippet("skuid.builder.page.preview",function(b){function c(a){h=window.open(a||"")}function d(b,d){var e=a.platform.getBasePreviewUrl()+b.Name+(d?d:"");ja.each(m,function(a,b){e+="&"+a+"="+b}),h?h.location=e:c(e)}function e(){var b=ja("<div>").addClass("nx-basicfieldeditor nx-editor-contents").css({"min-height":"200px"});b.append(ja("<div>").css({padding:"6px",marginBottom:"10px","word-wrap":"break-word",height:"60px",width:"600px"}).html('<h1 style="font-weight: 700; font-size: 1.2em;">'+j.Name+"</h1><br/>Click <b>Go</b> to preview this page "+(a.mobile?"":" in a new window")));var c=function(){d(j),b.dialog("close")},e="Preview Page",f=a.utils.generateGUID(),g="PreviewWindowGo_"+f,h="PreviewWindowCancel_"+f;b.dialog({width:640,title:e,resizable:!1,modal:!0,close:function(){a.hotkeys.unbind(g),ja(this).remove()},buttons:[{text:"Go",id:g,click:c},{text:"Cancel",id:h,click:function(){b.dialog("close")}}]}),a.hotkeys.bind(pa("<keys/>").append(pa('<k key="return" ignoretextinputs="true"/>')),g,c,ja("#"+g))}function f(){var b='condition[type="param"][inactive!="true"]',c=g.children("models").find(b);if(la.masterPage&&(c=c.add(la.masterPageXML.children("models").find(b))),c.length){var f={},h={},i=[];c.each(function(){var a=ja(this),b=a.attr("value");if(!b||b.toLowerCase()in f)return!0;var c,d=a.closest('condition[type="join"][joinobject][inactive!="true"]'),e=a.closest("model"),g=a.attr("field");if(c=d.length?d.attr("joinobject"):e.attr("sobject")){var j,k,l=N(e),m=l.buildEntityMetadataRequest({model:e,targetEntity:c}),n=l.getCachedEntityMetadata(m),o=!n,p=g&&n&&!n.getField(g);(o||p)&&(k=h[l.name],k||(k=h[l.name]={}),delete m.service,j=JSON.stringify(m),k[j]||(k[j]={fields:{}}),g&&(k[j].fields[g]=1))}i.push(a)});var l=function(){ja.each(i,function(){var a,b,c,d=ja(this),e=d.attr("value"),g=d.attr("field"),h=d.closest('condition[type="join"][joinobject]'),i=d.closest("model"),j=N(i);if(c=h.length?h.attr("joinobject"):i.attr("sobject"),a=g?ja.extend(!0,{},w(i,g,c)):{displaytype:Na},"ID"===a.displaytype){var k=e+"__FakeLookup";a.id=k+"__c",g=a.id,ja.extend(a,{editable:!0,filterable:!0,displaytype:Ka,ref:c,rel:k+"__r"}),b={id:a.rel+"."+ma.getNameField(c)}}else a.displaytype===Ka?b={id:a.rel+"."+ma.getNameField(a.rel)}:a.displaytype===Ja&&(a.displaytype=Na);a.createable=!0,a.editable=!0,a.overrideMetadata=!0,!e||e.toLowerCase()in f||(f[e.toLowerCase()]={field:g,fieldInfo:a,refInfo:b,sobject:c,service:j})});var b=ja("<div>").addClass("nx-basicfieldeditor nx-editor-contents").prepend(ja("<div>").css({border:"solid 1px #ddd",backgroundColor:"#efefef",padding:"6px",marginBottom:"10px"}).html('A condition was set for this page that references a URL parameter. Please provide a sample value for that URL Parameter so that the Page will behave appropriately.<br/><br/>If the Parameter is on a Reference field, please enter the Name (e.g. "ACME"), not the Id, in the Autocomplete. Skuid will grab the related record and use its Id for the preview.')),c=[];ja.each(f,function(d){var e,f,g,h,i,j=ja("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item"),k=ja("<div>").addClass("nx-basicfieldeditor-item-label").text(d+(this.fieldInfo.ref?" ("+(-1!==this.fieldInfo.ref.indexOf(",")?"multiple objects":this.fieldInfo.ref)+")":"")),l=this.service;b.append(j),j.append(k),f=new a.model.Model({fields:this.refInfo?[this.fieldInfo,this.refInfo]:[this.fieldInfo],data:[],conditions:[],createRowIfNoneFound:!0,objectName:this.sobject,preventUnloadIfUnsavedChanges:!1,serviceName:l.name,adapterName:l.adapter.name}).initialize().register(),c.push(f),e=this.fieldInfo&&this.fieldInfo.ref&&-1===this.fieldInfo.ref.indexOf(",")?l.getNameField(this.fieldInfo.ref):"Name",g=f.getFirstRow(),h={fieldId:this.field,mode:"edit",useSOSLSearch:!0,SOSLFields:"Name Fields",tokenizeSearch:"true"},i=new a.ui.Field(g,f,!1,h),i.metadata=this.fieldInfo,i.element.addClass("nx-previewfield").data("param",d),i.render(),j.append(i.element)});var e=function(a){var c=b.find(".nx-previewfield"),e="",f=[];c.each(function(){var a=ja(this).data("param"),b=ja(this).data("object"),c=b.metadata.id?ma.getObjectProperty(b.row,b.id):b.element.find("input").val();return!c||c&&b&&-1!==ja.inArray(b,["ID",Ka])&&c.length<15?(f.push("Please select a value for Parameter "+a),!0):void(c&&(e+="&"+a+"="+encodeURIComponent(c)))});var g=b.find(".nx-messages");f.length?(g.length?g.empty():g=ja('<div class="nx-messages"/>').appendTo(b),ja.each(f,function(){g.append(ja('<div class="nx-property-error">'+this+"</div><br/>"))})):(d(j,e),g.length&&g.empty().hide(),a.remove())},g="Set Parameters needed to View Page: "+j.Name,h=ma.generateGUID(),k="PreviewWindowGo_"+h,l=function(){c&&c.length&&ja.each(c,function(a,b){b.unregister()})};b.dialog({width:500,height:400,title:g,resizable:!1,modal:!0,close:function(){ja(this).remove(),l(),a.hotkeys.unbind(k)},buttons:[{text:"Go",id:k,click:function(){l(),e(ja(this))}},{text:"Cancel",id:"PreviewWindowCancel_"+h,click:function(){b.dialog("close")}}]}),a.hotkeys.bind(pa("<keys/>").append(pa('<k key="return" ignoretextinputs="true"/>')),k,function(){e(b)},ja("#"+k))},m=ja.Deferred(),q=ma.size(h);if(q){o=!0,n.block({message:"Retrieving metadata for fields associated with URL Parameter Conditions..."});var r=[];ja.each(h,function(b,c){var d=a.service.getService(b||"salesforce"),e=ja.Deferred(),f=[];r.push(e.promise()),ja.each(c,function(a,b){var c=JSON.parse(a);c.service=d,b.fields&&(c.fields=Object.keys(b.fields)),f.push(c)}),d.getEntityMetadata({entities:f,ignoreMetadataOverrides:!0}).then(function(){e.resolve()},function(a){e.reject(a)})}),ja.when.all(r).then(function(){m.resolve()},function(a){m.reject(a)})}else m.resolve();m.done(function(){n.unblock()}).fail(function(a){n.block({message:a,timeout:4e3})}).always(function(){l()})}else o||p||k?e():d(j);
}var g,h,i=b.model,j=b.row||i.getFirstRow(),k=b.saveFirst===!0,l=b.editor,m=b.params||{},n=ja("body"),o=!1,p=!1,q=ia(),r=ja.Deferred();if(b.xml)g=b.xml,r.resolve();else{var s,t=!0;ja.each(q,function(a,b){return i.getField(b)?void 0:(t=!1,!1)}),t?r.resolve():(p=!0,n.block({message:"Loading page layout data to check for required parameters..."}),s=new ra.Model({objectName:i.objectName,conditions:[{field:"Id",value:j.Id}],doQuery:!0,id:"TempPageLayoutFieldsModel"+(new Date).getTime(),preventUnloadIfUnsavedChanges:!1}),ja.each(i.fields,function(a,b){s.fields.push({id:b.id})}),ja.each(q,function(a,b){i.getField(b)||s.fields.push({id:b})}),s.initialize(),r=s.updateData())}ja.when(r).then(function(){var a;if(s&&(a=s.getFirstRow(),a&&(j=i.adoptRow(a,{notify:!1})),n.unblock()),!g){var b=i.getFieldValues(j,q,!0).join("");if(!b)return void window.alert("This page does not have any layout yet. Please continue building your page before previewing.");g=pa(b)}if(k){n.block({message:"Saving Page..."});var c=function(a){n.unblock(),a.totalsuccess&&f()};l?l.save({callback:function(a){c(a)}}):i&&i.save({callback:function(a){c(a)}})}else f()})}),qa.registerSnippet("skuid.builder.page.triggerVersionCheck",function(a){t(a.model,a.row)}),g.prototype={renderComponent:function(a,b){this.componentRenderer?this.componentRenderer(a,b):h(a,b)},renderProperties:function(a,b){b.mode?a.mode=b.mode:delete a.mode,this.propertiesRenderer?this.propertiesRenderer(a,b):i(a,b)},getDefaultState:function(a,b){var c=this.defaultStateGenerator?this.defaultStateGenerator(a):pa("<"+this.id+"/>");return b&&b.setUniqueId&&!c.attr("uniqueid")&&c.attr("uniqueid",ma.generateUniqueId()),c}};var Ya={},Za=[Fa,Ea,xa,za,Aa,Ba,Ca,Ha],$a=[La,Na,Ma,Ia,Da,Ja,Pa,ya,wa],_a=[Fa,La,Ma,Ia,Da,Ja,Pa,ya,wa,Aa,Ba,Ca,Ea,Ha,za,Oa],ab={name:"=",longname:"is",validFor:["fieldvalue","param","userinfo","blank","modelmerge","dependent","searchfield","contextrow"]},bb={"data.length":Ea,hasChildRows:xa,hasNoChildRows:xa,hasRows:xa,hasNoRows:xa,hasChanged:xa,isNew:xa,isCloned:xa,isSaved:xa},cb={"":ab,"=":ab,"!=":{name:"!=",longname:"is not",validFor:["fieldvalue","param","userinfo","blank","modelmerge","dependent","contextrow"]},gt:{name:">",longname:"is greater than",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:_a},lt:{name:"<",longname:"is less than",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:_a},gte:{name:">=",longname:"is greater than or equal to",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:_a},lte:{name:"<=",longname:"is less than or equal to",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:_a},"in":{name:"in",longname:"is in the set of values",validFor:["modelmerge","multiple","join","search","contextrows"]},"not in":{name:"not in",longname:"is not in the set of values",validFor:["modelmerge","multiple","join","contextrows"]},includes:{name:"includes",longname:"includes one or more of these values",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","multiple","searchfield"],validForDisplayTypes:[Ga]},excludes:{name:"excludes",longname:"does not include any of these values",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","multiple"],validForDisplayTypes:[Ga]},"starts with":{name:"starts with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","searchfield"],validForDisplayTypes:$a},"ends with":{name:"ends with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:$a},contains:{name:"contains",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","searchfield"],validForDisplayTypes:$a},"does not contain":{name:"does not contain",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:$a},"does not start with":{name:"does not start with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:$a},"does not end with":{name:"does not end with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:$a}},db={defaultcurrency:{label:"Default Currency"},firstname:{label:"First Name"},lastname:{label:"Last Name"},email:{label:"Email"},locale:{label:"Locale"},name:{label:"Name",value:"name"},organizationid:{label:"Organization Id"},organizationname:{label:"Organization Name"},profileid:{label:"Profile Id"},profilename:{label:"Profile Name"},sessionid:{label:"Session Id"},userid:{label:"User Id"},username:{label:"User Name"},userroleid:{label:"User Role Id"},usertype:{label:"User Type"},ismulticurrencyorganization:{label:"Is Multi Currency Org"}},eb={YESTERDAY:{label:"Yesterday"},TODAY:{label:"Today"},TOMORROW:{label:"Tomorrow"},LAST_WEEK:{label:"Last Week"},THIS_WEEK:{label:"This Week"},NEXT_WEEK:{label:"Next Week"},LAST_MONTH:{label:"Last Month"},THIS_MONTH:{label:"This Month"},NEXT_MONTH:{label:"Next Month"},LAST_90_DAYS:{label:"Last 90 Days"},NEXT_90_DAYS:{label:"Next 90 Days"},LAST_N_DAYS:{label:"Last n Days",merge:!0},NEXT_N_DAYS:{label:"Next n Days",merge:!0},THIS_QUARTER:{label:"This Quarter"},LAST_QUARTER:{label:"Last Quarter"},NEXT_QUARTER:{label:"Next Quarter"},NEXT_N_QUARTERS:{label:"Next n Quarters",merge:!0},LAST_N_QUARTERS:{label:"Last n Quarters",merge:!0},THIS_YEAR:{label:"This Year"},LAST_YEAR:{label:"Last Year"},NEXT_YEAR:{label:"Next Year"},NEXT_N_YEARS:{label:"Next n Years",merge:!0},LAST_N_YEARS:{label:"Last n Years",merge:!0},THIS_FISCAL_QUARTER:{label:"This Fiscal Quarter"},LAST_FISCAL_QUARTER:{label:"Last Fiscal Quarter"},NEXT_FISCAL_QUARTER:{label:"Next Fiscal Quarter"},NEXT_N_FISCAL_QUARTERS:{label:"Next n Fiscal Quarters",merge:!0},LAST_N_FISCAL_QUARTERS:{label:"Last n Fiscal Quarters",merge:!0},THIS_FISCAL_YEAR:{label:"This Fiscal Year"},LAST_FISCAL_YEAR:{label:"Last Fiscal Year"},NEXT_FISCAL_YEAR:{label:"Next Fiscal Year"},NEXT_N_FISCAL_YEARS:{label:"Next n Fiscal Years",merge:!0},LAST_N_FISCAL_YEARS:{label:"Last n Fiscal Years",merge:!0}},fb=["Id","LastReferencedDate","LastViewedDate","Name","Type"],gb=["FirstName","LastName"],hb="skuid__Composer_Settings__c",ib=function(a,b,c){var d,e;return c&&(d=c.modelPropId,e=c.component),d||(d="model"),"model.remove"===b.type&&a.attr(d)===b.modelId?(e?e.remove(!1,!0):a.remove(),sa("skuidBuilderNeedSave"),!0):!1},jb=function(a,b,c){return"model.idChange"===b.type&&a.attr(c||"model")===b.oldId?(a.attr(c||"model",b.newId),sa("skuidBuilderNeedSave"),!0):!1},kb=function(a,b){var c,d=o(a.prop("tagName"));d&&d.handleStateEvent&&(c=d.handleStateEvent(a,b)),c!==!1&&a.children().each(function(){kb(ja(this),b)})},lb={field:function(a,b){if("search"===a.attr("type"))return"Id";if(a.attr("field")){var c=a.attr("fieldfunction"),d=c&&"DISTANCE"===c;return b+" records where <b>"+(c&&!d?c.toUpperCase()+"(":"")+a.attr("field")+(c&&!d?")":"")+"</b>"}return"[No Field Selected]"},operator:function(a){var b="search"===a.attr("type")?"in":a.attr("operator")||"",c=la.operatormap[b];return"<b>"+(c.longname||c.name)+"</b>"},value:function(a){var b,c=a.attr("type"),d=a.attr("locationsource");if("fieldvalue"===c)b="<b>"+a.attr("value")+"</b>";else if("multiple"===c)b="",a.children("values").children().each(function(){b+=ja(this).text()+", "}),b=b.substring(0,b.length-2);else if("param"===c)b=a.attr("value")?"the <b>"+a.attr("value")+" page parameters</b>":"[No Parameter Given]";else if("userinfo"===c){var e=la.userinfomap[a.attr("userinfotype")],f=e?e.label:"User Id";b="the <b>"+f+"</b> of the user running this page"}else if("blank"===c)b="a <b>blank</b> value";else if("modelmerge"===c){var g=-1!==ja.inArray(a.attr("operator"),["in","not in"]);b=a.attr("mergefield")?(g?"containing":"the value of")+" the <b>"+a.attr("mergefield")+"</b> field from "+(g?"any":"the first")+" row returned by the <b>"+a.attr("model")+"</b> model":"[No Merge Field Selected]"}else"join"===c?b=a.attr("joinfield")?"specified by returning <b>"+a.attr("joinfield")+"</b> values from a subquery on the <b>"+a.attr("joinobject")+"</b> object":"[No Join Field Selected]":"search"===c&&(b="returned by searching <b>"+(a.attr("fieldfunction")||"Name Fields")+"</b> for '<b>"+a.attr("value")+"</b>'");if(d){var h=a.attr("units");if(h&&(b+=" <b>"+("km"===h?"kilometers":"miles")+"</b> from "),"userlocation"===d)b+=" the running user's location.";else if("param"===d)b+=" the location provided in the <b>"+(a.attr("latitudefield")||"[No Latitude Parameter]")+"</b> and <b>"+(a.attr("longitudefield")||"[No Longitude Parameter]")+"</b> page parameters";else if("modelmerge"===d){var i=a.attr("locationmodel");b+=i?" the location provided in values of the <b>"+(a.attr("latitudefield")||"[No Latitude Field]")+"</b> and <b>"+(a.attr("longitudefield")||"[No Longitude Field]")+"</b> fields in the <b>"+a.attr("locationmodel")+"</b> model.":"[Please choose a Location Model and Latitude, Longitude Fields]"}}return b},state:function(a){var b="This condition",c=a.attr("state");return c?"filterableon"===c||"filterableoff"===c?(a.attr("name")&&(b+=", named <b>"+a.attr("name")+"</b>"),b+=" can be modified by filters, but is <b>"+("filterableon"===c?"on":"off")+" by default</b>."):b+=" is <b>always off</b>":b+=" is <b>always on</b>.",b},parameter:function(a){var b=a.attr("sourceparam");return b?"<b>"+ma.encodeHTML(b)+"</b> equals ":"[No Parameter provided]"}},mb=[],nb=function(a,b){return a&&a.attr?a.attr(b):0},ob=!1;a.events.subscribe("skuidBuilderNeedSave",function(){ob=!0}),a.events.subscribe("skuidBuilderComponentNeedsRefresh",function(a){va[a._GUID]=a});var pb,qb=function(a){var b=G();b&&(ja.each(l(),function(b,c){var d,e=c.builder;e&&(d=e.handleStateEvent,d&&d(c.state,a,c))}),kb(b,a),ob&&(ob=!1,sa("skuidBuilderSave")))},rb=function(){if(pb&&pb.state){var a=L(pb.state.attr("id"));if(a&&a.length)return pb}return pb=null},sb=function(a){pb=a},tb=function(a){var b,c,d=a.state,e=a.property,f=a.syntax,g=a.onChange,h=a.onClose,i=a.readonly===!0,j=a.actionItems,k=q(d,e),l=ja("<div>"),m=ja('<div id="skuidcodeditor">').addClass("nx-code-editor").appendTo(l).hide();if(l.dialog({width:a.width||"80%",height:"auto",minHeight:600,title:a.title||(i===!0?"View":"Edit")+" Inline Code",resizable:!0,modal:!0,close:function(){var a=b.getValue();l.dialog("destroy"),l.remove(),h&&h(a)}}),b=a.codeEditor=window.ace.edit("skuidcodeditor"),ja(".ui-dialog").addClass("sk-dialog-codeeditor"),ja(".ui-widget-overlay").addClass("sk-overlay-codeeditor"),f&&b.getSession().setMode("ace/mode/"+f),j){var n=l.siblings(".ui-dialog-titlebar"),o=ja("<div>").addClass("ui-dialog-titlebar-actionswrapper").css({position:"absolute",top:0,right:n.find(".ui-dialog-titlebar-close").outerWidth()}).appendTo(n);ja.each(j,function(a,b){var c=b.text,d=b.icon,e=b.action,f=b.tooltip,g=ja("<div>").addClass("nx-pagebuilder-component-actionitem").append(ja("<div>").addClass("nx-pagebuilder-component-actionicon sk-icon "+d)).appendTo(o);c&&ja("<div>").addClass("nx-pagebuilder-component-actiontext").text(c).appendTo(g),g.append(ja("<div>").addClass("nx-pagebuilder-component-actionspacer")),f&&g.skootip(f),g.click(function(a){e&&e(),a.stopPropagation()}),b.element=g})}b.setValue(k),c=b.getSession().getUndoManager(),c.reset(),b.getSession().setUndoManager(c),b.getSession().getSelection().clearSelection(),m.show(),b.getSession().on("change",function(){var a=b.getValue();r(d,e||{},a),g&&g(a)}),i===!0&&b.setReadOnly(!0)},ub=function(a,b){var c,d=a.attr("id"),e=wb(a),f=a.attr("sobject"),g=[{rel:f,ref:f,id:d,selectable:!0}];return b&&b.isPolymorphic&&(g[0].isPolymorphic=!0),e&&(c=e.split("."),g[0].selectable=!1,ja.each(c,function(a,b){g.push({rel:b,ref:b,id:d,selectable:a===c.length-1})})),g},vb=function(b,c){var d,e,f="",g="",h=b.length?b[0].id:!1,i=!h&&b.length?pa('<model sobject="'+b[0].rel+'"/>'):null,j=h&&L(h)||i,k=(j?j.attr("adapter"):"")||"salesforce",l=k?a.adapter.getAdapter(k):null,m=j?a.service.getService(j.attr("service")||"salesforce"):null,n=[],o=ja.Deferred();return c=c||{},ja.each(b,function(a,d){if(m.populateBreadcrumbFromEntityMetadata({crumb:d,index:a,modelXML:j}),!d.rel)return!1;0!==a&&(g+=d.rel+".");var e=ja("<span>").text(d.rel+(d.isPolymorphic&&d.ref!==d.rel?"("+d.ref+")":"")).addClass("nx-pagebuilder-breadcrumb");a===b.length-1&&e.addClass("last"),d.isPolymorphic&&(f+=d.ref+"."),d.ref&&-1!==d.ref.indexOf(",")&&(d.possibleTargetObjects=d.ref.split(","),c.showObjectPickerIfPolymorphic?d.isPolymorphic=!0:d.ref="Name"),a<=b.length-2&&d.selectable!==!1&&e.addClass("nx-pagebuilder-breadcrumb-link"),n.push(e)}),d=b[b.length-1].ref,e=b[b.length-1].rel,f.length>0&&-1!==f.indexOf(".")&&(f=f.substring(0,f.length-1)),o.resolve({adapterName:k,adapter:l,elements:n,endsobject:d,endrel:e,isAggregate:j?"aggregate"===j.attr("type"):!1,modelId:h,model:j,prefix:g,targetObject:f}),o.promise()},wb=function(a){return"readwrite"===a.attr("type")?a.children("methods").children('method[type="query"][pathtocontent]').first().attr("pathtocontent"):a.attr("pathtocontent")},xb=function(a){var b;return ja.each(l(),function(){return a[0]&&this.state&&this.state[0]&&this.state[0]===a[0]?(b=this,!1):void(b=!1)}),b},yb=function(){var b={},c={},d={},e=[],f=a.platform.builder.getAvailableComponentPacks();return f&&ja.each(ja.map(f,function(a){return a}).sort(function(a,b){return a.orderIndex>b.orderIndex?1:a.orderIndex<b.orderIndex?-1:0}),function(){var f=this,g=f.components,h=f.folders;g&&g.length&&ja.each(g,function(){var d,e=f.id+"__"+this.id,g=e.split("__");return"skuidcore"===g[0]||"skuidmobilecore"===g[0]?(g.shift(),d=g.join("__")):o(e)?d=e:(g.shift(),d=g.join("__")),this.builder=o(d),!this.builder||this.builder.isLightningOnly&&!a.isAura||this.builder.isVFOnly&&a.isAura?!0:void(this.folderId?(this.folderId in b||(b[this.folderId]={}),b[this.folderId][e]=this):c[f.id+"__"+this.id]=this)}),h&&h.length&&ja.each(h,function(){this.components=b[this.id],d[f.id+"__"+this.id]=this,e.push(this)})}),{noFolderComponents:c,activeFolders:d,activeFoldersList:e}},zb=function(a,b){if(!a||!b)return!1;var c=a.emitsComponentAspects,d=b.acceptsComponentAspects,e=b.rejectsComponentAspects,f=a.rejectByDefault?!1:!0;if(d&&d.length){if(!c||!c.length)return!1;f=!1,ja.each(d,function(a,b){return-1!==c.indexOf(b)?(f=!0,!1):void 0})}return f&&e&&e.length&&c&&c.length&&ja.each(e,function(a,b){return-1!==c.indexOf(b)?(f=!1,!1):void 0}),f},Ab=function(a){var b=a.component,c=a.refreshComponent===!0,d=a.labelOnChange,e=a.labelid||"label",f=a.labelName||"Label",g=a.iconOnChange,h=a.iconid||"icon",i=a.iconName||"Icon";return[{id:e,type:"string",label:f,onChange:function(a,f){""===a&&(b.state.removeAttr(e),b.save()),c===!0&&b.refresh(),d&&d(a,f)}},{id:h,type:"icon",label:i,onChange:function(a){""===a&&(b.state.removeAttr(h),b.save()),c===!0&&b.refresh(),g&&g(a)}}]};ja.extend(la,{Builder:g,getBuilder:o,getBuilders:p,getLayoutFields:ia,registerBuilder:m,registerBuilders:n,registerComponent:j,unregisterComponent:k,getComponentsList:l,dropStack:ua,componentsNeedingRefresh:va,getStoredValue:q,updateState:s,getStateProperty:q,updateStateProperty:r,getFieldInfoFromCache:w,getConditionDisplayString:v,getModelFieldComponentLabel:f,save:u,userinfomap:db,operatormap:cb,dateliteralmap:eb,getValidOperators:U,determineQuotedness:y,getMetadataForField:x,isValidFieldForPossibleTargetObjects:A,isDistanceQueryable:T,getConditionByName:P,getDefaultAliasName:e,getPageSettings:C,updatePageSettings:D,createModelSettingsService:E,createComponentSettingsService:F,getPageXML:G,getMasterPageXML:H,isInMasterPage:I,getPageRegions:ca,getAllModelsInPage:J,getPageModels:K,getFirstModel:O,getModelFromModelName:L,getAdapterFromModelName:M,getServiceFromModel:N,getModelPathToContent:wb,getSObjectForField:z,getSObjectNameFromModelName:B,getUniqueModelName:c,getUniqueFieldName:d,isFieldInModel:R,addFieldToModel:S,getLastSelectedModelComponent:rb,setLastSelectedModelComponent:sb,createBreadcrumbForModel:ub,prettyPrintAPIName:ha,processBreadCrumbInfo:vb,publishStateEvent:qb,handleModelRemove:ib,handleModelIdChange:jb,getComponentFromState:xb,getAvailableComponentsWithFolders:yb,doesParentAcceptComponent:zb,showCodeEditor:tb,getValueEditorFromMetadata:V,conditionDescriptionRenderers:lb,getCoreActionOptions:W,getValidActionOptions:Y,addValidActionOptions:X,getActionLabel:Z,getJSItemLabel:$,getCSSItemLabel:_,getFilterItemLabel:aa,getEffectItemLabel:ba,getIconLabelProps:Ab,getClosestBackground:ea,getColorLightness:fa,getDefaultConditions:ga})}(skuid),function(a){var b={init:function(b){return this.each(function(){var c,d=a(this),e=b.axis,f=b.parentStateSelector,g=b.grandparentStateSelector,h=b.component,i=b.items,j=b.placeholder,k=b.connectWith,l=b.containment;i&&(c=i.substr(2)),h&&d.sortable({items:i?i:"> *",placeholder:j?j:!1,axis:e,opacity:.75,delay:200,handle:b.handle,tolerance:"pointer",revert:200,connectWith:k?k:!1,containment:l?l:!1,start:function(a,b){"> *"==i?b.item.startingIndex=b.item.index():b.item.startingIndex=b.item.parent().children(c).index(b.item);var d=b.item.parent().closest(".nx-pagebuilder-component"),e=d.parent().children(".nx-pagebuilder-component");b.item.parentStartingIndex=e.index(d)},stop:function(a,d){var e,j,k,l=d.item.startingIndex,m="> *"==i?d.item.index():d.item.parent().children(c).index(d.item),n=d.item.parentStartingIndex,o=d.item.parent().closest(".nx-pagebuilder-component"),p=o.parent().children(".nx-pagebuilder-component"),q=p.index(o);if(n!=q){var r=h.state.find(g).eq(n).children(f).first(),s=h.state.find(g).eq(q).children(f).first();j=r.children().eq(l),j.detach(),k=s.children().length,k>m?j.insertBefore(s.children().eq(m)):m>=k&&j.appendTo(s)}else e=f?f&&g?h.state.find(g).eq(q).children(f).first():h.state.find(f).first():h.state,j=e.children().eq(l),j.detach(),k=e.children().length,k>m?j.insertBefore(e.children().eq(m)):m>=k&&j.appendTo(e);h.save(),b.onSort&&b.onSort(d.item)}})})}};a.fn.sortableComponent=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on the sortableComponent plugin"):b.init.apply(this,arguments)}}(skuid.$),function(a){var b=a.$,c=a.builder.core,d=a.utils,e=a.ui.renderers,f=c.getAllModelsInPage,g=c.getPageXML,h=c.updateState,i=c.getStoredValue,j="node",k="attribute",l=function(c){var e,f,h,i,j,k={},l=g().attr("theme")||a.builder.core.defaultTheme;if(l?(b.each(a.builder.core.availableThemes,function(a){return a===l?(j=this,!1):void 0}),j&&(h=j.skuid__Resource_Namespace__c||null,f=j.skuid__Resource_Name__c)):(i=a.page.runtimeThemeResource.split("__"),2===i.length?(h=i[0],f=i[1]):(h=null,f=i[0])),f&&(e=d.getStaticResourceUrl(f,h)),e){var m=(h?h+"__":"")+f,n={};n[m]=["skuid_theme.json","resources.json"],d.getJSONBodiesOfZIPResourceFiles(n).done(function(a){a[m].url=e,c&&c(a[m])})}return k},m={},n="sk-icon",o=function(a){a.empty(),m&&m[n]&&m[n].icons&&b.each(m[n].icons,function(c){var d=c.substr(n.length+1),e=b("<div>").addClass("nx-picker-icon "+n+" "+c).attr("alt",d).attr("title",d),f=b('<div class="nx-picker-icon-label">').text(d);b('<div class="nx-picker-icon-wrapper">').append(e,f).appendTo(a)})},p=function(a,c,e){a.addClass("nx-picker-wrapper").appendTo("body");var f=b("<div>").addClass("nx-picker-header").appendTo(a),g=b("<input>").addClass("nx-picker-filter-input").attr("type","text").appendTo(f),h=b("<div>").addClass("nx-picker-cancel inline sk-icon sk-icon-cancel").css({cursor:"pointer",margin:"0px 5px 4px"}).skootip("Clear Filter Text").appendTo(f),i=b("<div>").addClass("nx-picker-body").appendTo(a),j=b("<div>").addClass("nx-picker-header-category-wrapper").appendTo(f);b("<label>").text("Filter Icons: ").appendTo(f),j.on("click",".nx-picker-header-category",function(){var a=b(this);j.find(".nx-picker-selected").removeClass("nx-picker-selected"),a.addClass("nx-picker-selected"),n=a.data("prefix"),o(i)}),d.delayInputCallback(g,function(a){var b=i.parent();a=a.toLowerCase(),i.detach(),""===a?i.find(".nx-picker-icon-wrapper").show():(i.find("."+n).not('[alt*="'+a+'"]').parent().hide(),i.find("."+n+'[alt*="'+a+'"]').filter(":hidden").parent().show()),i.appendTo(b)}),i.skootip(),h.click(function(){g.val("").change()}),i.on("click",".nx-picker-icon-wrapper",function(){var d=b(this).children("."+n).first().attr("alt");c.val(n+"-"+d).change(),e.empty().removeClass().addClass("nx-picker-icon "+n+" inline "+n+"-"+d),a.dialog("close")});var k=function(a){m=a["skuid_theme.json"].iconsets,m&&b.each(m,function(a,c){var d=b("<div>").addClass("nx-picker-header-category").text(c.label);d.data("category",a),n===a&&d.addClass("nx-picker-selected"),d.data("prefix",a),j.append(d)}),o(i)};m.length||l(k)},q=function(a,d){var e,g,h=[],i=[],j="multipicklist"==a.type,k=a.id,l=a.storeAs;if(!j||l&&"node"!==l.type)e=d.attr(k),g=e&&"undefined"!=e,g&&i.push(e);else{var m=d.children(k);e="",g=m.length,g&&l&&"node"===l.type&&(b.each(m.children(l.name),function(){i.push(b(this).text())}),e=i.join(","))}var n=a.objectTypeFilter,o=a.entryFilter;return f().children().each(function(d){var e=b(this).attr("id"),f=-1!==b.inArray(e,i),g=c.getSObjectNameFromModelName(e);if(n)if("string"==typeof n){if(g!==a.objectTypeFilter)return!0}else if("function"==typeof n&&!n({sobjectName:g,modelId:e,modelOrder:d,isSelected:f}))return!0;return"function"!=typeof o||o(e)?void h.push({value:e,label:e}):!0}),h},r={readonly:function(a){return b('<div class="nx-fieldtext">').text(void 0===a?"":a).addClass("nx-pagebuilder-readonly-text")},models:function(a,b,c){return a.type="multipicklist",a.storeAs||(a.storeAs={type:"node",name:"model"}),a.location||(a.location="node"),a.noneSelectedText||(a.noneSelectedText="Select Models..."),a.picklistEntries=q(a,b),r.multipicklist(a,b,c)},model:function(a,c){var d=a.id,f=a.isStateless===!0,g=f===!1?c.attr(d):a.value||a.valueFunction&&a.valueFunction(),i=g&&"undefined"!=typeof g,j=q(a,c),k=a.required===!1?!1:!0;if(a.noneOption&&j.unshift(a.noneOption),k&&!i&&j.length&&(g=j[0].value,i=g&&"undefined"!=typeof g,g&&i&&!f&&h(c,{key:d,value:g})),a.readonly)return r.readonly(g);var l=e.PICKLIST.edit({value:g,entries:j,required:k,onChange:function(b,e){f||h(c,{key:d,value:b}),a.onChange&&a.onChange(b,!1,e)}}),m=b('<label class="nx-basicfieldeditor-item-select-label">').append(l);return m},"boolean":function(a,c){var f,g,i=a.id,j=a.isStateless===!0;f=j===!0?a.value||a.valueFunction&&a.valueFunction()||a.defaultValue:"true"===c.attr(i)?!0:c.attr(i)?!1:a.defaultValue||!1,g=e.BOOLEAN.edit({value:f,onChange:function(b){var d=a.beforeChange?a.beforeChange(b):null;d===!1?g.val(!g.val()):(j||h(c,{key:i,value:b}),a.onChange&&a.onChange(b))}}),a.readonly&&g.prop("disabled",!0);var k=d.generateGUID(),l="sk-builder-check-"+k;g.attr("id",l);var m=b("<div>");return m.append(g,'<label for="'+l+'"></label>'),m},condition:function(a,c){var g,i=a.id,j=a.isStateless===!0,k=j===!1?c.attr(i):a.value||a.valueFunction&&a.valueFunction();if(a.modelName){var l=f().children('[id="'+a.modelName+'"]'),m=l.children("conditions, havings").find("[name]");g=m.map(function(){var a=b(this).attr("name");return d.startsWith(a,"__autofilter__")?void 0:{value:a,label:a}})}if(a.readonly)return r.readonly(k);var n=e.PICKLIST.edit({value:k,entries:g,onChange:function(b){var d=c.attr(i);j||h(c,{key:i,value:b}),a.onChange&&a.onChange(b,d)},noneLabel:"--None--"}),o=b('<label class="nx-basicfieldeditor-item-select-label">').append(n);return o},picklist:function(a,c){var d,f,g="multipicklist"==a.type,j=a.id,k=a.storeAs,l=a.options||a.picklistEntries,m="function"==typeof l?l():l,n=[],o=a.isStateless===!0,p=function(a){var b;g&&k&&"node"===k.type?(b={childNodeName:j,storeAs:k,value:a?a.split(","):[]},n=b.value):b={key:j,value:a||""},o||h(c,b),f=!0,d=a},q=function(b){var d=i(c,a);a.beforeChange&&a.beforeChange(b,d),p(b),a.onChange&&a.onChange(b,d)},s=function(){if(g)return e.MULTIPICKLIST.edit({value:d,entries:m,noneSelectedText:a.noneSelectedText,valueDelimiter:",",selectedList:4,onChange:function(a,b){q(a,b)}});var c=e.PICKLIST.edit({value:d,entries:m,defaultValue:a.defaultValue,required:a.required!==!1,onChange:function(a,b){q(a,b)}}),f=b('<label class="nx-basicfieldeditor-item-select-label">').append(c);return f};if(o===!0)d=a.value||a.valueFunction&&a.valueFunction()||a.defaultValue,f=d&&"undefined"!=typeof d;else if(g&&k&&"node"===k.type){var t=c.children(j);d="",f=t.length,f&&k&&"node"===k.type&&(b.each(t.children(k.name),function(){n.push(b(this).text())}),d=n.join(","))}else d=c.attr(j),f=d&&"undefined"!=typeof d;if(!g&&!f&&"defaultValue"in a&&p(a.defaultValue),a.readonly){var u=b.map(m,function(a){return a.value===d?a:void 0});return r.readonly(u[0]&&u[0].label||d)}return s()},filepath:function(a,c){var f,g,i,j,k=a.id,l=a.isStateless===!0,m=l===!1?c.attr(k):a.value||a.valueFunction&&a.valueFunction(),n=function(){var c,e=b.Deferred();return f=a.getResourceName(),g=a.getResourceNamespace(),f?j&&j.length>=0?e.resolve(j).promise():(c=d.getStaticResourceUrl(f,g,void 0,(new Date).getTime()),d.loadJS(d.getStaticResourceUrl("JSZip","skuid")).done(function(){JSZipUtils.getBinaryContent(c,function(a,c){a&&e.reject(a);var f;try{f=new JSZip(c),j=[],f.files&&b.each(f.files,function(a,b){b.options&&b.options.dir||d.startsWith(a,".")||d.contains(a,"/.")||j.push(a)}),e.resolve(j)}catch(g){e.reject(g)}})}).fail(function(a){e.reject(a)}),e.promise()):(j=!1,e.reject().promise())};if(a.readonly)i=b("<div>").addClass("nx-fieldtext").text(m||"").css("margin-top","6px");else{i=b("<div>");var o=e.AUTOCOMPLETE.edit({source:function(a,b,c,d){c(),n().then(function(c){d(),b(c.filter(function(b){return-1!==b.toLowerCase().indexOf(a.term.toLowerCase())}))},function(){d(),b([])})},onChange:function(b,d){var e=d.item.value;l||h(c,{key:k,value:e}),a.onChange&&a.onChange(e)},value:m,parentElem:i});i.append(o)}return i},multipicklist:function(a,b,c){return r.picklist(a,b,c)},sobject:function(b,c){var d=b.id,f=b.isStateless===!0,g=f===!1?c.attr(d):b.value||b.valueFunction&&b.valueFunction();return e.ENTITY.edit({value:g,service:function(){return a.service.getService(b.serviceName||"salesforce")},readOnly:g||b.readonly,onChange:function(a,e){f||h(c,{key:d,value:a}),b.onChange&&b.onChange(a,e)}})},autocomplete:function(c,f){var g,i,j=b("<div>").addClass("nx-field"),k=c.id,l=c.sobject,m=c.order,n=c.onChange,o=c.fieldsToSearch||["Name"],p=c.fieldsToReturn||["Name"],q=c.displayTemplate||"{{Name}}",s=c.valueTemplates||{},t={},u=k&&f.attr(k)||c.valueFunction&&c.valueFunction(),v=c.isStateless===!0;return k in s||(s[k]="{{Name}}"),g=c.readonly?r.readonly(d.decodeHTML(u||"")):e.AUTOCOMPLETE.edit({minLength:2,value:d.decodeHTML(u),source:c.source||function(c,d,e,f){if(c.term in t)return void d(t[c.term]);i=c.term.split(" ");var g={fields:[{id:"Id"}],conditions:[],objectName:l,doQuery:!0};b.each(p,function(a,b){"Id"!=b.toLowerCase()&&g.fields.push({id:b})}),m&&(g.order=m),b.each(o,function(a,c){b.each(i,function(a,b){g.conditions.push({field:c,operator:"LIKE",value:"%"+b+"%"})})});for(var h=[],j=1;j<=g.conditions.length;j++)h.push(""+j);g.conditionLogic=h.join("OR"),e(),a.remote().load(JSON.stringify(g),function(a,b){f();var e=JSON.parse(a),g=e.models[0];b.status&&(t[c.term]=g.data,d(g.data))},{escape:!1})},onChange:function(c,d){var e={};return b.each(s,function(b,c){var g=a.Mustache.render(c,d.item);e[b]=g,v||h(f,{key:b,value:g})}),n&&n(e[k],d.item),!1},onFocus:function(b,c){return g.val(a.Mustache.render(s[k],c.item)),!1},onClose:function(){g.focus()},onClear:function(){var a={};return b.each(s,function(b){var c="";a[b]=c,h(f,{key:b,value:c})}),n&&n(a[k]),!1},optionRenderer:function(c,d){var e="<a>"+a.Mustache.render(q,d)+"</a>";return i&&b.each(i,function(a,b){e=e.replace(b,"<b>"+b+"</b>")}),b("<li></li>").data("ui-autocomplete-item",d).append(e).appendTo(c)},parentElem:j}),j.append(g),j},icon:function(a,c){var e,f=a.id,g=a.isStateless===!0,i=f&&c.attr(f)||a.valueFunction&&a.valueFunction()||a.defaultValue||"",j=b("<div>").addClass("nx-pagebuilder-property-button-area"),k=b("<input>").attr("type","text").addClass("nx-picker-icon-input").val(i).appendTo(j),l=b("<button>").addClass("nx-picker-icon-btn nx-picker-icon-runtime"),m=b("<div>"),n=b("<div>").addClass("nx-pagebuilder-property-button-wrapper");if(""===i?m.removeClass().addClass("nx-picker-icon").text("?"):m.addClass("nx-picker-icon sk-icon "+i),a.readonly){var o=b("<div>").addClass("nx-pagebuilder-property-button-area").append(r.readonly(i));return n.append(m).css("margin-top","6px"),[n,o]}return l.append(m),l.on("click",function(){e?e.dialog("open"):(e=b("<div>"),p(e,k,m),e.dialog({width:800,height:400,title:"Choose an Icon",resizable:!0,modal:!0}))}),n.append(l),d.delayInputCallback(k,function(b){""===b?m.removeClass().addClass("nx-picker-icon inline").text("?"):m.empty().removeClass().addClass("nx-picker-icon sk-icon inline "+b),g||h(c,{key:f,value:b}),a.onChange&&a.onChange(b)}),[n,j]},formula:function(e,f){var g,l=e.fieldState,m=l.attr("name")?l.attr("name"):l.attr("id"),n=e.id,o=b("<div>").addClass("nx-field").css({"float":"left",width:"100%"}),p=b("<textarea>").css({height:"155px","font-family":"Courier"}).appendTo(o),q=function(a){var b=p.val(),c=p.getCursorPosition(),d=[];0===c?a+=b:c===b.length?a=b+a:(d[0]=b.substring(0,c),d[1]=b.substring(c,b.length),a=d[0]+a+d[1]),p.val(a).trigger("change")},s=b('<div class="nx-actionbutton">').actionSelect({items:[{value:"",label:"Insert Field",icon:"sk-icon-add",onSelect:function(){var d,f,g,h,i=!1,j=function(){e.modelName&&(d=e.modelName),d&&(f=c.getModelFromModelName(d)),i=c.getSObjectNameFromModelName(d)};if(h)g||h.dialog("open");else{h=b("<div>").addClass("nx-picker-wrapper").css("z-index","104");var k=b("<div>").appendTo(h).addClass("nx-pagebuilder-fieldpicker-header"),l=b("<div>").appendTo(k),n=b("<div>").appendTo(k).addClass("nx-pagebuilder-fieldpicker-headertext"),o=b("<div>").appendTo(h).addClass("nx-pagebuilder-fieldpicker-body"),p=e.showObjectPickerIfPolymorphic;if(j(),i||f){var r=i?i:f,s=[{rel:r,ref:r,id:d}];f&&c.getModelPathToContent(f)&&s&&(s=c.createBreadcrumbForModel(f)),p&&(s[0].isPolymorphic=!0),g=a.builder.desktop.makeFieldSelector(s,{showObjectPickerIfPolymorphic:p,showUiOnlyFields:!0,useMetadataOverrides:!0,element:o,headertext:n,filterboxwrapper:l,onChange:function(a){q("{{"+a.fieldId+"}}"),h.dialog("close")},filter:function(a){var b=a.name?a.name:a.id;return b!==m}})}b.when(g).then(function(){h.dialog({width:800,height:400,title:"Select Field",resizable:!1,modal:!1})})}}}],type:"button"}),t=b('<div class="nx-actionbutton">').actionSelect({onItemSelect:function(a){a.value&&q(a.value)},maxHeight:"170px",items:[{value:"",label:"Insert Operator",icon:"sk-icon-add"},{value:"+",label:"+  Add"},{value:"-",label:"-  Subtract"},{value:"*",label:"*  Multiply"},{value:"/",label:"/  Divide"},{value:"==",label:"== Equals"},{value:"!=",label:"!= Does not Equal"},{value:">",label:"> Greater than"},{value:">=",label:">= Greater than or Equal to"},{value:"<",label:"< Less than"},{value:"<=",label:"<= Less than or Equal to"}],type:"button"}),u=b('<div class="nx-actionbutton">').actionSelect({uniqueId:"function-inserter",onItemSelect:function(a){a.value&&q(a.value)},maxHeight:"170px",items:[{value:"",label:"Insert Function",icon:"sk-icon-add"}].concat(b.map(d.validFormulaFunctions,function(a,b){return{value:a.defaultState?a.defaultState:b+"()",label:b}})),type:"button"}),v=b("<div>").text("Enter Formula").addClass("nx-basicfieldeditor-item-label").css({"float":"left",width:"20%",clear:"none"}),w=b("<div>").addClass("nx-pagebuilder-property-button-wrapper").css({position:"relative",right:"-4px"}).append(s,t,u),x=b("<div>").append(v,w),y={},z=function(a){y.value=a,h(f,y)};e.location==j&&n?y.childNodeName=n:e.location==k&&(y.key=n),g=i(f,e),!g&&e.defaultValue&&(g=e.defaultValue,y.value=g,h(f,y));var A=c.getComponentFromState(f);return e.readonly||A&&"readonly"===A.mode?(v.text("Formula Value"),[v,r.readonly(g)]):(g&&p.val(g),d.delayInputCallback(p,function(a){z(a),e.onChange&&e.onChange(a)}),[x,o])},numberbox:function(a,c){
var d,e,f=i(c,a)||0,g=b("<div>").addClass("sk-numberbox-wrapper"),j=[],k=a.boxes,l=function(a){b.each(j,function(c){b(this).toggleClass("sk-selected",a>c)})};if(a.readonly)return r.readonly(f);for(e=0;k>e;e++)d=b("<div>").addClass("sk-numberbox").css("width",100/k+"%"),j.push(d);return g.append(j),l(f),g.on("click",".sk-numberbox",function(){var d=b(this).index()+1;h(c,{value:d,key:a.id}),l(d),a.onChange&&a.onChange(d)}),g},quicknumber:function(a,c){var d=i(c,a),f=b("<div>").css({width:"80%",display:"inline-block"}),g=b("<div>").css({width:"20%",display:"inline-block"}),j=function(c){var d=f.children();d.filter(".sk-selected").removeClass("sk-selected"),b.each(d,function(d){c==a.options[d]&&b(this).addClass("sk-selected")})},k=function(b){h(c,{value:b,key:a.id}),j(b),l.val()!=b&&l.val(b),a.onChange&&a.onChange(b)};if(a.options&&(b.each(a.options,function(){var a=b("<div>").addClass("sk-optionbutton").text(this);d==this&&a.addClass("sk-selected"),f.append(a)}),f.on("click",".sk-optionbutton",function(){k(a.options[b(this).index()])})),a.readonly)g.append(r.readonly(d)),f.off("click");else{var l=e.TEXT.edit({value:i(c,a),onChange:k});g.append(l)}return[f,g]},color:function(a,b){var c=a.id,d=a.isStateless===!0,f=c&&b.attr(c)||a.valueFunction&&a.valueFunction()||a.defaultValue||"";return e.COLOR[a.readonly?"read":"edit"]({value:f,placeholder:a.placeholder,onChange:function(e,f){a.beforeChange&&a.beforeChange(e,f),d||h(b,{key:c,value:e}),a.onChange&&a.onChange(e)}})},csssize:function(d,e){var f,g,i=d.id,j=d.isStateless===!0,k=i&&e.attr(i)||d.valueFunction&&d.valueFunction()||d.defaultValue||"",l=function(){var a=f&&g?f+g:"";d.beforeChange&&d.beforeChange(a),j||h(e,{key:i,value:a}),d.onChange&&d.onChange(a)},m=a.utils.getCSSSizeObj(k),n=[],o=b("<div>"),p=[{value:"px",label:"px"},{value:"em",label:"em"},{value:"%",label:"%"},{value:"vh",label:"vh"},{value:"vw",label:"vw"}];return d.allowUnits?b.each(d.allowUnits,function(a,b){var c=p.filter(function(a){return a.value===b})[0];c&&n.push(c)}):n=p,0===n.length?o:(m?(f=m.number+"",g=m.unit):(f="",g=n[0].value),g||(g=d.defaultUnit||"px"),d.readonly?r.readonly(f+(f?" "+g:"")):(o.append(r.picklist({isStateless:!0,value:g,picklistEntries:n,onChange:function(a){g=a,l()}}).css("width","50px").css("float","right")),o.append(b("<div>").append(c.getValueEditorFromMetadata({isStateless:!0,valueFunction:function(){return f},validator:c.validators.numericOnly,onChange:function(a){f=a,l()}})).css("margin-right","58px")),o))},custom:function(c,d){var e=c.renderProperty,f=b("<div>");if(!e||"function"!=typeof e)return f;var g={element:f,state:d,updateState:function(){var b,c=arguments;c.length>=1?(b=1===c.length?{key:c[0].key,value:c[0].value}:{key:c[0],value:c[1]},h(d,b)):a.events.publish("skuidBuilderSave")}};return e(g),g.element},standard:function(a,b){return a.readonly?r.readonly(i(b,a)):c.getValueEditorFromMetadata(a,b,a.id)}};c.buildIconPicker=p,c.getThemeResources=l,c.propertyRenderers=r}(skuid),function(a){function b(a,b){b=b||{};var c,d,e,f,g=a.state,h=b.modelName,i={modelName:h};c=b.fieldMetadata?b.fieldMetadata:X(a,i),d=c?c.displaytype:!1,e=_(d),f=e?["fieldvalue","param","blank","modelmerge"]:b.validTypes;var j={id:"type",type:"picklist",label:(e?"Distance value ":"")+"Content",defaultValue:"fieldvalue",picklistEntries:[{label:"Single specified value",value:"fieldvalue"},{label:"Multiple specified values",value:"multiple"},{label:"Page/URL parameter value",value:"param"},{label:"Running user attribute",value:"userinfo"},{label:"None - blank value",value:"blank"},{label:"Field from another model",value:"modelmerge"},{label:"Result of subquery",value:"join"},{label:"Another field from row",value:"dependent"}],onChange:function(c,d){var e=X(a,i),f=e?e.displaytype:null;"fieldvalue"===d&&"multiple"===c&&g.attr("value")?g.append(L("<values/>").append(L("<value/>").text(g.attr("value")))):g.empty(),g.attr("value",""),g.attr("operator")in $(c,f)||g.attr("operator",-1!==G.inArray(c,["multiple","join"])?"in":"="),g.removeAttr("enclosevalueinquotes model joinfield joinobject label"),"modelmerge"===c&&g.attr("model",V().attr("id")),"blank"===c&&g.attr("value","null"),Q(a,i),a.save().refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}};if(f){var k=[];G.each(j.picklistEntries,function(){-1!==G.inArray(this.value,f)&&k.push(this)}),j.picklistEntries=k}var l={id:"value",type:"string",label:"Value",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()},metadata:c},m={id:"value",type:"string",label:"Parameter",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},n={id:"novaluebehavior",type:"picklist",label:"If this Parameter is not provided, then...",helptext:"Specifies the action to take if the specified URL Parameter is not provided.",defaultValue:"",picklistEntries:[{label:"Set its value to Blank",value:""},{label:"Deactivate this Condition",value:"deactivate"},{label:"Abort this Model's Query",value:"noquery"}]},o={id:"userinfotype",type:"picklist",label:"UserInfo Property",helptext:"The UserInfo variable to merge in as the value for the selected field.",defaultValue:"userid",picklistEntries:[],onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}};G.each(I.userinfomap,function(a,b){o.picklistEntries.push({label:b.label,value:a})});var p={id:"mergefield",type:"field",label:"Source Field",modelprop:"model",defaultValue:"Id",displayTypeFilter:function(b,c){var d=a.state.attr("model");return d?I.isFieldInModel(d,c):!1},onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},q={id:"model",type:"model",label:"Source Model",helptext:"The Model whose first row's specified Merge Field's value will be used as the merge value for this Condition.",onChange:function(){a.refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},r={id:"novaluebehavior",type:"picklist",label:"If no row in Source Model, then...",helptext:"Specifies the action to take if no rows are returned by the source model.",defaultValue:"deactivate",picklistEntries:[{label:"Deactivate this Condition",value:"deactivate"},{label:"Abort this Model's Query",value:"noquery"}]},s={id:"joinobject",type:"sobject",label:"Join Object",helptext:"The Object to join in when performing a Semi-Join Sub-Select, e.g. Case in 'WHERE Id in (SELECT ContactId FROM Case)' ",onChange:function(){a.refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},t={id:"joinfield",type:"field",label:"Join Field",helptext:"The field to join when performing a Semi-Join Sub-Select, e.g. ContactId in 'WHERE Id in (SELECT ContactId FROM Case)' ",sobject:g.attr("joinobject"),displayTypeFilter:["ID",ua],onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},u={id:"logic",type:"string",label:"Subcondition Logic",onChange:function(){a.refresh()}},v={id:"values",location:"node",type:"multiitem",storeAs:{type:"node",name:"value"},label:"Values",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()},metadata:c},w={id:"depfield",type:"field",label:"Depends On",sobject:Z(h),onChange:function(){a.refresh()}},x=[j,m],y=[j,l],z={fieldvalue:y,multiple:[j,v],param:x,userinfo:[j,o],blank:[j],modelmerge:[j,q,p,r],join:[j,s,t,u],dependent:[j,w]};a.isRenderCondition||x.push(n);var A=z[g.attr("type")||"fieldvalue"];if(e){var B={id:"locationsource",type:"picklist",label:"Comparison Location Source",helptext:'For "DISTANCE from Location" queries, you must specify a source Latitude and Longitude defining the Location to compare against. The Latitude and Longitude can be retrieved from fields on another Model, or from Page/URL Parameters.',defaultValue:"modelmerge",picklistEntries:[{label:"Page/URL parameter values",value:"param"},{label:"Running user's location",value:"userlocation"},{label:"Fields from another model",value:"modelmerge"}],onChange:function(c){g.removeAttr("locationmodel latitudefield longitudefield"),"modelmerge"===c&&g.attr("locationmodel",V().attr("id")),a.save().refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}};A.push({id:"units",type:"picklist",label:"Units",defaultValue:"mi",picklistEntries:[{label:"Miles",value:"mi"},{label:"Kilometers",value:"km"}],onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},B);var C=g.attr(B.id)||B.defaultValue;"modelmerge"===C?A.push({id:"locationmodel",type:"model",label:"Location Source Model",helptext:"The Model whose first row's specified Latitude / Longitude Fields' values will be used as the source for this DISTANCE Condition.",onChange:function(){a.refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},{id:"locationnovaluebehavior",type:"picklist",label:"If no row in Location Source Model, then...",helptext:"Specifies the action to take if no rows are returned by the Location Source Model.",defaultValue:"deactivate",picklistEntries:[{label:"Deactivate this Condition",value:"deactivate"},{label:"Abort this Model's Query",value:"noquery"}]},{id:"latitudefield",type:"field",label:"Latitude Source Field",modelprop:"locationmodel",displayTypeFilter:["STRING",ia,"NUMBER"],onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},{id:"longitudefield",type:"field",label:"Longitude Source Field",modelprop:"locationmodel",displayTypeFilter:["STRING",ia,"NUMBER"],onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}}):"param"===C?A.push({id:"latitudefield",type:"string",label:"Latitude Parameter",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},{id:"longitudefield",type:"string",label:"Longitude Parameter",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},{id:"locationnovaluebehavior",type:"picklist",label:"If Latitude / Longitude Parameters are not provided, then...",helptext:"Specifies the action to take if either the Latitude or Longitude URL Parameters are not provided.",defaultValue:"deactivate",picklistEntries:[{label:"Deactivate this Condition",value:"deactivate"},{label:"Abort this Model's Query",value:"noquery"}]}):"userlocation"===C&&(A.push({id:"locationnovaluebehavior",type:"picklist",label:"If user's location cannot be determined, then...",helptext:"Specifies the action to take if the user's location cannot be determined, which may happen if the user decides to deny the browser permission to access location data.",defaultValue:"deactivate",picklistEntries:[{label:"Deactivate this Condition",value:"deactivate"},{label:"Abort this Model's Query",value:"noquery"}]},{id:"locationchangebehavior",type:"boolean",label:"Re-query Model when user's location changes",helptext:"If true, then whenever the user's location changes by more than a certain amount, this Model will be requeried.",defaultValue:!0,onChange:function(){b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}}),"false"!==g.attr("locationchangebehavior")&&A.push({id:"locationdelta",type:"string",label:"Minimum change in location before re-query (in meters)",helptext:"The user's location must change by at least this many meters before this Model will be re-queried.",defaultValue:"100",validator:function(a){return a&&a>0&&J.isNumber(a)?!0:"Value must be a number greater than 0."}}))}return A}function c(a,b){b=b||{};var c=a.state,d=b.modelname||b.modelName,e=!1;"search"===c.attr("type")&&(e=!0,c.attr("field","Id"));var f={id:"field",type:"field",label:"Field",readonly:e,onChange:function(e,f,g){ba(c,{key:"fieldtargetobjects",value:g});var h=X(a),i=h?h.displaytype:!1;"fieldvalue"===c.attr("type")&&(i===ea?"false"!==c.attr("value")&&c.attr("value","true"):i===na?c.attr("value","0"):-1!==G.inArray(i,[fa,ia])?c.attr("value","0.0"):-1!==G.inArray(i,[ga,ha])&&c.attr("value","")),_(i)||c.removeAttr("fieldfunction locationsource latitudefield longitudefield locationnovaluebehavior"),Q(a,{modelName:d}),a.save().refresh(),b.handleChange&&b.handleChange()}};return b.sobject?f.sobject=b.sobject:b.modelprop?f.modelprop=b.modelprop:d&&(f.modelname=d),b.addFieldToModel&&(f.addFieldToModel=!0),b.showObjectPickerIfPolymorphic&&(f.showObjectPickerIfPolymorphic=!0),f}function d(a,b){b=b||{};var d=a.state,e=c(a,b),f=[e],g="DISTANCE",h=b.fieldMetadata||X(a),i=h&&h.displaytype;if(_(i)){var j=!1,k=function(a,b,c){(c||d.attr(a)!==b)&&(d.attr(a,b),j=!0)};if(k("fieldfunction",g),d.attr("units")||k("units","mi",!0),d.attr("value")||k("value","5",!0),k("enclosevalueinquotes","false"),-1===G.inArray(d.attr("operator"),["lt","gt"])&&k("operator","lt",!0),j)return a.save(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh(),!1;f.push({id:"fieldfunction",defaultValue:g,type:"picklist",picklistEntries:[{value:g,label:g}],required:!0,readonly:!0,label:"Field Function"})}return a.isSubcondition&&"join"===d.parent().closest("condition").attr("type")&&(e.sobject=d.parent().closest("condition").attr("joinobject")),f}function e(a,b){b||(b={});var c=a.state,d=b.id||"operator",e=b.label||"Operator",f=b.defaultValue||"=",g=b.conditionType||c.attr("type"),h=b.fieldMetadata||!1,i=h?h.displaytype:!1,j={id:d,type:"picklist",label:e,defaultValue:f,picklistEntries:[],onChange:function(c){a.save().refresh(),b.handleChange&&b.handleChange(c)}};return _(i)?j.picklistEntries.push({label:"<",value:"lt"},{label:">",value:"gt"}):G.each($({type:g,displayType:i}),function(a,b){j.picklistEntries.push({label:b.name,value:a})}),j}function f(a,b){b=b||{};var c=a.state,d={id:"state",type:"picklist",label:"Condition State",defaultValue:"",picklistEntries:[{label:"Always On",value:""},{label:"Filterable Default On",value:"filterableon"},{label:"Filterable Default Off",value:"filterableoff"},{label:"Always Off",value:"off"}],onChange:function(d){if(d&&"filterableon"!==d?c.attr("inactive","true"):c.attr("inactive","false"),"filterableon"!==d&&"filterableoff"!==d)c.removeAttr("name");else if(!c.attr("name")&&(c.attr("field")||c.attr("sourceparam"))){for(var e=c.attr("field")||c.attr("sourceparam"),f=e,g=1;S(f,c.closest("model").attr("id")).length;)f=e+""+g++;c.attr("name",f)}a.save().refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},e={id:"name",type:"string",label:"Condition Name",helptext:"A unique name for this Condition, allowing it to be affected by Filters.",validator:function(b){return I.validators.conditionName(b,a)},onChange:function(d,e){aa({type:"model.condition.nameChange",modelId:c.closest("model").attr("id"),oldName:e,newName:d}),a.save().refresh(),b.handleChange&&b.handleChange()}};return"filterableon"===c.attr("state")||"filterableoff"===c.attr("state")?[d,e]:[d]}function g(a,b){function c(a){if(a){var b,c=J.extractFieldsFromTemplate(a,{ignoreGlobals:!0});if(c&&c.length){for(b=c.length-1;b>=0;b--)"."===c[b]&&c.splice(b,1);d?Array.prototype.push.apply(d,c):d=c}}}b=b||{};var d,e=a.state,f=e.closest("model"),g={id:"sourceparam",label:"URL Merge Parameter Name",onChange:function(){"param"!==e.attr("sourcetype")&&(e.attr("sourcetype","param"),a.save()),a.refresh(),b.handleChange&&b.handleChange()}};return"readwrite"===f.attr("type")?f.children("methods").first().children().each(function(){c(G(this).attr("endpoint"))}):c(f.attr("endpoint")),d&&d.length?(g.type="picklist",g.picklistEntries=G.map(d.sort(),function(a){return{value:a,label:a}})):(g.type="readonly",g.value="This Model's Service URL does not contain any Merge Parameters.",g.isStateless=!0),[g]}function h(b,c){var d,e,f,g,h,i,j=b.state,k=j.attr("adapter")||Ba,l=k===Ba,m="OData1-3"===k||"Sharepoint"===k,n="REST"===k,o=a.adapter.get(k),p=function(b){var c=a.service.map();return G.map(Object.keys(c).sort(function(a,b){return a===Ba?-1:b>a}),function(a){var d=c[a];return d.adapterName===b?{value:a,label:a===Ba?"Current Salesforce Org":a}:void 0})},q=I.pageModel,r=I.pageRow,s=q.getFieldValue(r,"skuid__MasterPage__c"),t=[],u=a.adapter.map(),v=function(){var a=j.attr("service")||Ba;return a===Ba},w=function(a){a.children("fields, groupby, conditions, actions, methods").empty();var b=a.attr("service"),c=["adapter","service","id","query","createrowifnonefound","unloadwarningifunsavedchanges"];a.removeAttr(G.map(a.attr(),function(a,b){return-1===G.inArray(b,c)?b:void 0}).join(" ")),b&&b!==Ba&&a.attr("processonclient","true")};if(n&&(d=!1,e=j.children("methods"),e.length&&(f=e.children('[type="query"]').first(),f.length&&(d=!0))),g=[{id:"id",type:"string",label:"Model Id",helptext:"A unique identifier for this Model. Can only contain letters, numbers, or underscores.",validator:function(a){return I.validators.modelId(a,b)},onChange:function(a,d){b.headerTitle?b.headerTitle.text(b.builder.name+" - "+a):b.element&&(b.element.find(".nx-pagebuilder-modeltag").children().eq(1).text(a),b.element.find(".nx-pagebuilder-fieldtag").attr("data-model",a)),c&&c.setTitle(b.builder.name+" - "+a),aa({type:"model.idChange",oldId:d,newId:a}),K.publish("skuidBuilderRefreshModelList")}}],J.size(u)>1){var x=[];G.each(u,function(a){if(a===Ba)x.push({value:Ba,label:"Salesforce"});else{var b=p(a);b&&b[0]&&x.push({value:a,label:a})}}),j.attr("adapter")||(j.attr("adapter",Ba),b.save()),g.push({id:"adapter",type:"picklist",label:"Data Source Type",picklistEntries:x,defaultValue:Ba,onChange:function(a,d){var e=p(a);e&&e[0]&&j.attr("service",e[0].value),"undefined"!=typeof a&&"undefined"!=typeof d&&w(j),b.save().refresh().rebuildProps(c)}})}return i=p(k),i.length>1&&(j.attr("adapter")!==Ba||j.attr("service")||(j.attr("service",Ba),b.save()),g.push({id:"service",type:"picklist",label:"Data Source",picklistEntries:i,onChange:function(a,d){"undefined"!=typeof a&&"undefined"!=typeof d&&w(j),b.save().refresh().rebuildProps(c)}})),m?g.push({id:"sobject",type:"sobject",adapterName:k,serviceName:j.attr("service"),label:"External Object Name",onChange:function(a){if(a&&(!j.attr("label")||!j.attr("labelplural"))){var c=a.split(".").pop();j.attr("label")||j.attr("label",c),j.attr("labelplural")||j.attr("labelplural",c+(J.endsWith(c,"s")?"":"s")),b.save()}}},{id:"label",type:"string",label:"Model Label"},{id:"labelplural",type:"string",label:"Model Plural Label"}):n?(g.push({id:"type",type:"picklist",label:"Model Behavior",defaultValue:"",picklistEntries:[{value:"",label:"Read-Only"},{value:"readwrite",label:"Read/Write"}],onChange:function(a,d){var g,h,i;"readwrite"!==a||d?a||"readwrite"!==d||(e=j.children("methods"),e.length&&(f=e.children('[type="query"]').first(),f.length&&(g=f.attr("pathtocontent"),h=f.attr("verb"),i=f.attr("endpoint"),j.attr({pathtocontent:g,verb:h,endpoint:i}),e.remove(),b.save()))):(g=j.attr("pathtocontent"),h=j.attr("verb"),i=j.attr("endpoint"),e=j.children("methods"),e.length||(e=L("<methods/>").appendTo(j)),f=L("<method/>").attr({type:"query",verb:h,endpoint:i,pathtocontent:g}).appendTo(e),j.removeAttr("verb endpoint pathtocontent"),b.save()),b.refresh().rebuildProps(c)}}),"readwrite"!==j.attr("type")&&(h=o.getMethodProperties({component:b,propertiesViewer:c,type:"query"}),h&&h.length&&(h[0].props?Array.prototype.push.apply(g,h[0].props):Array.prototype.push.apply(g,h))),g.push({id:"label",type:"string",label:"Model Label"},{id:"labelplural",type:"string",label:"Model Plural Label"})):l&&g.push({id:"sobject",type:"sobject",adapterName:k,serviceName:j.attr("service"),label:"Salesforce Object Name",onChange:function(){b.refresh(),a.mobile&&a.mobile.processResponsiveElements()}},{id:"type",type:"picklist",label:"Model Behavior",picklistEntries:[{label:"Basic",value:""},{label:"Aggregate",value:"aggregate"}],defaultValue:"",onChange:function(){j.children("fields, groupby").empty(),b.save().refresh()}}),!n||"readwrite"!==j.attr("type")||d?g.push({id:"query",type:"boolean",label:"Load Model data on page load",helptext:"Typically this should be true, unless this Model will be used as a Calendar component Event Source. If false, then no data rows will be loaded in to this Model when the page initially loads.",defaultValue:!0,onChange:function(){b.rebuildProps(c)}}):n&&!d&&"readwrite"===j.attr("type")&&"true"===j.attr("query")&&(j.attr("query","false"),b.save()),(l||m)&&g.push({id:"limit",type:"string",label:"Max # of records (Limit)",helptext:"The maximum number of data records to pull in to this Model, out of all data records that match the Model's Conditions."},{id:"orderby",type:"string",label:"Fields to order records by",helptext:"How to order the data records pulled in to this Model, e.g. 'LastName DESC, FirstName' would order by LastName going from Z to A, then by FirstName going from A to Z (this is the ORDER BY clause of the generated SOQL statement)."}),g.push({id:"createrowifnonefound",type:"boolean",label:"Create default row if Model has none",helptext:"Typically used for Pages functioning as Overrides for the 'New' action. If true, then when this Page loads, if no data records exist in the Model, then a default row will be automatically created."}),(l||m)&&v()&&t.push({id:"doclone",type:"picklist",label:"Clone data returned by Model query",helptext:"Should all data returned by querying this Model be 'cloned', meaning that data in the Model will be marked as 'New' so that when the Model is saved, new records will be created, rather than updates made to existing records?",picklistEntries:[{label:"Yes, always",value:"yes"},{label:"Yes, if 'clone' and 'id' parameters are present in URL",value:""},{label:"No",value:"no"}],defaultValue:""}),l&&(t.push({id:"queryallrows",type:"boolean",label:"Query Deleted / Archived records",helptext:'For developers: adds the SOQL "ALL ROWS" clause to your query. If true, then deleted records and/or archived Tasks will be included in your Model\'s query --- by default, they are not.'},{id:"forview",type:"boolean",label:'Update Salesforce "Recently Viewed" info',helptext:"For developers: adds the SOQL \"FOR VIEW\" clause to your query. Use this if you want this Model to feed into Salesforce's tracking of Recently Viewed Items. When this Model's query is run, the LastViewedDate for all records in this Model will be updated, and new records will be added to the RecentlyViewed object. "}),v()&&t.push({id:"processonclient",type:"boolean",defaultValue:s&&"true"===I.getMasterPageXML().attr("cachepage"),label:"Process Model client-side",helptext:"If this page, or its master page, has Page Caching enabled, this is HIGHLY RECOMMENDED, unless you expect this Model's data to rarely change. Causes Skuid to construct this Model client-side in JavaScript rather than server-side, which prevents your Model metadata and data from being cached, which could result in stale / inaccurate metadata/data being presented to your users."})),"yes"===j.closest("skuidpage").attr("unsavedchangeswarning")&&t.push({id:"unloadwarningifunsavedchanges",type:"boolean",defaultValue:!0,label:"Prevent users from leaving page if this Model has unsaved changes",helptext:"This Skuid Page has been configured to prevent users from navigating away from it if any of its Models have unsaved changes. Uncheck this property to tell Skuid to ignore this particular Model when performing its check for unsaved changes."}),[{name:"Basic",props:g},{name:"Advanced",props:t}]}function i(b){function c(a){for(var b=[],c={Checkbox:{value:ea,label:"Checkbox"},Currency:{value:fa,label:"Currency"},Date:{value:ga,label:"Date"},Datetime:{value:ha,label:"Datetime"},Formula:{value:la,label:"Formula"},Percent:{value:ta,label:"Percent"},Picklist:{value:sa,label:"Picklist"},MultiPicklist:{value:pa,label:"Multi-select Picklist"},Number:{value:ia,label:"Number"},Reference:{value:ua,label:"Reference"},Text:{value:wa,label:"Text"},Textarea:{value:xa,label:"Textarea"},Url:{value:ya,label:"Url"}},d=0;d<a.length;d++)b.push(c[a[d]]);return b}var d,e,f,g=b.component,h=b.propViewer,i=h,j=g.state,k=j.closest("model").first(),l="aggregate"===k.attr("type"),m=j.parent().is("groupby"),n=a.adapter.get(k.attr("adapter")||"salesforce"),o=n?"local"===n.prop("runtime.metadataSource"):!1,p="true"===j.attr("uionly"),q="true"===j.attr("overridemetadata"),r=p?null:X(g,{readMetadataFromFieldNode:!1}),s=function(){var a="Field: "+I.getModelFieldComponentLabel(j);l&&(a=(m?"Grouping ":"Aggregation")+" "+a),i.setTitle(a)},t=j.attr("id"),u=j.attr("name");if(l&&!p){if(f=[],m){if(m&&r&&(e=r.displaytype,e&&(e===ga||e===ha))){var v=e===ha,w=[];v||w.push({label:"--None--",value:"",abbrev:""}),w.push({label:"CALENDAR_MONTH",value:"CALENDAR_MONTH",abbrev:"cm"},{label:"CALENDAR_QUARTER",value:"CALENDAR_QUARTER",abbrev:"cq"},{label:"CALENDAR_YEAR",value:"CALENDAR_YEAR",abbrev:"cy"},{label:"DAY_IN_MONTH",value:"DAY_IN_MONTH",abbrev:"dm"},{label:"DAY_IN_WEEK",value:"DAY_IN_WEEK",abbrev:"dw"},{label:"DAY_IN_YEAR",value:"DAY_IN_YEAR",abbrev:"dy"}),v&&w.push({label:"DAY_ONLY",value:"DAY_ONLY",abbrev:"do"}),w.push({label:"FISCAL_MONTH",value:"FISCAL_MONTH",abbrev:"fm"},{label:"FISCAL_QUARTER",value:"FISCAL_QUARTER",abbrev:"fq"},{label:"FISCAL_YEAR",value:"FISCAL_YEAR",abbrev:"fy"},{label:"HOUR_IN_DAY",value:"HOUR_IN_DAY",abbrev:"hd"},{label:"WEEK_IN_MONTH",value:"WEEK_IN_MONTH",abbrev:"wm"},{label:"WEEK_IN_YEAR",value:"WEEK_IN_YEAR",abbrev:"wy"}),f.push({id:"function",type:"picklist",label:"Function",helptext:"The Date Function to use",defaultValue:v?"CALENDAR_YEAR":"",picklistEntries:w,onChange:function(a){var b;G.each(w,function(c,d){return d.value==a?(b=d.abbrev,!1):void 0}),null!==b&&j.attr("name",T(j.attr("id"),b)),g.save().refresh().rebuildProps(h)}})}}else f.push({id:"function",type:"picklist",label:"Function",helptext:"The Aggregation function to use",defaultValue:"SUM",required:!0,picklistEntries:[{label:"COUNT",value:"COUNT"},{label:"COUNT DISTINCT",value:"COUNT_DISTINCT"},{label:"SUM",value:"SUM"},{label:"AVG",value:"AVG"},{label:"MAX",value:"MAX"},{label:"MIN",value:"MIN"}],onChange:function(a){a&&j.attr("name",T(j.attr("id"),a)),g.save().refresh().rebuildProps(h)}});return f.push({id:"name",type:"string",label:"Alias Name",helptext:"An alias for this field to be used in Components that refer to it. Must be alphanumeric and have 3-25 characters.",onChange:function(a){a||j.attr("name",T(j.attr("id"),j.attr("function"))),g.save().refresh(),s()}}),s(),[{name:"Basic",props:f}]}var x={id:"id",type:"string",readonly:!p&&!o,label:"Field Id",validator:function(a){return I.validators.fieldId({field:j,model:k,newFieldId:a})},onChange:function(){s(),g.refresh()}},y={id:"overridemetadata",type:"boolean",label:"Override field metadata",defaultValue:!1,onChange:function(a){var b;if(r&&r.displaytype){if(j.attr("ogdisplaytype")||j.attr("ogdisplaytype",r.displaytype),b=r.displaytype,a)switch(b){case ca:case ja:case ka:case ma:case oa:case qa:case ra:case va:b=wa;break;case na:b=ia}j.attr("displaytype",b),g.save()}g.rebuildProps(h)}},z=[x];if(p||o||z.push(y),o&&z.push({type:"boolean",id:"uionly",defaultValue:!1,label:"Ui-Only",helptext:"If true, then this field will not be sent with any insert or update requests, and will not be requested as part of any queries."}),p||q||o){var A,B,C,D,E,F,H,K,M,N,O,P=wa,Q={id:"label",type:"template",modelName:k.attr("id"),location:"attribute",displayAs:"input",label:"Label",onChange:function(a){I.publishStateEvent({type:"model.field.metadataChange",fieldId:t,fieldName:u,modelId:k.attr("id"),changes:{label:a},newMetadata:j})}},R={id:"helptext",displayAs:"textarea",label:"Inline Help Text",type:"string"},S={id:"precision",label:"Length",type:"picklist",helptext:"Number of digits to the LEFT of the decimal point",defaultValue:p?"9":"",picklistEntries:[]},U={id:"scale",label:"Decimal Places",type:"picklist",helptext:"Number of digits to the RIGHT of the decimal point",defaultValue:p?"2":"",picklistEntries:[]},V=[{value:ea,label:"Checkbox"},{value:fa,label:"Currency"},{value:ga,label:"Date"},{value:ha,label:"Datetime"},{value:la,label:"Formula"},{value:ta,label:"Percent"},{value:sa,label:"Picklist"},{value:pa,label:"Multi-select Picklist"},{value:ia,label:"Number"},{value:ua,label:"Reference"},{value:wa,label:"Text"},{value:xa,label:"Textarea"},{value:ya,label:"Url"}],W={id:"readonly",label:"Read-Only",type:"boolean"},Y={id:"defaultValue",label:"Default Value"};for(q&&r&&(B=r.scale,C=r.precision,U.picklistEntries.push({value:"",label:"(Use field default"+(B?": "+B:"")+")"}),S.picklistEntries.push({value:"",label:"(Use field default"+(C?": "+C:"")+")"})),A=0;18>A;)S.picklistEntries.push({value:""+A,label:""+A}),10>A&&U.picklistEntries.push({value:""+A,label:""+A}),A++;if(!p&&r&&(r.label&&(Q.placeholder=r.label),r.inlineHelpText&&(R.placeholder=r.inlineHelpText)),e=j.attr("displaytype")||P,p||"REST"===k.attr("adapter"))D=V;else switch(j.attr("ogdisplaytype")||j.attr("displaytype")){case ea:D=c(["Checkbox","Formula","Picklist"]);break;case fa:D=c(["Currency","Formula","Number","Text","Textarea","Picklist"]);break;case ga:D=c(["Date","Datetime","Formula","Text"]);break;case ha:D=c(["Date","Datetime","Formula","Text"]);break;case ja:D=c(["Formula","Text","Textarea","Url","Picklist"]);break;case na:case ia:D=c(["Formula","Currency","Number","Text","Textarea","Picklist"]);break;case ta:D=c(["Formula","Currency","Number","Percent","Text","Textarea","Picklist"]);break;case oa:D=c(["Formula","Number","Text","Textarea"]);break;case ra:D=c(["Formula","Number","Text","Textarea","Picklist"]);break;case sa:case pa:D=c(["Formula","Text","Textarea","Picklist","MultiPicklist"]);break;case ua:D=c(["Formula","Text","Textarea","Reference"]);break;case va:case ka:case wa:case xa:D=c(["Formula","Currency","Number","Text","Textarea","Picklist","MultiPicklist"]);break;case ya:D=c(["Formula","Text","Textarea","Url","Picklist"]);break;default:D=V}if(e===da&&D.unshift({value:da,label:"Array"}),E={id:"displaytype",label:"Display Type",type:"picklist",defaultValue:P,picklistEntries:D,onChange:function(a){g.save().rebuildProps(h),I.publishStateEvent({type:"model.field.metadataChange",fieldId:t,fieldName:u,modelId:k.attr("id"),changes:{displaytype:a},newMetadata:j})}},F=j.attr("displaytype")===la,z.push(Q,R,E),F&&a.mobile&&z.push({id:"formula",label:"Formula",type:"code"}),F?z.push({label:"Read-Only",type:"custom",renderProperty:function(a){var b=a.state;"true"!==b.attr("readonly")&&(b.attr("readonly","true"),g.save()),I.propertyRenderers["boolean"]({isStateless:!0,value:!0,readonly:!0},b).appendTo(a.element)}}):z.push(W),J.endsWith(e,sa)?(Y.type="picklist",Y.picklistEntries=function(){var b=[{value:"",label:a.$L("none_option_text")}],c=j.children("picklistentries").children();return c.each(function(a,c){var d=G(c);b.push({value:d.attr("value"),label:d.attr("label")})}),b}):e===ea?Y.type="boolean":Y.type="string",e===sa||e===pa)d=[{name:"Basic",props:z.concat(Y)},{name:"Picklist Entries",tree:{id:"picklistentries",label:"Picklist Entries",deleteable:!1,icon:"sk-bi-options",isChild:!0,children:[{id:"entry",labelFunction:function(a){return a.attr("label")||"[No Label]"},defaultStateFunction:function(){return L('<entry value="New Entry" label="New Entry"/>')},propsFunction:function(a){return[{id:"value",label:"Value",type:"string"},{id:"label",label:"Label",type:"template",displayAs:"input",location:"attribute",onChange:function(){a.save().refresh()}}]}}]}}];else if(e===ua)H={id:"targetobjects",type:"sobject",label:"SObject Type"},d=[{name:"Basic",props:z.concat(H)}];else if(-1!==G.inArray(e,[ia,fa,ta]))d=[{name:"Basic",props:z.concat(Y,S,U)}];else if(e===na){for(K={id:"digits",label:"Length",type:"picklist",defaultValue:p?"9":"",picklistEntries:[]},p||K.picklistEntries.push({value:"",label:"(Use field default"+(r?": "+r.digits:"")+")"}),A=0;18>A;)K.picklistEntries.push({value:""+A,label:""+A}),A++;d=[{name:"Basic",props:z.concat(Y,K)}]}else-1!==G.inArray(e,[wa,xa])?(M={id:"length",label:"Length",type:"string",helptext:"The maximum number of characters that can be entered in this field",defaultValue:p?"255":""},!p&&r&&r.length&&(M.placeholder="Default: "+r.length),d=[{name:"Basic",props:z.concat(Y,M)}]):e===la?(N={id:"returntype",label:"Formula Return Type",type:"picklist",required:!0,defaultValue:wa,picklistEntries:[{value:ea,label:"Checkbox"},{value:fa,label:"Currency"},{value:ga,label:"Date"},{value:ha,label:"Datetime"},{value:ta,label:"Percent"
},{value:ia,label:"Number"},{value:wa,label:"Text"}],onChange:function(){g.rebuildProps(h)}},O=z.concat(N),-1!==G.inArray(j.attr("returntype"),[ia,fa,ta])&&O.push(S,U),d=[{name:"Field",props:O},{name:"Formula",customPropFunction:function(a,b){a.css({margin:"10px"}).append(I.propertyRenderers.formula({id:"formula",location:"node",modelName:k.attr("id"),fieldState:b},b))}}]):e===da?(d=[{name:"Basic",props:z}],E.readonly=!0):d=[{name:"Basic",props:z.concat(Y)}]}else{var Z=j.attr("displaytype")||r&&r.displaytype;Z&&z.push({label:"Display Type",type:"string",isStateless:!0,value:Z,readonly:!0}),d=[{name:"Basic",props:z}]}return s(),d}function j(b){var c=b.component,d=a.adapter.getAdapter(c.state.closest("model").attr("adapter")||Ba),e=b.propertiesViewer,f=[];return d&&d.prop("canConditionsBeGrouped")&&f.push({id:"logic",type:"string",label:"Grouping Logic",helptext:"How to group and apply these Conditions when loading the Model, e.g. ((1 AND 2) OR (3 AND 4)). By default, all Conditions are applied."}),e.setTitle((d?d.prop("composer.modelConditionsLabel"):"")||"Conditions"),[{name:"",props:f}]}function k(a){var b=a.state,c={id:"location",type:"picklist",label:"Resource Location",defaultValue:"staticresource",picklistEntries:[{label:"Static Resource",value:"staticresource"},{label:"External",value:"external"},{label:"In-Line",value:"inline"}],onChange:function(c){"staticresource"===c?b.attr({url:"",cachelocation:"false",name:"",namespace:""}):"external"!==c&&b.attr("url",""),a.refresh().rebuildProps()}},d={id:"name",type:"autocomplete",sobject:"StaticResource",fieldsToReturn:["Name","NamespacePrefix","ContentType"],fieldsToSearch:["Name","NamespacePrefix"],displayTemplate:"{{Name}}{{#ContentType}} ({{ContentType}}){{/ContentType}}",valueTemplates:{name:"{{Name}}",namespace:"{{NamespacePrefix}}"},order:"Name",label:"Resource Name",helptext:"The name of the Static Resource where this CSS is stored.",required:!0,onChange:function(){a.refresh().rebuildProps()}},e={id:"namespace",type:"string",label:"Namespace (if in managed package)",helptext:"ONLY needed if this StaticResource is included in a Managed Package."},f={id:"name",type:"string",label:"Resource Name (optional)",onChange:function(){a.refresh()}},g={id:"url",type:"string",label:"Resource URL",divisionSize:"2",onChange:function(){a.refresh()}},h={type:"code",syntax:"css",label:"Resource Body",divisionSize:"2"},i={id:"cachelocation",type:"boolean",label:"Cache Resource Location",helptext:"Leave UNCHECKED unless the contents of your Static Resource are very stable and will not be changing."},j={id:"filepath",type:"filepath",label:"File Path (within ZIP Static Resources)",helptext:"The desired file's relative location within Static Resources that are .zip files. Do not use unless your Static Resource is a ZIP file.",divisionSize:"2",getResourceName:function(){return b.attr("name")},getResourceNamespace:function(){return b.attr("namespace")}},k={external:[c,f,g],inline:[c,f,h],staticresource:[c,d,e,i],DEFAULT:[c,f,e]};return b.attr("name")&&k.staticresource.push(j),k[b.attr("location")||"DEFAULT"]}function l(a){var b=a.state,c={id:"location",type:"picklist",label:"Resource Location",defaultValue:"staticresource",picklistEntries:[{label:"Static Resource",value:"staticresource"},{label:"External",value:"external"},{label:"In-Line",value:"inline"},{label:"In-Line (Snippet)",value:"inlinesnippet"},{label:"In-Line (Component)",value:"inlinecomponent"}],onChange:function(c,d){"staticresource"===c?b.attr({url:"",cachelocation:"false",name:"",namespace:""}):"external"!==c&&b.attr("url",""),c&&J.startsWith(c,"inline")&&d&&d!==c&&(b.text()&&b.text()!==O[d]||b.text(O[c]),b.attr("name")&&b.attr("name")!==P[d]||b.attr("name",P[c])),a.save().refresh().rebuildProps()}},d={id:"name",type:"autocomplete",sobject:"StaticResource",fieldsToReturn:["Name","NamespacePrefix","ContentType"],fieldsToSearch:["Name","NamespacePrefix"],displayTemplate:"{{Name}}{{#ContentType}} ({{ContentType}}){{/ContentType}}",valueTemplates:{name:"{{Name}}",namespace:"{{NamespacePrefix}}"},order:"Name",label:"Resource Name",helptext:"The name of the Static Resource where this JavaScript is stored.",required:!0,onChange:function(){a.refresh().rebuildProps()}},e={type:"code",syntax:"javascript",label:"Resource Body",divisionSize:"2"},f={id:"name",type:"string",label:"Snippet Name",onChange:function(){a.refresh()}},g={type:"code",syntax:"javascript",label:"Snippet Body",divisionSize:"2"},h={id:"name",type:"string",label:"Component Name",onChange:function(){a.refresh()}},i={type:"code",label:"Component Body",syntax:"javascript",divisionSize:"2"},j={id:"namespace",type:"string",label:"Namespace (if in managed package)",helptext:"ONLY needed if this StaticResource is included in a Managed Package."},k={id:"name",type:"string",label:"Resource Name (optional)",onChange:function(){a.refresh()}},l={id:"url",type:"string",label:"Resource URL",divisionSize:"2",onChange:function(){a.refresh()}},m={id:"cachelocation",type:"boolean",label:"Cache Resource Location",helptext:"Leave UNCHECKED unless the contents of your Static Resource are very stable and will not be changing."},n={id:"filepath",type:"filepath",label:"File Path (within ZIP Static Resources)",helptext:"The desired file's relative location within Static Resources that are .zip files. Do not use unless your Static Resource is a ZIP file.",divisionSize:"2",getResourceName:function(){return b.attr("name")},getResourceNamespace:function(){return b.attr("namespace")}},o={external:[c,k,l],inline:[c,k,e],inlinesnippet:[c,f,g],inlinecomponent:[c,h,i],staticresource:[c,d,j,m],DEFAULT:[c,k,j]};return b.attr("name")&&o.staticresource.push(n),o[b.attr("location")||"DEFAULT"]}function m(a){var b={id:"id",type:"string",label:"Label Id"};return a&&a.onChange&&(b.onChange=a.onChange),[b]}function n(b,c,d,e){e=e||{};var f=b.state,g=f.attr("type"),h=[],i=[],j=e.onActionTypeChange,k=e.additionalActionOptions||[],l=G.merge([],I.getValidActionOptions()),m=Y(d),n=m&&a.adapter.get(m.attr("adapter")||Ba);n&&n.getServiceActions&&k.push({value:"modelAction",label:"Model Service Action"}),k&&k.length&&(l.push({value:"-",label:"",disabled:!0}),l.push({value:"-",label:"Additional actions",disabled:!0}),G.each(k,function(){l.push(this),g===this.value&&(this.props&&this.props.length&&G.each(this.props,function(){i.push(this)}),this.propsFunction&&(i=i.concat(this.propsFunction(b))))})),h.push({id:"type",label:"Action Type",type:"picklist",options:l,onChange:function(a){b.refresh().rebuildProps(c),j&&j(a)}}),"showPopup"===g?h.push({type:"customaction",label:"Configure Popup",icon:"sk-bi-popup",mode:"edit",customAction:function(){H.desktop.showPopupBuilder({parentComponent:b,getContextModelName:function(){return d},useAfterCloseActions:!0})}}):-1!==G.inArray(g,["toggleLeftPanel","setLeftPanel","setMainPanel","setPopupPanel"])&&(h.push({id:"panel",label:"Panel",type:"panel"}),"setPopupPanel"===g&&h.push({id:"title",label:"Popup Title",type:"template",location:"attribute"}));var o=r({propViewer:c,component:b,getContextModelName:function(){return d}});return o.length&&G.each(o,function(a,b){h.push(b)}),i.length&&G.each(i,function(a,b){h.push(b)}),h}function o(a){a||(a={});var d,e=a.treeNode||{},f=a.propViewer,g=a.useModelName,h=a.linkedComponent,i=a.refreshLinkedComponent,j=e.indent||0;return d={id:"action",addtooltip:a.addtooltip||"Add Action",deletetooltip:a.deletetooltip||"Remove Action",refreshLinkedComponent:i,linkedComponent:h,labelFunction:function(b){return W(b,a.additionalActionOptions)},labelEventHandlers:{dblclick:function(a){var b=a.state,c=b.attr("type"),d=H.desktop;d&&("drawer"===c?d.showDrawerBuilder({parentComponent:a,getContextModelName:function(){return g}}):"showPopup"===c&&d.showPopupBuilder({parentComponent:a,getContextModelName:function(){return g},useAfterCloseActions:!0}))}},defaultStateFunction:function(){return L('<action type="save"/>')},propsFunction:function(b){return n(b,f,g,a)},childrenFunction:function(d){var e=[],g=d.state,h=g.attr("type");return"createRow"===h&&e.push({id:"default",labelFunction:function(a){var b=a.attr("field")||"[No Field]",c=a.attr("value");return"undefined"==typeof c&&(c="[No Value]"),b+": "+c},invisibleParent:"defaults",invisibleParentLabel:"Default Values",indent:1+j,addtooltip:"Add Default Value",deletetooltip:"Remove Default Value",propsFunction:function(a){var d,e=a.state,h=e.attr("field"),i=[],j=g.attr("model"),k={showObjectPickerIfPolymorphic:!0,addFieldToModel:!0,handleChange:function(){a.refresh().rebuildProps(f)},modelName:j};if(i.push(c(a,k)),h&&j){var l=Y(j);l&&(d=U(j,h,l.attr("sobject")))}return i.concat(b(a,{fieldMetadata:d,handleRefresh:function(){var b=e.attr("field");b&&a.rebuildProps(f)},modelName:j,validTypes:["fieldvalue","blank"]}))},defaultStateFunction:function(){return L("<default/>")}}),-1!==G.inArray(h,["save","requeryModel","requeryModels","custom","runProcessPlugin","modelAction","sfdc-custom-apex"])?e.push(o(G.extend({},a,{treeNode:{invisibleParent:"onerroractions",invisibleParentLabel:"On-Error Actions",indent:1+j,icon:"sk-bi-action-error",addicon:"sk-bi-action-error",addtooltip:"Add on-error Action",deletetooltip:"Remove on-error Action",defaultStateFunction:function(){return L('<action type="blockUI" message="There was an error" timeout="3000"/>')}}}))):a.additionalActionOptions&&G.each(a.additionalActionOptions,function(){this.value===h&&this.childrenFunction&&(e=e.concat(this.childrenFunction(d)))}),e}},e&&G.extend(d,e),d}function p(a){a||(a={});var b=a.linkedComponent,c=!1,d={},e=a.actionsIndent;return e&&(d.indent=e),b&&a.refreshLinkedComponent&&(c=!0),{id:a.customNodeId||"actions",label:a.label||"Actions",addtooltip:"Add Action",deleteable:!1,icon:"sk-icon-component-pack",isChild:!0,linkedComponent:b,props:a.props,refreshLinkedComponent:c,childrenFunction:function(e){return[o({linkedComponent:b,refreshLinkedComponent:c,component:e,propViewer:a.propViewer,useModelName:a.useModelName,additionalActionOptions:a.additionalActionOptions,treeNode:d})]}}}function q(a){return{name:a&&a.label?a.label:"Actions",tree:p(a)}}function r(b){var d=b.component,e=b.propViewer,f=b.getContextModelName?b.getContextModelName():b.contextModelName,g=d.state,h=g.attr("type"),i=[],j=function(){d&&d.refresh()},k={id:"behavior",type:"picklist",label:"Query Behavior",defaultValue:"standard",picklistEntries:[{label:"Standard - Completely Replace Data",value:"standard"},{label:"Get More - Merge in new Rows with old",value:"loadmore"}]};if(-1!==G.inArray(h,["save","cancel","requeryModels","emptyModelData"])){var l="Models to ";"save"===h?l+="Save":"cancel"===h?l+="Cancel":"requeryModels"===h?l+="Query":"emptyModelData"===h&&(l="Empty"),i.push({id:"models",label:l,type:"models",onChange:j}),"save"===h?i.push({id:"rollbackonanyerror",label:"Roll back entire save on any error",helptext:"If true, then if there is any error while saving any of the selected Models, then the entire save operation will be rolled-back, as if no part of it ever occurred. ",type:"boolean"}):"requeryModels"===h&&i.push(k)}else if("redirect"===h)i.push({id:"url",label:"URL",type:"template",location:"attribute"},{id:"window",type:"picklist",label:"Open URL in",defaultValue:"self",picklistEntries:[{label:"Current window",value:"self"},{label:"Blank window",value:"blank"},{label:"Parent window",value:"parent"}]});else if("blockUI"===h){i.push({id:"message",type:"string",label:"Message"});for(var m={id:"timeout",type:"picklist",label:"Timeout (seconds)",picklistEntries:[{label:"Never",value:""}]},n=1;20>=n;n++)m.picklistEntries.push({value:500*n,label:n/2});i.push(m)}else if("publish"===h)i.push({id:"event",label:"Event name",type:"string"});else if("runProcessPlugin"===h)i.push({id:"pluginname",label:"Plugin Name",type:"string"});else if(G.inArray(h,["createRow","requeryModel","markRowsForDeletion","abandonRows"])>-1)i.push({id:"model",label:"Model",type:"model",location:"attribute",onChange:j}),"createRow"===h?i.push({id:"appendorprepend",type:"picklist",label:"Place row at...",defaultValue:"prepend",picklistEntries:[{label:"Start of Model data",value:"prepend"},{label:"End of Model data",value:"append"}]},{id:"defaultmodefornewitems",type:"picklist",label:"Have associated Components initially show this row in...",defaultValue:"edit",picklistEntries:[{value:"edit",label:"Edit mode"},{value:"read",label:"Read mode w/ inline-editing"}],helptext:"When this row is created, Components bound to this Model will create a new Item corresponding to the row. What Mode should the new Item start in?"}):"requeryModel"===h&&i.push(k);else if("adoptRows"===h)i.push({id:"sourcemodel",label:"Source Model",type:"model",location:"attribute"},{id:"targetmodel",label:"Target Model",type:"model",location:"attribute"});else if("updateRow"===h){i.push({id:"fieldmodel",label:"Model",type:"model",required:!0,location:"attribute",onChange:function(){d.refresh().rebuildProps(e)}});var o=c(d,{handleChange:function(){d&&d.refresh().rebuildProps(e)},modelName:g.attr("fieldmodel")});i.push(o),d.isUpdateAction=!0,i.push({id:"value",type:"string",label:"Value",metadata:X(d,{modelName:g.attr("fieldmodel")})})}else if("custom"===h)i.push({id:"snippet",label:"Name of Snippet to run",type:"string",location:"attribute",onChange:j});else if(-1!==G.inArray(h,["setCondition","activateCondition","deactivateCondition"])){i.push({id:"model",label:"Model",type:"model",location:"attribute",onChange:function(a,b,c){b!==!0&&c&&d&&d.rebuildProps(e),d&&d.refresh()}});var p=g.attr("model");p||(p=I.getFirstModel(),p=p?p.attr("id"):null),i.push({id:"condition",label:"Condition",type:"condition",modelName:p,location:"attribute",onChange:j}),"setCondition"===h&&i.push({id:"value",label:"Value",type:"template",location:"attribute",modelName:f})}else if("modelAction"===h){var q=Y(f),r=a.adapter.get(q.attr("adapter")||Ba);if(r.getServiceActions){var s=r.prop("composer.modelActionProps");s&&(i=i.concat(s({component:d,model:q})))}}else if(J.startsWith(h,"sfdc-")){var t=h.split("-"),u=t[1],v=t[2];if("custom"===u){var w,x,y={apex:"Apex Action",flow:"Flow Name",emailAlert:"SObject Type",quickAction:"SObject Type"}[v],z={apex:"Apex Actions",flow:"Flows",emailAlert:"objects with pre-configured Email Alerts",quickAction:"objects with Quick Actions"}[v],A={type:"GET",url:"/actions/custom/"+v,cache:!0},B=a.sfdc.api.getCachedResult(A);if(B){x=[],w={id:"sfdcactionname",type:"picklist",picklistEntries:x,label:y},i.push(w),"apex"===v||"flow"===v?G.each(B.actions,function(a,b){x.push({label:b.label,value:b.name})}):G.each(B,function(a){x.push({label:a,value:a})}),!g.attr("sfdcactionname")&&x.length&&ba(g,{key:"sfdcactionname",value:x[0].value});var C,D;if(g.attr("sfdcactionname"))if(C={type:"GET",url:"/actions/custom/apex/"+g.attr("sfdcactionname"),cache:!0},D=a.sfdc.api.getCachedResult(C)){if(D.inputs){var E,F=g.children("inputs"),H=D.inputs;F.length&&(E=F.children()),G.each(H,function(a,b){var c=b.name,e=E?E.filter('[name="'+c+'"]'):[],f=e.length?e.attr("value"):null,h=b.type;i.push({isStateless:!0,value:f,label:b.label,required:b.required,type:h.toLowerCase(),helptext:b.description,onChange:function(a){var b=F?F.children('[name="'+c+'"]'):!1;a||a===!1||0===a?(b&&b.length||(b=L("<input/>").attr({name:c,displaytype:h}),(!F||F&&!F.length)&&(F=L("<inputs/>").appendTo(g)),b.appendTo(F)),b.attr("value",a)):b.remove(),d.save()}})})}}else a.sfdc.api.makeRequest(C).done(function(){d.rebuildProps(e)})}else w={type:"string",label:y,value:"Loading "+z+" ...",readonly:!0,isStateless:!0},i.push(w),a.sfdc.api.makeRequest(A).done(function(){d&&d.rebuildProps(e)})}}return i}function s(a){var b=a.parent();if(b.length){if(b[0]&&"skuidpage"===b[0].nodeName)return!1;var c=R(b);if(c){var d=c.builder;return d&&(d.givesContext||d.givesMultipleContextRows)?c:s(b)}return s(b)}return!1}function t(a){a||(a={});var b=a.state,c=a.model,d=a.modelprop,f=s(b);if(!f)return!1;var g=I.getComponentFromState(b),h=f.getContextModelName&&f.getContextModelName(),i=f.givesMultipleContextRows,j=g&&g.builder&&g.builder.supportsMultipleContextRows,k=i===!0&&j===!0;return{name:"Context",tree:{id:"conditions",label:"Context Conditions",deleteable:!1,isChild:!0,linkedComponent:a.linkedComponent,children:[{id:"condition",labelFunction:function(a){var b=a.attr("field")||"Id",c=I.operatormap[a.attr("operator")||""].name,d=a.attr("mergefield")||"Id",e="contextrows"===a.attr("type")?"rows":"row";return b+" of record"+(k?"(s)":"")+" "+c+" "+d+" of "+e+" in context."},defaultStateFunction:function(){var a=L('<condition type="'+(k?"contextrows":"contextrow")+'" field="Id" mergefield="Id" />');return k&&a.attr("operator","in"),a},propsFunction:function(a){a.isContextCondition=!0;var f,g=[];return d?f=b.attr(d):c&&(f=c),f?(g.push({id:"field",type:"field",label:"Field",helptext:"The field on this component's model that will be checked against a field on the row in context.",modelname:f,onChange:function(){a.refresh()}}),h&&g.push({id:"mergefield",type:"field",label:"Merge Field",helptext:"The field on the row in context that will be checked against a field on this component's model.",modelname:h,onChange:function(){a.refresh()}}),g.push(e(a,{fieldMetadata:X(a,{modelName:f})})),g):!1}}]}}}function u(a){var d=a.propViewer,f=a.component,g=a.model,h=a.showOnHideDataBehaviorProp,i=a.showMessageWhenDisabledProp,j=a.conditionsNodeId||"renderconditions",k=a.conditionsNodeLabel||"Render Conditions",l=a.conditionsNodeIcon||"sk-bi-renderconditions",m=a.doLabel||"Render",n=a.undoLabel||"Don't render",o=a.conditionNodeId||"rendercondition",p=a.addConditionNodeLabel||"Add new Render Condition",q=a.conditionsIndent||0;return{id:j,label:k,deleteable:!1,icon:l,isChild:!0,linkedComponent:f,propsFunction:function(a){var b=[],c=a.state,e=c.attr("logictype");if(e||(e="and",c.attr("logictype",e)),b.push({id:"logictype",type:"picklist",label:m+" if...",defaultValue:"and",picklistEntries:[{label:"ALL Conditions are met",value:"and"},{label:"ANY Conditions are met",value:"or"},{label:"Custom logic is met",value:"custom"}],onChange:function(b,e){if("custom"===b&&!c.attr("logic")){var f=c.children(),g=[];f.length&&(f.each(function(a){g.push(a+1)}),c.attr("logic",g.join(" AND ")),a.save())}b&&e&&a.rebuildProps(d)}}),"custom"===e&&b.push({id:"logic",type:"string",label:"Condition Logic",helptext:"Custom logic for grouping and applying these Conditions, e.g. ((1 AND 2) OR (3 AND 4))."}),h){var f="onhidedatabehavior";""===c.attr(f)&&c.attr(f,"cancel"),b.push({id:f,type:"picklist",label:"If hidden, Model field changes should be...",helptext:"When this Field is hidden by Conditional Rendering, by default any changes to this Field's Model data will be left in the Model. You may want to have hidden data changes cancelled, so that the changes are not saved along with visible data changes.",defaultValue:"keep",picklistEntries:[{label:"Retained in Model",value:"keep"},{label:"Cancelled",value:"cancel"}]})}return i&&b.push({id:"message",isNew:!0,type:"string",label:"Message to show when disabled",helptext:"When disabled, the user will be shown this message to explain why."}),b},children:[{id:o,indent:q,addtooltip:p,labelFunction:function(a){return I.getConditionDisplayString(a)},defaultStateFunction:function(){return L("<"+o+' type="fieldvalue" operator="=" enclosevalueinquotes="true"/>')},propsFunction:function(a){a.isRenderCondition=!0;var f,h,i=a.state,j=i.attr("fieldmodel"),k=[],l={},o=!1,p=function(a,b){i.attr(a,b),o=!0},q=function(a){return"modelproperty"===a||"rowproperty"===a},r={id:"sourcetype",type:"picklist",label:"Source Type",defaultValue:"fieldvalue",picklistEntries:[{label:"Model field value",value:"fieldvalue"},{label:"Model property",value:"modelproperty"},{label:"Row property",value:"rowproperty"},{label:"Page/URL Parameter value",value:"param"},{label:"Running User attribute",value:"userinfo"},{label:"Snippet returns true",value:"snippet"}],onChange:function(b,c){c&&b!==c&&(q(b)&&(q(c)&&i.removeAttr("sourceproperty"),i.removeAttr("field value operator")),Q(a,l),a.save().refresh().rebuildProps(d))}},s={id:"fieldmodel",type:"model",label:"Source Model",helptext:"The Model to use when evaluating this Condition. If there is a row in context that is in this Model, Conditions will be evaluated against the context row. Otherwise, Conditions will be evaluated against this Model's first row.",onChange:function(){a.refresh().rebuildProps(d)}},t="Skip other Conditions, and ",u={id:"nosourcerowbehavior",type:"picklist",label:"If no rows in Model...",helptext:"Specifies the action to take if no rows are returned by the source model.",defaultValue:"deactivate",picklistEntries:[{label:"Ignore this Condition",value:"deactivate"},{label:t+m.toLowerCase(),value:"skipandrender"},{label:t+n.toLowerCase(),value:"skipandnorender"}]},v={id:"sourceparam",type:"string",label:"Parameter Name",onChange:function(){a.refresh()}},w={id:"sourceuserinfotype",type:"picklist",label:"User attribute",helptext:"The name of the property on the running User's record to compare against",defaultValue:"profilename",picklistEntries:[],onChange:function(){a.refresh()}},x={id:"sourceproperty",type:"picklist",label:"Model Property",defaultValue:"hasRows",picklistEntries:[{value:"data.length",label:"# of rows in Model"},{value:"hasNoRows",label:"Doesn't have data rows"},{value:"hasRows",label:"Has data rows"},{value:"hasChanged",label:"Has unsaved changes"},{value:"label",label:"Model label"},{value:"labelPlural",label:"Model plural label"}],onChange:function(b){"hasRows"===b||"hasNoRows"===b?i.removeAttr("type enclosevalueinquotes operator value"):("hasChanged"===b&&(i.attr("value")||i.attr({type:"fieldvalue",value:"true",enclosevalueinquotes:"false"})),Q(a,l)),a.save().refresh().rebuildProps(d)}},y={id:"sourceproperty",type:"picklist",label:"Row Property",defaultValue:"isNew",picklistEntries:[{value:"hasChanged",label:"Has unsaved changes"},{value:"isNew",label:"Is new record"},{value:"isSaved",label:"Is existing record in database"},{value:"isCloned",label:"Is unsaved clone of existing record"}],onChange:function(b){"isCloned"===b||"hasChanged"===b?i.attr("value")||i.attr({type:"fieldvalue",value:"true",enclosevalueinquotes:"false"}):i.removeAttr("type enclosevalueinquotes operator value"),Q(a,l),a.save().refresh().rebuildProps(d)}},z={id:"sourcesnippet",type:"string",label:"Snippet Name",helptext:"The name of the Skuid JavaScript Snippet to run to determine whether to render.",onChange:function(){a.refresh()}};if(G.each(I.userinfomap,function(a,b){w.picklistEntries.push({label:b.label,value:a})}),j)h=j;else if(g)h=g,p("fieldmodel",h);else{var A=I.getLastSelectedModelComponent();h=A&&A.state?A.state.attr("id"):I.getAllModelsInPage().children().first().attr("id"),p("fieldmodel",h)}l.modelName=h;var B=i.attr("sourcetype")||"fieldvalue",C=q(B),D="rowproperty"===B,E=i.attr("sourceproperty"),F=i.attr("value");C&&(E||(E=D?y.defaultValue:x.defaultValue,p("sourceproperty",E)),D&&-1!==G.inArray(E,["isCloned","hasChanged"])?("undefined"==typeof F&&p("value","true"),"false"!==i.attr("enclosevalueinquotes")&&p("enclosevalueinquotes","false")):D||-1===G.inArray(E,["data.length","hasChanged"])||("undefined"==typeof F&&"hasChanged"===E&&p("value","true"),"false"!==i.attr("enclosevalueinquotes")&&p("enclosevalueinquotes","false"))),o&&(o=!1,a.save().refresh()),k.push(r),f=X(a,{modelName:h});var H={showObjectPickerIfPolymorphic:!0,addFieldToModel:!0,handleChange:function(){a.rebuildProps(d)}};H.modelName=i.attr("fieldmodel")?i.attr("fieldmodel"):h;var J=[s],K={fieldvalue:J,modelproperty:[s,x],rowproperty:[s,y],param:[v],userinfo:[w],snippet:[z]};return g&&g===h||J.push(u),J.push(c(a,H)),G.each(K[B],function(){k.push(this)}),C&&-1!==G.inArray(E,["hasRows","hasNoRows","hasChildRows","hasNoChildRows","isNew","isSaved"])||"snippet"===B?k:(k.push(e(a,{fieldMetadata:f})),k.concat(b(a,{handleRefresh:function(){a.rebuildProps(d)},handleChange:function(){a.refresh()},modelName:h,validTypes:-1!==G.inArray(E,["isCloned","hasChanged"])?["fieldvalue"]:["fieldvalue","multiple","blank","userinfo","param"]})))}}]}}function v(d,f,g,h){var i,j,k=Y(f),l=k?"aggregate"==k.attr("type"):!1,m=d.state,n=m.attr("type"),o=m.attr("id"),p=o?U(f,o):!1,q=p?p.uiOnly:!1,r=p?p.displaytype:!1,s=Z(f),t='The desired width of this column, relative to the total width available to its containing table. This is an Approximate width, as the actual width may be different depending on how much room the HTML table has available to it. A percentage (e.g. 25%) is recommended, but a pixel amount, e.g. "200px" is also possible --- however, do NOT mix and match pixels/percents among columns in the table.';if(n===Aa||n===za||r===da){if(i=[{id:"label",type:"template",label:"Label",onChange:function(){d.refresh()}},{id:"template",type:"template",label:"Template",onChange:function(){d.refresh()}},{id:"allowhtml",type:"boolean",label:"Allow HTML",defaultValue:!1,onChange:function(){d.refresh()}},{id:"valuehalign",type:"picklist",label:"Horizontal Alignment",helptext:"(Optional) The alignment of the field value within its container. Defaults to Left.",picklistEntries:[{label:"Left (default)",value:""},{label:"Right",value:"right"}],defaultValue:""}],r!==da&&n!==za&&i.push({id:"readonly",type:"boolean",label:"Read-only",defaultValue:!1,onChange:function(){d.rebuildProps()}}),"skootable"===g&&(i.push({id:"columnwidth",type:"string",label:"Column Width",helptext:t}),n===Aa&&(i.push({id:"allowordering",type:"boolean",label:"Allow Ordering",onChange:function(){d.rebuildProps()}}),"true"===m.attr("allowordering")&&i.push({id:"orderfield",type:"field",label:"Order Field",showUiOnlyFields:!1,sobject:s}))),"true"!==m.attr("readonly")&&n===Aa&&"basicfieldeditor"===g&&(i.push({id:"editmodebehavior",type:"picklist",label:"Edit Mode behavior",defaultValue:"autopopup",picklistEntries:[{label:"Show default Popup",value:"autopopup"},{label:"Show custom Popup",value:"custompopup"}],onChange:function(){d.rebuildProps()}}),"custompopup"===m.attr("editmodebehavior"))){var u=H.desktop.makePopupBuilder({title:"Template Field Edit Mode Popup Properties",linkedComponent:d}),v=m.children("editmodepopup");if(0===v.length){var w,x=m.children("template").text();x.length&&(w=J.extractFieldsFromTemplate(x,{ignoreGlobals:!0})),v=u.defaultStateGenerator({id:"editmodepopup",title:m.children("label").text()||"Template Field",width:"450",childComponents:L('<basicfieldeditor showsavecancel="false" mode="edit" model="'+f+'"><columns><column width="100%"><sections><section title=""><fields>'+(w&&w.length?'<field id="'+w.join('"/><field id="')+'"/>':"")+"</fields></section></sections></column></columns></basicfieldeditor>")}),m.append(v)}d.editModePopupComponent=I.componentFactory(v,u,!0),i.push({id:"editmodepopup",type:"customaction",label:"Configure Edit Mode Popup",icon:"sk-bi-popup",customAction:function(){d.editModePopupComponent.select()}})}(n===za||r===da)&&i.push({id:"delimiter",type:"string",label:"Delimiter"}),j=[{name:"Basic",props:i}]}else{var z=[];r&&(r===sa?(z.push({label:"Standard",value:""}),z.push({label:"Radio Buttons",value:"RADIO_BUTTONS"})):r===pa?(z.push({label:"Standard",value:""}),z.push({label:"Checkboxes",value:"CHECKBOXES"})):r===ua?"skuid__Image__c"===p.ref?z.push({label:"File Upload",value:""}):(z.push({label:"Auto-Complete",value:""}),z.push({label:"Picklist",value:"REFPICK"})):r===ga&&z.push({label:"Standard",value:""})),z.length||z.push({label:"Standard",value:""}),z.push({label:"Custom (run a Snippet)",value:"CUSTOM"});var A;A="mobilefield"===g?{id:"id",type:"field",label:"Field",modelname:f,filter:function(a,b){var c;return c=a.displaytype!==ua?k.children("fields,groupby").find('field[id="'+M(b+a.id)+'"]'):k.children("fields,groupby").find('field[id^="'+M(b+a.rel+".")+'"]'),0!==c.length},onChange:function(a){d.element.attr("data-field",a),d.state.removeAttr("type"),d.save().refresh().renderProperties(h)}}:{id:"id",type:"readonly",label:"Field Id"};for(var B={id:"type",type:"picklist",label:"Field Renderer",defaultValue:"",picklistEntries:z,onChange:function(){d.save().refresh().rebuildProps(h)}},C={id:"name",type:"readonly",label:"Field Alias Name"},D={id:"label",type:"template",location:"node",label:"Custom Label",onChange:function(){d.refresh()}},E={id:"optionsource",type:"picklist",label:"Option Source",defaultValue:"",picklistEntries:[{label:"Automatic",value:""},{label:"Model",value:"model"}],onChange:function(){m.removeAttr("displaytemplate searchtemplate"),"undefined"!=typeof m.attr("optionmodel")&&m.removeAttr("optionmodel"),d.refresh().rebuildProps(h)}},F={id:"optionmodel",type:"model",label:"Option Model",objectTypeFilter:p?p.ref:!1,onChange:function(a,b){b!==!0&&(m.removeAttr("displaytemplate searchtemplate"),d.refresh().rebuildProps(h))}},K={id:"displaytemplate",type:"template",label:"Display Template",modelprop:"optionmodel",fieldContext:p?p:null,fieldId:o,location:"attribute",helptext:'The fields from related records to display, specified using Merge syntax, e.g. "{{Name}} - {{Industry}}" would show the Name and Industry of related Accounts, if this is the AccountId field. Fields can be easily added using the Merge-Field Picker to the right.'},N={id:"searchtemplate",type:"template",label:"Search Template",modelprop:"optionmodel",fieldContext:p?p:null,fieldId:o,location:"attribute",helptext:'The fields from related records to display on search, specified using Merge syntax, e.g. "{{Name}} - {{Industry}}" would show the Name and Industry of related Accounts, if this is the AccountId field. Fields can be easily added using the Merge-Field Picker to the right.'},O={id:"allowordering",type:"boolean",label:"Allow Ordering"},P={id:"columnwidth",type:"string",label:"Column Width",helptext:t},Q={id:"summaries",location:"node",type:"multipicklist",storeAs:{type:"node",name:"summary"},label:"Column Summaries",helptext:"Choose one or more summary type(s) for this field. Summaries are displayed at the bottom of a table.",picklistEntries:[{label:"Sum",value:"sum"},{label:"Average",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Median",value:"med"}],noneSelectedText:"Select Summary Type(s)...",onChange:function(){d.rebuildProps(h)}},R={id:"countBlanks",type:"boolean",label:"Count Blanks in Summaries",helptext:"Set this to true if you  want blank values to be counted in summary calculations."},S=p?p.calculated||!(p.createable||p.editable):!1,T={id:"readonly",type:"boolean",label:"Read-only",readonly:S,defaultValue:S},V={id:"required",type:"boolean",label:"Required",defaultValue:p?p.required:!1,readonly:(p?p.required:!1)||(p?p.calculated:!1),onChange:function(){r&&(r===sa||r===ua&&"REFPICK"===m.attr("type"))&&d.save().refresh().rebuildProps(h)}},W={id:"addnoneoption",type:"boolean",label:'Add "None" option',helptext:'When a Picklist is required, Skuid normally does not add a "--None--" option at the beginning of the list of options, and instead will auto-select the first available Picklist option if none has yet been selected. There is then no way for the user to go back to "--None--". This is sometimes undesirable and can lead to bad data, because users will not realize that an option was auto-selected and therefore will not select an accurate option. Checking this property will add a "--None--" option at the top of the list, which will be selected by default.',defaultValue:!1},$={id:"tokenizesearch",type:"boolean",label:"Tokenize autocomplete search",defaultValue:!1,helptext:"Search separately on each term, rather than requiring a field to contain a match on the whole search string entered."},_={id:"maxdisplaycharacters",type:"string",label:"Max Characters to Display",helptext:"(Read Mode only) The maximum number of characters that will be displayed for this textarea in Read mode before the text is curtailed with '...'",placeholder:"URL"===r?"40":""},aa={id:"displayrows",type:"string",label:"Rows to Display",helptext:"(Optional, Edit Mode only) The number of visible text lines for this textarea. If blank, the textarea will auto-expand to its content.",
onChange:function(a){""===a&&(m.removeAttr("displayrows"),d.save())},validator:function(a){return a&&a>0&&J.isNumber(a)?!0:"Value must be a number greater than 0."}},ba={id:"decimalplaces",type:"picklist",label:"# of Decimal Places",helptext:"(Optional) The number of decimal places / digits to show in Read mode. Defaults to the number of decimal places configured in the Salesforce field's metadata.",picklistEntries:[{label:"(Use field metadata)",value:""}],defaultValue:""},ca={id:"valuehalign",type:"picklist",label:"Horizontal Alignment",helptext:"(Optional) The alignment of the field value within its container.",picklistEntries:[{label:"Left (default)",value:""},{label:"Right",value:"right"}],defaultValue:""},ea={id:"snippet",type:"string",label:"Render Snippet Name",helptext:'The name of a Skuid Snippet to run that will serve as a "Custom Renderer". Snippets are named JavaScript functions, and can be created by going to the Resources tab and creating a new JavaScript Resource of type "Inline (Snippet)". If your Resource Name is "CustomDatepicker", then you should enter "CustomDatepicker" here.'},fa={id:"showhelp",type:"boolean",label:"Show Inline Help",defaultValue:!0,helptext:"If true, Inline Help Text for this field will be shown."},ia={id:"maxselected",type:"string",label:"Max selectable items (optional)",helptext:"The maximum number of picklist items that a user can select. By default, the user can select as many items as they want."},ja=0;9>ja;ja++)ba.picklistEntries.push({value:ja+"",label:ja+""});if(!o)return j=[{name:"Basic",props:[A]}];var ka,la,ma,na,oa,qa,ra,ta,va,wa,xa,ya,Ca;if(r&&J.startsWith(r,"DATE")){var Da={id:"monthpicker",type:"boolean",defaultValue:!1,label:"Show Month Picker",helptext:"If true, a month picker will be displayed, allowing for quickly jumping to a specific month."},Ea={id:"yearpicker",type:"boolean",defaultValue:!1,label:"Show Year Picker",helptext:"If true, a year picker will be displayed, allowing for quickly jumping to a specific year.",onChange:function(){d.rebuildProps(h)}};if(xa=[Da,Ea],"true"===m.attr("yearpicker")){var Fa=[1,2,3,4,5,6,7,8,9,10,20,30,40,50,60,70,80,90,100];xa.push({id:"yearpickermin",type:"picklist",label:"Year Picker Lower Bound",defaultValue:"c-10",picklistEntries:G.map(Fa,function(a){return{value:"c-"+a,label:"Selected - "+a}}).concat(G.map(Fa,function(a){return{value:"-"+a,label:"Today - "+a}}))},{id:"yearpickermax",type:"picklist",label:"Year Picker Upper Bound",defaultValue:"c+10",picklistEntries:G.map(Fa,function(a){return{value:"c+"+a,label:"Selected + "+a}}).concat(G.map(Fa,function(a){return{value:"+"+a,label:"Today + "+a}}))})}r===ha&&(ya=xa.slice(0),ya.push({id:"minuteincrement",type:"picklist",label:"Minute Picker Increment",defaultValue:"5",picklistEntries:G.map([1,5,10,15,20,30],function(a){return a=""+a,{value:a,label:a}})}))}var Ga="TEXTAREA"===r&&p&&p.htmlFormatted===!0;"skootable"===g?(ma=[A,D,T,V,P,ca,B],na=[A,D,T,V,_,P,ca,B],qa=[A,D,Q,T,V,P,ba,ca,B],ra=[A,D,Q,T,V,P,ca,B],ta=[A,D,T,V,P,ca,B],va=[A,D,T,V,P,ia,ca,B],wa=[A,D,T,B,ca,P],oa=[A,D,T,V],Ga||oa.push(aa),oa.push(_,P,ca,B),Ca=[ma,na,oa,qa,ra,ta,va,wa],ka={TEXT:na,TEXTAREA:oa,COMBOBOX:na,ANYTYPE:na,STRING:na,URL:na,REFERENCE:ta,DEFAULT:ma,MULTIPICKLIST:va,BOOLEAN:wa,INTEGER:ra,DOUBLE:qa,PERCENT:qa,CURRENCY:qa,NUMBER:qa},la={REFERENCE:[E,K,N],DATE:xa,DATETIME:ya,DEFAULT:[]},!q&&p&&p.sortable&&G.each(Ca,function(a,b){b.splice(2,0,O)}),m.children("summaries").children("summary").length>0&&(ra.splice(4,0,R),qa.splice(4,0,R))):(ma=[A,D,fa,T,V,ca,B],na=[A,D,fa,T,V,_,ca,B],oa=[A,D,fa,T,V],Ga||oa.push(aa),oa.push(_,ca,B),ka={TEXTAREA:oa,ANYTYPE:na,TEXT:na,STRING:na,COMBOBOX:na,URL:na,REFERENCE:[A,D,fa,T,V,ca,B],BOOLEAN:[A,D,fa,T,ca,B],MULTIPICKLIST:[A,D,fa,T,V,ia,ca,B],DOUBLE:[A,D,fa,T,V,ba,ca,B],PERCENT:[A,D,fa,T,V,ba,ca,B],CURRENCY:[A,D,fa,T,V,ba,ca,B],DEFAULT:ma},la={REFERENCE:[E,K,N],DATE:xa,DATETIME:ya,DEFAULT:[]}),(r===sa||r===ua&&"REFPICK"===n)&&(p&&p.required||"true"===m.attr("required"))&&(ka[r]||ka.DEFAULT).splice(5,0,W),"model"===m.attr("optionsource")&&la.REFERENCE.push(F),m.attr("type")||la.REFERENCE.push($),i=(ka[r]||ka.DEFAULT).slice(0),"basicfieldeditor"===g&&p&&(p.inlineHelpText?"undefined"==typeof m.attr("showhelp")&&m.attr("showhelp","true"):i.splice(2,1));var Ha=(la[r]||la.DEFAULT).slice(0);if("CUSTOM"===m.attr("type")&&i.push(ea),l){ka={TEXTAREA:[A,C,D,P,_,ca],DOUBLE:[A,C,D,P,ba,ca],PERCENT:[A,C,D,P,ba,ca],CURRENCY:[A,C,D,P,ba,ca],DEFAULT:[A,C,D,P,ca]},i=(ka[r]||ka.DEFAULT).slice(0);var Ia=k.children("groupby").children('[name="'+M(m.attr("name"))+'"]'),Ja=Ia&&Ia.length;Ja?p&&p.sortable&&i.push(O):(i.push(Q),m.children("summaries").children("summary").length>0&&i.push(R),i.push(O)),i.push(B),"CUSTOM"===m.attr("type")&&i.push(ea),j=[{name:"Basic",props:i}]}else if(r===ua){var La=[{label:"Search Properties",linkedComponent:d,deleteable:!1,props:Ha}];1===p.referenceTo.length&&La.push(Ka({sobject:p.ref,modelName:f,linkedComponent:d,isReference:!0})),j=[{name:"Basic",props:i},{name:"Search",tree:La}]}else j=[{name:"Basic",props:i},{name:"Advanced",props:Ha}];l||r!==ua||j.push({name:"Filters",tree:{id:"filters",label:"Lookup Filters",linkedComponent:d,deleteable:!1,icon:"sk-bi-filters",isChild:!0,children:[{id:"filter",addtooltip:"Add New Lookup Filter",labelFunction:function(a){return I.getConditionDisplayString(a)},defaultStateFunction:function(){return L('<filter type="fieldvalue" operator="=" enclosevalueinquotes="true"/>')},propsFunction:function(d){var g=d.state;g.attr("operator")||g.attr("operator","="),d.isLookupFilterCondition=!0;var i=X(d,{modelName:f});if(!i&&g.attr("field")){var j=I.getSObjectForField(d);if(-1===j.indexOf(","))return a.service.getService(k.attr("service")||Ba).getEntityMetadata({entities:j,ignoreMetadataOverrides:!0}).then(function(){X(d,{modelName:f})||g.removeAttr("field"),d.rebuildProps(h)}),[]}var l=[c(d,{sobject:I.getSObjectForField(d),modelName:f,showObjectPickerIfPolymorphic:!0,handleChange:function(){d.rebuildProps(h)}}),e(d,{fieldMetadata:i})];return l.concat(b(d,{handleRefresh:function(){d.rebuildProps(h)},modelName:f,validTypes:["fieldvalue","multiple","blank","userinfo","param","modelmerge","dependent"]}))}}]}})}return"skootable"!==g&&(j[0].props.push(I.coreProps.cssClassProp()),j.push(y({component:d,propViewer:h,model:f,showOnHideDataBehaviorProp:!0,showEnableDisableConditions:!0,showMessageWhenDisabledProp:!0}))),j}function w(a,b){b=b||{};var c=[{name:"Basic",props:[{id:"title",type:"template",location:"attribute",label:"Popup Title",onChange:function(b){a.element.dialog("option","title",b)}},{id:"width",type:"csssize",label:"Width",onChange:function(b){a.element.dialog("option","width",b)}}]}];return b.useAfterCloseActions&&c.push(I.getActionsCategory({customNodeId:"afterclose",label:"After Close Actions",linkedComponent:a})),c}function x(a){a||(a={});var b=a.propViewer,c=a.useModelName,d=a.allowChildActions||!1,e=a.id||"hotkeys",f=a.label||"Hotkeys",g={id:"hotkey",deletetooltip:"Remove Hotkey",labelFunction:function(a){var b=a.attr("modifiers"),c=a.attr("key"),d="";return b&&G.each(b.split(","),function(a,b){G.each(Ea,function(){return this.value===b?(d+=this.label+"+",!1):void 0})}),G.each(Ha,function(){return this.value===c?(d+=this.label,!1):void 0}),d},defaultStateFunction:function(){return L('<hotkey modifiers="ctrl" key="n"/>')},propsFunction:function(a){var c=function(){a.refresh&&a.refresh()},d=[{id:"modifiers",location:"attribute",type:"multipicklist",label:"Modifiers",helptext:"Choose one or more modifiers that must be pressed at the same time as the principal hot key",picklistEntries:Ea,defaultValue:"ctrl",noneSelectedText:"Select Modifiers...",onChange:function(d){d&&"shift"!==d||(a.state.attr("ignoretextinputs","true"),a.save().rebuildProps(b)),c()}},{id:"key",type:"picklist",label:"Key",picklistEntries:Ha,defaultValue:"S",onChange:c},{id:"ignoretextinputs",type:"boolean",label:"Ignore Hot Key if user is typing in input element",helptext:"If true, then this Hot Key will be ignored while a user is entering text into any text input area. This option should be used if the Hot Key would conflict with typical data entry Hot Keys, such as arrow keys, copy/paste, etc."}];return d}};return d&&(g.childrenFunction=function(a){return[o({component:a,propViewer:b,useModelName:c,treeNode:{indent:1,invisibleParent:"actions"}})]},g.addtooltip="Add Hotkey Action"),{name:f,tree:{id:e,label:f,linkedComponent:a.linkedComponent,deleteable:!1,icon:"sk-icon-component-pack",addtooltip:"Add Hotkey",isChild:!0,children:[g]}}}function y(a){a||(a={});var b,c,d=a.showEnableDisableConditions||!1,e=G.extend({},a,{showOnHideDataBehaviorProp:a.showOnHideDataBehaviorProp,showMessageWhenDisabledProp:!1});return d&&(c=u(G.extend({},a,{showOnHideDataBehaviorProp:!1,showMessageWhenDisabledProp:!0,conditionsNodeId:"enableconditions",conditionsNodeLabel:"Enable Conditions",doLabel:"Enable",undoLabel:"Disable",conditionNodeId:"condition",addConditionNodeLabel:"Add new Enable Condition"}))),b=u(e),{name:"Rendering",tree:d?[b,c]:b}}function z(a){var b,c=a.closest("skootable, queue, eventview");return c.is("skootable, queue")?b=c.attr("model"):c.is("eventview")&&(b=c.attr("groupingmodel")),b}function A(a){var b=a.state;a.modelName=z(b);var c={id:"action",type:"picklist",label:"Action",defaultValue:"activate",picklistEntries:[{label:"Activate and Set Value",value:"set"},{label:"Activate",value:"activate"},{label:"De-Activate",value:"deactivate"}],onChange:function(){a.refresh().rebuildProps()}},d={id:"condition",label:"Model Condition",modelName:a.modelName,type:"condition",onChange:function(b,c){a.refresh(),c&&G.removeCookie(N.getConditionCookieName(a.modelName,c,H.pagebuilderui.row.Id))}},e=[c,d],f=b.parent().parent(),g=f&&f.is("source");return"set"===b.attr("action")&&(g&&"model"===f.attr("type")?e.push({id:"value",label:"Value to inject into Condition",type:"template",location:"attribute",displayAs:"input",defaultValue:"{{Id}}",onChange:function(){a.refresh()}}):g&&"metadata"===f.attr("type")||e.push({id:"value",label:"Value",type:"string",onChange:function(){a.refresh()}})),e}function B(a){var b,c,d,f,g,h=a.state,i=h.attr("conditionsource"),j=h.attr("type"),k=h.attr("conditionfield"),l="false"!==h.attr("affectcookies"),m=function(){k&&b&&(c=U(b,k),d=c?c.displaytype:!1)};i||(i=j?"manual":"auto"),"auto"===i&&k&&l&&(Ua(h,b),a.save()),a.modelName||(a.modelName=z(h)),b=a.modelName,m(),f=j+"_"+i,g={id:"type",type:"picklist",label:"Filter Type",defaultValue:"select",picklistEntries:[{label:"Date Range",value:"daterange"},{label:"Multi-select Option",value:"multiselect"},{label:"Select Option",value:"select"},{label:"Toggle",value:"toggle"}],onChange:function(c,d){h.removeAttr("conditionoperator"),h.empty(),a.element.children(".nx-childwrapper").empty(),"auto"===h.attr("conditionsource")&&"toggle"!==d&&Va(h,b),"toggle"===c&&"toggle"!==d?h.attr("conditionsource","manual"):"multiselect"===c&&"multiselect"!==d&&h.attr("conditionsource","auto"),"auto"===h.attr("conditionsource")&&"false"!==h.attr("affectcookies")&&h.attr("conditionfield")&&Ua(h,b),a.save().refresh().rebuildProps()}};var n,o={id:"condition",label:"Model Condition to Affect",helptext:"The Condition on this Model whose values this Filter will affect by default -- unless specified otherwise in the Effects of this Filter's options.",modelName:b,type:"condition",onChange:function(b,c){a.refresh(),c&&G.removeCookie(N.getConditionCookieName(a.modelName,c,H.pagebuilderui.row.Id)),a.rebuildProps()}},p={id:"conditionsource",type:"picklist",label:"Condition Source",defaultValue:"auto",picklistEntries:[{label:"Auto Generate Conditions",value:"auto"},{label:"Specify Existing Conditions",value:"manual"}],onChange:function(c,d){d&&d!==c&&("auto"===c&&h.attr("conditionfield")&&"false"!==h.attr("affectcookies")?Ua(h,b):"manual"===c&&Va(h,b),a.save().refresh().rebuildProps())}},q={id:"conditionsource",type:"picklist",label:"Pick Options and Condition(s)",defaultValue:"auto",picklistEntries:[{label:"Automatically",value:"auto"},{label:"Manually",value:"manual"}],onChange:function(c,d){d&&d!==c&&("auto"===c&&h.attr("conditionfield")&&"false"!==h.attr("affectcookies")?Ua(h,b):"manual"===c&&(Va(h,b),"auto"===h.attr("labelmode")&&h.removeAttr("labelmode")),h.removeAttr("conditionoperator"),a.save().refresh().rebuildProps())}},r={id:"conditionfield",type:"field",label:"Date/Datetime Field",displayTypeFilter:[ga,ha],addFieldToModel:!1,modelname:b,onChange:function(c,d,e,f){f&&"[No Field Selected]"!==f?(Wa(h,b,f),a.save()):(Ua(h,b),a.save()),a.refresh()}},s={id:"conditionfield",type:"field",label:"Filter Field",displayTypeFilter:[sa,pa,ua],addFieldToModel:!1,modelname:b,onChange:function(c,d,e,f){f&&"[No Field Selected]"!==f?(Wa(h,b,f),a.save()):(Ua(h,b),a.save()),a.refresh().rebuildProps()}},t={id:"startcondition",label:"Begin Model Condition",modelName:b,type:"condition",onChange:function(c,d){a.refresh(),d&&G.removeCookie(N.getConditionCookieName(b,d,H.pagebuilderui.row.Id))}},u={id:"endcondition",label:"End Model Condition",modelName:b,type:"condition",onChange:function(c,d){a.refresh(),d&&G.removeCookie(N.getConditionCookieName(b,d,H.pagebuilderui.row.Id))}},v={id:"affectcookies",label:"Remember last-selected filter value",helptext:"Skuid will remember each user's last filter value selection.",type:"boolean",defaultValue:!0,onChange:function(c){var d=h.attr("conditionfield")&&"auto"===h.attr("conditionsource");d&&(c===!0?Ua(h,b):Va(h,b),a.save()),a.refresh().rebuildProps()}},w={id:"createfilteroffoption",label:'Create "None Selected" Option',helptext:"If checked, an option which turns off this filter will be added to the options list.",type:"boolean",onChange:function(){a.refresh().rebuildProps()}},x={id:"filteroffoptionlabel",label:'"None Selected" Option Text',type:"string",helptext:'If desired, you can change the text of the "Filter Off" option, to be something like "Any Status", "Any Record Type", etc.',defaultValue:"Any",onChange:function(){a.refresh()}},y={id:"labelmode",label:"Show Label above Filter",type:"picklist",helptext:"If desired, an always-visible label will be shown above this filter.",defaultValue:"no",picklistEntries:[{label:"Yes, use Field's label",value:"auto"},{label:"Yes, use custom label",value:"manual"},{label:"No",value:"no"}],onChange:function(){a.rebuildProps()}},A={id:"label",label:"Filter Label",type:"string",onChange:function(){a.refresh()}},B={id:"autocompthreshold",label:"Switch Filter to Autocomplete at X Items",type:"number",defaultValue:"25",helptext:"By default, Select Option filters will become Autocompletes when the count of items in their list reaches 25. Change this amount if you'd like that to happen at a higher or lower number."},C={id:"maxheight",label:"Maximum Height (Optional)",type:"csssize"},D=function(){"manual"===h.attr("labelmode")&&n.push(A)};switch(f){case"toggle_manual":return[g,A,v];case"daterange_auto":return n=[g,p,r,y],D(),n;case"daterange_manual":return y.picklistEntries[0].label="Yes, use Condition's Field's label",n=[g,p,v,t,u,y],D(),n;case"multiselect_auto":return n=[g,s],c&&d&&n.push(e(a,{id:"conditionoperator",label:"Filter Condition Operator",conditionType:"multiple",fieldMetadata:c,handleChange:function(c){var d=Sa(h.attr("conditionfield")),e=S(d,b);e&&e.length&&(e.attr("operator",c),a.save())},defaultValue:d===pa?"includes":"in"})),n.push(v,y),D(),n.push(x),n;case"select_manual":return h.attr("condition")?y.picklistEntries[0].label="Yes, use Condition's Field's label":y.picklistEntries.splice(0,1),n=[g,q,o,v,B,y],D(),n.push(w),"true"===h.attr(w.id)&&n.push(x),n;default:return n=[g,q,s,v,C],d!==ua&&n.push(B),n.push(y),D(),n.push(x),n}}function C(a){return[{id:"columngutter",type:"csssize",label:"Column Gutter Size",onChange:function(){a.refresh(),K.publish("builder.colorcheck")}},{id:"rowgutter",type:"csssize",label:"Row Gutter Size",onChange:function(){a.refresh(),K.publish("builder.colorcheck")}}]}function D(a,b){var c=[],d=a.state,e=d.attr("behavior"),f={id:"behavior",type:"picklist",label:"Division Behavior",defaultValue:"flex",picklistEntries:[{label:"Flexible Width",value:"flex"},{label:"Fit to Content",value:"fit"},{label:"Specified Width",value:"specified"}],onChange:function(b){"flex"===b?(d.removeAttr("width"),d.attr({ratio:"1",minwidth:"100px"})):"fit"===b?d.removeAttr("width minwidth ratio"):"specified"===b&&(d.removeAttr("minwidth ratio"),d.attr("width","200px")),a.save().rebuildProps().refresh(),K.publish("builder.colorcheck")}},g={id:"minwidth",type:"csssize",label:"Minimum Width",onChange:function(){a.refresh(),K.publish("builder.colorcheck")}},h={id:"ratio",type:"string",label:"Flex Ratio",onChange:function(){a.refresh(),K.publish("builder.colorcheck")}},i={id:"verticalalign",type:"picklist",label:"Vertical Align",defaultValue:"top",picklistEntries:[{label:"Top",value:"top"},{label:"Center",value:"center"},{label:"Bottom",value:"bottom"}],onChange:function(){a.refresh(),K.publish("builder.colorcheck")}},j={id:"width",type:"csssize",label:"Width",onChange:function(){a.refresh(),K.publish("builder.colorcheck")}},k=E(a,b);return c.push(f),"flex"===e?c.push(h,g):"specified"===e&&c.push(j),c.push(i,k),c}function E(a,b){return{type:"custom",label:"Change Order",renderProperty:function(c){var d=c.element,e=c.state,f=G("<button>").append('<div class="nx-picker-icon sk-icon fa-arrow-left">').addClass("nx-picker-icon-btn"),g=G("<button>").append('<div class="nx-picker-icon sk-icon fa-arrow-right">').addClass("nx-picker-icon-btn"),h=e.index(),i=e.parent(),j=i.children().length;h>0?f.click(function(){e.insertBefore(i.children().eq(h-1)),b.save().rebuildProps().refresh(),a.select().rebuildProps(),K.publish("builder.colorcheck")}):f.addClass("nx-disabled"),j-1>h?g.click(function(){j>h+2?e.insertBefore(i.children().eq(h+2)):h+2>=j&&e.appendTo(i),b.save().rebuildProps().refresh(),a.select().rebuildProps(),K.publish("builder.colorcheck")}):g.addClass("nx-disabled"),d.append(f,g)}}}function F(a){var b,c,d=[],e=a.state,f=!0;return void 0===e.attr("showerrorsinline")&&(f=!1),b={id:"showerrorsinline",type:"boolean",label:"Show Errors Inline",helptext:"If true, field level errors will display next to the fields themselves.",defaultValue:f,onChange:function(){a.rebuildProps()}},c={id:"showerroronhover",type:"boolean",label:"Show Inline Error Only on Hover",helptext:"If true, field level error text will only be displayed when the user hovers over the field.",defaultValue:!1},d.push(b),"true"===e.attr("showerrorsinline")&&d.push(c),d}var G=a.$,H=a.builder,I=H.core,J=a.utils,K=a.events,L=J.makeXMLDoc,M=J.escapeSelector,N=a.model,O=I.defaultJavaScriptResourceBodies,P=I.defaultJavaScriptResourceNames,Q=I.determineQuotedness,R=I.getComponentFromState,S=I.getConditionByName,T=I.getDefaultAliasName,U=I.getFieldInfoFromCache,V=I.getFirstModel,W=I.getActionLabel,X=I.getMetadataForField,Y=I.getModelFromModelName,Z=I.getSObjectNameFromModelName,$=I.getValidOperators,_=I.isDistanceQueryable,aa=I.publishStateEvent,ba=I.updateState,ca="ADDRESS",da="ARRAY",ea="BOOLEAN",fa="CURRENCY",ga="DATE",ha="DATETIME",ia="DOUBLE",ja="EMAIL",ka="ENCRYPTEDSTRING",la="FORMULA",ma="ID",na="INTEGER",oa="LOCATION",pa="MULTIPICKLIST",qa="OBJECT",ra="PHONE",sa="PICKLIST",ta="PERCENT",ua="REFERENCE",va="STRING",wa="TEXT",xa="TEXTAREA",ya="URL",za="CHILDREL",Aa="COMBO",Ba="salesforce",Ca=function(a){a||(a={});var b={query:["GET","POST"],insert:["POST"],update:["PUT","PATCH","POST"],"delete":["DELETE"]};return{id:"verb",type:"picklist",label:"Service Access Method",defaultValue:"GET",picklistEntries:G.map(b[a.type||"query"],function(a){return{value:a,label:a}}),onChange:a.onChange}},Da=function(a){var b=a.component,c=b.state,d=c.is("model"),e=d?c:c.closest("model");return{id:"pathtocontent",type:"field",ignorePathToContent:!0,displayTypeFilter:[qa,da],modelprop:d?"id":!1,modelName:d?!1:e.attr("id"),label:"Path to Contents",helptext:"The path through the result of this GET request to the desired contents of this Model.",onChange:function(a,c,d,f){e.children("fields").children().each(function(){var b,c=G(this),d=c.attr("id");a&&J.startsWith(d,a)?b=d.substring(a.length+1):!a&&f&&(b=f+"."+d),c.attr("id",b)}),b.save().refresh()}}},Ea=[{label:"Alt",value:"alt"},{label:"Ctrl",value:"ctrl"},{label:"Command",value:"meta"},{label:"Shift",value:"shift"}],Fa={disabled:!0,label:"",value:""},Ga=function(a){return{disabled:!0,label:a,value:""}},Ha=[Ga("Letters/Numbers")];G.each("ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split(""),function(a,b){Ha.push({label:b,value:b.toLowerCase()})}),Ha.push(Fa,Ga("Arrow Keys")),G.each(["Left","Up","Right","Down"],function(){Ha.push({label:this,value:this.toLowerCase()})}),Ha.push(Fa,Ga("Special Keys")),G.each([{l:"Backspace/Delete",v:"backspace"},{l:"Delete Right",v:"del"},{l:"End",v:"end"},{l:"Home",v:"home"},{l:"Page Down",v:"pagedown"},{l:"Page Up",v:"pageup"},{l:"Tab",v:"tab"}],function(){Ha.push({label:this.l,value:this.v})}),Ha.push(Fa,Ga("Function Keys"));for(var Ia=1;13>Ia;Ia++)Ha.push({label:"F"+Ia,value:"f"+Ia});var Ja=function(b){b||(b={});var c=b.component,d=c.state,e=b.modelName,f=b.propViewer,g=b.hideOrderingOptions===!0,h=c.updateSearchBox?c.updateSearchBox:!1,i=Y(e),j=i?i.attr("adapter"):!1,k=j?a.adapter.getAdapter(i.attr("adapter")):!1,l=d.attr("searchmethod"),m="server"===l,n=!k||k.prop("canFieldsBeIndividuallySearched")!==!1,o=function(a){var b=[{id:"searchbox",type:"boolean",label:"Show Search Box",helptext:"By default, a search box is displayed, allowing for full-text search on all searchable fields displayed in this table. Uncheck this box to hide this search box.",onChange:function(){h&&h(),a.rebuildProps(f)}}];return"true"===d.attr("searchbox")&&(b.push({id:"searchmethod",type:"picklist",label:"Search Method",defaultValue:"server",helptext:'By default, table search is performed server-side, meaning that all records in the database will be searched for the text in the search box. To search just the records initially retrieved in the model, select "Client" instead.',picklistEntries:[{label:"Server",value:"server"},{label:"Client",value:"client"}],onChange:function(){a.rebuildProps(f)}}),!n&&m&&b.push({id:"searchconditionname",type:"condition",modelName:e,label:"Search Condition / Merge Parameter"}),n&&b.push({id:"tokenizesearch",type:"boolean",label:"Tokenize Search Terms",helptext:"If checked, this will split search terms on the 'space' character and search for them separately."}),b.push({id:"searchplaceholdertext",type:"template",displayAs:"input",location:"attribute",label:"Search box placeholder text",onChange:function(){h&&h()},helptext:'(Optional) Custom text to display as a placeholder in the search box until the user starts typing, e.g. "Search newly created Accounts...". Defaults to "Search " + the plural label of the Model\'s SObject, e.g. "Search Accounts"'}),m&&b.push({id:"emptysearchbehavior",type:"picklist",label:"Empty Search Behavior",defaultValue:"query",helptext:'By default, when the search box is emptied, the Model is requeried, but with no search Condition applied, so records will likely be returned. To remove all records from this Model when the search box is emptied, select "Remove all Model data".',picklistEntries:[{label:"Re-query for Model data",value:"query"},{label:"Remove all Model data",value:"remove"}]})),b},p=[];return a.mobile||p.push({label:"Filter & Search Behavior",linkedComponent:c,deleteable:!1,props:[{id:"instantfilters",type:"boolean",label:"Apply Filters and Search Immediately",defaultValue:!0,helptext:'By default, changing a Filter or entering search text will immediately re-query this Component\'s Model. Disable this setting to instead shown "Apply" and "Cancel" buttons which delay execution of filters and search until the user clicks "Apply".'}]}),p.push({label:"Search Properties",linkedComponent:c,deleteable:!1,propsFunction:o}),(n||"client"===l)&&p.push(Ka({fieldsNodeId:"searchfields",modelName:e,linkedComponent:c,hideOrderingOptions:g})),{name:"Filters & Search",tree:p}},Ka=function(b){b=b||{};var c=b.fieldsNodeId||"searchfields",d=b.isReference,e=b.sobject,f=b.modelName,g=b.propViewer,h=b.hideOrderingOptions===!0,i='<searchfield query="true" return="true" show="true"/>';return{label:"Search Fields",linkedComponent:b.linkedComponent,id:c,isChild:!0,deleteable:!1,propsFunction:function(a){var b,c=a.state,i=c.parent().attr("searchmethod"),j=[{type:"helptext",html:"Use Search Fields to specify which fields to search on.  If you do not specify any fields, all searchable fields will be searched."}],k=Y(f),l=k&&(k.attr("adapter")===Ba||!k.attr("adapter")),m="defaultordering";return l&&("server"===i||d)&&(b="true"===c.attr("usesosl"),j.push({type:"boolean",label:"Use SOSL to improve search performance",id:"usesosl",onChange:function(){a.state.attr("soslfields","Name Fields").empty(),a.save().refresh().rebuildProps(g)}}),b&&(j.push({id:"soslfields",type:"picklist",label:"Fields to Search",defaultValue:"Name Fields",picklistEntries:[{label:"Name Fields",value:"Name Fields"},{label:"All Text Fields",value:"All Fields"},{label:"Email Fields",value:"Email Fields"},{label:"Phone Fields",value:"Phone Fields"},{label:"SideBar Fields (Name, Phone, Email, External Ids)",value:"Sidebar Fields"}],onChange:function(){a.refresh().rebuildProps(g)}}),h||j.push({id:m,type:"boolean",label:"Use Default Ordering",helptext:"If checked, no additional sorting will be applied to the results of this search",defaultValue:!1,onChange:function(){a.rebuildProps()}})),h||(!b||"true"===c.attr(m))&&b||j.push({id:"orderby",type:"string",placeholder:J.getNameField(e||k&&k.objectName),label:"Fields to order records by",helptext:"How to order the data records returned for this Field, e.g. 'LastName DESC, FirstName' would order by LastName going from Z to A, then by FirstName going from A to Z."})),j},noItemsFunction:function(a){return a.attr("usesosl")?G("<div>").text("(Searching on "+a.attr("soslfields")+".)"):G("<div>").text(d?"(Searching on name field.)":"(Searching on all searchable fields.)")},childrenFunction:function(c){return"true"===c.state.attr("usesosl")?[]:[{id:"searchfield",indent:1,linkedComponent:b.linkedComponent,addtooltip:"Add New Search Field",labelFunction:function(a){var c,f,g,h=a.attr("operator")||"contains",i=a.attr("field");return!i||d&&"true"!==a.attr("query")||(g=U(b.modelName,i,e),g&&g.displaytype&&(c=J.getSearchOperatorForDisplayType(h,g.displaytype,i),f=" "+c+" [Search]")),(a.attr("field")||"[No Field Selected]")+(f||"")},defaultStateFunction:function(){return L(d?i:"<searchfield/>")},propsFunction:function(c){var f=c.state,h=f.attr("return"),i=f.attr("show"),j=f.attr("query"),k=f.attr("field"),l=k?U(b.modelName,k,e):!1,m=l?l.displaytype:!1,n=a.ui.searchableDisplayTypes,o=l?m in n:!1;"undefined"==typeof h&&(h="true"===i?"true":"false",f.attr("return",h),c.save());var p=[{id:"field",type:"field",label:"Field",displayTypeFilter:function(a){return d||a.displaytype in n},modelname:b.modelName,sobject:e,allowModelFieldAdds:!0,onChange:function(a){if(d){var h=U(b.modelName,a,e);if(h&&h.displaytype===ua){var i,j=h.rel+"."+J.getNameField(e),k=f.siblings('[field="'+M(j)+'"]'),l=f.parent();k.length||(l.append(L('<searchfield query="true" return="true" show="false" field="'+j+'"/>')),i=R(l.parent()),i&&(i.save(),i.rebuildProps&&i.rebuildProps(),i.renderProperties&&i.renderProperties(g)))}}c.refresh().rebuildProps()}}];if(d&&o&&p.push({id:"query",type:"boolean",label:"Search this Field",onChange:function(){c.save().refresh().rebuildProps(g)}}),k&&(!d||"true"===j)&&l&&o){var q,r=!1,s=G.map($("searchfield",m),function(a,b){return"contains"===b&&(r=!0),{label:a.name,value:b}});q=m===pa?"includes":r?"contains":s[0].value,s.length&&p.push({id:"operator",type:"picklist",label:"Search Operator",defaultValue:q,picklistEntries:s,onChange:function(){c.refresh()}})}return d&&(p.push({id:"return",type:"boolean",readonly:"true"===i,label:"Return Field in query results",onChange:function(){c.save().rebuildProps(g)}}),"true"===h&&p.push({id:"show",type:"boolean",label:"Show Field in Search Popup",onChange:function(){c.save().rebuildProps(g)}}),"true"===i&&p.push({id:"label",type:"template",displayAs:"input",location:"node",label:"Custom Label"})),p}}]}}},La=["background","background-image","background-size","background-attachment","background-repeat","background-position","background-color"],Ma=["min-height","border","border-left","border-right","border-top","border-bottom","padding","padding-left","padding-top","padding-right","padding-bottom"],Na=["color","font-size"],Oa=La.concat(Ma,Na),Pa=function(a){function b(a,b){return L("<styleitem />").attr("property",a).attr("value",b)}function c(a,c){var d,e,f,g,h=[];if(c)for(d in c)if(e=c[d])if(e instanceof Array)for(f=0;f<e.length;f++)h.push(b(d,e[f]));else h.push(b(d,e));h.length?(g=L("<styles/>").append(h),a.empty().append(g)):a.empty()}function d(a){var b=[];return G.each(a.children("styles").first().children(),function(){var a=G(this),c=a.attr("property"),d=a.attr("value");c&&b.push(G("<div>").addClass("nx-pagebuilder-styleitem-desc").text(c+": "+d+";"))}),b.length?b:!1}function e(a){for(var b,c=0,d=[];c<a[0].attributes.length;c++)b=a[0].attributes[c].name,"type"!==b&&d.push(b);for(c=0;c<d.length;c++)a[0].removeAttribute(d[c])}a||(a={});var f,g=a.component,h=g.state,i=function(a){a.element.append(G.map(a.items,function(b){var d=a.itemcomponent,e=a.styleProps,f=a.isSelectedFunction,h=a.property,j=G("<div>");return!f&&e&&h&&(f=function(b){return b===e[a.property]}),b instanceof Array?(j.addClass("nx-pagebuilder-prop-visualoptiongroup"),a.forceNewLinesForGroups&&j.css("width","100%"),a.element=j,a.items=b,i(a)):(j.addClass("nx-pagebuilder-prop-visualoption ui-state-default"+(f(b.value)?" ui-state-highlight":"")).append(G("<div>").addClass(b.fullCSS?b.fullCSS:a.cssPrefix+b.value.replace(" ","-")).attr("title",b.label)),b.minilabel&&j.append('<div class="minilabel">'+b.minilabel+"</div>"),"readonly"===d.mode?j.addClass("nx-pagebuilder-prop-visualoption-disabled"):j.on("click",function(){e&&(e[h]=b.value,c(d.state,e)),a.onClick&&a.onClick(b.value),d.rebuildProps().refresh(),g.save().refresh()})),j}))},j={background:{defaultState:'<styleitem type="background" bgtype="none" />',labelFunction:function(){return"Background"},propsFunction:function(a){var b=a.state,d=b.children("styles").first(),f=b.attr("bgtype")||"none",h=[{id:"bgtype",label:"Background Type",type:"picklist","default":"none",options:[{value:"none",label:"Not Set"},{value:"image",label:"Image"},{value:"color",label:"Color"}],beforeChange:function(a){a!==f&&(b.children().remove(),e(b))},onChange:function(b,c){b!==c&&"undefined"!=typeof c&&(a.rebuildProps().refresh(),g.save().refresh(),K.publish("builder.colorcheck"))}}],j={},k=function(){c(b,j)};switch(f){case"none":k();break;case"image":!function(){var c=b.attr("bg-source")||"staticresource";if(j["background-size"]=d.children('[property="background-size"]').attr("value")||"auto",j["background-attachment"]=d.children('[property="background-attachment"]').first().attr("value")||"scroll",j["background-position"]=d.children('[property="background-position"]').first().attr("value")||"center center",j["background-repeat"]=d.children('[property="background-repeat"]').first().attr("value")||"no-repeat",0===d.children().length&&k(),h.push({id:"bg-source",label:"Image Source",type:"picklist","default":"staticresource",options:[{value:"staticresource",label:"Static Resource"},{value:"external",label:"External URL"}],onChange:function(b,c){b!==c&&"undefined"!=typeof c&&(a.rebuildProps().refresh(),g.save().refresh())}}),"staticresource"===c){var e="{{#NamespacePrefix}}{{NamespacePrefix}}__{{/NamespacePrefix}}{{Name}}";h.push({id:"bg-resource",label:"Resource Name",type:"autocomplete",sobject:"StaticResource",fieldsToReturn:["Name","NamespacePrefix","ContentType"],fieldsToSearch:["Name","NamespacePrefix"],displayTemplate:e+"{{#ContentType}} ({{ContentType}}){{/ContentType}}",valueTemplates:{
resource:e},order:"Name",onChange:function(){a.refresh(),g.refresh()}},{id:"bg-path",label:"File Path (within a ZIP Resource)",type:"filepath",getResourceName:function(){var a=b.attr("bg-resource");return a?(a=a.split("__"),a[a.length-1]):null},getResourceNamespace:function(){var a=b.attr("bg-resource");return a&&(a=a.split("__"),2===a.length)?a[0]:null},onChange:function(){a.refresh(),g.refresh()}})}else"external"===c&&h.push({id:"bg-url",label:"Image URL",type:"string",onChange:function(){a.refresh(),g.save().refresh()}});h.push({label:"Size",type:"custom",renderProperty:function(b){i({element:b.element,items:[{label:"Do not resize the image.",value:"auto",minilabel:"Original"},{label:"Maintaining its aspect ratio, resize the image to fit within the Wrapper. The image will not be clipped.",value:"contain",minilabel:"Contain"},{label:"Maintaining its aspect ratio, resize the image to completey cover the Wrapper. The image may be clipped.",value:"cover",minilabel:"Cover"}],property:"background-size",styleProps:j,cssPrefix:"preview bg size_",itemcomponent:a})}},{label:"Position",type:"custom",renderProperty:function(b){i({element:b.element,forceNewLinesForGroups:!0,items:[[{label:"Top Left",value:"top left"},{label:"Top Center",value:"top center"},{label:"Top Right",value:"top right"}],[{label:"Center Left",value:"center left"},{label:"Center",value:"center center"},{label:"Center Right",value:"center right"}],[{label:"Bottom Left",value:"bottom left"},{label:"Bottom Center",value:"bottom center"},{label:"Bottom Right",value:"bottom right"}]],property:"background-position",styleProps:j,cssPrefix:"preview bg position_",itemcomponent:a})}},{label:"Repeat",type:"custom",renderProperty:function(b){i({element:b.element,items:[{label:"None",value:"no-repeat",minilabel:"No Repeat"},{label:"Horizontally",value:"repeat-x",minilabel:"Horizontal"},{label:"Vertically",value:"repeat-y",minilabel:"Vertical"},{label:"Both",value:"repeat",minilabel:"Both"}],property:"background-repeat",styleProps:j,cssPrefix:"preview bg repeat_",itemcomponent:a})}},{label:"Special Effects",type:"custom",renderProperty:function(b){i({element:b.element,items:[{label:"No Effects",value:"scroll",minilabel:"No Effects",fullCSS:"preview bg"},{label:"Parallax Effect",value:"fixed",minilabel:"Parallax",fullCSS:"preview effects_parallax"}],property:"background-attachment",styleProps:j,itemcomponent:a})}})}();case"color":!function(){j["background-color"]=d.children('[property="background-color"]').attr("value")||"transparent",0===d.children().length&&(k(),g.save(),K.publish("builder.colorcheck")),h.push({isStateless:!0,label:"Color",type:"color",valueFunction:function(){return j["background-color"]},beforeChange:function(a){j["background-color"]=a,k()},onChange:function(){a.refresh(),g.save().refresh(),K.publish("builder.colorcheck")}})}()}return h}},size:{defaultState:'<styleitem type="size" />',labelFunction:function(){return"Size"},propsFunction:function(a){function b(){var a={};"collapse"===f?a=G.extend(a,{width:["-webkit-fit-content","-moz-fit-content"],"-ms-grid-columns":"min-content",display:"table"}):"custom"===f&&(a=G.extend(a,{"min-width":j,"max-width":h}),j&&""!==j&&(a["min-width"]=j),h&&""!==h&&(a["max-width"]=h)),"viewport"===k?(d.attr("vwheight",l),a["overflow-y"]="auto"):"custom"===k&&(m&&""!==m&&(a["min-height"]=m),n&&""!==n&&(a["max-height"]=n,a["overflow-y"]="auto")),c(d,a)}var d=a.state,e=d.children("styles").first(),f=d.attr("width")||"full",h=e.children('[property="max-width"]').attr("value")||"",j=e.children('[property="min-width"]').attr("value")||"",k=d.attr("height")||"collapse",l=d.attr("vwheight")||"50",m=e.children('[property="min-height"]').attr("value")||"",n=e.children('[property="max-height"]').attr("value")||"",o=[];return o.push({label:"Width",type:"custom",renderProperty:function(c){i({element:c.element,items:[{label:"Full Width",value:"full",minilabel:"Full"},{label:"Collapse",value:"collapse",minilabel:"Collapse"},{label:"Custom",value:"custom",minilabel:"Custom"}],isSelectedFunction:function(a){return f===a},cssPrefix:"preview sz width_",itemcomponent:a,onClick:function(a){f=a,b(),c.updateState({key:"width",value:a})}})}}),"custom"===f&&o.push({isStateless:!0,label:"Maximum Width",type:"csssize",valueFunction:function(){return h},beforeChange:function(a){h=a,b()},onChange:function(){a.refresh(),g.save().refresh()}},{isStateless:!0,label:"Minimum Width",type:"csssize",valueFunction:function(){return j},beforeChange:function(a){j=a,b()},onChange:function(){a.refresh(),g.save().refresh()}}),o.push({label:"Height",type:"custom",renderProperty:function(c){i({element:c.element,items:[{label:"Collapse",value:"collapse",minilabel:"Collapse"},{label:"Custom",value:"custom",minilabel:"Custom"}],isSelectedFunction:function(a){return k===a},cssPrefix:"preview sz height_",itemcomponent:a,onClick:function(a){k=a,b(),c.updateState({key:"height",value:a})}})}}),"custom"===k&&o.push({isStateless:!0,label:"Minimum Height",type:"csssize",helptext:'Pro-tip: Use "100vh" to match the viewport height. 100% doesn\'t usually work.',valueFunction:function(){return m},beforeChange:function(a){m=a,b()},onChange:function(){a.refresh(),g.save().refresh()}},{isStateless:!0,label:"Maximum Height",type:"csssize",helptext:'Pro-tip: Use "100vh" to match the viewport height. 100% doesn\'t usually work.',valueFunction:function(){return n},beforeChange:function(a){n=a,b()},onChange:function(){a.refresh(),g.save().refresh()}}),o}},itemsize:{defaultState:'<styleitem type="itemsize" />',labelFunction:function(){return"Size"},propsFunction:function(a){function b(){var a={};"auto"===f||"custom"===f&&h&&""!==h&&(a.width=h),"auto"===j||"custom"===j&&k&&""!==k&&(a.height=k),c(d,a)}var d=a.state,e=d.children("styles").first(),f=d.attr("width")||"auto",h=e.children('[property="width"]').attr("value")||"",j=d.attr("height")||"auto",k=e.children('[property="height"]').attr("value")||"",l=[];return l.push({label:"Width",type:"custom",renderProperty:function(c){i({element:c.element,items:[{label:"Fill Container",value:"auto",minilabel:"Auto"},{label:"Custom",value:"custom",minilabel:"Custom"}],isSelectedFunction:function(a){return f===a},cssPrefix:"preview sz width_",itemcomponent:a,onClick:function(a){f=a,b(),c.updateState({key:"width",value:a})}})}}),"custom"===f&&l.push({isStateless:!0,label:"Width",type:"csssize",valueFunction:function(){return h},beforeChange:function(a){h=a,b()},onChange:function(){a.refresh(),g.save().refresh()}}),l.push({label:"Height",type:"custom",renderProperty:function(c){i({element:c.element,items:[{label:"Proportional",value:"auto",minilabel:"Auto"},{label:"Custom",value:"custom",minilabel:"Custom"}],isSelectedFunction:function(a){return j===a},cssPrefix:"preview sz height_",itemcomponent:a,onClick:function(a){j=a,b(),c.updateState({key:"height",value:a})}})}}),"custom"===j&&l.push({isStateless:!0,label:"Minimum Height",type:"csssize",valueFunction:function(){return k},beforeChange:function(a){k=a,b()},onChange:function(){a.refresh(),g.save().refresh()}}),l}},border:{defaultState:'<styleitem type="border" />',labelFunction:function(){return"Border and Padding"},propsFunction:function(a){function b(){var a={};G.each(f,function(b,c){h.indexOf(c)>-1&&(a["border"+("all"===c?"":"-"+c)]=j[c])}),G.each(k,function(b,c){l.indexOf(c)>-1&&(a["padding"+("all"===c?"":"-"+c)]=m[c])}),G.each(n,function(b,c){o.indexOf(c)>-1&&(a["margin"+("all"===c?"":"-"+c)]=p[c])}),a["box-sizing"]="border-box",c(d,a)}var d=a.state,e=d.children("styles").first(),f=["all","left","top","right","bottom"],h=d.attr("borders")||"none",j={},k=["all","left","top","right","bottom"],l=d.attr("padding")||"none",m={},n=["all","left","top","right","bottom"],o=d.attr("margin")||"none",p={},q=[];return G.each(f,function(a,b){j[b]=e.children('[property="border'+("all"===b?"":"-"+b)+'"]').attr("value")||"0px solid transparent",j[b+"Vals"]=j[b].split(" ")}),G.each(k,function(a,b){m[b]=e.children('[property="padding'+("all"===b?"":"-"+b)+'"]').attr("value")||"0px"}),G.each(n,function(a,b){p[b]=e.children('[property="margin'+("all"===b?"":"-"+b)+'"]').attr("value")||"0px"}),q.push({label:"Border",type:"custom",renderProperty:function(c){i({element:c.element,items:[{label:"No Borders",value:"none",minilabel:"No Borders"},{label:"All Borders the Same",value:"all",minilabel:"All"},[{label:"Left Border On/Off",value:"left",minilabel:"Left"},{label:"Top Border On/Off",value:"top",minilabel:"Top"},[{label:"Right Border On/Off",value:"right",minilabel:"Right"},{label:"Bottom Border On/Off",value:"bottom",minilabel:"Bottom"}]]],isSelectedFunction:function(a){return h.indexOf(a)>-1},cssPrefix:"preview bd border_",itemcomponent:a,onClick:function(a){"all"===a||"none"===a?h=a:(h="all"===h||"none"===h?"":h,h=h.indexOf(a)>-1?h.replace(a+",",""):a+","+h),b(),c.updateState({key:"borders",value:h})}})}}),G.each([{label:"",value:"all"},{label:"Left",value:"left"},{label:"Top",value:"top"},{label:"Right",value:"right"},{label:"Bottom",value:"bottom"}],function(c,d){h.indexOf(d.value)>-1&&q.push({isStateless:!0,label:d.label+" Border Width",type:"csssize",valueFunction:function(){var a=j[d.value+"Vals"];return a.length>0?a[0]:"0px"},beforeChange:function(a){var c=j[d.value+"Vals"];3===c.length?j[d.value]=a+" "+c[1]+" "+c[2]:j[d.value]=a+" solid transparent",j[d.value+"Vals"][0]=a,b()},onChange:function(){a.refresh(),g.save().refresh()}},{isStateless:!0,label:d.label+" Border Color",type:"color",valueFunction:function(){var a=j[d.value+"Vals"];return 3===a.length?a[2]:"transparent"},beforeChange:function(a){var c=j[d.value+"Vals"];3===c.length?j[d.value]=c[0]+" "+c[1]+" "+a:j[d.value]="0px solid "+a,j[d.value+"Vals"][2]=a,b()},onChange:function(){a.refresh(),g.save().refresh()}})}),q.push({label:"Padding",type:"custom",renderProperty:function(c){i({element:c.element,items:[{label:"No Padding",value:"none",minilabel:"No Padding"},{label:"All Padding the Same",value:"all",minilabel:"All"},[{label:"Left Padding On/Off",value:"left",minilabel:"Left"},{label:"Top Padding On/Off",value:"top",minilabel:"Top"},[{label:"Right Padding On/Off",value:"right",minilabel:"Right"},{label:"Bottom Padding On/Off",value:"bottom",minilabel:"Bottom"}]]],isSelectedFunction:function(a){return l.indexOf(a)>-1},cssPrefix:"preview bd padding_",itemcomponent:a,onClick:function(a){"all"===a||"none"===a?l=a:(l="all"===l||"none"===l?"":l,l=l.indexOf(a)>-1?l.replace(a+",",""):a+","+l),b(),c.updateState({key:"padding",value:l})}})}}),G.each([{label:"",value:"all"},{label:"Left",value:"left"},{label:"Top",value:"top"},{label:"Right",value:"right"},{label:"Bottom",value:"bottom"}],function(c,d){l.indexOf(d.value)>-1&&q.push({isStateless:!0,label:d.label+" Padding Width",type:"csssize",valueFunction:function(){return m[d.value]||"0px"},beforeChange:function(a){m[d.value]=a,b()},onChange:function(){a.refresh(),g.save().refresh()}})}),q.push({label:"Margin",type:"custom",renderProperty:function(c){i({element:c.element,items:[{label:"No Margin",value:"none",minilabel:"No Margin"},{label:"All Margins the Same",value:"all",minilabel:"All"},[{label:"Left Margin On/Off",value:"left",minilabel:"Left"},{label:"Top Margin On/Off",value:"top",minilabel:"Top"},[{label:"Right Margin On/Off",value:"right",minilabel:"Right"},{label:"Bottom Margin On/Off",value:"bottom",minilabel:"Bottom"}]]],isSelectedFunction:function(a){return o.indexOf(a)>-1},cssPrefix:"preview bd padding_",itemcomponent:a,onClick:function(a){"all"===a||"none"===a?o=a:(o="all"===o||"none"===o?"":o,o=o.indexOf(a)>-1?o.replace(a+",",""):a+","+o),b(),c.updateState({key:"margin",value:o})}})}}),G.each([{label:"",value:"all"},{label:"Left",value:"left"},{label:"Top",value:"top"},{label:"Right",value:"right"},{label:"Bottom",value:"bottom"}],function(c,d){o.indexOf(d.value)>-1&&q.push({isStateless:!0,label:d.label+" Margin Width",type:"csssize",valueFunction:function(){return p[d.value]||"0px"},beforeChange:function(a){p[d.value]=a,b()},onChange:function(){a.refresh(),g.save().refresh()}})}),q}}},k=a.standardStyleSections||[];return a.customStyleSections&&G.each(a.customStyleSections,function(a,b){j[a]=b,k.push(a)}),k&&k.length&&(f=h.children("styles").first(),f.length||(f=L("<styles/>"),h.append(f)),G.each(k,function(a,b){var c=j[b];if(c&&0===f.children('styleitem[type="'+b+'"]').length){var d=f.children("styleitem[type]").last();d.length?L(c.defaultState).insertAfter(d):f.append(L(c.defaultState))}}),G.each(f.children("styleitem[type]"),function(){var a=G(this);if(-1===k.indexOf(a.attr("type"))){var b=a.find("styleitem");b.length&&f.append(b),a.remove()}}),g.save()),{id:a.id||"styles",label:"Style Attributes",deleteable:!1,icon:"sk-icon-generate-assets",isChild:!0,linkedComponent:g,children:[{id:"styleitem",addtooltip:"Add New Style Attribute",linkedComponent:g,labelFunction:function(a){var b=a.attr("property"),c=a.attr("value"),d=a.attr("type");return d&&j[d]?j[d].labelFunction(a):(b||"(none)")+" : "+(c||"(none)")+";"},noItemsFunction:function(a){var b=a.attr("type");return b&&j[b]?d(a):void 0},defaultStateFunction:function(){return L("<styleitem/>")},afterDelete:function(){g.refresh(),K.publish("builder.colorcheck")},deleteableFunction:function(a){var b=a.attr("type");return-1===["background","size","itemsize","border"].indexOf(b)},actionItemsFunction:function(a){var b=a.state,c=b.attr("type");return c&&j[c]?[{label:"",icon:"fa-bomb",action:function(){b.empty(),e(b),g.save(),g.refresh(),a.refresh().rebuildProps(),K.publish("builder.colorcheck")},tooltip:"Reset Property Group"}]:!1},propsFunction:function(a){var b=a.state.attr("type"),c={id:"property",type:"string",label:"Property",onChange:function(){g.refresh(),a.refresh(),K.publish("builder.colorcheck")}},d={id:"value",type:"string",label:"Value",onChange:function(){g.refresh(),a.refresh(),K.publish("builder.colorcheck")}};return b&&j[b]?j[b].propsFunction(a):[c,d]}}]}},Qa=function(a){return"__autofilter__start__"+a},Ra=function(a){return"__autofilter__end__"+a},Sa=function(a){return"__autofilter__"+a},Ta=function(a){a||(a={});var b,c,d,e=a.currentOperator,f=a.filterType,g=a.fieldName,h=a.modelName,i="multiselect"===f;return i?(h&&g&&(b=U(h,g),c=b?b.displaytype:!1,c&&(d=$({type:"multiple",displayType:c}))),d&&e&&e in d?e:c===pa?"includes":"in"):"="},Ua=function(a,b){var c=a.attr("type"),d=a.attr("conditionfield"),e=Y(b),f=e.children("conditions");if(f.length)if("daterange"===c){var g=Qa(d);S(g,f).length||f.append(L("<condition/>").attr({type:"fieldvalue",field:d,operator:"gte",inactive:"true",enclosevalueinquotes:"false",name:g,state:"filterableoff",value:""}),L("<condition/>").attr({type:"fieldvalue",field:d,operator:"lte",inactive:"true",enclosevalueinquotes:"false",name:Ra(d),state:"filterableoff",value:""}))}else if(J.contains(c,"select")){var h=Sa(d),i="multiselect"===c;S(h,f).length||f.append(L("<condition/>").attr({type:i?"multiple":"fieldvalue",field:d,operator:Ta({fieldName:d,modelName:b,currentOperator:a.attr("conditionoperator"),filterType:c}),inactive:"true",enclosevalueinquotes:"true",name:h,state:"filterableoff",value:""}))}},Va=function(a,b){var c=a.attr("type"),d=a.attr("conditionfield"),e=Y(b),f=e.children("conditions").children();if(f.length)if("daterange"===c){var g=Qa(d),h=Ra(d);G.removeCookie(N.getConditionCookieName(b,g,H.pagebuilderui.row.Id)),G.removeCookie(N.getConditionCookieName(b,h,H.pagebuilderui.row.Id)),f.each(function(){var a=G(this),b=a.attr("name");(b===g||b===h)&&a.remove()})}else if(J.contains(c,"select")){var i=Sa(d);G.removeCookie(N.getConditionCookieName(b,i,H.pagebuilderui.row.Id)),f.each(function(){var a=G(this);return a.attr("name")===i?(a.remove(),!1):void 0})}},Wa=function(a,b,c){var d=a.attr("type"),e=a.attr("conditionfield"),f=Y(b),g=f.children("conditions").children();if(g.length)if("daterange"===d){var h=Qa(c),i=Ra(c),j=Qa(e),k=Ra(e),l=!1,m=!1;g.each(function(){var a=G(this),c=a.attr("name"),d=c===h,f=c===i;(d||f)&&(d?(l=!0,a.attr("name",j)):f&&(m=!0,a.attr("name",k)),a.attr("field",e),G.removeCookie(N.getConditionCookieName(b,c,H.pagebuilderui.row.Id)))}),l&&m||Ua(a,b)}else if(J.contains(d,"select")){var n=Sa(c),o=Sa(e),p=!1;g.each(function(){var c=G(this);return c.attr("name")===n?(p=!0,c.attr({name:o,field:e,operator:Ta({fieldName:e,modelName:b,currentOperator:a.attr("conditionoperator"),filterType:d})}),G.removeCookie(N.getConditionCookieName(b,n,H.pagebuilderui.row.Id)),!1):void 0}),p||Ua(a,b)}};G.extend(I,{getServiceAccessMethodProperty:Ca,getPathToContentProperty:Da,getModelFieldProperties:i,getModelProperties:h,getConditionsBuilderProperties:j,getConditionFieldPropObj:c,getConditionFieldProperties:d,getConditionOperatorPropObj:e,getConditionParameterProperties:g,getConditionValueProperties:b,getConditionStateProperties:f,getLabelProperties:m,getJSItemProperties:l,getCSSItemProperties:k,getActionTreeNode:o,getActionsCategory:q,getActionsTree:p,getContextCategory:t,getCoreActionProperties:r,getFieldProperties:v,getPopupProperties:w,getHotkeysCategory:x,getListSearchPropsCategory:Ja,getRenderingCategory:y,getSearchFieldsTreeItem:Ka,getStandardStyleTree:Pa,builderSafeStyleProperties:Oa,builderSafeBackgroundProperties:La,builderSafePositionProperties:Ma,builderSafeFormatProperties:Na,getGridProperties:C,getDivisionProperties:D,getDivisionReOrderProp:E,getErrorBehaviorProperties:F,getEffectItemProperties:A,getFilterItemProperties:B,removeModelConditionsForAutoFilter:Va})}(skuid),function(a){function b(a,b,c,d){return new y.Component(a,b,c,d)}function c(a,c,d,e){var f=B.getComponentFromState(a);return f?f.refresh():f=b(a,c,d,e),f}function d(a,b,d){d=d||{};var e=[];z.each(b,function(){var a=c(z(this),d.customBuilder,d.makeDraggable,d.isGlobalComponent);e.push(a.element)}),e.length&&a.append(e)}function e(b,c,d,e){var f=this;if(f.state=b,"object"==typeof d){var g=arguments[2];d=g.makeDraggable,e=g.isGlobalComponent,f.mode=g.mode}if(0===b.length)return!1;var h=b[0].nodeName.toLowerCase();B.registerComponent(f),B.isInMasterPage(b)===!0&&(f.mode="readonly"),f.customBuilder=c,f.isGlobalComponent=e,f.makeDraggable=d,c?(f.builder=c,f.builderId=f.builder.id):(f.builderId=h,f.builder=B.getBuilder(f.builderId)||new B.Builder({id:f.builderId})),f.builder&&(void 0!==f.builder.isGlobalComponent&&(e=f.builder.isGlobalComponent),void 0!==f.builder.makeDraggable&&(d=f.builder.makeDraggable)),f.element=z("<div>").data("object",f).addClass("nx-pagebuilder-component");var i=f.element;"readonly"===f.mode&&i.addClass("nx-pagebuilder-component-readonly"),f.headerWrapper=z("<div>").addClass("nx-pagebuilder-component-header"),f.actionbar=z("<div>").addClass("nx-pagebuilder-component-actionbar"),f.actionItems={},f.header=z("<span>"),f.headerWrapper.append(f.actionbar,f.header),f.body=z("<div>").addClass("nx-pagebuilder-component-body");var j=f.builder.hideWrapper;if("function"==typeof j&&(j=j(f)),j?i.addClass("nx-pagebuilder-component-hidewrapper"):i.addClass("nx-pagebuilder-component-showwrapper"),i.append(f.headerWrapper,f.body),f.builder.isTransparent){var k="nx-pagebuilder-component-transparent";i.addClass(k);var l=function(){i.removeClass(k+"-darkbg "+k+"-lightbg "+k+"-mediumbg").addClass(k+"-whitebg")},m=function(){i.removeClass(k+"-whitebg"),i.removeClass(k+"-darkbg"),i.removeClass(k+"-mediumbg"),i.addClass(k+"-lightbg")},n=function(){i.removeClass(k+"-whitebg"),i.removeClass(k+"-darkbg"),i.removeClass(k+"-lightbg"),i.addClass(k+"-mediumbg")},o=function(){i.removeClass(k+"-whitebg"),i.removeClass(k+"-lightbg"),i.removeClass(k+"-mediumbg"),i.addClass(k+"-darkbg")},p=function(){var a=B.getClosestBackground(i);if(a){var b=B.getColorLightness(a);f.headerWrapper.find(".nx-page-builder-hiddenheader-title").css("background-color",a),255===b?l():b>150?m():b>60?n():o()}else l()};a.events.subscribe("ui.reflow",p),a.events.subscribe("builder.colorcheck",p)}f.refresh()}function f(a,b,c,d){1===arguments.length&&void 0!==a.componentsXML?(this.componentsXML=a.componentsXML,this.customBuilder=a.customBuilder,this.accept=a.accept||F,this.mode=a.mode):(this.accept=c||F,this.mode=d,this.customBuilder=b,this.componentsXML=a),this.element=z("<div>").addClass("nx-pagebuilder-acceptor"),this.element.data("object",this),this.refresh()}function g(){function c(a){var b=a.data("builder"),c=A.pagebuilderui.cproperties;c.clear(),i().removeClass("nx-pagebuilder-selected"),a.addClass("nx-pagebuilder-selected"),c.setTitle(b.name),b.helplink&&c.header.prepend(z("<a>").css({"float":"right","font-size":"7pt"}).attr({target:"_blank",href:b.helplink}).append(z("<div>").text(b.name+" Help").css({display:"inline-block","vertical-align":"middle"}),z("<div>").addClass("inline sk-icon sk-icon-help").css({margin:"8px","vertical-align":"middle"}))),A.pagebuilderui.cproperties.body.empty().append(z("<div>").addClass("nx-pagebuilder-infotext").html(b.description+"<br/><br/>To add this component to a page, drag it into the component workspace."))}function d(a,b,d){var e=z("<div>").addClass("nx-pagebuilder-componenttag");if(b.isJSCreateable!==!1&&e.addClass("nx-js-createable"),e.attr("data-ctype",b.id).data({generateOptions:{componentId:b.id},builder:b}).append(z("<div>").css("float","left").addClass("sk-icon "+b.icon),z("<div>").text(b.name).css({"margin-left":"24px"})).draggable({appendTo:".nx-page",helper:function(){return z(this).clone().addClass("nx-pagebuilder-component-helper")},start:function(){c(z(this))},revert:"invalid"}).appendTo(d),b.compatText){var f=z("<div>").addClass("sk-icon fa-info-circle inline nx-pagebuilder-component-infoicon");f.skootip(b.compatText),e.append(f)}g.components.push(e)}function e(a,b,c){var d=z("<div>").addClass("nx-pagebuilder-folderwrapper"),e=z("<div>").addClass("nx-pagebuilder-foldertag").append(z("<div>").css("float","right").addClass("sk-icon fa-angle-"+(b.autoopen?"down":"right")),z("<div>").css("float","left").addClass("sk-icon "+(b.icon?b.icon:"sk-icon-component-pack")),z("<div>").css({"margin-left":"24px"}).text(b.name)),h=z("<div>").addClass("nx-pagebuilder-foldercomponentswrapper");b.autoopen?h.css("display","block"):h.css("display","none"),d.append(e,h),c.append(d),f(b.components,h),g.folders.push(d)}function f(a,b){C.size(a)>0&&z.each(a,function(a){var c=this.builder;if(c){if(c.hideFromComponentsList)return!0;d(a,c,b)}else z(".nx-page").data("component").addProblem("Could not load the builder for the "+a+" component.")})}var g=this;if(this.element=z("<div>").addClass("nx-pagebuilder-components-inner"),this.components=[],this.folders=[],this.filterComponents=function(a){var b,c,d;if(void 0===this.prevFilter||""===this.prevFilter)for(b=0;b<g.folders.length;b++)c=z(g.folders[b]).find(".nx-pagebuilder-foldertag"),d=z(g.folders[b]).find(".nx-pagebuilder-foldercomponentswrapper"),d.data("prevDisplay",d.css("display")),d.css("display","block"),c.css("display","none");if(""===a)for(b=0;b<g.folders.length;b++)c=z(g.folders[b]).find(".nx-pagebuilder-foldertag"),d=z(g.folders[b]).find(".nx-pagebuilder-foldercomponentswrapper"),d.css("display",d.data("prevDisplay")),c.css("display","block");for(b=0;b<g.components.length;b++){var e=z(g.components[b]),f=e.data("builder").name.toLowerCase().split(" ").join("");f.match(a.toLowerCase().split(" ").join(""))?e.show():e.hide()}this.prevFilter=a},a.page.useComponentPacks){var h=B.getAvailableComponentsWithFolders();f(h.noFolderComponents,g.element),z.each(h.activeFolders,function(a,b){e(a,b,g.element)})}else{var k={};z.each(B.getBuilders(),function(a,b){return b.hideFromComponentsList?!0:(b.name in k||(k[b.name]=[]),void k[b.name].push(b))});var l=Object.keys(k).sort(),m=[];z.each(l,function(a,b){z.each(k[b],function(a,b){m.push(b)})}),z.each(m,function(a,b){d(a,b,g.element)})}this.element.on("dblclick",".nx-pagebuilder-componenttag",function(){var a,c,d=z(this),e=d.data("builder"),f=d.data("generateOptions"),g=e.personalizationSettings&&"undefined"!=typeof e.personalizationSettings.setUniqueId?e.personalizationSettings.setUniqueId:!0,h=b(e.getDefaultState(f,{setUniqueId:g}),e,!0,!0),k=i(),l=!1,m=z(".ui-dialog-content:visible").last();if((!k.length||!k.is(".nx-pagebuilder-component:visible")||m.length&&!k.closest(".ui-dialog-content:visible").is(m))&&(k=j()),k.length&&k.is(":visible")&&(!m.length||k.closest(".ui-dialog-content:visible").is(m))){var n=k.data("object");n&&n.addChildComponent(h)?l=!0:a&&a.length&&(c=a.last().data("object"),c&&c.canAcceptComponent(h)&&(c.addComponent(h,{after:k}),l=!0))}if(!l&&(a=A.pagebuilderui.find("> .nx-pagebuilder-workspace > .nx-pagebuilder-component > .nx-pagebuilder-component-body > .nx-pagebuilder-acceptor"),a&&a.length)){var o;for(o=a.length-1;o>=0;o--)if(c=z(a[o]).data("object"),c.canAcceptComponent(h)){c.addComponent(h),l=!0;break}}l&&h.save().select()}).on("click",".nx-pagebuilder-componenttag",function(){c(z(this))}).on("click",".nx-pagebuilder-foldertag",function(){var a=z(this),b=a.find(".sk-icon");b.is(".fa-angle-right")?b.removeClass("fa-angle-right").addClass("fa-angle-down"):b.removeClass("fa-angle-down").addClass("fa-angle-right"),C.niceExpand(a.parent(),a.parent().children(".nx-pagebuilder-foldercomponentswrapper").first(),0)})}function h(){this.element=z("<div>").addClass("nx-pagebuilder-toolbarpanel"),this.header=z("<div>").addClass("nx-pagebuilder-toolbarpanel-header ui-widget-header"),this.propGroups=z("<div>").addClass("nx-pagebuilder-toolbarpanel-propgroups").appendTo(this.header),this.headertext=z("<div>").addClass("nx-pagebuilder-toolbarpanel-headertext").html("&nbsp;").appendTo(this.header),this.body=z("<div>").addClass("nx-pagebuilder-toolbarpanel-body"),this.element.append(this.header,this.body)}function i(){return z(".nx-pagebuilder-selected")}function j(){return G||z()}function k(a){i().not(a).each(function(){var a=z(this);a.removeClass("nx-pagebuilder-selected");var b=a.data("object");b&&b.builder.onUnSelect&&b.builder.onUnSelect(b)})}function l(b,c,d){d=d||{},d.columnCount=d.columnCount||2;for(var e=z("<div>").addClass("nx-editor-contents"),f={},g=[],h=B.getComponentFromState(b),i=d.mode||h.mode,j=0;j<d.columnCount;j++){var k=z("<div>").addClass("nx-pagebuilder-propcolumn").css("width",100/d.columnCount+"%");g.push(k),e.append(k)}return z.each(c,function(e,h){("readonly"===i&&"undefined"==typeof h.mode||"readonly"===h.mode)&&(h.readonly=!0),h.init&&h.init();var j=z("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item");g[Math.floor(e*d.columnCount/c.length)].append(j),f[h.id]=j;var k,l,m,o,q,r=h.id,s=h.label||r,t=z("<div>").addClass("nx-basicfieldeditor-item-label").text(s),u=h.storeAs;if(j.append(t),(h.isUpdated||h.isNew)&&(t.css("position","relative"),t.append(z("<div>").addClass("nx-pagebuilder-"+(h.isUpdated?"new":"updated")+"prop").text(h.isUpdated?"Updated":"New"))),h.helptext){var v=z("<div>").addClass("sk-icon sk-icon-help inline").css({"vertical-align":"top","margin-left":"4px"});v.skootip(h.helptext),t.append(v)}if(h.compatText){var w=z("<div>").addClass("sk-icon fa-info-circle inline").css({"vertical-align":"top","margin-left":"4px"});w.skootip(h.compatText),t.append(w)}var x=z("<div>").addClass("nx-field");if(j.append(x),h.type)if(-1!==z.inArray(h.type,["autocomplete","boolean","color","condition","csssize","custom","icon","filepath","model","models","multipicklist","numberbox","picklist","quicknumber","sobject"]))x.append(B.propertyRenderers[h.type](h,b));else if("readonly"===h.type){var y=r&&b.attr(r)||h.value||h.valueFunction&&h.valueFunction()||h.defaultValue,A=z("<div>").addClass("nx-fieldtext").text(y||"").addClass("nx-pagebuilder-readonly-text");x.append(A)}else if("helptext"===h.type)j.empty().html(h.html).addClass("nx-pagebuilder-property-helptext").removeClass("nx-basicfieldeditor-item");else if("multiitem"===h.type){var E=b.children(r),F=z("<div>"),G=function(c){var d=z("<div>").css("clear","both"),e=z("<div>").addClass("nx-pagebuilder-property-button-area"),f=z("<button>").addClass("nx-picker-icon-btn").append(z("<div>").addClass("nx-picker-icon sk-icon inline sk-icon-delete"));f.on("click",function(){c.remove(),d.remove(),a.events.publish("skuidBuilderSave"),h.onChange&&h.onChange()}),e.append(B.getValueEditorFromMetadata(h,b,r,c));var g=z("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(f);return d.append(g,e),d};if(E.length||(E=D("<values/>").append(D("<value/>")),E.appendTo(b)),h.readonly){var H=z.map(E.children(u.name),function(a){return z(a).text()}).join(", ");x.append(z("<div>").html(H))}else E.children(u.name).each(function(){F.append(G(z(this)))}),x.append(F,z("<div>").text("Add Another Value").addClass("nx-pagebuilder-viewxmllink").css({cursor:"pointer","float":"left","margin-bottom":"2px"}).click(function(){var b=D("<value/>").appendTo(E);F.append(G(b)),a.events.publish("skuidBuilderSave"),h.onChange&&h.onChange()}))}else if("field"===h.type){q=z("<div>").addClass("nx-pagebuilder-property-button-area");var I,J,K,L,M="[No Field Selected]",N=r&&b.attr(r),O=N||h.defaultValue||M,P=h.isMultiselect||!1,Q=P?"Select Fields":"Select Field",R=z("<div>").addClass("nx-fieldtext").text(h.labelFunction?h.labelFunction(b):O).appendTo(q).addClass("nx-pagebuilder-property-button-area-inner"),S=!1;if(K=!1,h.readonly)x.append(q);else{l=z("<button>").addClass("nx-picker-icon-btn"),k=z("<div>").appendTo(l).skootip(Q).addClass("nx-picker-icon sk-icon inline sk-bi-field-pick");var T=function(a,c){var d=h.ignorePathToContent?a.fullFieldId:a.fieldId,e=a.isChecked,f=a.targetObjects,g=O;h.addFieldToModel&&d&&e&&J&&B.addFieldToModel({fieldId:d,model:J}),r&&B.updateState(b,{key:r,value:d}),h.onChange&&h.onChange(d,e,f,g),R.text(h.labelFunction?h.labelFunction(b):d),O=d,P||c&&c.dialog("close")},U=h.selectedFunction||function(a){return a===r&&b.attr(r)},V=function(){I=h.modelname?h.modelname:h.modelprop?b.attr(h.modelprop):b.closest("model").attr("id")||b.attr("fieldmodel"),I&&(J=B.getModelFromModelName(I)),K=h.sobject?h.sobject:B.getSObjectNameFromModelName(I)};O&&N!==O&&O!==M&&(V(),T({fieldId:O,isChecked:!0})),l.on("click",function(){if(S)return!1;S=!0,m=z("<div>").addClass("nx-picker-wrapper").css("z-index","104");var a,b=z("<div>").appendTo(m).addClass("nx-pagebuilder-fieldpicker-header"),c=z("<div>").appendTo(b),d=z("<div>").appendTo(b).addClass("nx-pagebuilder-fieldpicker-headertext"),e=z("<div>").appendTo(m).addClass("nx-pagebuilder-fieldpicker-body"),f=h.showObjectPickerIfPolymorphic;V(),a=[{rel:K,ref:K,id:I}],f&&(a[0].isPolymorphic=!0),!h.ignorePathToContent&&J&&B.getModelPathToContent(J)&&a.length&&(a=B.createBreadcrumbForModel(J,{isPolymorphic:f})),L=n(a,{ignorePathToContent:h.ignorePathToContent,showObjectPickerIfPolymorphic:f,showUiOnlyFields:h.showUiOnlyFields!==!1,useMetadataOverrides:!0,element:e,headertext:d,filterboxwrapper:c,isSelected:U,onChange:function(a){T(a,m)},isMultiselect:P,filter:function(a,b,c){var d=!0;if(h.displayTypeFilter){d=!1;var e=h.displayTypeFilter;e instanceof Array?d=-1!=z.inArray(a.displaytype,e):"function"==typeof e?d=e(a,c):a.displaytype===e&&(d=!0)}return z.inArray(a.displaytype,["REFERENCE","OBJECT"])>-1||d},selectable:function(a,b){var c=!0;if(h.displayTypeFilter){c=!1;var d=h.displayTypeFilter;d instanceof Array?c=-1!=z.inArray(a.displaytype,d):"function"==typeof d?c=d(a,b):a.displaytype===d&&(c=!0)}return h.refFilter&&(c=!1,a.ref===h.refFilter&&(c=!0)),c}}),L.always(function(){S=!1,m.dialog({width:800,height:400,title:Q,resizable:!1,modal:!1,open:function(){var a=z(this).addClass("dialog-pickerwrapper"),b=Number(a.css("z-index"));z(".ui-widget-overlay.ui-front").css("z-index",b+1),z(".dialog-pickobject").css("z-index",b+2+"")}})})}),h.readonly||(o=z("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(l),x.append(o)),x.append(q)}}else if("template"===h.type||"code"===h.type){h.location||(h.location="node");var W=B.getStoredValue(b,h);if(!W&&h.defaultValue&&(W=h.defaultValue,B.updateStateProperty(b,h,W)),h.readonly&&"template"===h.type)x.append(B.propertyRenderers.readonly(W));else if("template"===h.type){var X=h.displayAs,Y=z("<div>").addClass("nx-pagebuilder-property-button-area"),Z=z("<"+("input"===X?"input":"textarea")+">").val(W).appendTo(Y);
h.placeholder&&Z.attr("placeholder",h.placeholder),k=z("<div>").addClass("nx-picker-icon sk-icon inline sk-bi-field-pick"),l=z("<button>").append(k).addClass("nx-picker-icon-btn").skootip("Select a Field to insert").on("click",function(){var a,c,d,e,f;if(h.modelprop?(a=b.attr(h.modelprop),"undefined"!=typeof a&&(c=a)):h.modelName&&(c=h.modelName),c||(c=b.closest("[model]").attr("model")),c&&(d=B.getModelFromModelName(c)),d){e=d.attr("sobject"),f=B.getFieldInfoFromCache(d,b.attr("id"));var g=[],i=!1;if(h.fieldContext&&a)g.push({rel:h.fieldContext.rel,ref:h.fieldContext.ref,id:c});else if(h.fieldContext){g.push({rel:e,ref:e,id:c});var j=h.fieldId,k=j.split(".");k.length&&z.each(k,function(a,b){a<k.length-1&&g.push({rel:b,ref:b,id:c})}),k.pop(),k.push(h.fieldContext.rel),i=k.join("."),g.push({rel:h.fieldContext.rel,ref:h.fieldContext.ref,id:c})}else g.push({rel:e,ref:e,id:c});var l,m=b.attr("id");if(f&&(l=f.displaytype),"CHILDREL"===b.attr("type")){var n=m,o=B.getServiceFromModel(d).getCachedEntityMetadata(e).getChildRelationship(n);o&&(e=o.childSObject,g=[{rel:e,ref:e,id:c}])}else if("ARRAY"===l){var q=m.split(".");z.each(q,function(a,b){var c=b;g.push({rel:c,ref:c})}),i=m}d&&B.getModelPathToContent(d)&&g.length&&(g=B.createBreadcrumbForModel(d)),p({breadcrumb:g,model:d,isMultiselect:!0,showAllFields:!1,addFieldsHandler:function(a){if(a&&z.isArray(a)){var b="aggregate"===d.attr("type"),c=a.reduce(function(a,c){return i&&(c=c.substring(i.length+1,c.length)),a+(b?"{{{"+c+"}}}":"{{"+c+"}}")},"");Z.insertAtCaret(c).focus(),Z.trigger("input")}}})}}),o=z("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(l);var $=z("<button>").addClass("nx-picker-icon-btn");z("<div>").appendTo($).skootip("Open Resource Editor").addClass("nx-picker-icon sk-icon inline sk-bi-code-edit");var _=function(a){W=a,Z.val(W)};$.on("click",function(){var a=[];J&&a.push({text:"Insert Field(s)",icon:"sk-bi-field-pick",action:function(){p({model:J,isMultiselect:!0,addFieldsHandler:function(a){if(a&&z.isArray(a)){var b="aggregate"===J.attr("type"),d=a.reduce(function(a,c){return a+(b?"{{{"+c+"}}}":"{{"+c+"}}")},"");c.insert(d)}}})}});var c,d={state:b,property:h,syntax:h.syntax,onChange:h.onChange,onClose:_,readonly:h.readonly,actionItems:a};B.showCodeEditor(d),c=d.codeEditor});var aa=z("<div>").addClass("nx-pagebuilder-property-button-wrapper").css({clear:"right"}).append($);x.append(o,aa,Y),C.delayInputCallback(Z,function(a){B.updateStateProperty(b,h,a),h.onChange&&h.onChange(a)})}else{q=z("<div>").addClass("nx-pagebuilder-property-button-area"),l=z("<button>").addClass("nx-picker-icon-btn"),k=z("<div>").appendTo(l).skootip("Open Resource Editor").addClass("nx-picker-icon sk-icon inline sk-bi-code-edit");var ba=z("<div>").addClass("nx-fieldtext").appendTo(q).addClass("nx-pagebuilder-property-button-area-inner"),ca=function(a){ba.text(a&&a.length>200?a.substring(0,200)+" ...":a)};ca(W),l.on("click",function(){B.showCodeEditor({state:b,property:h,syntax:h.syntax,onChange:h.onChange,onClose:ca,readonly:h.readonly})}),o=z("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(l),x.append(o,q)}}else"customaction"===h.type?h.readonly||(l=z("<button>").addClass("nx-picker-icon-btn"),k=z("<div>").appendTo(l).skootip(h.label).addClass("nx-picker-icon sk-icon inline "+h.icon),l.on("click",function(){h.customAction&&h.customAction()}),x.append(l)):x.append(B.propertyRenderers.standard(h,b));else;}),e}function m(a,b,c,d,e){var f=b.split(","),g=z("<div>").addClass("nx-basicfieldeditor nx-editor-contents").append(z("<br/>")).css({"text-align":"center","text-valign":"middle","float":"center"}),h=z("<select>");z.each(f,function(a,b){h["User"===b&&C.endsWith(c,"Owner")?"prepend":"append"](z("<option>").attr("value",b).text(b))}),h.appendTo(g);var i=function(f){var g={ref:h.val(),isPolymorphic:!0};c===b&&-1!==b.indexOf(",")?g.rel=h.val():g.rel=c,a.push(g),e.resolve(),n(a,d),f.dialog("destroy")};g.dialog({draggable:!1,closeOnEscape:!1,resizable:!1,modal:!0,title:"Choose a related Object to pick Fields from",width:"400px",close:function(){i(z(this)),z(".ui-widget-overlay.ui-front").css("z-index",100)},hide:"slide",show:"slide",buttons:[{text:"Go",click:function(){i(z(this))}}],open:function(a){z(a.target).parent().addClass("dialog-pickobject");var b=z(this).addClass("dialog-pickobject"),c=Number(z(".dialog-pickobject").css("z-index"));z(".ui-widget-overlay.ui-front").css("z-index",c+1),b.css("z-index",c+2+"")}})}function n(b,c){c=c||{};var d,e,f=z.Deferred(),g=c.element,h=c.headertext,i=c.filterboxwrapper,j=c.isSelected,k=c.onChange,l=c.isMultiselect,o=c.selectedOnly,p=c.childRelationshipsOnly,q=c.showDragHandles&&b.length&&b[0].id||!1,r=c.showObjectPickerIfPolymorphic===!0,s=c.allowModelFieldAdds,t=c.onModelAddChange,u="readonly"===c.mode,v=c.showUiOnlyFields,w=c.useAliasNamesIfAggregate,x=c.allowRepeatedSelectionsOfSameField,y=function(a){var b=z('<div style="padding: 10px; font-size: 12pt;">').text(a);d&&d.length?d.append(b):g.append(b)};return h.empty(),g.empty(),i.empty(),e=z('<table cellpadding="0" cellspacing="0">').addClass("nx-skootable-data"),d=z("<tbody>").appendTo(e),g.append(e),b&&b.length?(z.when(B.processBreadCrumbInfo(b,{showObjectPickerIfPolymorphic:r})).fail(function(a){y(a),f.reject(a)}).done(function(e){var g=e.model,A=e.adapter,D=w&&e.isAggregate,E=B.getModelPathToContent(g),F=function(){var a=z(this).closest("tr"),b=a.data("field"),c=e.prefix+b,d=c,f=x?!0:this.checked,g={fieldName:a.data("fieldname"),targetObjects:e.targetObjects,isChildRelationship:p,isChecked:f};E&&C.startsWith(d,E)&&(d=d.substring(E.length+1)),g.fieldId=d,g.fullFieldId=c,D&&(g.fieldFunction=a.data("fieldfunction")),q&&a.find(".nx-draghandle").toggle(f),o&&a.remove(),k&&k(g)};if(h.append(e.elements),e.endsobject&&-1!==e.endsobject.indexOf(",")&&r)return b.splice(b.length-1,1),m(b,e.endsobject,e.endrel,c,f),void f.resolve();var G=z('<input type="text" placeholder="Search...">').addClass("nx-pagebuilder-toolbarpanel-headersearch");i.append(G),G.focus();var H=A.prop("composer.canFieldsBeSelected"),I=H?H({mode:v?"components":"model",model:g,breadcrumb:e}):!0;if(I!==!0)return y(I),void f.resolve(I);u||(x?d.on("click",".fieldpicker.sk-icon-add",F):d.on("change",'input[type="checkbox"],input[type="radio"]',F)),d.on("click",".sk-bi-follow-ref",function(){var a=z(this).closest("tr"),d=a.data("rel"),e=a.data("ref"),f=a.data("displaytype"),g=a.data("isPolymorphic");if(g&&-1!==e.indexOf(","))m(b,e,d,c);else{var h={rel:d,ref:e,isPolymorphic:!1,displayType:f};"Name"===e&&(h.possibleTargetObjects=a.data("possibleTargetObjects")),b.push(h),n(b,c)}}),h.off().on("click",".nx-pagebuilder-breadcrumb-link",function(){n(b.slice(0,z(this).index()+1),c)}),C.delayInputCallback(G,function(a){a?(d.children().hide(),d.children().filter(function(){var b=z(this).attr("data-field"),c=z(this).attr("data-label"),d=b?-1!==b.toLowerCase().indexOf(a.toLowerCase()):!1,e=c?-1!==c.toLowerCase().indexOf(a.toLowerCase()):!1;return d||e}).show()):d.children().show()});var J,K=a.service.getService(g.attr("service")||"salesforce"),L=K.buildEntityMetadataRequest({model:g,targetEntity:e.endsobject,path:e.prefix,ignorePathToContent:!0}),M=K.getEntityMetadataLoadingMessageFromBreadcrumb(e);J=K.getEntityMetadata({entities:L,ignoreMetadataOverrides:!0}),y(M),z.when(J).fail(function(a){y(a),f.reject(a)}).done(function(h){d.empty();var i,k,m=b.length?b[b.length-1]:!1,n=m&&"Name"===m.ref,r=n?m.possibleTargetObjects:!1;p?i=z.map(h.getChildRelationshipsList(),function(a){return a}):D?(i=[],g.children("fields, groupby").children().each(function(){var a=z(this),b=a.attr("id"),c=a.attr("name"),d=h.getField(b)||h.getField(c);i.push({id:b,name:c,"function":a.attr("function"),label:d?d.label:null,displaytype:d?d.displaytype:null,isGrouping:a.parent().is("groupby")})})):i=z.map(h.getSortedFieldsList(),function(a){return a}),k=function(a){var b,d,f,g,h,i,k,v,w,y,A,F,G,H,I,J,K,L,M,N;if(p?(b=a.relationshipName,d=a.relationshipName,a.displaytype=""):(b=a.id,d=a.label),N=e.prefix+b,E&&(N=N.substring(E.length+1)),c.filter&&!c.filter(a,m,N))return null;if(n&&!B.isValidFieldForPossibleTargetObjects(a,r))return null;if(v=j&&j(N),o&&!v)return null;if(w=a,f=w.displaytype,g="REFERENCE"===f,h="OBJECT"===f,i="ARRAY"===f,(g||h||i)&&(k=w.referenceTo),y=z("<tr>").attr({"data-field":b}),e.isAggregate&&y.attr({"data-fieldname":a.name,"data-fieldfunction":a["function"]}),y.attr({"data-label":d,"data-displaytype":f}),A=z('<td style="width: 5px;">'),q&&!h&&(F=z("<div>").addClass("nx-draghandle nx-pagebuilder-field").attr("data-model",e.modelId).data("generateOptions",{fieldId:N,doNotSelect:!0,isChildRelationship:p}),F.append('<div class="nx-draghandle-row"><div class="nx-draghandle-item"></div><div class="nx-draghandle-item"></div></div><div class="nx-draghandle-row"><div class="nx-draghandle-item"></div><div class="nx-draghandle-item"></div></div><div class="nx-draghandle-row"><div class="nx-draghandle-item"></div><div class="nx-draghandle-item"></div></div>'),A.append(F),F.draggable({appendTo:".nx-page",helper:function(){var a=z("<div>").append(z(this).clone().css("float","left"),z("<div>").text(w.label).css("margin","6px 6px 6px 22px"));return a.css({"z-index":1e3,border:"1px solid #CCC","background-color":"#EEE",padding:"4px"}),a},revert:"invalid",delay:200})),G=z('<td style="width: 24px;">'),s&&!h&&t&&!o&&e.modelId&&B.isFieldInModel(e.modelId,N)===!1&&!u){var O={addIcon:"sk-bi-model-add",deleteIcon:"sk-bi-model-delete",addTitle:"Add field to model",deleteTitle:"Remove field from model"},P=function(a){t({fieldId:N,isChecked:!0}),H.show(),a.removeClass(O.addIcon).addClass(O.deleteIcon).attr("title",O.deleteTitle).on("click",function(){Q(a)})},Q=function(a){t({fieldId:N,isChecked:!1}),H.hide(),a.removeClass(O.deleteIcon).addClass(O.addIcon).attr("title",O.addTitle).on("click",function(){P(a)})},R=z("<div>").addClass("sk-icon "+O.addIcon).css({margin:"7px 4px 6px 4px",cursor:"pointer"}).attr("title",O.addTitle).on("click",function(){var a=z(this);a.hasClass(O.addIcon)?P(a):a.hasClass(O.deleteIcon)&&Q(a)});G.append(R)}if(I=z('<td style="width: 24px;">'),!c.selectable||c.selectable&&c.selectable(a,N)){x?H=z('<div class="fieldpicker sk-icon sk-icon-add">').css("cursor","pointer"):(H=z(l?'<input type="checkbox">':'<input type="radio" name="fieldpicker">'),H.prop("disabled",u),v&&H.prop("checked",!0)),H.css("margin","9px 6px 8px 6px");var S="checkbox"+b;H.prop("id",S),q&&!v&&F&&F.hide(),I.append(H),I.append('<label for="'+S+'"><label>'),s&&e.modelId&&B.isFieldInModel(e.modelId,N)===!1&&H.hide()}if(D){var T,U=a["function"];T=a.isGrouping?U?"DAY_ONLY"===U?"DATE":"INTEGER":g?"ID":f:C.contains(U,"COUNT")?"INTEGER":f,K=z('<td style="padding: 8px;">'+(U?U+"("+b+")":b)+"</td>"),L=z('<td style="padding: 8px;">'+a.name+"</td>"),M=z('<td style="padding: 8px;">').text(T),y.append(I,K,L,M)}else J=z('<td style="width: 30px;">'),(g||h||i)&&k&&k.length&&"null"!==w.rel&&(y.attr({"data-rel":w.rel,"data-ref":w.ref,"data-displaytype":f}),"Name"===w.ref&&y.data("possibleTargetObjects",w.possibleTargetObjects),y.data("isPolymorphic",w.isPolymorphic),J.append(z('<div class="sk-icon sk-bi-follow-ref">').css({margin:"6px",cursor:"pointer"}))),K=z('<td style="padding: 8px;">'+d+"</td>"),L=z('<td style="padding: 8px;">'+(p?a.childSObject+" > "+a.field:b)+"</td>"),M=z('<td style="padding: 8px;">').text(f+(g&&k&&k.length?" ("+(k.length>2?k.length+" possible objects":w.ref)+")":"")),q&&y.append(A),s&&t&&!o&&y.append(G),y.append(I,J,K,L,M);return y},!p&&v&&g.children("fields").children('[uionly="true"]').each(function(){i.push(new a.model.Field({xml:z(this),adapter:A}))}),d.append(z.map(i,function(a){return k(a)})),f.resolve()})}),f.promise()):(f.resolve(),f.promise())}function o(a){var b=a.component,c=a.showTemplate!==!1,d=[];return a=z.extend({allowModelFieldAdds:!0,isMultiselect:!0},a||{}),d.push({text:"Model Field(s)",icon:"sk-bi-model",action:function(){var c=b&&b.state,d="function"==typeof a.modelName?a.modelName():a.modelName||c.attr("model"),e=B.getModelFromModelName(d);p(z.extend(a,{model:e}))}}),c&&d.push({text:"Template",icon:"sk-bi-template",action:function(){var c=a.fieldBuilder.defaultStateGenerator({componentId:"template"});b.state.children("fields").first().append(c),b.save().refresh()}}),d}function p(b){var c=z("<div>").addClass("nx-picker-wrapper"),d=z("<div>").addClass("nx-pagebuilder-fieldpicker-header").appendTo(c),e=z("<div>").appendTo(d),f=z("<div>").addClass("nx-pagebuilder-buttonwrapper").css({"float":"right",margin:"0px 6px 4px"}).appendTo(d),g=z("<div>").text("All Fields").addClass("nx-pagebuilder-toolbarpanel-propgroup").appendTo(f),h=z("<div>").text("Selected Fields").addClass("nx-pagebuilder-toolbarpanel-propgroup on").appendTo(f),i=z("<div>").addClass("nx-pagebuilder-fieldpicker-headertext").appendTo(d),j=z("<div>").addClass("nx-pagebuilder-fieldpicker-body").appendTo(c),k=[],l=[],m=b.model,o=b.breadcrumb||B.createBreadcrumbForModel(m),p="aggregate"===m.attr("type"),q=!p&&b.showAllFields!==!1,r=b.addFieldsHandler,s=b.component,t=b.state||s&&s.state,u=function(a,c){p&&(c="selectedOnly"),n(o,{element:a,headertext:i,filterboxwrapper:e,isSelected:b.isSelected||function(a){return z.inArray(a,k)>-1},showUiOnlyFields:!0,useMetadataOverrides:!0,onChange:b.onChange||function(a){var b=p?a.fieldName:a.fieldId,c=a.isChecked;c===!0?k.push(b):c===!1&&(k=k.filter(function(a){return a!==b}))},isMultiselect:b.isMultiselect,filter:b.filter||function(a,b,d){var e=!0;if((p||"selectedOnly"===c)&&-1===z.inArray(a.displaytype,["REFERENCE","OBJECT"])){var f=m.children("fields,groupby").find('field[id="'+C.escapeSelector(d)+'"]'+(p?',field[name="'+C.escapeSelector(d)+'"]':""));0===f.length&&(e=!1)}return e},selectable:b.selectable||function(a,b){var d=!0,e=p?a.name:b;if(p||"selectedOnly"===c){var f=p?"name":"id",g=m.children("fields,groupby").find("field["+f+'="'+C.escapeSelector(e)+'"]');0===g.length&&(d=!1)}return d},allowModelFieldAdds:!p&&"selectedOnly"!==c&&b.allowModelFieldAdds===!0,onModelAddChange:b.onModelAddChange||function(a){var b=a.fieldId,c=a.isChecked;c===!0?l.push(b):c===!1&&(l=l.filter(function(a){return a!==b}))},useAliasNamesIfAggregate:!0})};q?(g.click(function(){g.hasClass("on")||(g.addClass("on"),h.removeClass("on"),j.empty(),u(j,"allFields"))}),h.click(function(){h.hasClass("on")||(h.addClass("on"),g.removeClass("on"),j.empty(),u(j,"selectedOnly"))})):(g.hide(),h.hide()),u(j,"selectedOnly"),c.dialog({autoOpen:!0,draggable:!0,resizable:!1,width:800,height:468,title:"Add Field(s)",modal:!0,buttons:[{text:"Apply",id:"apply",icons:{primary:"sk-icon-save sk-icon"},click:function(){!p&&l.length>0&&(z.each(l,function(){B.addFieldToModel({fieldId:this,model:m})}),a.events.publish("skuidBuilderSave")),k.length>0&&("function"==typeof r?r(k):(z.each(k,function(){var a=p?"name":"id",c=m.children("fields,groupby").find("field["+a+'="'+this+'"]'),d={fieldId:c.attr("id")};p&&(d.fieldName=c.attr("name"));var e=b.fieldBuilder.defaultStateGenerator(d);B.isFieldInModel(m,this,{searchByName:p})===!0&&t.children("fields").first().append(e)}),s.save().refresh())),c.dialog("close")}},{text:"Cancel",id:"cancel",icons:{primary:"sk-icon-cancel sk-icon"},click:function(){c.dialog("close")}}]})}function q(a,b){var c={id:"type",type:"picklist",label:"Type",defaultValue:"skuid",picklistEntries:[{label:"Skuid Page",value:"skuid"},{label:"Page Assignment",value:"assignment"}],onChange:function(){b.removeAttr("pagename objecttype actiontype modulename"),a.refresh().rebuildProps()}};"visualforce"===b.attr("type")&&c.picklistEntries.push({label:"Visualforce Page",value:"visualforce"});var d={id:"pagename",type:"autocomplete",sobject:"ApexPage",fieldsToReturn:["Name","NamespacePrefix"],fieldsToSearch:["Name","NamespacePrefix"],displayTemplate:"{{NamespacePrefix}}{{^NamespacePrefix}}c{{/NamespacePrefix}}__{{Name}}",valueTemplates:{pagename:"{{NamespacePrefix}}{{^NamespacePrefix}}c{{/NamespacePrefix}}__{{Name}}"},order:"Name",label:"Visualforce Page",helptext:"The Visualforce Page whose content you would like to load in to this part of the page, in the format 'namespace__PageName', where 'namespace' is the namespace in which your VF Page is included, and 'PageName' is the API Name of the desired Visualforce Page.",required:!0,onChange:function(){a.refresh()}},e={id:"pagename",type:"autocomplete",sobject:"skuid__Page__c",fieldsToReturn:["Name","skuid__Module__c"],fieldsToSearch:["Name","skuid__Module__c"],displayTemplate:"{{Name}}{{#skuid__Module__c}} ({{skuid__Module__c}}){{/skuid__Module__c}}",valueTemplates:{pagename:"{{Name}}",module:"{{skuid__Module__c}}"},order:"Name",label:"Skuid Page",helptext:"The Skuid Page whose content you would like to load in to this part of the page.",required:!0,onChange:function(){a.refresh()}},f={id:"querystring",type:"text",label:"Query String",helptext:"The content of the query string (parameters that come after the main body of a URL) to send along with the Visualforce Page include request, e.g. 'showheader=false&id={{$Param.id}}'",required:!1,onChange:function(){a.refresh()}},g={id:"objecttype",type:"sobject",label:"Object Type",onChange:function(){a.refresh()},helptext:"(Autocomplete) API Name of an SObject that you have defined Page Assignments for."},h={id:"actiontype",type:"picklist",picklistEntries:[{label:"Tab",value:"Tab"},{label:"List",value:"List"},{label:"View",value:"View"},{label:"Edit",value:"Edit"},{label:"New",value:"New"},{label:"Clone",value:"Clone"}],label:"Action Type",helptext:"The Action Type on the selected Object that you have defined Page Assignments for.",onChange:function(){a.refresh()}},i=B.coreProps.uniqueIdProp({component:this,helptext:"Optional parameter that allows this Page Include Component to be referenced by other Components, such as Queues, or manipulated via JavaScript."}),j=B.coreProps.cssClassProp(),k={id:"lazyload",type:"boolean",label:"Lazy Load",helptext:"If true, this Page Include will not load immediately. This is useful when you have a Queue that will load content into this Page Include later, or when you have a Page Include in a Tab, in which case the Tab, when activated, can be configured to load the Page Include's contents. You can also load Page Includes via JavaScript, e.g. with skuid.component.getById('MyPageInclude').load();"},l={skuid:[c,e,f,i,j,k],assignment:[c,g,h,f,i,j,k],visualforce:[c,d,f,k]},m=b.attr("type"),n=l[m||"skuid"].slice(0);return n}function r(a){a||(a={});var c,d,e=a.parentComponent,f=a.parentState||e.state,g=a.getContextModelName,h=e.drawercomponent;h||(c=A.makePopupBuilder({title:"Drawer Properties",width:"90%",getContextModelName:g,customProps:[{name:"Basic",props:[{id:"closehandle",label:"Show Close Handle",type:"boolean"}]},B.getActionsCategory({customNodeId:"beforeload",label:"Before Load Actions",useModelName:g(),linkedComponent:e})],linkedComponent:e}),d=f.children("drawer"),0===d.length&&(d=c.defaultStateGenerator({id:"drawer",title:"Drawer Area"}),d.attr("closehandle","true"),f.append(d)),h=e.drawercomponent=b(d,c,!0)),h.select()}function s(a){return a||(a={}),[{type:"customaction",label:"Configure Drawer",icon:"sk-bi-popup",mode:"edit",customAction:function(){r(a)}},{id:"openicon",type:"icon",label:"Drawer Opened Icon",helpText:"Optional icon to show when the drawer is currently open."}]}function t(a){return{value:"drawer",label:"Open/Close a Drawer",propsFunction:function(b){var c={};return z.extend(c,a),b&&(c.parentComponent=b),s(c)}}}function u(a){a||(a={});var b=a.width,c=a.linkedComponent,d=A.pagebuilderui;return new B.Builder({id:"popup",name:"Popup",givesContext:!0,givesMultipleContextRows:c&&c.givesMultipleContextRows===!0,addChildComponent:function(a,b){return a.acceptor.canAcceptComponent(b)?(a.acceptor.addComponent(b),!0):!1},componentRenderer:function(e){e.element.attr("title",e.state.attr("title")).css({padding:"0px",margin:"0px"}),e.headerWrapper.css("padding","0px"),e.body.css("border","0px solid white"),a.getContextModelName&&(e.getContextModelName=a.getContextModelName),this.givesMultipleContextRows===!0&&(e.givesMultipleContextRows=!0),e.element.dialog({autoOpen:!1,position:{my:"top",at:"top+500",of:"body"},draggable:!0,resizable:!0,open:function(){z("body").children(".ui-widget-overlay"),d.layoutcontainer.append(z("<div>").addClass("ui-widget-overlay")),d.cselector.element.find(".nx-pagebuilder-componenttag").each(function(){var a=z(this);a.is(".nx-js-createable")||z(this).hide()})},close:function(){d.layoutcontainer.find(".ui-droppable").droppable("enable"),d.layoutcontainer.children(".ui-widget-overlay").remove(),d.cselector.element.find(".nx-pagebuilder-componenttag").show(),c&&c.select()},width:b?b:e.state.attr("width"),height:350}),e.dialogwrapper=e.element.parent(),e.dialogwrapper.css({"z-index":"50","box-shadow":"4px 4px 10px rgba(0,0,0,.25)"}).addClass("nx-pagebuilder-workspace"),e.dialogwrapper.on("click",".nx-pagebuilder-component",function(a){var b=z(this).data("object");b&&b.select(),a.stopPropagation()}),e.dialogwrapper.on("click",".ui-dialog-title",function(){e.select()});var f=e.acceptor=new y.ComponentAcceptor({componentsXML:e.state.children("components"),mode:e.mode});e.body.append(f.element)},propertiesRenderer:function(b,c){b.setTitle(a.title||"Popup Properties"),z("html, body").animate({scrollTop:z(".nx-page").first().offset().top+56},100,"swing",function(){c.element.dialog("open"),d.layoutcontainer.find(".ui-droppable").droppable("disable")});var e,f=a.customProps;a.makePropsEditor?b.body.append(a.makePropsEditor(b,c)):e=f?z.isFunction(f)?f(c):f:B.getPopupProperties(c,{useAfterCloseActions:a.useAfterCloseActions}),e&&b.applyPropsWithCategories(e,c.state),c.element.removeClass("nx-pagebuilder-selected")},defaultStateGenerator:function(a){a||(a={});var b=a.id||"popup",c=a.title||"New Popup",d=a.width||"90%",e=D("<components/>");return a.childComponents&&e.append(a.childComponents),D("<"+b+' title="'+c+'" width="'+d+'"/>').append(e)}})}function v(a){a||(a={});var c,d,e,f=a.parentComponent,g=a.parentState||f.state,h=a.getContextModelName,i=a.key||"popup";e=f[i],e||(d=g.children(i),c=y.makePopupBuilder({getContextModelName:h,linkedComponent:f,useAfterCloseActions:a.useAfterCloseActions}),0===d.length&&(d=c.defaultStateGenerator(),g.append(d)),e=f[i]=b(d,c,!0)),e.select()}function w(a){var b=z.extend({},B.getBuilder("button"));return b.options=a,b}var x,y,z=a.$,A=a.builder,B=A.core,C=a.utils,D=C.makeXMLDoc,E=a.$L;y=A.desktop={},x=y,B.addValidActionOptions([{value:"-",label:"Visual navigation",disabled:!0},{value:"closeAllPopups",label:"Close all Popups"},{value:"closeTopmostPopup",label:"Close topmost Popup"},{value:"showPopup",label:"Show Popup"},{value:"blockUI",label:"Show message and block UI"},{value:"unblockUI",label:"Unblock the UI"},{value:"redirect",label:"Redirect to URL"},{value:"-",label:"",disabled:!0}]),B.addValidActionOptions(B.getCoreActionOptions()),e.prototype.getPersonalizationService=function(){var b="_personalizationService",c=this[b];return c||(c=this[b]=a.personalization.createComponentService({})),c},e.prototype.save=function(){return a.events.publish("skuidBuilderSave"),this},e.prototype.isSelected=function(){return this.element.is(".nx-pagebuilder-selected")},e.prototype.select=function(a){a=a||{},y.unselectCurrentComponent(this.element),this.element.is(".nx-pagebuilder-component")&&(G=this.element);var b=this.builder.onSelect&&this.builder.onSelect(this);return b&&b.cancelSelect?this:(a.resetPropCategory!==!1&&this.builder.resetPropCategory!==!1&&(A.pagebuilderui.cproperties.category=!1),this.isSelected()===!1&&(this.element.addClass("nx-pagebuilder-selected"),this.state.parents("pageregioncontents").length&&B.isInMasterPage(this.state)===!1&&delete this.mode,"readonly"===this.mode&&this.actionbar.hide(),this.rebuildProps()),this)},e.prototype.rebuildProps=function(b){return a.events.publish("skuid.pageComposer.propertyPanel.beforeRender"),b=this.builder.customPropObj||A.pagebuilderui.cproperties,b.clear?b.clear():b.empty(),this.builder.renderProperties(b,this),a.events.publish("skuid.pageComposer.propertyPanel.afterRender"),this},e.prototype.remove=function(a,b){var c=this,d=c.element,e=d.next();c.actionbar.find(".nx-pagebuilder-component-actionitem").tooltip().hide();var f=A.pagebuilderui.cproperties;return a||(f.clear?f.clear():f.empty()),e.is(".nx-dropzone")&&e.remove(),d.remove(),c.state.remove(),b!==!0&&c.save(),c.builder&&c.builder.afterDelete&&c.builder.afterDelete(c),B.unregisterComponent(c),c},e.prototype.refresh=function(){var a=this,b=a.element;a.body.empty(),b.data("object",a),a.actionbar.detach().empty(),a.header.detach().empty(),a.headerWrapper.empty().append(a.actionbar,a.header),a.isGlobalComponent&&(b.addClass("nx-pagebuilder-component-global"),a.addActionItem({text:E("remove"),icon:"sk-icon-delete",action:function(){a.remove()},id:"removeButton"}));var c=b.is(".nx-pagebuilder-component")?!1:a.builder.dragHandle||"> .nx-pagebuilder-component-header";return a.makeDraggable&&"readonly"!==a.mode&&(b.find(a.builder.dragHandle).css("cursor","move"),b.draggable({appendTo:".nx-page",handle:c,cancel:".nx-pagebuilder-component-actionitem",delay:200,helper:function(){return z("<div>").addClass("nx-pagebuilder-componenttag").css({"z-index":1e3,border:"1px solid #CCC","background-color":"#EEE"}).append(z("<div>").css("float","left").addClass("sk-icon "+a.builder.icon),z("<div>").css({"margin-left":"24px","margin-top":"1px"}).text(a.builder.name))},revert:"invalid",start:function(){z(this).hide().next().hide()},stop:function(){z(this).show().next().show()}})),a.builder.renderComponent(a,{isRefresh:!0}),a.builder&&a.builder.afterAttach&&a.builder.afterAttach(a),a},e.prototype.setTitle=function(a){return!a&&this.builder&&(a=this.builder.name),this.builder&&this.builder.icon&&this.headerWrapper.prepend(z("<div>").addClass(this.builder.icon+" sk-icon sk-builder-icon")),this.header.html(a),this},e.prototype.setHeaderText=function(a){return this.setTitle(a),this},e.prototype.addChildComponent=function(a){return this.builder.addChildComponent?!!this.builder.addChildComponent(this,a):!1},e.prototype.addActionGroup=function(a,b,c){var d;"actionsObj"in arguments[0]&&(d=arguments[0],a=d.actionsObj,b=d.text,c=d.icon);var e=z("<div>").addClass("nx-pagebuilder-component-actionitem");c?z("<div>").addClass("nx-pagebuilder-component-actionicon sk-builder-icon sk-icon "+c).appendTo(e):e.css("padding-left","8px"),e.append(z("<div>").addClass("nx-pagebuilder-component-actiontext").text(b),z("<div>").addClass("nx-pagebuilder-component-actionarrow").append(z("<div>")));var f=z("<div>").addClass("nx-pagebuilder-component-actionoptions").hide();z.each(a,function(){var a=this.action,b=z("<div>").addClass("nx-pagebuilder-component-subactionitem").append(z("<div>").addClass("nx-pagebuilder-component-actionicon sk-builder-icon sk-icon "+this.icon),z("<div>").addClass("nx-pagebuilder-component-actiontext").text(this.text));b.appendTo(f).click(function(b){a&&a(),b.stopPropagation(),f.slideUp("fast")})}),e.append(f).click(function(){f.slideToggle("fast")});var g;return e.mouseleave(function(){g=setTimeout(function(){f.slideUp("fast")},1e3)}),e.mouseenter(function(){clearTimeout(g)}),this.actionbar.append(e),d&&(d.element=e),this},e.prototype.addActionItem=function(a,b,c,d,e){var f;1===arguments.length&&"string"!=typeof a&&(f=arguments[0],a=f.text,b=f.icon,c=f.action,d=f.tooltip,e=f.id);var g=z("<div>").addClass("nx-pagebuilder-component-actionitem").append(z("<div>").addClass("nx-pagebuilder-component-actionicon sk-builder-icon sk-icon "+b));return a&&z("<div>").addClass("nx-pagebuilder-component-actiontext").text(a).appendTo(g),g.append(z("<div>").addClass("nx-pagebuilder-component-actionspacer")),d&&g.skootip(d),g.click(function(a){c&&c(),a.stopPropagation()}),this.actionbar.append(g),f&&(f.element=g),e&&(this.actionItems[e]=g),this},e.prototype.addDefaultEditorConditions=function(){var a=this,b=a.builderId,c=a.state;if(-1!==z.inArray(b,["basicfieldeditor","file","pagetitle","skootable","repeat","social","template"])&&!c.children("conditions").length){var d=c.closest('action[type="popup"]'),e=c.closest("eventsource");if(d.length&&d.parent().is("rowactions")||e.length&&-1!==z.inArray(e.attr("eventclickhandler"),["custompopup","snippetthencustompopup"])){var f=B.getDefaultConditions({state:c}),g=f.children("condition").first(),h=e.length?e.first():d.closest("skootable");a.modifyAutoCreatedEditorCondition(g,h)}}},e.prototype.modifyAutoCreatedEditorCondition=function(b,c){var d=this,e=d.state;if(c){var f=c.attr("model"),g=e.attr("model");if(f&&g){var h=B.getModelFromModelName(f),i=B.getModelFromModelName(g);if(h&&i){var j=h.attr("sobject"),k=i.attr("sobject");if(j!==k)return void a.service.getService(h.attr("service")||"salesforce").getEntityMetadata({entities:k}).then(function(a){a&&a[0]&&(a=a[0]);var c="Id";i.children("fields").children().each(function(){var b=z(this),d=b.attr("id"),e=a.getField(d);return e&&e.ref&&-1!==e.ref.indexOf(j)?(c=d,!1):void 0}),b.attr("field")!==c&&b.attr("field",c)})}}}"Id"!==b.attr("field")&&b.attr("field","Id")},e.prototype.updateAutoCreatedEditorCondition=function(){var a,b,c,d=this,e=d.state,f=e.find('conditions > condition[autocreated="true"]');f.length&&(a=e.closest('action[type="popup"]'),b=e.closest("eventsource"),(a.length&&a.parent().is("rowactions")||b.length&&-1!==z.inArray(b.attr("eventclickhandler"),["custompopup","snippetthencustompopup"]))&&(c=b.length?b.first():a.closest("skootable"),d.modifyAutoCreatedEditorCondition(f,c)))};var F=".nx-pagebuilder-componenttag, .nx-pagebuilder-component-global";f.prototype.canAcceptComponent=function(a){return a.element.is(this.accept)},f.prototype.refresh=function(){var a=this;a.element.empty().append(a.makeDropZone()),a.componentsXML.children().each(function(){var b=z(this),d=!a.customBuilder,e=c(b,a.customBuilder,!0,d);a.addComponent(e,{modifyState:!1,isNew:!1})})},f.prototype.addComponent=function(b,c){c||(c={});var d=this,e=c.modifyState!==!1,f=c.isNew!==!1,g=c.after;g?(g.is(".nx-dropzone")||(g=g.next(".nx-dropzone")),g.after(b.element,d.makeDropZone())):d.element.append(b.element,d.makeDropZone()),e&&(g?C.insertAtIndex(d.componentsXML,b.state,g.index()/2):d.componentsXML.append(b.state)),b.builder&&b.builder.afterAttach&&b.builder.afterAttach(b),e&&(f&&b.addDefaultEditorConditions&&b.addDefaultEditorConditions(),b.builder&&b.builder.isTransparent&&a.events.publish("builder.colorcheck"),b.save())},f.prototype.makeDropZone=function(){var a=z("<div>").addClass("nx-dropzone"),b=this;return"readonly"!==b.mode&&a.droppable({accept:b.accept,tolerance:"touch",drop:function(a,c){var d=z(this);if(B.dropStack=z(),d.is(".nx-dropzone-active")){var e,f=b.customBuilder||c.draggable.data("builder"),g=c.draggable.data("generateOptions"),h=!b.customBuilder,i=!1;if(c.draggable.is(".nx-pagebuilder-component"))e=c.draggable.data("object"),e.state.detach(),e.element.next().remove(),e.element.detach();else{var j=b.customBuilder?b.customBuilder:c.draggable.data("builder"),k=j.personalizationSettings&&"undefined"!=typeof j.personalizationSettings.setUniqueId?j.personalizationSettings.setUniqueId:!0;e=B.componentFactory(j.getDefaultState(g,{setUniqueId:k}),f,!0,h),i=!0}b.addComponent(e,{after:d,modifyState:!0,isNew:i}),g&&g.doNotSelect||e.select(),d.removeClass("nx-dropzone-active")}},over:function(){B.dropStack=B.dropStack.add(z(this)),B.dropStack.removeClass("nx-dropzone-active"),B.dropStack.first().addClass("nx-dropzone-active")},out:function(){B.dropStack.removeClass("nx-dropzone-active"),B.dropStack=B.dropStack.not(z(this)),B.dropStack.first().addClass("nx-dropzone-active")}}),a},h.prototype.clear=function(a){return this.setTitle(a?"":"Nothing Selected"),this.headertext.detach(),this.propGroups.empty().detach(),this.header.empty().append(this.propGroups,this.headertext),this.body.empty(),this},h.prototype.setTitle=function(a){return this.headertext.empty(),a&&this.headertext.text(a),this},h.prototype.setHeaderText=function(a){return this.setTitle(a);
},h.prototype.createBuilderFromTreeObj=function(a,b,c){c=c||{};var d=this,e=a.linkedComponent,f=c.wrapper,g=c.proparea;return f&&g?(c.mode&&(a.mode=c.mode),new B.Builder({id:a.id,name:a.id,givesMultipleContextRows:e&&e.givesMultipleContextRows===!0,componentRenderer:function(c,h){h=h||{};var i,j,k,l=a.labelFunction&&a.labelFunction(c.state)||a.label,m=a.summaryFunction&&a.summaryFunction(c.state)||a.summary,n=l&&m?!0:!1;if(e&&a.refreshLinkedComponent&&h.isRefresh&&e.refresh(),this.givesMultipleContextRows===!0&&(c.givesMultipleContextRows=!0),a.icon&&(k="function"==typeof a.icon?a.icon(c.state):a.icon),n===!0){c.body.css({padding:"0px"}),i=z("<div>").addClass("nx-pagebuilder-propertytag");var o=z("<div>").addClass("nx-pagebuilder-propertytaglabel").text(l);k&&o.append(z("<div>").css("float","left").addClass("sk-icon "+k)),j=z("<div>").addClass("nx-pagebuilder-propertytagbody").html(m),i.append(o,j)}else c.body.addClass("nx-pagebuilder-labelwrapper").css("padding","0px"),c.actionbar.addClass("nx-pagebuilder-actionbar-tag"),i=z("<div>").addClass("nx-pagebuilder-labelstag"),j=z("<div>").css("margin-left","24px"),l?j.text(l):m&&j.html(m),i.append(z("<div>").css("float","left").addClass("sk-icon "+(k||"sk-bi-propertyitem")),j);var p=a.labelEventHandlers;p&&z.each(p,function(a,b){c.body.on(a,function(){b(c)})}),(a.isUpdated||a.isNew)&&j.append(z("<div>").css({position:"static",display:"inline-block","vertical-align":"top","margin-left":"5px","margin-top":"1px"}).addClass("nx-pagebuilder-"+(a.isUpdated?"new":"updated")+"prop").text(a.isUpdated?"Updated":"New")),a.indent&&i.css("margin-left",24*(parseInt(a.indent,10)+1)+"px"),(a.deleteableFunction?a.deleteableFunction(c.state):a.deleteable!==!1)&&c.addActionItem("",a.deleteicon||"sk-bi-propertyitem-delete",function(){a.beforeDelete&&a.beforeDelete(c),c.remove(!0),a.linkedComponent&&(a.linkedComponent===B.getComponentFromState(c.state)?a.linkedComponent.remove(!0):a.refreshLinkedComponent&&a.linkedComponent.refresh());var b=f.closest(".nx-childwrapper").siblings(".nx-noitemwrapper");b.length&&!f.children().length&&b.show(),g.empty(),a.afterDelete&&a.afterDelete(c)},a.deletetooltip),c.body.append(i),c.element.children(".nx-childwrapper").remove();var q,r=z('<div class="nx-childwrapper">'),s=!1,t=a.childrenFunction&&a.childrenFunction(c)||a.children;if(t&&z.each(t,function(){var e=this;e.invisibleParent?b.children(e.invisibleParent).each(function(){z(this).children(e.id).each(function(){d.addTreeComponent(e,z(this),{wrapper:r,proparea:g}),s=!0})}):b.children(e.id).each(function(){d.addTreeComponent(e,z(this),{wrapper:r,proparea:g}),s=!0}),r.sortableComponent({axis:"y",component:c,parentStateSelector:e.invisibleParent,placeholder:"sk-placeholder",items:"> :not(.nx-pagebuilder-component-readonly)"}),c.addActionItem("",e.addicon||"sk-bi-propertyitem-add",function(){var f;if(e.invisibleParent){var h=b.children(e.invisibleParent);h.length||(h=D("<"+e.invisibleParent+"/>"),b.append(h)),f=h}else f=c.state;var i=e.defaultStateFunction&&e.defaultStateFunction()||D("<"+e.id+"/>");f.append(i),c.save(),d.addTreeComponent(e,i,{wrapper:r,proparea:g}),e.refreshLinkedComponent&&e.linkedComponent.refresh(),a.noItemsFunction&&q&&q.hide()},e.addtooltip?e.addtooltip:a.addtooltip)}),a.noItemsFunction){q=c.element.find(".nx-noitemwrapper"),q.length||(q=z("<div>").addClass("nx-noitemwrapper").css("margin-left",(parseInt(a.indent,10)||0)+32+"px").appendTo(c.element));var u=a.noItemsFunction(c.state);q.empty().append(u),s||!u?q.hide():q.show()}if(a.actionItemsFunction){var v=a.actionItemsFunction(c);v&&v.length&&z.each(v,function(){var a=this;c.addActionItem(a.label,a.icon,a.action,a.tooltop,a.id)})}c.element.append(r)},propertiesRenderer:function(b,c){y.buildPropsEditor(c.state,a.propsFunction&&a.propsFunction(c)||a.props||[],{columnCount:1,mode:c.mode}).css({padding:"4px",margin:"0px",clear:"none"}).appendTo(b)},hideWrapper:!0,customPropObj:g,defaultStateGenerator:function(){return a.defaultStateFunction&&a.defaultStateFunction()||D("<"+a.id+"/>")},onSelect:function(){e&&e.element.addClass("nx-pagebuilder-selected")},resetPropCategory:!1})):!1},h.prototype.addTreeComponent=function(a,c,d){d=d||{};var e=a.state?a.state:c,f=b(e,this.createBuilderFromTreeObj(a,e,d));return d.wrapper.append(f.element),f},h.prototype.applyPropTreeItem=function(a,b,c){c=c||{};var d,e;a.isChild?(e=b.children(a.id),e.length||(e=a.defaultStateFunction&&a.defaultStateFunction()||D("<"+a.id+"/>"),b.append(e)),d=this.addTreeComponent(a,e,c)):d=this.addTreeComponent(a,b,c),c.autoselect&&d.select({resetPropCategory:!1})},h.prototype.applyPropTree=function(a,b,c){var d=this,e=z("<div>").css("height","100%"),f=z("<div>").addClass("nx-pagebuilder-propsidebar"),g=z("<div>").addClass("nx-pagebuilder-propmainbar");a instanceof Array?z.each(a,function(a){d.applyPropTreeItem(this,b,{autoselect:0===a,wrapper:f,proparea:g,mode:c&&c.mode})}):d.applyPropTreeItem(a,b,{autoselect:!0,wrapper:f,proparea:g}),e.append(f,g),this.body.append(e)},h.prototype.applyPropsWithCategories=function(a,b,c){var d=this;d.body.empty(),d.propGroups.empty(),d.catObj=a,c||(c={}),d.mode&&(c.mode=d.mode),z.each(a,function(){var a,e=this,f=e.state?e.state:b;(e.props&&e.props.length>0||e.customPropFunction||e.tree)&&(a=z("<div>").addClass("nx-pagebuilder-toolbarpanel-propgroup"),d.propGroups.append(a.attr("data-name",e.name).text(e.name).click(function(){e.beforeChange&&e.beforeChange(),d.propGroups.children().removeClass("on"),z(this).find(".little-span").remove(),z(this).addClass("on"),z(this).append('<span class="little-span"></span>'),d.category=e.name,d.body.empty();var a;e.customPropFunction?(a=z("<div>"),e.customPropFunction(a,f,c)):e.tree?d.applyPropTree(e.tree,f,c):(a=y.buildPropsEditor(f,e.props,c),d.body.empty()),d.body.append(a),"function"==typeof e.afterPropsRendered&&e.afterPropsRendered(a)})),(e.isUpdated||e.isNew)&&(a.css("position","relative").css("padding-left",(e.isUpdated?54:37)+"px"),a.append(z("<div>").css({top:"3px",left:"6px"}).addClass("nx-pagebuilder-"+(e.isUpdated?"new":"updated")+"prop").text(e.isUpdated?"Updated":"New"))))});var e=this.propGroups.children(),f=e.filter('[data-name="'+this.category+'"]').first();return this.category&&e.length>1&&f.length>0?(this.propGroups.show(),f.click()):e.length>1?(this.propGroups.show(),e.first().click()):(this.propGroups.hide(),e.first().click()),this},h.prototype.applyProps=function(a,b,c){return this.body.empty(),this.propGroups.empty(),this.body.append(y.buildPropsEditor(b,a,c)),this},h.prototype.applyPropsEditor=function(a){return this.body.empty(),this.propGroups.empty(),this.body.append(a),this};var G;B.componentFactory=b,B.componentFactoryWithCache=c,B.appendComponents=d,A.Builder=B.Builder,A.registerBuilder=B.registerBuilder,A.getBuilders=B.getBuilders,A.getBuilder=B.getBuilder,A.updateState=B.updateState,A.save=B.save,A.getConditionDisplayString=B.getConditionDisplayString,A.userinfomap=B.userinfomap,A.operatormap=B.operatormap,A.determineQuotedness=B.determineQuotedness,A.getFieldInfoFromCache=B.getFieldInfoFromCache,A.getMetadataForField=B.getMetadataForField,A.getSObjectForField=B.getSObjectForField,A.isValidFieldForPossibleTargetObjects=B.isValidFieldForPossibleTargetObjects,A.getModelFromModelName=B.getModelFromModelName,A.getSObjectNameFromModelName=B.getSObjectNameFromModelName,A.addFieldToModel=B.addFieldToModel,A.getLastSelectedModelComponent=B.getLastSelectedModelComponent,A.setLastSelectedModelComponent=B.setLastSelectedModelComponent,A.getConditionFieldPropObj=B.getConditionFieldPropObj,A.getConditionOperatorPropObj=B.getConditionOperatorPropObj,A.getConditionValueProperties=B.getConditionValueProperties,A.getFieldProperties=B.getFieldProperties,A.Component=x.Component=e,A.ComponentAcceptor=x.ComponentAcceptor=f,A.ComponentsViewer=x.ComponentsViewer=g,A.PropertiesViewer=x.PropertiesViewer=h,A.buildPropsEditor=x.buildPropsEditor=l,A.sObjectList=x.sObjectList=a.utils.sObjectList,A.makeFieldSelector=x.makeFieldSelector=n,A.makeAddFieldActionButton=x.makeAddFieldActionButton=o,A.showModelFieldPicker=x.showModelFieldPicker=p,A.unselectCurrentComponent=x.unselectCurrentComponent=k,A.getIncludePanelProperties=x.getIncludePanelProperties=q,A.getDrawerActionOption=x.getDrawerActionOption=t,A.getDrawerProps=x.getDrawerProps=s,A.showDrawerBuilder=x.showDrawerBuilder=r,A.makePopupBuilder=x.makePopupBuilder=u,A.popupbuilder=y.popupbuilder=u(),A.showPopupBuilder=y.showPopupBuilder=v,A.makeCustomButtonBuilder=y.makeCustomButtonBuilder=w,A.domIdProp=y.domIdProp=B.coreProps.domIdProp(),A.cssClassProp=y.cssClassProp=B.coreProps.cssClassProp()}(skuid),function(a){var b=a.$,c=a.utils,d=a.builder,e=d.core,f=c.makeXMLDoc;e.registerBuilder(new e.Builder({id:"condition",name:"Condition",hideFromComponentsList:!0,hideWrapper:!0,handleStateEvent:function(b,c,d){("model.remove"===c.type||"model.idChange"===c.type)&&(e.handleModelRemove(b,c,{component:d}),e.handleModelIdChange(b,c)&&d&&a.events.publish("skuidBuilderComponentNeedsRefresh",[d]))},defaultStateGenerator:function(a){var b=f('<condition type="fieldvalue" value="" enclosevalueinquotes="true"/>');return a&&a.model&&"REST"===a.model.attr("adapter")&&b.attr("sourcetype","param"),b},componentRenderer:function(a){a.actionbar.css("top","1px");var d=a.state,g=d.attr("type"),h=d.attr("name"),i=h&&c.startsWith(h,"__autofilter__");a.body.css("padding","0px").append(b("<div>").addClass("nx-pagebuilder-conditiontag").append(b("<div>").css("float","left").addClass("sk-icon sk-bi-condition"),b("<div>").addClass("nx-pagebuilder-conditionlabel").css({"margin-left":"24px","margin-top":"1px"}).text(e.getConditionDisplayString(d)))),a.isSubcondition=d.parent().is("condition")||d.parent().parent().is("condition"),i?a.body.css("opacity","0.4"):a.addActionItem("","sk-bi-condition-delete",function(){var b=a.element.parent().parent().parent().data("object");a.remove(),b.refresh().select()},a.isSubcondition?"Remove this Sub-Condition":"Remove this Condition");var j=b("<div>").addClass("nx-pagebuilder-conditionschildren").show(),k=e.getBuilder("condition"),l=function(a){var b=e.componentFactory(a,k);b.element.css("margin-left","24px"),j.append(b.element)};d.children("conditions, condition").each(function(){var a=b(this);a.is("conditions")?a.children().each(function(){l(b(this))}):l(a)}),a.isSubcondition||"join"!==g||a.addActionItem("","sk-bi-condition-add",function(){var b=a.state.attr("joinobject"),c="undefined"!=typeof b&&b!==!1;if("join"!==g||c){var d=a.state.children("conditions");d.length||(d=f("<conditions/>"),a.state.append(d));var h=k.getDefaultState();d.append(h);var i=e.componentFactory(h,k);i.element.css("margin-left","24px"),j.append(i.element),a.save()}else window.alert("You must choose a Join Object for this Condition before creating Sub-Conditions.")},"Add a Sub-Condition"),a.body.append(j)},propertiesRenderer:function(d,f){var g=f.state,h=b("<div>").css("height","100%"),i=g.attr("name"),j=i&&c.startsWith(i,"__autofilter__"),k=g.closest("model"),l=k.attr("id"),m=k.attr("adapter")||"salesforce",n=a.adapter.getAdapter(m),o="REST"===m;if(d.setTitle(n.prop("composer.modelConditionLabel")||"Condition Properties"),j)h.text("This Condition was automatically generated by a Filter --- it cannot be modified or removed, except by the Filter that created it.").css("padding","8px"),d.body.append(h);else{var p,q,r=k.attr("sobject"),s=e.getMetadataForField(f),t=n.prop("validConditionTypes"),u=[];if(t=t&&t.length?t.slice(0):["fieldvalue","multiple","param","userinfo","blank","modelmerge","join"],f.isSubcondition)for(var v=t.length-1;v>=0;v--)"join"===t[v]&&t.splice(v,1);p=function(a){return function(){a.refresh()}},q=function(a){return function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}},o?u.push({label:"URL Merge Parameter",deleteable:!1,linkedComponent:f,summaryFunction:function(a){return e.conditionDescriptionRenderers.parameter(a)},propsFunction:function(a){return e.getConditionParameterProperties(f,{handleChange:p(a),handleRefresh:q(a)})}}):u.push({label:"Field",deleteable:!1,linkedComponent:f,summaryFunction:function(a){return e.conditionDescriptionRenderers.field(a,r)},propsFunction:function(a){return e.getConditionFieldProperties(f,{fieldMetadata:s,handleChange:function(){s=e.getMetadataForField(f),p(a)()},handleRefresh:q(a),modelName:l})}},{label:"Operator",deleteable:!1,linkedComponent:f,summaryFunction:function(a){return e.conditionDescriptionRenderers.operator(a,r)},propsFunction:function(a){return[e.getConditionOperatorPropObj(f,{fieldMetadata:s,handleChange:p(a)})]}}),u.push({label:"Value",deleteable:!1,linkedComponent:f,summaryFunction:function(a){return e.conditionDescriptionRenderers.value(a,r)},propsFunction:function(a){return e.getConditionValueProperties(f,{handleChange:p(a),handleRefresh:q(a),validTypes:t,modelName:l})}},{label:"State",deleteable:!1,linkedComponent:f,summaryFunction:function(a){return e.conditionDescriptionRenderers.state(a,r)},propsFunction:function(a){return e.getConditionStateProperties(f,{handleChange:p(a),handleRefresh:q(a)})}}),d.applyPropTree(u,g)}}}))}(skuid),function(a){function b(a,b,d){c("#toolbarWrapper .nx-pagebuilder-toolbarpanel-headertext .nx-pagebuilder-component-headerbuttons").remove();var e=c("<div>").addClass("nx-pagebuilder-component-headerbuttons").css({"float":"right",cursor:"pointer"}),f=c("<span>").addClass("nx-pagebuilder-component-actionicon sk-icon");f.addClass(a),e.on("click",function(){d()}),e.append(f),""!==b&&e.skootip(b),c("#toolbarWrapper .nx-pagebuilder-toolbarpanel-headertext").append(e)}var c=a.$,d=a.$L,e=a.builder,f=e.core,g=e.desktop,h=a.utils,i=a.model,j=h.makeXMLDoc,k=a.snippet,l=k.getSnippet,m=k.registerSnippet,n=a.events.publish,o="salesforce",p=!1,q=new f.Builder({id:"field",name:"Field",componentRenderer:function(b){var d,e,g=b.state,h="childRelationship"===g.attr("type"),i=g.attr("id"),j=g.attr("name"),k=g.closest("model"),l=k.attr("id"),m=f.getFieldInfoFromCache(l,i),o={fieldId:i,fieldName:j,isChildRelationship:h};h&&(o.relationshipName=m?m.relationshipName:i),b.body.css({padding:"0px",overflow:"visible"}),b.actionbar.addClass("nx-pagebuilder-actionbar-tag"),b.element.attr({"data-fieldId":i,"data-fieldName":j}),d=c("<div>").addClass("nx-pagebuilder-fieldtag nx-pagebuilder-field").attr("data-model",l).data("generateOptions",o),d.append(c("<div>").css("float","left").addClass("sk-icon sk-bi-"+(h?"childrelfield":"field"))),e=f.getModelFieldComponentLabel(g),d.append(c("<div>").css({"margin-left":"24px","margin-top":"1px"}).html(e.replace(".",".<wbr>"))),b.body.append(d),m&&d.draggable({appendTo:".nx-page",helper:function(){var a=c(this).clone();return a.css({"z-index":1e3,border:"1px solid #CCC","background-color":"#EEE","padding-left":"8px"}),a},revert:"invalid"}),b.addActionItem("","sk-icon-delete",function(){var a=g.attr("id"),c=g.attr("name"),d=g.closest("model").attr("id");b.remove(!1,!0),n("skuidBuilderNeedSave"),f.publishStateEvent({type:"model.field.remove",fieldId:a,fieldName:c,modelId:d})}),function(){var d,e,f=a.builder.getBuilders(),g=[];for(e in f)d=f[e],d.hideFromComponentsList||g.push(e);var h=a.builder.core.getComponentsList();c.each(h,function(b,c){if(-1!==g.indexOf(c.builderId)){var d=c.state;if(!d.attr("uniqueid")){var e=a.utils.generateUniqueId();d.attr("uniqueid",e)}}}),b.save()}()},propertiesRenderer:function(a,b){var d,e=b.state;if("childRelationship"===e.attr("type")){var i,k,l,m,o=e.closest("model"),p=e.attr("id"),r=c("<div>"),s=o.attr("sobject"),t=o.attr("id");a.header.prepend(r),l=f.getServiceFromModel(o).getCachedEntityMetadata(s),l&&(m=l.getChildRelationship(p),m&&(i=m.childSObject)),i&&(k=[{rel:i,ref:i,id:t}]),a.setTitle("Child Relationship: "+p),d=[{name:"Fields",customPropFunction:function(b,c){r.css("visibility","visible"),g.makeFieldSelector(k,{element:b,showDragHandles:!1,headertext:a.headertext,filterboxwrapper:r,isMultiselect:!0,isSelected:function(a){var b=c.children("fields");return b.length&&b.children('[id="'+h.escapeSelector(a)+'"]').length},onChange:function(a){var b=a.fieldId,d=a.isChecked,e=c.children("fields");e.length||(e=j("<fields/>"),c.append(e));var g=e.children('[id="'+h.escapeSelector(b)+'"]');d&&0===g.length?e.append(q.getDefaultState({id:b})):g.remove(),r.children("input").first().select(),n("skuidBuilderNeedSave"),f.publishStateEvent({type:"model.field.remove",parentChildRelationship:c.attr("id"),fieldId:b,modelId:t})}})}},{name:"Conditions",beforeChange:function(){r.css("visibility","hidden")},tree:{id:"conditions",label:"Conditions",deleteable:!1,icon:"sk-bi-conditions",isChild:!0,children:[{id:"condition",labelFunction:function(a){return f.getConditionDisplayString(a)},defaultStateFunction:function(){return j('<condition enclosevalueinquotes="true" operator="="/>')},propsFunction:function(a){a.isChildRelationshipCondition=!0;var b=[f.getConditionFieldPropObj(a,{sobject:i,modelName:t,handleChange:function(){a.rebuildProps()}}),f.getConditionOperatorPropObj(a,{fieldMetadata:f.getMetadataForField(a)})];return b.concat(f.getConditionValueProperties(a,{handleRefresh:function(){a.rebuildProps()},validTypes:["fieldvalue","multiple","blank","userinfo","modelmerge","param"],modelName:t}))}}]}},{name:"Properties",beforeChange:function(){r.css("visibility","hidden")},props:[{id:"limit",type:"string",label:"Max # of Records (Limit)"},{id:"orderby",type:"string",label:"Fields to Order Records By"}]}]}else d=f.getModelFieldProperties({component:b,propViewer:a});a.applyPropsWithCategories(d,e)},hideWrapper:!0,defaultStateGenerator:function(a){return f.defaultStateGenerators.field(a)}});e.fieldBuilder=g.fieldbuilder=q;var r=f.getBuilder("condition"),s=new f.Builder({id:"conditions",name:"Conditions",componentRenderer:function(b){var d,e=b.state,g=c("<div>").addClass("nx-pagebuilder-conditionschildren"),i=e.closest("model"),j=a.adapter.get(i.attr("adapter")||"salesforce");b.actionbar.addClass("nx-pagebuilder-actionbar-tag"),b.isExpanded=!0,b.conditionschildren=g,b.body.addClass("nx-pagebuilder-conditionswrapper").css({padding:"0px",overflow:"visible"}).append(c("<div>").addClass("nx-pagebuilder-conditionstag").append(c("<div>").css("float","left").addClass("sk-icon sk-bi-conditions"),c("<div>").css({"margin-left":"24px","margin-top":"1px"}).text((j?j.prop("composer.modelConditionsLabel"):"")||"Conditions"))),d=function(a){g.append(f.componentFactory(a,r).element)},e.children().each(function(){var a=c(this);a.is("conditions")?a.children().each(function(){d(c(this))}):d(a)}),b.addActionItem("","sk-icon-add",function(){var a=r.getDefaultState({model:i});b.state.append(a);var c=f.componentFactory(a,r);g.append(c.element),h.scrollTo(c.element,0),b.save(),c.select()}),e.attr("logic")||g.sortableComponent({axis:"y",component:b,placeholder:"sk-placeholder"}),b.body.append(g)},propertiesRenderer:function(a,b){a.applyPropsWithCategories(f.getConditionsBuilderProperties({propertiesViewer:a,component:b}),b.state,{mode:a.mode})},onSelect:function(a){var b=a.element;a.isExpanded&&a.isSelected()?(a.conditionschildren.hide(),a.isExpanded=!1):(b.siblings().find(".nx-pagebuilder-groupbyfieldschildren, .nx-pagebuilder-fieldschildren").hide(),h.niceExpand(a.body,a.conditionschildren,0,!0),a.isExpanded=!0)},hideWrapper:!0}),t=new f.Builder({id:"fields",name:"Fields",componentRenderer:function(b){b.body.addClass("nx-pagebuilder-fieldswrapper").css({padding:"0px",overflow:"visible"});var d=b.state.closest("model"),e="aggregate"===d.attr("type"),g=a.adapter.getAdapter(d.attr("adapter")||"salesforce"),i=g&&"local"===g.prop("runtime.metadataSource"),j=c("<div>").addClass("nx-pagebuilder-fieldstag"),k=c("<div>").addClass("nx-pagebuilder-fieldschildren").hide();j.append(c("<div>").css("float","left").addClass("sk-icon sk-bi-"+(e?"fields-agg":"fields")),c("<div>").css({"margin-left":"24px","margin-top":"1px"}).text(e?"Aggregations":"Fields")),b.body.append(j),b.fieldschildren=k,b.isExpanded=!1,b.state.children().each(function(){var a=f.componentFactory(c(this),q);k.append(a.element)}),b.addActionItem("Add "+(i?"":"Ui-Only ")+"Field","sk-icon-add",function(){var a,c=q.getDefaultState({id:f.getUniqueFieldName("NewField",f.getModelFromModelName(d))});i||c.attr("uionly","true"),b.state.append(c),a=f.componentFactory(c,q),k.append(a.element),h.scrollTo(a.element,0),b.save(),a.select()}),b.body.append(k)},propertiesRenderer:function(b,d){var i=d.state.closest("model"),j=i.attr("adapter")||o,k=a.adapter.get(j),l=a.service.getService(i.attr("service")||o),m=i.attr("id"),p="aggregate"===i.attr("type"),r=e.pagebuilderui.cproperties.clear(!0),s=c("<div>");r.header.prepend(s);var t=function(a,c,e){g.makeFieldSelector(f.createBreadcrumbForModel(i),{element:a,showDragHandles:!p,allowRepeatedSelectionsOfSameField:p,headertext:r.headertext,filterboxwrapper:s,isMultiselect:!0,isSelected:function(a){return p?!1:c.children('[id="'+h.escapeSelector(a)+'"]').length},selectedOnly:"selectedonly"===e,selectable:function(a){return"OBJECT"!==a.displaytype},childRelationshipsOnly:"childonly"===e,onChange:function(a){var b=a.fieldId,g=a.isChecked,j=a.targetObjects,k=a.isChildRelationship||!1,l=c.children('[id="'+h.escapeSelector(b)+'"]'),o=d.body.find(".nx-pagebuilder-fieldschildren");if(p||g&&0===l.length)f.addFieldToModel({fieldId:b,targetObjects:j,model:i,fieldsNode:c,fieldsElement:o,fieldBuilder:q,isChildRelationship:k,view:e}),n("skuidBuilderSave");else{var r,t,u;p?(t=a.fieldName,r=o.children('[data-fieldname="'+t+'"]')):r=o.children('[data-fieldid="'+b+'"]'),u=r.data("object"),u&&u.remove(!0,!0),n("skuidBuilderNeedSave"),f.publishStateEvent({type:"model.field.remove",fieldId:b,fieldName:t,modelId:m})}s.children("input").first().select()},mode:b.mode})},u=[{name:"All Fields",customPropFunction:function(a,b){t(a,b)}}];p||(u.push({name:"Selected Fields",customPropFunction:function(a,b){t(a,b,"selectedonly")}}),k&&k.prop("composer.supports.childRelationships")&&u.push({name:"Child Relationships",customPropFunction:function(a,b){t(a,b,"childonly")}}));var v=function(){r.applyPropsWithCategories(u,d.state)};v(),c('<div class="nx-pagebuilder-toolbarpanel-actions nx-pagebuilder-refresh-icon-wrapper">').append(c('<div class="sk-icon sk-icon-refresh">').on("click.skuid",function(){c.blockUI({message:"Refreshing list of Model fields..."}),l.getEntityMetadata({entities:l.buildEntityMetadataRequest({model:i}),ignoreCache:!0,ignoreMetadataOverrides:!0}).done(function(){c.unblockUI(),v()}).fail(function(a){c.blockUI({message:"There was an error refreshing fields: "+(a&&a.error?a.error:a),timeout:2e3})})}).skootip("Refresh Fields")).insertAfter(c(".nx-pagebuilder-toolbarpanel-propgroups").first())},onSelect:function(a){a.isExpanded&&a.isSelected()?(a.fieldschildren.hide(),a.isExpanded=!1):(a.element.siblings().find(".nx-pagebuilder-conditionschildren, .nx-pagebuilder-groupbyfieldschildren").hide(),h.niceExpand(a.body,a.fieldschildren,0,!0),a.isExpanded=!0)},hideWrapper:!0}),u=new f.Builder({id:"groupby",name:"Groupings",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-fieldswrapper").css("padding","0px").css("overflow","visible");var b=c("<div>").addClass("nx-pagebuilder-fieldstag");b.append(c("<div>").css("float","left").addClass("sk-icon sk-bi-aggmodel-grouping")),b.append(c("<div>").css({"margin-left":"24px","margin-top":"1px"}).text("Groupings")),a.body.append(b);var d=c("<div>").addClass("nx-pagebuilder-groupbyfieldschildren").hide();a.fieldschildren=d,a.isExpanded=!1,a.state.children().each(function(){var a=f.componentFactory(c(this),q);d.append(a.element)}),d.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"}),a.body.append(d)},propertiesRenderer:function(a,b){var d=b.state,i=d.parent(),j=i.attr("sobject"),k=i.attr("id"),l=e.pagebuilderui.cproperties.clear(!0),m=c("<div>"),o=c("<div>"),p=c("<div>");l.body.append(p,o),l.header.prepend(m),g.makeFieldSelector([{rel:j,ref:j,id:k}],{element:o,showDragHandles:!1,headertext:l.headertext,filterboxwrapper:m,isMultiselect:!0,isSelected:function(a){return d.children('[id="'+h.escapeSelector(a)+'"]').length},onChange:function(a){var c=a.fieldId,e=a.isChecked,g=a.targetObjects,j=d.children('[id="'+h.escapeSelector(c)+'"]'),l=b.body.find(".nx-pagebuilder-groupbyfieldschildren");if(e&&0===j.length)f.addFieldToModel({fieldId:c,targetObjects:g,model:i,fieldsNode:d,fieldsElement:l,fieldBuilder:q}),n("skuidBuilderSave");else{var o=l.children('[data-fieldid="'+c+'"]'),p=o.data("object");p&&p.remove(!0,!0),n("skuidBuilderNeedSave"),f.publishStateEvent({type:"model.field.remove",fieldId:c,fieldName:a.fieldName,modelId:k})}m.children("input").first().select()},filter:function(a){return a.groupable||"DATETIME"===a.displaytype}});var r=[{id:"method",type:"picklist",label:"Grouping Method",defaultValue:"simple",picklistEntries:[{value:"simple",label:"Simple"},{value:"rollup",label:"Rollup"}],onChange:function(){}}],s=g.buildPropsEditor(b.state,r);p.empty().append(s)},onSelect:function(a){a.isExpanded&&a.isSelected()?(a.fieldschildren.hide(),a.isExpanded=!1):(a.element.siblings().find(".nx-pagebuilder-conditionschildren, .nx-pagebuilder-fieldschildren").hide(),h.niceExpand(a.body,a.fieldschildren,0,!0),a.isExpanded=!0)},hideWrapper:!0}),v=[{label:"Model saved",value:"models.saved"},{label:"Model requeried",value:"models.loaded"},{label:"Model cancelled",value:"models.cancelled"},{label:"New row created in Model",value:"row.created"},{label:"Row in Model updated",value:"row.updated"},{label:"Row in Model marked for deletion",value:"row.deleted"},{label:"Row in Model un-marked for deletion",value:"row.undeleted"}],w={};c.each(v,function(){w[this.value]=this});var x=new f.Builder({id:"action",name:"Action",hideFromComponentsList:!0,hideWrapper:!0,defaultStateGenerator:function(){return j("<action><actions/><events/></action>")},componentRenderer:function(a){var b,d=a.body,e=a.state,f=c("<div>").addClass("nx-pagebuilder-modelactiontag"),g=e.children("events").first().children(),h=e.children("actions").first().children().length;d.css("padding","0px"),a.actionbar.css("top","1px"),f.append(c("<div>").css("float","left").addClass("sk-icon sk-bi-model-actions")),b=g.length?"When "+c.map(g,function(a){var b=w[c(a).text()];return b?b.label:"[Unknown Event]"}).join(" or ")+", then run "+h+" actions":"(No initiating events specified)",f.append(c("<div>").addClass("nx-pagebuilder-modelactionlabel").css({"margin-left":"24px","margin-top":"1px"}).text(b)),d.append(f),a.addActionItem("","sk-bi-condition-delete",function(){var b=a.element.parent().parent().parent().data("object");a.remove(),b.refresh().select()},"Remove this Action")},propertiesRenderer:function(a,b){a.setTitle("Model Action Properties");var d=b.state,e={id:"events",location:"node",type:"multipicklist",storeAs:{type:"node",name:"event"},label:"Initiating Event(s)",helpText:"If these Events occur on this Model, then the action items will be run",picklistEntries:v,noneSelectedText:"Select Events...",onChange:function(a,c){c&&!h.contains(a,"row.updated")&&h.contains(c,"row.updated")&&d.children("fields").remove(),b.save().refresh().rebuildProps()}},g=[e],i=[{name:"Initiating Events",props:g},f.getActionsCategory({useModelName:d.closest("model").attr("id"),linkedComponent:b,refreshLinkedComponent:!0})];if(d.children("events").children('event:contains("row.updated")').length){var j,k=[],l=f.getModelFromModelName(d.closest("model").attr("id"));l.length&&(l.children("fields").children("field").each(function(){var a=c(this).attr("id");h.contains(a,".")||k.push(a)}),k.sort(),j=c.map(k,function(a){return{value:a,label:a}})),g.push({id:"fields",isNew:!0,location:"node",type:"multipicklist",storeAs:{type:"node",name:"field"},label:"When which Fields(s) are updated?",helpText:"Optionally, choose which fields must be updated in order for actions to be run. By default, if any field is updated, then actions will be run.",picklistEntries:j||[],noneSelectedText:"Any Fields in Model"})}a.applyPropsWithCategories(i,d)}}),y=new f.Builder({id:"actions",name:"Actions",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-modelactionswrapper").css({padding:"0px",overflow:"visible"}),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var b=c("<div>").addClass("nx-pagebuilder-modelactionstag").append(c("<div>").css("float","left").addClass("sk-icon sk-bi-model-actions"),c("<div>").css({"margin-left":"24px","margin-top":"1px"}).text("Actions"));a.body.append(b),a.isExpanded=!1;var d=c("<div>").addClass("nx-pagebuilder-modelactionschildren").hide();a.modelActionsChildren=d,a.state.children().each(function(){var a=f.componentFactory(c(this),x);d.append(a.element)}),a.addActionItem("","sk-icon-add",function(){var b=x.getDefaultState();a.state.append(b);var c=f.componentFactory(b,x);d.append(c.element),h.scrollTo(c.element,0),a.save(),c.select()}),d.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"}),a.body.append(d)},propertiesRenderer:function(a){a.setTitle("Model Actions"),a.body.empty().append(c("<div>").addClass("nx-pagebuilder-infotext").html('Skuid Model Actions allow you to specify actions to perform when certain events are triggered on a given model. For example, use Model Actions to query related models (i.e. an "Action") when the given model is saved (i.e. an "Initiating Event").'))},onSelect:function(a){a.isExpanded&&a.isSelected()?(a.modelActionsChildren.hide(),a.isExpanded=!1):(a.element.siblings().find(".nx-pagebuilder-groupbyfieldschildren, .nx-pagebuilder-fieldschildren, .nx-pagebuilder-conditionschildren").hide(),h.niceExpand(a.body,a.modelActionsChildren,0,!0),a.isExpanded=!0)},hideWrapper:!0}),z=function(a){return a.attr("type")||"Query"},A=new f.Builder({id:"method",name:"Method",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-labelwrapper").css("padding","0px"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var b=c("<div>").addClass("nx-pagebuilder-labeltag").append(c("<div>").css("float","left").addClass("sk-icon sk-bi-label"),c("<div>").css({"margin-left":"24px","margin-top":"1px"}).text(z(a.state)));a.body.append(b),a.addActionItem("","sk-icon-delete",function(){a.remove()})},propertiesRenderer:function(b,d){var e,g=d.state,h=a.adapter.get(g.closest("model").attr("adapter")||"REST"),i={onChange:function(){d.refresh().rebuildProps(b),b.setTitle("Method: "+z(g))}},j=[{id:"type",label:"Type",type:"picklist",defaultValue:"query",picklistEntries:[{value:"query",label:"Query"},{value:"insert",label:"Insert"},{value:"update",label:"Update"},{value:"delete",label:"Delete"}],onChange:function(a){var b=a&&-1!==c.inArray(a,["update","delete","insert"]),e=!1,h=g.attr("verb"),j=c.map(f.getServiceAccessMethodProperty({type:a}).picklistEntries,function(a){return a.value});h&&-1!==c.inArray(h,j)||(g.attr("verb",j[0]),e=!0),b&&(g.attr("endpoint")||"insert"===a||(g.attr("endpoint",g.closest("methods").children('[type="'+("update"===a?"delete":"update")+'"][endpoint]').attr("endpoint")),e=!0),g.attr("successif")||(g.attr("successif","requestsucceeds"),e=!0),"true"!==g.closest("model").attr("query")||g.closest("methods").children('[type="query"]').length||(g.closest("model").attr("query","false"),e=!0)),e&&d.save(),i.onChange()}}];if(h&&h.getMethodProperties){var k=h.getMethodProperties({component:d,propertiesViewer:b,type:g.attr("type"),onChange:i.onChange});k&&k.length&&(k[0].props?(e=k,Array.prototype.push.apply(j,e[0].props),e[0].props=j):Array.prototype.push.apply(j,k))}e||(e=[{name:"Basic",props:j}]),b.setTitle("Method: "+z(g)),b.applyPropsWithCategories(e,g,{mode:b.mode})},defaultStateGenerator:function(){return j('<method type="query" verb="GET"/>')},hideWrapper:!0}),B=new f.Builder({id:"methods",name:"Methods",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-labelswrapper").css("padding","0px").css("margin-left","24px"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag"),a.body.append(c("<div>").addClass("nx-pagebuilder-resourcestag").append(c("<div>").css("float","left").addClass("sk-icon sk-bi-labels"),c("<div>").css({
"margin-left":"24px","margin-top":"1px"}).text("Methods")));var b=c("<div>").addClass("nx-pagebuilder-labelschildren");a.body.append(b),a.childItems=b,a.state.children().each(function(){var a=f.componentFactory(c(this),A);b.append(a.element)}),a.childItems.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"}),a.addActionItem("","sk-icon-add",function(){var c,d=A.getDefaultState();a.state.append(d),c=f.componentFactory(d,A),b.append(c.element),h.scrollTo(c.element,0),a.save(),c.select()})},propertiesRenderer:function(a){a.setTitle("Data Access Methods"),a.body.empty().append(c("<div>").addClass("nx-pagebuilder-infotext").html("Read/Write REST Services must define a Method for each function you want to perform with the Model, including reading, creating, updating, and deleting data."))},hideWrapper:!0}),C=new f.Builder({id:"model",name:"Model",componentRenderer:function(b){var d,e,g,h,i,k,l,m,n,o=b.state,p=o.attr("adapter")||"salesforce",q=o.attr("id"),r=c("<div>").addClass("nx-pagebuilder-modeltag"),v=c("<div>").addClass("nx-pagebuilder-modelchildren"),w=o.children("fields");b.element.is(".nx-pagebuilder-selected")?v.show():v.hide(),b.body.addClass("nx-pagebuilder-modelwrapper"),b.actionbar.addClass("nx-pagebuilder-actionbar-tag"),b.tagText=q,b.element.data("component",b),b.modelchildren=v,b.isExpanded=!1,"readonly"===b.mode&&r.addClass("nx-pagebuilder-component-readonly"),r.append(c("<div>").css("float","left").addClass("sk-icon sk-bi-model"),c("<div>").css({"margin-left":"24px","margin-top":"1px"}).text(q)),b.body.append(r,v),"REST"===p&&"readwrite"===o.attr("type")&&(d=o.children("methods"),d.length||(d=j("<methods/>").append(j('<method type="query" verb="GET"/>')),o.append(d)),e=f.componentFactory(d,B),v.append(e.element)),w.length||(w=j("<fields/>"),o.append(w)),g=f.componentFactory(w,t),v.append(g.element),h=o.children("conditions"),h.length||(h=j("<conditions/>"),o.append(h)),i=f.componentFactory(h,s),v.append(i.element),"aggregate"===o.attr("type")&&(m=o.children("groupby"),m.length||(m=j('<groupby method="simple"/>'),o.append(m)),n=f.componentFactory(m,u),v.append(n.element)),k=o.children("actions"),k.length||(k=j("<actions/>"),o.append(k)),l=f.componentFactory(k,y),v.append(l.element),b.addActionItem("","sk-bi-model-delete",function(){var c=a.builder.pagebuilderui.pagecomponent,d=!1;if(!d){var e="Are you sure you want to remove this Model?\n\nIf you do, any Components which reference this Model will be removed, including:\n\n -Components (or sub-components) with a Model attribute set to this Model\n -Conditions / Lookup Filters of type 'Field from another Model'";d=window.confirm(e)}if(d){var g=o.attr("id");b.remove(!1),f.publishStateEvent({type:"model.remove",modelId:g}),c.refresh()}}),b.addActionItem("","sk-icon-clone",function(){var a,c=o.clone();c.children("conditions").find("condition[name^='__autofilter__']").remove(),c.attr("id",f.getUniqueModelName(c.attr("id"))),a=f.componentFactory(c,C),b.element.parent().append(a.element),o.parent().append(a.state),a.save(),a.select()})},propertiesRenderer:function(a,b){var c=b.state;a.setTitle("Model - "+c.attr("id")),a.applyPropsWithCategories(f.getModelProperties(b,a),c)},hideWrapper:!0,defaultStateGenerator:function(){return f.defaultStateGenerators.model()},onSelect:function(a){f.setLastSelectedModelComponent(a),a.isExpanded&&a.isSelected()?(a.modelchildren.hide(),a.isExpanded=!1):(a.isExpanded=!0,a.element.siblings().find(".nx-pagebuilder-modelchildren").hide(),h.niceExpand(a.body,a.modelchildren,0,!0))}}),D=new f.Builder({id:"models",name:"Models",componentRenderer:function(a){a.headerWrapper.css("position","static");var b=a.body.css("overflow","visible");if(f.masterPageXML&&f.masterPageXML.length){var d=f.masterPageXML.children("models");d.children("model").each(function(){var a=f.componentFactory(c(this),C);b.append(a.element)})}a.body.addClass("nx-pagebuilder-component-models"),a.state.children().each(function(){var a=f.componentFactory(c(this),C);b.append(a.element)}),b.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder",items:"> :not(.nx-pagebuilder-component-readonly)"}),this.component=a},propertiesRenderer:function(a){var d=this;b("sk-icon-add","Add Model",function(){var a=d.component,b=f.componentFactory(C.getDefaultState(),C);a.body.append(b.element),a.state.append(b.state),a.save(),b.select()}),a.setTitle("Skuid Models"),a.body.empty().append(c("<div>").addClass("nx-pagebuilder-infotext").html("Skuid Models determine what data will be pulled into this page.  Each model is based on a single Salesforce object, a REST service, or an ODATA service.  Once a model is added to a page, you can set which fields to pull in as well as conditions for which records to load.  Components within the page will reference models to determine the data that they will display."))},hideWrapper:!0}),E=new f.Builder({id:"label",name:"Label",componentRenderer:function(a){var b=a.state.attr("id");a.body.addClass("nx-pagebuilder-resourcewrapper").css("padding","0"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag"),a.element.data("component",a),a.tagText=b;var d=c("<div>").addClass("nx-pagebuilder-resourcetag");d.append(c("<div>").css("float","left").addClass("sk-icon sk-bi-label")),d.append(c("<div>").css("margin-left","24px").css("margin-top","1px").text(b)),a.body.append(d),a.addActionItem("","sk-bi-label-delete",function(){a.remove()})},propertiesRenderer:function(a,b){var c={onChange:function(){b.refresh(),a.setTitle("Label - "+b.state.attr("id"))}},d=f.getLabelProperties(c);a.setTitle("Label - "+b.state.attr("id")),a.applyProps(d,b.state,{mode:a.mode})},defaultStateGenerator:function(){return f.defaultStateGenerators.label("newlabel")},hideWrapper:!0}),F=new f.Builder({id:"labels",name:"Labels",componentRenderer:function(a){a.headerWrapper.css("position","static"),a.body.addClass("nx-pagebuilder-labelswrapper nx-pagebuilder-component-labels");var b=a.childItems=a.body,d=f.masterPageXML&&f.masterPageXML.children("resources");d&&d.children("labels").children("label").each(function(){var a=f.componentFactory(c(this),E);b.append(a.element)}),a.state.children().each(function(){var a=f.componentFactory(c(this),E);b.append(a.element)}),a.childItems.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder",items:"> :not(.nx-pagebuilder-component-readonly)"}),this.component=a},propertiesRenderer:function(a){var d=this;b("sk-icon-add","Add Label",function(){var a=E.getDefaultState(),b=d.component;b.state.append(a);var c=f.componentFactory(a,E);b.body.append(c.element),h.scrollTo(c.element,0),b.save(),c.select()}),a.setTitle("Included Custom Labels"),a.body.empty().append(c("<div>").addClass("nx-pagebuilder-infotext").html('Skuid allows you to use Force.com Custom Labels, along with Translation Workbench, to display public-facing text in each of your users\' preferred Language. For each Custom Label you request, Skuid will see if there is a Translation corresponding to the Language of the User viewing your Skuid Page. If there is, Skuid will display this translated text to the user. It is considered best-practice to use Custom Labels wherever displaying custom text to your users.<br/><br/>To include a Custom Label in a Template, use {{$Label.&lt;LabelName&gt;}}, e.g. {{$Label.Save}}.<br/><br/>To create a new Custom Label, go to Setup &gt; Create &gt; Custom Labels.<br/><br/>More information: <a href="http://help.skuidify.com/s/tutorials/m/supercharge-your-ui/l/102513-using-custom-labels-and-translations-in-skuid" target="SkuidBuilderHelp">Using Custom Labels and Translations in Skuid</a>'))},hideWrapper:!0}),G=new f.Builder({id:"jsitem",name:"JavaScript Item",componentRenderer:function(a){var b=a.state,d=f.getJSItemLabel(b);a.body.addClass("nx-pagebuilder-resourcewrapper").css("padding","0px"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag"),a.element.data("component",a),a.tagText=d.prefix+" "+d.name;var e=c("<div>").addClass("nx-pagebuilder-resourcetag").append(c("<div>").css("float","left").addClass("sk-icon sk-bi-jsitem"),c("<div>").css({"margin-left":"24px","margin-top":"1px"}).text(d.prefix+" "+d.name));a.body.append(e),h.startsWith(b.attr("location"),"inline")&&a.body.off("dblclick").on("dblclick",function(){f.showCodeEditor({state:b,syntax:"javascript",title:"Edit Inline JavaScript",onClose:function(){a.rebuildProps()}})}),a.addActionItem("","sk-bi-jsitem-delete",function(){a.remove()})},propertiesRenderer:function(a,b){var c=b.state.attr("name");a.setTitle("JavaScript Item "+(c&&"- "+c)),a.applyProps(f.getJSItemProperties(b),b.state,{mode:a.mode})},defaultStateGenerator:function(){return f.defaultStateGenerators.jsitem()},hideWrapper:!0}),H=new f.Builder({id:"javascript",name:"JavaScript",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-labelswrapper nx-pagebuilder-component-javascripts"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var b=a.childItems=a.body;f.moduleResources&&f.moduleResources.js&&c.each(f.moduleResources.js,function(){var a=f.componentFactory(j('<jsitem name="'+this.name+'" namespace="'+this.namespace+'" location="staticresource"/>'),G,{mode:"readonly"});b.append(a.element)});var d=f.masterPageXML&&f.masterPageXML.children("resources");d&&d.children("javascript").children("jsitem").each(function(){var a=f.componentFactory(c(this),G);b.append(a.element)}),a.state.children().each(function(){var a=f.componentFactory(c(this),G);b.append(a.element)}),a.childItems.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder",items:"> :not(.nx-pagebuilder-component-readonly)"}),this.component=a},propertiesRenderer:function(a){var d=this;a.setTitle("Included JavaScript"),b("sk-icon-add","Add JavaScript resource",function(){var a=G.getDefaultState(),b=d.component;b.state.append(a);var e=f.componentFactory(a,G);b.childItems.append(e.element),h.scrollTo(c(e.element),0),b.save(),e.select()}),c("<div>").prependTo(a.header);var e=[{name:"Help",customPropFunction:function(a){a.empty().append(c("<div>").addClass("nx-pagebuilder-infotext").html('Skuid allows you to add JavaScript files that will be included with this page.<br/><br/>More information: <a href="http://help.skuidify.com/s/tutorials/m/supercharge-your-ui/l/102514-including-custom-javascript-in-a-skuid-page" target="SkuidBuilderHelp">Including Custom JavaScript in a Skuid Page</a>'))}}];a.applyPropsWithCategories(e,d.component.state)},hideWrapper:!0}),I=new f.Builder({id:"cssitem",name:"CSS Item",componentRenderer:function(a){var b=a.state,d=f.getCSSItemLabel(b);a.actionbar.addClass("nx-pagebuilder-actionbar-tag"),a.element.data("component",a),a.tagText=d.prefix+" "+d.name,a.body.addClass("nx-pagebuilder-resourceswrapper").css("padding","0px").append(c("<div>").addClass("nx-pagebuilder-resourcetag").append(c("<div>").css("float","left").addClass("sk-icon sk-bi-cssitem"),c("<div>").text(a.tagText).css({"margin-left":"24px","margin-top":"1px"}))),"inline"===b.attr("location")&&a.body.off("dblclick").on("dblclick",function(){f.showCodeEditor({state:b,title:"Edit Inline CSS",syntax:"css",onClose:function(){a.rebuildProps()}})}),a.addActionItem("","sk-bi-cssitem-delete",function(){a.remove()})},propertiesRenderer:function(a,b){var c=b.state.attr("name");a.setTitle("CSS Item "+(c&&"- "+c)),a.applyProps(f.getCSSItemProperties(b),b.state,{mode:a.mode})},defaultStateGenerator:function(){return f.defaultStateGenerators.cssitem()},hideWrapper:!0}),J=new f.Builder({id:"css",name:"CSS",componentRenderer:function(a){a.actionbar.addClass("nx-pagebuilder-actionbar-tag"),a.body.addClass("nx-pagebuilder-labelswrapper nx-pagebuilder-component-css");var b=a.childItems=a.body;f.moduleResources&&f.moduleResources.css&&c.each(f.moduleResources.css,function(){var a=f.componentFactory(j('<cssitem name="'+this.name+'" namespace="'+this.namespace+'" location="staticresource"/>'),I,{mode:"readonly"});b.append(a.element)});var d=f.masterPageXML&&f.masterPageXML.children("resources");d&&d.children("css").children("cssitem").each(function(){var a=f.componentFactory(c(this),I);b.append(a.element)}),a.state.children().each(function(){var a=f.componentFactory(c(this),I);b.append(a.element)}),a.childItems.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder",items:"> :not(.nx-pagebuilder-component-readonly)"}),this.component=a},propertiesRenderer:function(a){var d=this;b("sk-icon-add","Add CSS resource",function(){var a=I.getDefaultState(),b=d.component;b.state.append(a);var c=f.componentFactory(a,I);b.body.append(c.element),h.scrollTo(c.element,0),b.save(),c.select()}),a.setTitle("Included CSS"),c("<div>").prependTo(a.header);var e=[{name:"Help",customPropFunction:function(a){a.empty().append(c("<div>").addClass("nx-pagebuilder-infotext").html('Skuid allows you to add CSS files that will included with this page.<br/><br/>More information: <a href="http://help.skuidify.com/s/tutorials/m/supercharge-your-ui/l/102515-including-custom-css-in-a-skuid-page" target="SkuidBuilderHelp">Including Custom CSS in a Skuid Page</a>'))}}];a.applyPropsWithCategories(e,this.component.state)},hideWrapper:!0}),K=new f.Builder({id:"filter",name:"Filter",hideWrapper:!0,hideFromComponentsList:!0,handleStateEvent:function(a,b,d){if("field"===a.parent().parent().prop("tagName").toLowerCase())return!1;var e="model.condition.nameChange"===b.type,f="model.remove"===b.type,g="model.idChange"===b.type,h=!1;return e?b.modelId===a.closest("[model]").attr("model")&&(a.attr("condition")===b.oldName&&(a.attr("condition",b.newName),h=!0),c.each(a.find('effect[condition="'+b.oldName+'"]'),function(){c(this).attr("condition",b.newName),h=!0})):(f||g)&&c.each(a.find('source[model="'+(g?b.oldId:b.modelId)+'"]'),function(){g?(c(this).attr("model",b.newId),h=!0):f&&(c(this).remove(),h=!0)}),h&&(n("skuidBuilderNeedSave"),d&&n("skuidBuilderComponentNeedsRefresh",[d])),!1},componentRenderer:function(a){a.body.css("padding","0px");var b=c("<div>").css("margin-top","1px").addClass("nx-conditiontoken nx-actionselect unavailable").append(c("<div>").addClass("nx-actionselect-text").text(f.getFilterItemLabel(a.state)));a.body.append(b)},propertiesRenderer:function(b,c){b.setTitle("Filter Properties");var d=[{name:"Filter",tree:{id:"filter",labelFunction:f.getFilterItemLabel,linkedComponent:c,refreshLinkedComponent:!0,propsFunction:function(a){return a.modelName=c.modelName,f.getFilterItemProperties(a)},beforeDelete:function(a){f.removeModelConditionsForAutoFilter(a.state,a.modelName)},childrenFunction:function(b){var c=[],d=b.state,e=d.attr("type"),g=d.attr("conditionsource");return g||(g=e?"manual":"auto",d.attr("conditionsource",g)),e||(e="select",d.attr("type",e)),"select"===e&&"auto"!==g?c.push({id:"source",labelFunction:function(a){var b="Source: ",c=a.attr("type");return"metadata"===c?b+="Picklist Options":"model"===c?b+="Rows in a Model":"manual"===c?b+="Manual":"custom"===c&&(b+="Result of Snippet"),b},invisibleParent:"sources",indent:1,icon:"sk-bi-source",addicon:"sk-bi-source-add",addtooltip:"Add Option Source",deleteicon:"sk-bi-source-delete",deletetooltip:"Remove Option Source",childrenFunction:function(a){var b=[],c=a.state;return"manual"===c.attr("type")?b.push({id:"option",labelFunction:function(a){return a.attr("label")},invisibleParent:"options",indent:2,icon:"sk-bi-option",addicon:"sk-bi-option-add",deleteicon:"sk-bi-option-delete",addtooltip:"Add Option",deletetooltip:"Remove Option",childrenFunction:function(a){var b=[];return"complex"===a.state.attr("type")&&b.push({id:"effect",labelFunction:f.getEffectItemLabel,invisibleParent:"effects",indent:3,icon:"sk-bi-effect",addicon:"sk-bi-effect-add",deleteicon:"sk-bi-effect-delete",addtooltip:"Add Effect",deletetooltip:"Remove Effect",propsFunction:f.getEffectItemProperties,defaultStateFunction:function(){return j('<effect action="set" value=""/>')}}),b},propsFunction:function(a){var b={id:"type",type:"picklist",label:"What Condition(s) will this Option affect?",defaultValue:"simple",picklistEntries:[{label:"Affect the Default Condition",value:"simple"},{label:"Affect Other Condition(s)",value:"complex"}],onChange:function(){a.state.empty(),a.element.children(".nx-childwrapper").empty(),a.save().refresh().rebuildProps()}},c={id:"label",label:"Label",type:"string",onChange:function(){a.refresh()}},d={id:"value",label:"Value",type:"string",onChange:function(){a.refresh()}},e={simple:[b,c,d],complex:[b,c]};return e[a.state.attr("type")]},defaultStateFunction:function(){return j('<option label="New Option" type="simple"/>')}}):("justothers"===c.attr("effectsbehavior")||"defaultandothers"===c.attr("effectsbehavior"))&&b.push({id:"effect",labelFunction:f.getEffectItemLabel,invisibleParent:"effects",indent:2,icon:"sk-bi-effect",addicon:"sk-bi-effect-add",deleteicon:"sk-bi-effect-delete",addtooltip:"Add Effect",deletetooltip:"Remove Effect",propsFunction:f.getEffectItemProperties,defaultStateFunction:function(){return j('<effect action="set" value=""/>')}}),b},propsFunction:function(b){var c,d=b.state,e={id:"type",type:"picklist",label:"Source Type",defaultValue:"manual",picklistEntries:[{label:"Manual",value:"manual"},{label:"Rows in a Model",value:"model"},{label:"Picklist Options for Condition's Field",value:"metadata"},{label:"Custom Source (Snippet)",value:"custom"}],onChange:function(){b.state.empty(),b.element.children(".nx-childwrapper").empty(),b.save().refresh().rebuildProps()}},g={id:"effectsbehavior",type:"picklist",label:"Which Conditions will this Source's Options affect?",defaultValue:"justdefault",picklistEntries:[{label:"Just the Default Condition",value:"justdefault"},{label:"Default Condition and others",value:"defaultandothers"}],onChange:function(a){"justdefault"===a&&(d.remove("effects"),b.element.children(".nx-childwrapper").empty()),b.save().refresh().rebuildProps()}},h=d.attr("model"),i=h&&f.getModelFromModelName(h);i&&(c=a.utils.getNameField(i.attr("sobject"))),c||(c="Name");var j={id:"labeltemplate",type:"template",displayAs:"input",defaultValue:"{{{"+c+"}}}",label:"Option Label Template",helptext:'Defines the visible label for each auto-created Filter Option. Example: "Account: {{Name}}". Defaults to {{{Name}}}.'},k={id:"valuetemplate",type:"template",displayAs:"input",defaultValue:"{{Id}}",label:"Value to inject into Default Condition",helptext:'Defines the value for each auto-created Filter Option, which will be injected into the Default Condition when the Option is chosen. Defaults to "{{Id}}", but can be any field included in the Model.'},l={id:"prefix",type:"string",label:"Label Prefix (optional)",helptext:'Text to insert BEFORE each auto-generated Filter Option\'s label. For example, if your Filter is on a Status field with options like "New", "Closed", you might want Label Prefix to be "Status: ", so that your Option Labels will look like "Status: New", "Status: Closed", etc.'},m={id:"suffix",type:"string",label:"Label Suffix (optional)",helptext:"Text to be added after each auto-generated Filter Option's label."},n={id:"snippet",type:"string",label:"Snippet Name",helptext:"The name of a Snippet which will dynamically return a list of Options to use to build this Filter."},o={id:"model",type:"model",label:"Merge Source",helptext:"The Model whose first row's specified Merge Field's value will be used as the merge value for this Condition.",onChange:function(a,c,e){d.children("labeltemplate, valuetemplate").empty(),d.children("effects").children("effect[value]").attr("value","{{Id}}"),e&&a&&b.refresh().rebuildProps()}},p={manual:[e],model:[e,o,j,g],metadata:[e,l,m,g],custom:[e,n,g]},q=d.attr("type"),r=d.attr("effectsbehavior"),s=p[q];return"model"===q&&"justothers"!==r&&s.push(k),s},defaultStateFunction:function(){return j('<source type="manual" effectsbehavior="justdefault"/>')}}):"toggle"===e&&c.push({id:"effect",labelFunction:f.getEffectItemLabel,invisibleParent:"effects",indent:1,icon:"sk-bi-effect",addicon:"sk-bi-effect-add",addtooltip:"Add Effect",deleteicon:"sk-bi-effect-delete",deletetooltip:"Remove Effect",propsFunction:f.getEffectItemProperties,defaultStateFunction:function(){return j('<effect action="set" value=""/>')}}),c}}}];b.applyPropsWithCategories(d,c.state)},defaultStateGenerator:function(){return j('<filter type="select" filteroffoptionlabel="New Filter" createfilteroffoption="true" affectcookies="true" autocompthreshold="25" conditionsource="auto" labelmode="auto" />')}});f.registerBuilder(K);var L=new f.Builder({id:"skuidpage",name:"Skuid Page",addChildComponent:function(a,b){return a.acceptor.canAcceptComponent(b)?(a.acceptor.addComponent(b),!0):!1},componentRenderer:function(b){var d,h,i=e.pagebuilderui,k=b.state,l=k.children("models").first(),m=k.children("resources").first(),n=k.children("components").first(),o=k.children("styles").first(),p=k.children("pageregioncontents").first();b.element.css("margin","0px"),b.header.append(c(i.model.mergeRow(i.row,b.builder.name+" - {{Name}}"))),l.length||(l=j("<models/>"),k.append(l)),m.length||(m=j("<resources/>"),k.append(m)),n.length||(n=j("<components/>"),k.append(n)),a.utils.processStylesNode(o,b.element,{whitelist:f.builderSafeBackgroundProperties,removeInlineStyles:!0}),p.length&&(d=p.children('pageregioncontent[uniqueid="__header"]').first(),d.length&&f.appendComponents(b.body,d.children("components").first().children()));var q=b.acceptor=new g.ComponentAcceptor(n,void 0,void 0,b.mode);b.body.css("padding","0").append(q.element.css("margin","8px")),p.length&&(h=p.children('pageregioncontent[uniqueid="__footer"]').first(),h.length&&f.appendComponents(b.body,h.children("components").first().children()))},propertiesRenderer:function(b,d){function g(b,c){var e,g,h,i,k,l=q.children("pageregioncontents");l.length||(l=j("<pageregioncontents/>").appendTo(q)),e=l.children('pageregioncontent[uniqueid="__'+c+'"]'),b===!0?(e.length||(e=j('<pageregioncontent uniqueid="__'+c+'"/>')),k=e.children("components").first(),k.length||(k=j("<components/>")),k.appendTo(e),e.appendTo(l),h=a.builder.getBuilder("skuid"+c),g=h.getDefaultState(),k.append(g)):(g&&g.length&&(i=f.getComponentFromState(g),i&&i.remove()),e&&e.length&&e.remove(),0===l.children().length&&l.remove()),d.save().refresh(),a.events.publish("builder.colorcheck")}b.setTitle("Edit Page Properties");var h,i,k,l,m,n=e.pagebuilderui,o=n.model,p=n.row,q=d.state,r=a.platform.builder,s={},t=c.map(a.builder.core.availableThemes||{},function(a){return"Composer Dark"!==a.Name&&"Composer Light"!==a.Name?(s[a.Name]=a,a.Name):void 0}).sort(),u=[{label:"Default",value:""}],v=r.getProtectedModules(),w=r.getPageModule(o,p),x=r.getModuleEntries(o),y=!1;c.each(t,function(a,b){u.push({label:b,value:b})}),c.each(x,function(){var a=this.value;return void 0===a?!0:(a===w&&""!==w&&(y=!0),void((-1!==c.inArray(a,v)||-1!==c.inArray(a.toLowerCase(),v))&&(this.disabled=!0)))}),y===!1&&""!==w&&x.push({value:w,label:w,disabled:!1,defaultValue:!1}),i=o.getFieldValue(p,"skuid__MasterPage__c"),k=[{type:"string",label:"Page Name",isStateless:!0,mode:"edit",valueFunction:function(){return o.getFieldValue(p,"Name")},onChange:function(a){o.updateRow(p,{Name:a})}},{type:"picklist",label:"Module",isStateless:!0,required:!1,disabled:w&&(-1!==c.inArray(w,v)||-1!==c.inArray(w.toLowerCase(),v)),mode:"edit",options:x,valueFunction:function(){return o.getFieldValue(p,"skuid__Module__c")},onChange:function(a){a!==w&&o.updateRow(p,{skuid__Module__c:a})}},{type:"integer",label:"Max Auto-Saves",isStateless:!0,helptext:o.getField("skuid__Max_Auto_Saves__c").inlineHelpText,valueFunction:function(){return o.getFieldValue(p,"skuid__Max_Auto_Saves__c")},validator:f.validators.numericOnly,onChange:function(a,b){a!==b&&o.updateRow(p,{skuid__Max_Auto_Saves__c:a})}},{id:"tabtooverride",type:"string",label:"Tab to Override",helptext:"Either the SObject Name (e.g. 'Account', 'skuid__Page__c') of the custom object tab, or the label (e.g. 'Schools' or 'My Timesheets') of the Web/Visualforce tab, that you will be using this page as an override for.",mode:"edit"},{type:"picklist",label:"Theme",picklistEntries:u,helptext:"The name of the theme to use.",mode:"edit",isStateless:!0,valueFunction:function(){return f.getPageXML().attr("theme")},onChange:function(a,b){a!==b&&(""!==a?f.getPageXML().attr("theme",a):f.getPageXML().removeAttr("theme"),d.save(),N())}},{id:"unsavedchangeswarning",type:"picklist",label:"Warn users if page has unsaved changes",picklistEntries:[{label:"No",value:""},{label:"Yes",value:"yes"}],defaultValue:"",helptext:"If a user tries to leave or close this page, and one or more of its Models has unsaved changes, a warning message will be shown before they can leave."},{id:"personalizationmode",type:"picklist",label:"Personalization Mode",picklistEntries:[{label:"Client-Side",value:"client"},{label:"Server-Side",value:"server"}],defaultValue:"server",helptext:'Choose where to store user personalizations, such as remembered table filters. "Client-Side" uses browser session storage and cookies. "Server-Side" uses SObjects.'}],null===i?k.push({type:"boolean",label:"Available as a Master Page",readonly:void 0!==p&&void 0!==p.skuid__Pages__r&&p.skuid__Pages__r.totalSize>0,valueFunction:function(){return o.getFieldValue(p,"skuid__IsMaster__c")},isStateless:!0,onChange:function(a){if(a!==o.getFieldValue(p,"skuid__IsMaster__c")){var b=!0,e=f.pageXML.find("pageregion");a===!1&&e.length&&(b=window.confirm("Page Regions are only allowed on Master Pages. Remove all Page Regions from this page?")),b?(o.updateRow(p,{skuid__IsMaster__c:a}),a===!0?c("#components").find('div[data-ctype="pageregion"]').show():(c("#components").find('div[data-ctype="pageregion"]').hide(),e.remove(),d.element.find(".nx-pagebuilder-region").remove(),d.save())):d.rebuildProps()}}}):k.push({id:"masterpage",type:"custom",label:"Master Page",renderProperty:function(a){var b=o.getFieldValue(p,"skuid__MasterPage__r.Name"),c=o.getFieldValue(p,"skuid__MasterPage__r.skuid__Module__c");a.element.addClass("nx-fieldtext nx-pagebuilder-readonly-text").html('<a href="/'+i+'">'+b+(c?" ("+c+")":"")+"</a>")}}),l=[{name:"Basic",props:k},{name:"Layout",props:[{id:"showheader",type:"boolean",label:"Show Salesforce Header",defaultValue:!0,helptext:"Show the standard Salesforce page header."},{id:"showsidebar",type:"boolean",label:"Show Salesforce Sidebar",defaultValue:!0,helptext:"Show the standard Salesforce sidebar."},{type:"boolean",label:"Show Custom Header",isStateless:!0,valueFunction:function(){return q.children("pageregioncontents").children('pageregioncontent[uniqueid="__header"]').length},onChange:function(a){g(a,"header")}},{type:"boolean",label:"Show Custom Footer",isStateless:!0,valueFunction:function(){return q.children("pageregioncontents").children('pageregioncontent[uniqueid="__footer"]').length},onChange:function(a){g(a,"footer")}}]},{name:"Styles",tree:f.getStandardStyleTree({component:d,standardStyleSections:["background"]})}],a.isAura||l.push({name:"Caching",props:[{id:"cachepage",type:"boolean",label:"Enable Page Caching",defaultValue:!1,helptext:"If enabled, Skuid will cache the generated HTML source for this page, which can dramatically speed up page load time. This is a great way to optimize performance if you are not actively developing a page. Skuid recommends that all Models be processed client-side if Page Caching is enabled so as to ensure that no stale data / metadata is presented to users.",mode:i?"readonly":"edit",beforeChange:function(a){if(a===!0){var b=window.confirm('Before enabling Page Caching, Skuid HIGHLY recommends switching all Models where data / metadata may frequently change to be processed client-side in JavaScript. You can choose to continue processing particular Models server-side by going to a Model\'s Advanced properties and un-checking "Process Model Client-Side".\n\nWould you like Skuid to make this change to all Models?');b&&f.getPageXML().children("models").children("model").each(function(){c(this).attr("processonclient","true")})}}},{id:"cacheexpires",type:"string",label:"Page Cache Longevity (in seconds)",helptext:"The length of time in (seconds) before the page cache will expire and need to be refreshed. Defaults to 600 (10 minutes) if not specified.",placeholder:"600",mode:i?"readonly":"edit"}]}),b.applyPropsWithCategories(l,d.state),h=b.propGroups.children('.nx-pagebuilder-toolbarpanel-propgroup[data-name="Basic"]'),h&&(m=function(){function d(b){void 0===b&&(b={});var d,e,f,g,h,i,j=c("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item");b.column.append(j),d=c("<div>").addClass("nx-basicfieldeditor-item-label").text(b.label||b.field.label),e=b.helptext||b.field.inlineHelpText,e&&(f=c("<div>").addClass("sk-icon sk-icon-help inline").css({"vertical-align":"top","margin-left":"4px"}),f.skootip(e),d.append(f)),j.append(d),g=c("<div>").addClass("nx-field"),j.append(g),h={fieldId:b.field.id,mode:b.mode||"edit"},void 0!==b.filters&&(h.filters=b.filters),i=new a.ui.Field(p,o,null,h),i.render(),void 0===b.defaultValue||o.getFieldValue(p,b.field.id)||i.element.find("input").val(b.defaultValue),g.append(i.element)}var e=b.body.find(".nx-pagebuilder-propcolumn:first");d({column:e,field:o.getField("OwnerId"),label:"Owner"})},h.on("click",m),m())},defaultStateGenerator:function(){return j('<skuidpage showsidebar="true" showheader="true" unsavedchangeswarning="yes" personalizationmode="server"/>').append(j("<resources><labels/><javascript/><css/></resources>"),j("<models/>"),j("<components/>"))}}),M={init:function(b,h){var k,p=this,q=f.getLayoutFields();e.pagebuilderui=p,a.events.subscribe("skuidBuilderXMLLoaded",N),m("pagepreview",function(){l("skuid.builder.page.preview")({xml:p.pageXML,row:p.row,editor:p.editor,model:p.model})}),m("restoreFromSavedVersion",function(b){var d=b.item.row,e=a.model.getModel("pageBuilder_SelectedVersion");c.blockUI({message:"Restoring saved Page Version..."}),e.setCondition(e.getConditionByName("selectedversionid"),d.Id,!1),e.updateData(function(){try{var a=e.getFieldValues(e.getFirstRow(),q,!0).join("");k(a),p.save(),setTimeout(function(){c.blockUI({message:"Restore complete!",timeout:500})},200)}catch(b){c.blockUI({message:"There was an error while trying to restore the selected Page Version:\n\n"+b,timeout:4e3})}})}),m("addSavedPageVersion",function(a){var b,d,e=a.model,g=a.list;c.each(q,function(a,b){if(!e.getField(b)){var d=c.extend({},p.model.getField(b));e.fields.push(d),e.fieldsMap[b]=d}}),b=e.createRow({initiatorId:g&&g.id()}),f.save(p.pageXML[0],e,b),g&&(d=g.newItem(b,{editModeForNewItems:!0}),g.render({resetPagination:!0,refreshFields:!1}))}),p.addClass("nx-editor ui-widget"),p.toolbarwrapper=c("<div>").addClass("nx-pagebuilder-toolbar-wrapper"),p.toolbar=c("<div>").addClass("nx-pagebuilder-toolbar").appendTo(p.toolbarwrapper);var r=c("<div>").addClass("nx-pagebuilder-drawer-handle").append(c("<div>").addClass("nx-pagebuilder-drawer-handle-arrow"),c("<div>").addClass("nx-pagebuilder-drawer-handle-arrow"),c("<div>").addClass("nx-pagebuilder-drawer-handle-arrow")).on("click",function(){p.toolbar.toggle(),p.layoutcontainer.toggleClass("nx-pagebuilder-layout-minimized-composer"),r.toggleClass("down")}).appendTo(p.toolbarwrapper);p.cselector=new g.ComponentsViewer,p.cproperties=new g.PropertiesViewer;var s=c('<div id="rightPanelWrapper">').append(p.cproperties.element),t=c('<div id="toolbarWrapper">'),u=c("<div>").addClass("nx-pagebuilder-toolbarpanel-header"),v=c("<div>").addClass("nx-pagebuilder-toolbarpanel-headertext").text("Components").appendTo(u),w=c("<input>").addClass("nx-pagebuilder-toolbarpanel-headersearch").appendTo(u).attr("placeholder","Search...").css({position:"absolute",right:"28px",top:"0px",width:"140px"}),x=c("<div>").addClass("nx-pagebuilder-toolbarpanel-headersearch-cancel sk-icon sk-icon-delete").appendTo(u).css({position:"absolute",right:"34px",top:"6px",cursor:"pointer"}).hide();w.on("input",function(){var a=w.data("component"),b=w.val();b?x.show():x.hide(),a?R(a,b):p.cselector.filterComponents(b),O()}),x.on("click",function(){w.val(""),
w.trigger("input"),x.hide()});var y=c('<div id="toolbarPanelWrapper">'),z=c("<div>").addClass("nx-pagebuilder-toolbarpanel-body"),A=c('<ul id="toolbarTabNav">');A.append(c('<li class="sk-icon sk-bi-components nx-pagebuilder-toolbar-tab nx-pagebuilder-toolbar-tab-selected nx-pagebuilder-componentstab">').attr("data-icon","sk-bi-components").attr("data-label",d("components")).prop("title",d("components")),c('<li class="sk-icon sk-bi-models nx-pagebuilder-toolbar-tab nx-pagebuilder-modelstab">').attr("data-icon","sk-bi-models").attr("data-label",d("models")).prop("title",d("models")),c('<li class="sk-icon sk-bi-jsitems nx-pagebuilder-toolbar-tab">').attr("data-icon","sk-bi-jsitems").attr("data-label","JavaScript").prop("title","JavaScript"),c('<li class="sk-icon sk-bi-cssitems nx-pagebuilder-toolbar-tab">').attr("data-icon","sk-bi-cssitems").attr("data-label","CSS").prop("title","CSS"),c('<li class="sk-icon sk-bi-labels nx-pagebuilder-toolbar-tab">').attr("data-icon","sk-bi-labels").attr("data-label","Labels").prop("title","Labels")),A.skootip(null,{position:{my:"left center",at:"right+3 center",using:null},show:{delay:0,duration:150},hide:{delay:0,duration:150},open:function(a,b){var d=c("<div>").addClass("sk-hastooltip").css({width:"0",left:"4px",top:"-12px","-webkit-transform":"rotate(90deg)",transform:"rotate(90deg)"});b.tooltip.append(d)}});var B=c("<div>").prop("id","components").append(p.cselector.element).css("display","block"),C=c("<div>").prop("id","models").css("display","none"),E=c("<div>").prop("id","resources").css("display","none"),G=c("<div>").prop("id","resources").css("display","none"),I=c("<div>").prop("id","resources").css("display","none");t.append(A,y),z.append(B,C,E,G,I),y.append(u,z),A.on("click","li.nx-pagebuilder-toolbar-tab",function(){var a=c(this);a.addClass("nx-pagebuilder-toolbar-tab-selected"),a.siblings(".nx-pagebuilder-toolbar-tab").removeClass("nx-pagebuilder-toolbar-tab-selected");var b=z.children().eq(a.index());z.children().css("display","none"),b.css("display","block");var d=b.children(".nx-pagebuilder-component").data("object"),f=w.data("component");if(d&&f&&d._GUID==f._GUID||(v.empty(),v.append(a.attr("data-label"))),w.focus(),w.val(""),w.trigger("input"),d)d.element.hasClass("nx-pagebuilder-selected")||(d.select(),w.data("component",d));else{w.removeData("component");var g=e.pagebuilderui.cproperties;g.clear(),g.setTitle("Skuid Components"),g.body.append(c("<div>").addClass("nx-pagebuilder-infotext").text("Skuid Components are the building blocks of Skuid. They are what define a page's functionality. They also introduce many capabilities above and beyond standard their VisualForce counterparts. Some components can contain other components (ie, Panel Set, Tab Set). Others allow for customization using Mustache templates.")),e.unselectCurrentComponent()}}),A.removeClass("ui-corner-all"),p.toolbar.append(t,s),p.layoutcontainer=c("<div>").addClass("nx-pagebuilder-workspace");var K,M=c(window),P=!1;if(M.scroll(function(){var a=window.pageYOffset||document.documentElement.scrollTop;void 0===K&&(K=p.offset().top),a>K?P||(p.toolbarwrapper.addClass("nx-pagebuilder-toolbar-wrapper-fixed"),p.layoutcontainer.addClass("nx-pagebuilder-layout-fixed"),P=!0):P&&(p.toolbarwrapper.removeClass("nx-pagebuilder-toolbar-wrapper-fixed"),p.layoutcontainer.removeClass("nx-pagebuilder-layout-fixed"),P=!1)}),p.on("click",".nx-pagebuilder-component",function(a){var b=c(this).data("object");b&&b.select(),a.stopPropagation()}),p.model=f.pageModel=a.$M("page"),p.row=f.pageRow=p.model.getFirstRow(),O(),p.editor=new a.ui.Editor(p,{showHeader:"false"!==b.attr("showheader")}),p.editor.handleCancel=function(){a.ui.Editor.prototype.handleCancel.call(p.editor),k(),p.cproperties.clear(),a.events.publish("ui.reflow"),p.smallNavLinks&&p.smallNavLinks.removeClass("disabled")},p.editor.handleSave=function(){a.ui.Editor.prototype.handleSave.call(p.editor),p.smallNavLinks&&p.smallNavLinks.removeClass("disabled");var b=i.getModel("versions");b.cancel(),b.updateData()},p.editor.handleChange=function(){a.ui.Editor.prototype.handleChange.call(p.editor),p.smallNavLinks&&p.smallNavLinks.addClass("disabled")},p.model&&p.editor.registerModel(p.model),p.save=function(){f.save(p.pageXML[0],p.model,p.row)},a.events.subscribe("skuidBuilderSave",function(){p.save()}),f.masterPage=p.model.getFieldValue(p.row,"skuid__MasterPage__c"),null!==f.masterPage){var Q=c.map(q,function(a){return"skuid__MasterPage__r."+a});f.masterPageXML=j(p.model.getFieldValues(p.row,Q,!0).join(""))}k=function(b){var d,e,g=!1;b||(b=p.model.getFieldValues(p.row,q,!0).join("")),b.length?p.pageXML=j(b):p.model&&p.model.data[0]&&(g=!0,p.pageXML=L.getDefaultState()),f.pageXML=p.pageXML,n("skuidBuilderXMLLoaded"),d=p.pageXML.children("models");var h={},i=[];if(c.each(d.children(),function(){var b,d,e,f=c(this),g=f.attr("adapter")||o,j=f.attr("service"),k=a.adapter.getAdapter(g),l=a.service.getService(j);return j||g===o?(j||g!==o||(j=o),void(k&&l&&j!==o&&(e=h[j],e||(e=h[j]={}),d=l.buildEntityMetadataRequest({model:f}),d.modelId=f.attr("id"),b=k.getEntityMetadataCacheKey(d),e[b]||(e[b]=d)))):(i.push(f.attr("id")),!0)}),c.blockUI({message:"Loading Model metadata..."}),i.length>0){var k="The following Models do not have a Data Source selected: "+i.join(", ");a.component.getByType("skuidpage")[0].addProblem(k)}c.when.all(c.map(h,function(b,d){return a.service.getService(d).getEntityMetadata({entities:c.map(b,function(a){return a}),ignoreMetadataOverrides:!0}).fail(function(b){var e="Error retrieving metadata for Model(s) associated with Data Source '"+d+"'. Please check Models' properties to ensure they are set correctly.";if(b){var f="";b instanceof Array?c.each(b,function(a,b){f+=b+"\n"}):"object"==typeof b?f=JSON.stringify(b,void 0,3):f+=b,f&&(e+="\n"+f)}a.component.getByType("skuidpage")[0].addProblem(e)})})).always(function(){c.unblockUI(),p.pagecomponent=f.componentFactory(f.masterPageXML||p.pageXML,L),p.layoutcontainer.empty().append(p.pagecomponent.element),e=f.componentFactory(d,D),C.empty().append(e.element);var a,b,h,i=p.pageXML.children("resources"),k=i.children("labels"),l=i.children("javascript"),m=i.children("css");k.length||(k=j("<labels/>"),i.append(k)),a=f.componentFactory(k,F),I.empty().append(a.element),l.length||(l=j("<javascript/>"),i.append(l)),b=f.componentFactory(l,H),E.empty().append(b.element),m.length||(m=j("<css/>"),i.append(m)),h=f.componentFactory(m,J),G.empty().append(h.element),p.pagecomponent.select(),g&&p.save()})};var R=function(a,b){var d,e=a.body.children();if(""===b)for(d=0;d<e.length;d++)c(e[d]).css("display","block");else for(d=0;d<e.length;d++){var f=c(e[d]).data("component").tagText.toLowerCase().split(" ").join("");f.match(b.toLowerCase().split(" ").join(""))?c(e[d]).css("display","block"):c(e[d]).css("display","none")}};k(),i.isNewId(p.row.Id)||(p.smallNavLinks=c("<div>").addClass("nx-pagebuilder-smallnavlinks").append(c("<a>").addClass("nx-pagebuilder-viewxmllink").prop("href","/apex/skuid__PageXMLEdit?id="+p.row.Id).text("View/Edit XML"),c("<a>").addClass("nx-pagebuilder-viewxmllink").prop("href",(a.isAura?"/apex/skuid__PageBuilder?":(a.page.sfdcDomain?"https://"+a.page.sfdcDomain+".lightning.force.com":"")+"/skuid/pagebuilder.app?")+"id="+p.row.Id).text("Build Page in "+(a.isAura?"Visualforce":"Lightning")))),p.append(p.toolbarwrapper,p.layoutcontainer,p.smallNavLinks),h&&(h.unregister=function(){a.component.Component.prototype.unregister.call(h),p.editor&&p.editor.unregister()})}},N=function(){a.builder.core.getThemeResources(function(b){c("link#stylesheet-icons").remove();var d,e=b["resources.json"],g=[],i={custom:{families:[],urls:[]},google:{families:[]}},j=!1,k=h.combineUrls(b.url.replace("/resource","/resource/"+(new Date).getTime()),"skuidicons.css");e&&(d=e.fontConfig),h.loadCSS(k,{insertBefore:c("link#themeLink")[0],attrs:{id:"stylesheet-icons"}}),d&&c.each(d,function(a,b){b.families&&c.each(b.families,function(b,c){g.push(c.split(":")[0]),-1==c.toLowerCase().split(/[\s\+]/g).join("").indexOf("opensans")&&(j=!0,i[a].families.push(c),d[a].urls&&i[a].urls.push(d[a].urls[b]))})}),f.fonts.web=g,j&&a.webfonts.load({fontConfig:i}),a.events.publish("skuid.builder.themeChanged")})},O=function(){var a=f.pageModel,b=f.pageRow,c=e.pagebuilderui.cselector;a.getFieldValue(b,"skuid__IsMaster__c")!==!0&&c.element.find('div[data-ctype="pageregion"]').hide()};h.registerPlugin("pageBuilder",M),a.componentType.register("pagebuilder",function(a,b,c){p===!1&&(p=!0,a.pageBuilder(b,c))})}(skuid),function(a){function b(a){a||(a={});var b,d,e,g=a.type;switch(g){case r:s[r]||(s[r]=[]),d=a.pageId,e=a.listener,b=f({pageId:d,listener:e,maxInteractionAge:a.maxInteractionAge,schedulerStateChangedHandler:a.schedulerStateChangedHandler,updateInterval:a.updateInterval}),s[r].push(b)}if(b){b.getType=function(){return r};var h=b.destroy;b.destroy=function(){typeof h===o&&h(),c(b)}}return b}function c(a){var b=a.getType();s[b]=s[b].filter(function(b){return b!==a})}function d(a){a||(a={}),typeof a===p&&(a={type:a});var b=a.type,c=b&&s[b],d=[];return c?d=c.slice(0):i.each(s,function(a,b){d=d.concat(b)}),d}function e(a){var b=d(a);b&&b.forEach(function(a){a.destroy()})}function f(a){return a||(a={}),typeof a.pageId!==m&&typeof a.listener===o?g(a):void 0}function g(b){function c(){return ca?void(W()&&(da=!0)):void d()}function d(a){function b(){var b=i.Deferred(),c={};return i.extend(c,V||{},a.interactions||{}),typeof c[z]===m&&(c[z]={type:z}),i.each(c,function(a,b){if(-1===B.indexOf(a))return!0;var c,d=s({type:a}),e=b.data||JSON.stringify({timestamp:Date.now()}),f=b.cancel,g={};f&&0===d.length||(f?$.deleteRows(d):0===d.length?(c=$.createRow(),g[J]=a,g[K]=e,$.updateRow(c,g)):(d.length>1&&$.deleteRows(d.slice(1)),g[K]=e,$.updateRow(d[0],g)))}),$.save().done(function(){V={},b.resolve()}).fail(function(){$.cancel(),b.resolve()}),b.promise()}function c(){var a=i.Deferred();return u===!0?(a.resolve(),a.promise()):($.hasChanged&&$.cancel(),$.updateData(null,{syncOnly:!f}).fail(function(){a.resolve()}).done(function(){var b={},c=[];U=$.getRows().reduce(function(a,d){var e=function(a){return $.getFieldValue(d,a,!0)},f=e(E),g=e(F),h=e(D),i=e(J),l=e(K),m=j.parseSFDateTime(e(L)),n=b[f];n||(n=b[f]={id:f,usersMap:{},users:[]},c.push(n));var o=n.usersMap,p=n.users,q=n.usersMap[g];q||(q=o[g]={id:g,name:e(H),photoUrl:e(I)||k.getDefaultImageUrl("person"),interactionsMap:{},interactions:[]},p.push(q));var r={id:h,type:i,data:l,lastModified:m};return q.interactionsMap[i]=r,q.interactions.push(r),g===S()&&(a[i]={type:i}),a},{}),_.forEach(function(a){typeof a===o&&a(c)}),a.resolve()}),a.promise())}if(!X&&(a||(a={}),!ca)){var e=ba.getState()===N,f=a.isInitial===!0;e&&ba.hibernate(),ca=!0,b().always(function(){X||c().always(function(){X||(da?setTimeout(function(){ca=!1,da=!1,d()},0):ca=!1,e&&ba.resume())})})}}function e(){return r({type:z})}function f(){return u=!0,r([{type:z,cancel:!0},{type:A,cancel:!0}])}function g(){return r({type:A})}function n(){return r({type:A,cancel:!0})}function p(){return r({type:A,cancel:!0})}function q(){X||(i.each(V,function(a,b){b.cancel=!0}),r(G().map(function(a){return{type:a.type,cancel:!0}})))}function r(a){if(!X){i.isArray(a)||(a=[a]);var b=!1;a.forEach(function(a){var c=a.type;b=b||!(c in U)||a.cancel===!0,V[c]=a}),b&&c()}}function s(a){var b=a.type,c=k.filterRowsByConditions($.getRows(),[{field:E,value:R},{field:F,value:S()},{field:J,value:b}]);return c}function G(){return X?[]:$.getRows().filter(function(a){return a.skuid__User__c===S()}).map(function(a){return{type:a.skuid__Type__c}})}function M(){return G().reduce(function(a,b){return a[b.type]=b,a},{})}function O(a){X||a&&typeof a.listener===o&&_.push(a.listener)}function P(a){var b=a.age||NaN,c=new Date;return new Date(c.setMinutes(c.getMinutes()-b))}function Q(){X||(X=!0,i(window).off(y),ba.hibernate(),ba=null,delete t[R],U={},V={},$.unregister(),$=null)}b||(b={});var R=b.pageId,S=function(){return k.userInfo.userId},T=t[R],U={},V={},W=function(){return k.size(V)>0},X=!1,Y=a.page.params.disablepolling||a.collaboration.disablePolling?!0:!1;if(typeof R!==m){if(T)return T.registerListener(b.listener),T;var Z=b.maxInteractionAge||v,$=new l.Model({id:"sk-pi-"+k.generateGUID(),objectName:C,fields:[{id:D},{id:E},{id:F},{id:H},{id:I},{id:J},{id:K},{id:L}],conditions:[new l.Condition({field:E,value:R}),new l.Condition({field:J,type:"multiple",operator:"in",values:[z,A]}),new l.Condition({field:L,name:"LastMod",operator:"gte",value:j.getSFDateTime(P({age:Z})),encloseValueInQuotes:!1}),new l.Condition({field:F,value:S()})],conditionLogic:"(1AND2AND(3OR4))",doQuery:!0,preventUnloadIfUnsavedChanges:!1,recordsLimit:100}),_=b.listener?[b.listener]:[],aa=1e3*(b.updateInterval||w),ba=h({interval:aa,callback:c,hibernateTimeout:x,hibernate:!0,stateChangedHandler:b.schedulerStateChangedHandler}),ca=!1,da=!1;return Y||($.initialize().register().load().done(function(){X||(d(),ba.resume())}),i(window).on(y,ba.keepAwake)),{registerListener:O,reportComposerOpened:e,reportComposerClosed:f,reportComposerUnsavedChanges:g,reportComposerChangesSaved:n,reportComposerChangesCancelled:p,resetPreviousReports:q,getCurrentUsersInteractions:G,getCurrentUsersInteractionsMap:M,destroy:Q}}}function h(a){function b(a){var b=t;b!==a&&(t=a,typeof s===o&&s(a,b))}function c(){return t}function d(){q||(q=!0),c()===N&&(b(P),e()),l=window.setTimeout(g,i),b(N)}function e(){(c()!==M||c()!==O)&&(window.clearTimeout(l),l=null,b(O))}function f(){c()!==N&&c()!==P&&(c()===O&&b(P),d())}function g(){function a(){var a=(Date.now()-p)/1e3;m>a?d():b(O)}b(Q),l=null;var c=j(k)||{};typeof c.always===o?c.always(a):a()}function h(){p=Date.now(),c()===O&&d()}var i=a.interval,j=a.callback,k=a.callbackParams||{},l=null,m=a.hibernateTimeout||1/0,p=Date.now(),q=!1,r=a.hibernate===!0,s=a.stateChangedHandler,t=M;if(typeof i===n&&typeof j===o)return r||d(),{hibernate:e,resume:f,getState:c,keepAwake:h}}var i=a.$,j=a.time,k=a.utils,l=a.model,m="undefined",n="number",o="function",p="string",q=a.collaboration||(a.collaboration={}),r="pageInteractions",s={};i.extend(q,{serviceTypes:{PAGE_INTERACTIONS:r},register:b,getActiveServices:d,destroyAll:e});var t={},u=!1,v=60,w=4,x=60,y="mousemove.pgIntSvc click.pgIntSvc keydown.pgIntSvc scroll.pgIntSvc",z="composerOpened",A="composerUnsavedChanges",B=[z,A],C="skuid__Page_Interaction__c",D="Id",E="skuid__Page__c",F="skuid__User__c",G="skuid__User__r",H=G+".Name",I=G+".SmallPhotoUrl",J="skuid__Type__c",K="skuid__Data__c",L="LastModifiedDate";q.interactions={flags:{IT_COMPOSER_OPENED:z,IT_COMPOSER_UNSAVED_CHANGES:A}};var M="unstarted",N="running",O="hibernating",P="restarting",Q="processing";q.schedulerService={flags:{STATE_UNSTARTED:M,STATE_RUNNING:N,STATE_HIBERNATING:O,STATE_RESTARTING:P,STATE_PROCESSING:Q}}}(skuid),function(a){var b=a.$,c=a.collaboration,d=c.schedulerService.flags,e=c.interactions.flags,f=a.builder.core,g=a.componentType,h=a.events,i=a.$M,j=a.utils,k=function(a,b){return Array.prototype.join.call(a,b)},l="page",m=30,n=e.IT_COMPOSER_OPENED,o=e.IT_COMPOSER_UNSAVED_CHANGES,p=[o,n],q="undefined",r="destroy",s="option",t="content",u="close",v="fast",w="<div>",x="<span>",y="<img>",z="src",A="id",B="interaction-container",C="interaction-avatar",D="stale",E="row.updated",F="models.saved",G="models.cancelled",H="beforeunload",I="mouseout";g.register("CollaborationUI",function(e){function f(a){if(b.isArray(a)&&0!==a.length){var c=a[0],d=c.users.filter(function(a){return a.id!==j.userInfo.userId});d.forEach(function(a){var b=Number.MAX_SAFE_INTEGER,c=-1;a.interactions.forEach(function(a){b=Math.min(b,p.indexOf(a.type)),c=Math.max(c,a.lastModified.getTime())}),a._interactionPriority=b+1,a._interactionGroup=p[b],a._lastInteractionDate=new Date(c)}),d.sort(function(a,b){var c=0,d=a._interactionPriority,e=a._lastInteractionDate.getTime(),f=b._interactionPriority,g=b._lastInteractionDate.getTime();return c=d-f,0===c&&(c=-1*(e-g)),c}),J({users:d})}}function g(a){a===d.STATE_HIBERNATING?R.addClass("hibernating"):R.removeClass("hibernating")}function J(a){var c={users:a.users,usersMap:{}},d=c.users,e=c.usersMap;b.each(d,function(a,b){e[b.id]=a}),b.each(S.users,function(a,b){typeof e[b.id]===q&&b._element.fadeOut(v,function(){b._element.tooltip(r).detach()})}),b.each(d,function(a,c){var d,e,f=P+"avatar-"+c.id,g=S.usersMap[c.id],h=S.users[g];h&&h._element.index()===a?(c._element=h._element,L({user:c})):(d=b("#"+f),d.fadeOut(v,function(){d.tooltip(r).detach()}),c._element=e=K({wrapperId:f,user:c}),0===a?R.prepend(e):R.children().length>=a?R.children("span:nth-child("+a+")").after(e):R.append(e),L({user:c}),e.fadeIn(v))}),S=c}function K(a){var c=a.wrapperId,d=a.user;return b(x).attr(A,c).addClass(C).append(b(y).attr(z,d.photoUrl)).append(b(x).addClass("unsaved-changes-warning sk-icon ui-icon fa-warning")).tooltip({items:"span",position:{my:"left top",at:"left bottom"}})}function L(a){var b=a.user,c=b.id===j.userInfo.userId?"You":b.name,d=b._element,e=((new Date).getTime()-b._lastInteractionDate.getTime())/1e3,f=e>=m,g=null;d.removeClass(k([n,o]," ")).addClass(b._interactionGroup),f?d.addClass(D):d.removeClass(D),b._interactionGroup===n?g=k([c,"is viewing this page."]," "):b._interactionGroup===o&&(g=k([c,"has unsaved changes on this page."]," ")),d.tooltip(s,t)!==g&&d.tooltip(s,t,g),d.on(I,function(){d.tooltip(u)})}if(!a.collaboration.disablePolling){var M=i(l),N=M.getFirstRow(),O=N&&M.getFieldValue(N,"Id"),P="sk-pc-"+O+"-"+j.generateGUID()+"-",Q=P+"container",R=b(w).attr(A,Q).addClass(B).appendTo(e),S={users:[],usersMap:{}},T=c.register({type:c.serviceTypes.PAGE_INTERACTIONS,pageId:O,listener:f,schedulerStateChangedHandler:g});T.resetPreviousReports(),h.subscribe(E,function(a){var b=a.modelId;b===l&&T.reportComposerUnsavedChanges()}),h.subscribe(F,function(a){l in a.models&&a.totalsuccess===!0&&T.reportComposerChangesSaved()}),h.subscribe(G,function(a){l in a.models&&T.reportComposerChangesCancelled()}),window.addEventListener(H,function(){T.reportComposerClosed()})}});var J=" skuid err 001";g.register("messagesui",function(b,c,d){var e=new a.ui.Editor(b,{showHeader:!1,showMessages:!0,showErrorsInline:!1,showErrorsOnHover:!1});d.editor=e,e.handleMessages=function(b,f){if(f.initiatorId===e.id()){var g,h=b.filter(function(a){return a.message.indexOf(J)>=0}),i=b;h.length>0&&(g=h[0],g.message=g.message.replace(J,""),a.actions.runActionsNode(c.children("conflictActions").first(),d,{editor:e,initiatorId:e.id(),$Error:g}),i=b.filter(function(a){return a!==g})),a.ui.Editor.prototype.handleMessages.apply(e,[i,f])}}}),a.snippet.register("CopyCurrentPageState",function(b){var c=b.model,d=b.row,e=a.$M("page"),g=e.getFirstRow();c.updateRow(d,{Name:g.Name+"-"+(new Date).toISOString().replace(/[:.]/g,"-"),skuid__Type__c:g.skuid__Type__c,skuid__Module__c:g.skuid__Module__c,skuid__Composer_Settings__c:g.skuid__Composer_Settings__c,skuid__IsMaster__c:g.skuid__IsMaster__c,skuid__MasterPage__c:g.skuid__MasterPage__c,skuid__Max_Auto_Saves__c:g.skuid__Max_Auto_Saves__c}),f.save(f.pageXML[0],c,d)}),a.snippet.register("CreateNewPageVersion",function(b){var c=b.context,d=a.snippet.get("addSavedPageVersion"),e=a.$M("versions");d({model:e}),c.model=e,c.row=e.getFirstRow()})}(skuid);