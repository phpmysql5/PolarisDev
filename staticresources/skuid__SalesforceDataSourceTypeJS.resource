!function(a){function b(a){for(;J(a);)try{a=JSON.parse(a)}catch(b){break}return a}function c(a,b,d,e){if(b){var f,g,h,i,j,k,l=b.split("."),m=e.getDataSource&&e.getDataSource();if("childRelationship"===a.type)(i=a.referenceTo&&a.referenceTo.length&&a.referenceTo[0])&&(j=m&&m.getCachedEntityMetadata(i.o),(k=a.subFields)&&G.each(k,function(a,b){c(b,b.id,j,e)}));else if(1===l.length){if(f=d&&d.getField&&d.getField(b)){g=e.getOverrideableFieldMetadata(a);var n=a.id,o=a.name;G.extend(!0,a,f),n&&(a.id=n),o&&(a.name=o),g&&G.each(g,function(b,c){a[b]=c})}if(a&&a["function"]){var p,q,r=a["function"];r&&(r=r.toUpperCase(),p=["CALENDAR_MONTH","CALENDAR_QUARTER","CALENDAR_YEAR","DAY_IN_MONTH","DAY_IN_WEEK","DAY_IN_YEAR","FISCAL_MONTH","FISCAL_QUARTER","FISCAL_YEAR","HOUR_IN_DAY","WEEK_IN_MONTH","WEEK_IN_YEAR"],q=["DAY_ONLY"],0===r.lastIndexOf("COUNT",0)?a.displaytype=x.INTEGER:a.displaytype!==x.DATE&&a.displaytype!==x.DATETIME||-1===p.indexOf(r)?a.displaytype==x.DATETIME&&-1!==q.indexOf(r)&&(a.displaytype=x.DATE):a.displaytype=x.STRING,a.required=a.createable=a.editable=!1)}if(a&&a.displaytype===y){var s,t,u,v;a.relationshipName||(a.relationshipName=a.rel),!a.ref&&a.referenceTo&&(s=a.referenceTo)&&s.length&&(t=[],u=[],v={c:"createable",o:"objectName",l:"label",k:"keyPrefix",p:"labelPlural",s:"searchable"},G.each(s,function(a,b){b.o&&(t.push(b.o),u.push(b.k),G.each(v,function(a,c){b[c]=b[a],delete b[a]}),b.accessible=!0)}),t.length&&(a.ref=t.join(",")),u.length&&(a.refprefix=u.join(",")))}}else b=l.shift(),b=H.getReferenceFieldNameFromRelationshipField(b),f=d&&b&&d.getField&&d.getField(b),f&&(h=f.referenceTo,h&&1===h.length?d=m&&m.getCachedEntityMetadata(h[0].objectName||h[0].o):h&&h.length>1&&(d=m&&m.getCachedEntityMetadata("Name")),d&&c(a,l.join("."),d,e)),a.required=a.createable=a.editable=!1}}function d(a){if(a&&a.fields&&a.fields.length){var b=a.getDataSource&&a.getDataSource(),d=b&&b.getCachedEntityMetadata(a.objectName);G.each(a.fields,function(b,e){c(e,e.id,d,a)})}return a}function e(a){if(!a)return"";var c=a.statusCode,d=a.body,e=c&&a.status?c+" "+a.status+": ":"";return d=b(d),d instanceof Array&&1===d.length?e+=d[0].message:d&&d.message?e+=d.message:a.error&&(e+=a.error),e}function f(c){for(var d,f={},g=H.combineUrls(c.serviceUrl,"/services/apexrest/skuid/api/v1/models"),h=0,i=["load","save","getModelMetadata","getEntityList","doSearch"];h<i.length;h++)d=i[h],f[d]=function(d){return function(f){var h,i,j,k=G.Deferred(),l=f&&!J(f)?JSON.stringify(f):f||null,m=!1,n=!1,o=window.Visualforce;return c.name===z?(j=[],l&&j.push(l),j.push(function(b,c){var e,f=!1,g=function(){n||(n=!0,window.confirm('You need to log in again, your session has expired.\n\nPress "OK" to go to the login page now.\n\nPress "Cancel" to remain on this page. Refresh your browser to go to the login page.')&&window.location.reload())},h=function(){var a=G.Deferred(),b=setTimeout(a.reject,5e3),c=G('<iframe src="/apex/" width="0" height="0"/>').css("display","none").appendTo(document.body).load(function(){clearTimeout(b),c.remove(),a.resolve()});return a.promise()},i=function(a){var b=G.Deferred(),c=setTimeout(b.reject,5e3);return a.refresh(function(){clearTimeout(c),b.resolve()}),b.promise()};if(c.status){if(J(b))try{b=JSON.parse(b)}catch(l){}k.resolve(b)}else e=c.message,e&&-1!==e.indexOf("Logged in?")?f=!0:e&&-1!==e.indexOf("Page not allowed for the profile")?f=!0:e&&-1!==e.indexOf("Remoting request invalid")&&(f=!0),f?m?(g(),k.reject(c.message)):(m=!0,function(){return h().then(function(){return G.when.all(G.map(o.remoting.Manager.providers,function(a){return i(a)}))})}().then(function(){a.remote()[d].apply(window,j)},function(){g(),k.reject(c.message)})):k.reject(c.message)},{escape:!1}),a.remote()[d].apply(window,j)):(h=l?"POST":"GET",i={method:h,url:g,headers:{"x-skuid-rest-service-method":d,"X-SKUID-REST-SERVICE-METHOD":d}},"POST"===h&&(i.body=l,i.contentType="application/json"),c.makeRequest(c.createHTTPRequest(i)).then(function(c){var d=c.body,f=c.statusCode;c.error?k.reject(c.error):d&&(d=b(d),G.inArray(f,[200,201,204])<0?k.reject(e(c)):d&&d.error&&1===H.size(d)?"Invalid Skuid Model API request method: null"===d.error&&a.platform.getName()===w.NATIVE?k.reject("The version of Skuid installed in the target Salesforce org is not compatible with Skuid Platform. Please install the latest version of Skuid into this Salesforce org."):k.reject(d.error):k.resolve(d))},function(a){k.reject(e(a))})),k.promise()}}(d);return c._sfdcRemote=f,f}function g(a){var b=a._sfdcRemote;return b||(b=new f(a)),b}function h(){return H.userInfo}function i(a){var b,c=a.fields,d=a.file,e=a.payloadField,f=a.url,g="formboundary"+Math.random().toString(36).substr(2,10),i=a.filename||d.name,j=a.dataSource,k={};b=new Blob(["--boundary_"+g+'\nContent-Disposition: form-data; name="entity_content";\nContent-Type: application/json\n\n'+JSON.stringify(c)+"\n\n--boundary_"+g+"\nContent-Type: "+d.type+'\nContent-Disposition: form-data; name="'+e+'"; filename="'+i+'"\n\n',d,"\n\n--boundary_"+g+"--"],{type:'multipart/form-data; boundary="boundary_'+g+'"'});var l=j.createHTTPRequest({url:f,headers:k,method:"POST"});return l.headers.Accept="application/json",j.name===z&&(l.headers.Authorization="Bearer "+h().sessionId),G.extend(l,{body:b,cache:!1,contentType:!!j.useApexProxy&&'multipart/form-data; boundary="boundary_'+g+'"',processData:!1}),H._ie&&(l.contentType='multipart/form-data; boundary="boundary_'+g+'"'),j.makeRequest(l)}function j(a){var b=a.path,c=a.basePath||"";return a.dataSource&&a.dataSource.name===z&&(c=""),a.accessToken=a.accessToken||h().sessionId,a.url=H.getSafeRelativeUrl(c+"/services/data"+b),i(a)}function k(a,b,c,d,e){var f=c.uploadMethod.dataSource;H.readFileAsBase64(a).then(function(h){var i,j,k,l,m,n=[],o={},p={},q={},r=b.model,s=b.row,t=s&&r?r.getRowId(s):null;o.id="imageAttachmentUpload",o.type="Attachment",p.id="imageImageInsert",p.type="skuid__Image__c",q.id="updateObject",q.type=r.objectName,j=c.description?I(c.description,{row:s,model:r},{createFields:!1}):"",l=c.filename?I(c.filename,{row:s,model:r},{createFields:!1}):a.name,k=b.fieldValue,i=b.fileId,"field"===c.storeAs?i&&k?(p.id="imageImageUpdate",p.updates={},p.updates[k]={Name:l},o.updates={},o.updates[i]={Body:h,Name:l,ContentType:a.type,Description:j},n.push(o,p),m="AttachmentUpdate"):k?(p.id="imageImageUpdate",p.updates={},p.updates[k]={Name:l},o.inserts={1:{ParentId:k,Body:h,Name:l,ContentType:a.type,Description:j}},n.push(o,p),m="CreateAttachment"):(p.inserts={1:{}},o.inserts={2:{ParentId:"1",Body:h,Name:l,ContentType:a.type,Description:j}},q.updates={},q.updates[t]={},q.updates[t][b.fieldName]="1",n.push(p,o,q),m="CreateFileAndAttachment"):"record"===c.storeAs&&(o.inserts={1:{ParentId:t,Body:h,Name:l,ContentType:a.type,Description:j}},n.push(o),m="CreateAttachment"),d({fileName:l}),g(f).save(JSON.stringify({operations:n,rollbackOnAnyError:!0})).then(function(a){var c,d,f,g,h=a.updateResults,i=a.insertResults,j=b.fieldValue;"AttachmentUpdate"===m?h&&2===h.length&&h[0].success&&h[1].success?(c=h[0].id,d=j):(g="Failure Updating Attachment",f=[],h[0].errors&&h[0].errors.length&&(f=f.concat(h[0].errors)),h[1]&&h[1].errors&&h[1].errors.length&&(f=f.concat(h[1].errors))):"CreateAttachment"===m?i&&i.length&&i[0].success?(c=i[0].id,d=j):(g="Failure Creating Attachment",f=[],h[0]&&h[0].errors&&h[0].errors.length&&(f=f.concat(h[0].errors)),i[0]&&i[0].errors&&i[0].errors.length&&(f=f.concat(i[0].errors))):"CreateFileAndAttachment"===m&&(i&&2===i.length&&h&&1===h.length?i[0].success&&i[1].success&&h[0].success?(c=i[1].id,d=i[0].id):(g="Failure Creating File and Attachment (1)",f=[],h[0].errors&&h[0].errors.length&&(f=f.concat(h[0].errors)),i[0].errors&&i[0].errors.length&&(f=f.concat(i[0].errors)),i[1].errors&&i[1].errors.length&&(f=f.concat(i[1].errors))):g="Failure Creating File and Attachment (2)"),g&&f&&f.length&&(g+=": "+G.map(f,function(a){return a.message}).join(", ")),e({newFileId:c,newFieldValue:d,newFileName:l,message:g})},function(a){e({message:a&&a.error})})},function(a){e(a)})}function l(a){var b,c,d,e,f=G.Deferred(),g=a.paramString||"",h=a.dataSource,i=a.fileField,j=a.context;return j&&(j.id?c=j.id:j.row&&(i?-1!==i.indexOf(".")?c=H.getObjectProperty(j.row,i):(d=i.substr(0,i.length-1),c=H.getObjectProperty(j.row,d+"r.skuid__AttachmentId__c")):j.model&&(e=j.model.objectName,"skuid__Image__c"===e?c=j.row.skuid__AttachmentId__c:"Attachment"===e&&(c=j.row.Id)))),c?h.name===z?f.resolve(H.getUrlFromAttachmentId(c+g)):(b=h.serviceUrl+"/services/data/v"+M+"/sobjects/Attachment/"+c+"/body",h.authenticate().then(function(){return h.makeRequest(h.createHTTPRequest({url:b,accept:"application/octet-stream"}))}).then(function(a){f.resolve("data:;base64,"+a.body)},function(a){f.reject(a)})):f.reject("No Attachment Id"),f.promise()}function m(b,c){c({message:a.ajax.getErrorMessage(b,C)})}function n(b,c,d,e,f,h){function i(a){m(a,f)}function k(a){return j({path:"/v"+M+"/sobjects/ContentVersion",basePath:l&&l.serviceUrl,fields:{Origin:a,PathOnClient:q,Description:p},payloadField:"VersionData",file:b,filename:q,dataSource:l})}var l=d.uploadMethod.dataSource,n={row:c.row,model:c.model},o={createFields:!1},p=d.description?I(d.description,n,o):"",q=d.filename?I(d.filename,n,o):b.name,r=d.feedtext?I(d.feedtext,n,o):"";if(e({fileName:q}),a.isAura)return f({message:"Cannot upload large files in Lightning"}),!1;if("record"===d.storeAs)j({path:"/v"+M+"/sobjects/Attachment",basePath:l&&l.serviceUrl,fields:{ParentId:c.model.getRowId(c.row),Name:q,ContentType:b.type,Description:p},payloadField:"Body",file:b,filename:q,dataSource:l}).then(function(a){var b,c=a&&(a.response||a.body);J(c)&&(c=JSON.parse(c)),b=c.id,f({newFileId:b,newFileName:q})},i,function(a){h(a)});else if("field"===d.storeAs){var s,t="/v"+M+"/sobjects/Attachment",u=c.fieldValue;(function(){var a=G.Deferred();if(u)a.resolve(u);else{var b=[],d={id:"imageImageInsert",inserts:{1:{}},type:"skuid__Image__c"},e={id:"updateObject",updates:{},type:c.model.objectName},f=c.model.getRowId(c.row);e.updates[f]={},e.updates[f][c.fieldName]="1",b.push(d,e),g(l).save(JSON.stringify({operations:b,rollbackOnAnyError:!0})).then(function(b){var c,d="";b.globalErrors&&b.globalErrors.length?d+=b.globalErrors.join(", "):b.insertResults&&1===b.insertResults.length&&b.updateResults&&1===b.updateResults.length?b.insertResults[0].success&&b.updateResults[0].success?c=b.insertResults[0].id:(G.each(b.insertResults[0].errors,function(){d+=this.message}),G.each(b.updateResults[0].errors,function(){d+=this.message})):d+="Error Uploading File",c?a.resolve(c):a.reject(d)},function(b){a.reject(b&&b.error)})}return a.promise()})().then(function(a){var d=c.fileId;s=a,d&&a&&(t+="/"+d+"?_HttpMethod=PATCH");var e={Name:q,ContentType:b.type,Description:p};return!d&&a&&(e.ParentId=a),j({path:t,basePath:l&&l.serviceUrl,fields:e,payloadField:"Body",file:b,filename:q,dataSource:l})}).then(function(a){var b,d=c.fileId,e=a&&(a.response||a.body);d?b=d:e&&(e=J(e)?JSON.parse(e):e,b=e.id),f({newFileId:b,newFileName:q,newFieldValue:s})},i,function(a){h(a)})}else"chatterfeed"===d.storeAs?function(){var d=a.page?a.page.community:null,e=d?d.id:null;return j({path:"/v35.0"+(e?"/connect/communities/"+e:"")+"/chatter/feed-elements",basePath:l&&l.serviceUrl,fields:{body:{messageSegments:[{type:"Text",text:r}]},capabilities:{content:{description:p,title:q}},feedElementType:"FeedItem",subjectId:c.model.getRowId(c.row)},payloadField:"feedElementFileUpload",file:b,filename:q,dataSource:l})}().then(function(){if(f(),window.chatter&&l.name===z){var a=chatter.getFeed(),b=a.getConfig();a.refresh({feedType:b.feedType,isFullRefresh:!0,params:b})}},i,function(a){h(a)}):"chatterfiles"===d.storeAs?k("H").then(function(){f()},i,function(a){h(a)}):"contentdocument"===d.storeAs&&k("C").then(function(){f()},i,function(a){h(a)})}function o(b,c,d,e,f){var g=d.filename||b.name,i=d.uploadMethod.dataSource,j=i&&i.serviceUrl?i.serviceUrl:"",k=function(a){m(a,f)};e({fileName:g}),H.readFileAsBase64(b).then(function(b){var c,d,e,l=g.split("."),m="";l.length>1&&(m=l.pop().toUpperCase()),g=l.join("")+m,c=g.match(/[a-z]|[A-Z]|[0-9]/g),g=c?c.join(""):"unnamedResource",/[0-9]/.test(g.charAt(0))&&(g="SR"+g),d=i.createHTTPRequest({url:j+"/services/data/v"+M+"/sobjects/StaticResource",headers:{"Content-Type":"application/json"},method:"POST"}),d.headers.Accept="application/json",i.name===z&&(d.headers.Authorization="Bearer "+h().sessionId),e={Name:g,ContentType:"application/"+m,Body:b,CacheControl:"Public"},G.extend(d,{body:JSON.stringify(e),contentType:"application/json"}),i.makeRequest(d).then(function(a){var b=a.body,c=b.id||b.Id;void 0!==c&&(e.Id=c),f({record:G.extend(e,a)})},function(b){var c="SELECT Id FROM StaticResource WHERE Name='"+g+"'";if(i.name!==z)return void k(b);a.sfdc.api.query(c).then(function(c){if(c.records&&c.records[0]){if(window.confirm('Static Resource "'+g+'" already exists, do you want to overwrite it?')){e.Id=c.records[0].Id;return new a.sfdc.api.SObject("StaticResource",e).update()}}return G.Deferred().reject(b).promise()}).then(function(){f({record:e})},function(a){k(a)})})})}function p(a){var b;return a&&(b=J(a)?a:a.objectName),b&&b in N?N[b]:b in O||b&&H.endsWith(b,"__x")?"Id":"Name"}function q(a,b){return b.getFieldValue(a,p(b.objectName),!0)}function r(a,b){return b.getFieldValue(a,"Id",!0)}function s(){return"Id"}function t(a){return{operations:a.operations.map(function(a){var b={updates:a.returning.map(function(a){return{id:a}}),changes:{},id:a.id,type:a.type};return a.inserts&&G.each(a.inserts,function(a,c){b.changes[a]=c}),a.updates&&G.each(a.updates,function(a,c){b.changes[a]=c}),a.deletes&&G.each(a.deletes,function(a){b.changes[a]={__deleted:!0}}),b}),rollbackOnAnyError:a.rollbackOnAnyError}}function u(b,c){var d={Case:["UseActiveAssignmentRule","SendAutoResponseEmails","SendUserNotificationEmails","AllowExternalEmails"],CaseComment:["AllowExternalEmails"],Event:["SendUserNotificationEmails","AllowExternalEmails"],Lead:["UseActiveAssignmentRule","SendAutoResponseEmails","SendUserNotificationEmails","AssignmentRuleId"],Task:["SendUserNotificationEmails"],User:["SendUserNotificationEmails"]};if(b&&b.operations)return c||(c=B),b.operations.forEach(function(b){var c=d[b.type];["inserts","updates","changes"].forEach(function(d){b[d]&&G.each(b[d],function(d,e){if(G.each(e,function(a,b){(H.endsWith(a,"__r")||H.endsWith(a,"__pr")||H.toClass.call(b)in D)&&delete e[a]}),c){var f=a.$M(b.id),g=f.changes[d];G.each(c,function(a,b){g.hasOwnProperty(b)&&(e[b]=g[b])})}})})}),c<2?t(b):b}function v(a,b){var c=b.dataSource,d=c.getCacheProperty(A);return d||(d=B,c.setPersistentCacheProperty(A,d)),c.authenticate().then(function(){return g(c).save(u(a,d)).then(function(a){return a},function(b){if(b&&b.indexOf("Invalid Skuid Save request - could not deserialize JSON into valid Save Request")>-1){var e=d>=2?1:2;return g(c).save(u(a,e)).then(function(a){return c.setPersistentCacheProperty(A,e),a})}return b})})}var w=a.constants,x=w.DISPLAY_TYPES,y=x.REFERENCE,z=w.SALESFORCE,A="x-salesforce-save-api-version",B=2,C="Could not upload file",D={"[object Object]":1,"[object Array]":1},E=a.dataSource,F=E.getDataSource,G=a.$,H=a.utils,I=H.mergeAsTextInContext,J=H.isString,K=a.sfdc,L=H.makeXMLDoc,M=K.api.version,N={Case:"CaseNumber",ContentDocument:"Title",ContentVersion:"Title",CustomPermission:"MasterLabel",Event:"Subject",FeedItem:"Title",Idea:"Title",PartnerNetworkConnection:"ConnectionName",Solution:"SolutionName",Task:"Subject",WorkOrder:"WorkOrderNumber"},O={CampaignMember:1,AccountContactRole:1,OpportunityContactRole:1,ContractContactRole:1,CaseContactRole:1,CaseComment:1,CaseSolution:1,OpportunityLineItem:1};new a.dataSource.DataSourceType({name:z,prefillMetadataForObject:function(a){d(a.data)},getNameField:p,getIdField:s,getRowId:r,getRowName:q,save:v,load:function(a,b){var c=b.dataSource;return c.authenticate().then(function(){var d,e=["conditionLogic","doQuery","forView","groupByMethod","havingLogic","id","objectName","orderByClause","offsetPageNumber","offsetPageSize","queryAllRows","recordsLimit","type"],f=!1,h=G.map(a,function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&G.inArray(c,e)>-1&&(b[c]=a[c]);return G.each(["fields","groupByFields"],function(c,d){var e,f=a[d];f&&f.length&&(e=b[d]=[],G.each(f,function(a,b){var c;b.uiOnly?c=b:"childRelationship"===b.type?(c={id:b.id,type:b.type},G.each(["recordsLimit","orderByClause","subConditionLogic"],function(a,d){b.hasOwnProperty(d)&&null!==b[d]&&"undefined"!=typeof b[d]&&(c[d]=b[d])}),b.subConditions&&(c.subConditions=[],b.subConditions.length&&G.each(b.subConditions,function(a,b){var d={};for(var e in b)b.hasOwnProperty(e)&&null!==b[e]&&"undefined"!=typeof b[e]&&(d[e]=b[e]);c.subConditions.push(d)})),b.subFields&&(c.subFields=[],b.subFields.length&&G.each(b.subFields,function(a,d){var e={id:d.id};"undefined"!=typeof b.query&&null!==b.query&&(e.query=e.query),c.subFields.push(e)}))):(c={id:b.id},G.each(["name","function","query"],function(a,d){b.hasOwnProperty(d)&&null!==b[d]&&(c[d]=b[d])})),e.push(c)}))}),G.each(["conditions","havings"],function(c,d){var e,f=a[d];f&&f.length&&(e=b[d]=[],G.each(f,function(a,b){var c=G.extend({},b);for(var d in c)null===c[d]&&delete c[d];e.push(c)}))}),a.needsMetadataLoad&&(f=!0),b});return d=!b||b.loadAllMetadata||f?h:{operationModels:h,options:{excludeMetadata:!0}},g(c).load(d).then(function(a){var b,d=G.Deferred();return G.isArray(a)?d.resolve(a):a&&a.models?(b=a.metadata,b&&H.size(b)&&G.each(b,function(a,b){c.cacheEntityMetadata(a,b)}),d.resolve(a.models)):d.reject("Invalid Response Format"),d.promise()})})},getEntityList:function(b){var c=a.utils.sObjectList,d=b.dataSource;return d.name===z&&c?G.Deferred().resolve(c).promise():d.authenticate().then(function(){return g(d).getEntityList()})},search:function(a){var b=a.dataSourceName;return g(F(b)).doSearch(a).then(function(c){var d=G.Deferred();return c.results&&c.results.map(function(b,c){b.objectMapKey=a.returning[c].objectMapKey,b.modelName=a.returning[c].modelName}),a.dataSource=F(b),c.request=a,d.resolve(c).promise()})},buildEntityMetadataRequest:function(a){var b=a.targetEntity;return!b&&a.model&&a.model.attr&&(b=a.model.attr("sobject")),{objectName:b}},getEntityMetadataLoadingMessageFromBreadcrumb:function(a){return"Loading metadata for object "+a.endsobject+"..."},getEntityMetadataCacheKey:function(a){return a.objectName},getEntityMetadata:function(a){var b=G.Deferred(),c=a.entities,e=a.dataSource,f=a.ignoreMetadataOverrides?"true":"false";return c?e.authenticate().then(function(){var a=[];G.each(c,function(b,c){var h=G.Deferred(),i=J(c)?c:c.objectName,j={sObjectName:i,loadChildRelationships:"true",loadPicklistValues:"false",ignoreMetadataOverrides:f};if(a.push(h.promise()),!i)return h.reject("Error: no Salesforce Object Name was specified for Model."),!0;c&&c.fields&&c.fields.length&&(j.fieldsToLoad=c.fields.join(","),G.isPlainObject(c.fields[0])&&(j.fieldsToLoad=c.fields.map(function(a){return a.id}).join(","))),g(e).getModelMetadata(j).then(function(a){a?a instanceof Array&&a.length?h.resolve(G.map(a,function(a){return d(a),a})):(d(a),h.resolve(a)):h.resolve(a)},function(a){h.reject("There was an error retrieving metadata for object: "+i+": "+a)})}),G.when.all(a).then(function(a){b.resolve(a)},function(a){b.reject(a&&a.length?a.join(","):"")})},function(a){b.reject("Unable to authenticate to Salesforce. Metadata could not be retrieved. "+a)}):b.reject("No SObject provided."),b.promise()},getImageSources:function(b){var c={label:"Attachment",needsRecordContext:!0,needsFieldContext:!0,relatedObjectName:"skuid__Image__c",automaticFieldMappings:{Attachment:!0,skuid__Image__c:!0},getSrc:l},d={attachment:c};return b&&b.name===z&&(d.staticresource={label:"Static Resource",builderProps:function(b,c,d){var e=d.additionalOnRefresh,f=d.additionalOnRebuildAndRefresh,g=d.prefix||"",h=[],i=g+"resource",j=g+"resourceContentType",k=g+"path",l={},m=!0;return l[i]="{{#NamespacePrefix}}{{{NamespacePrefix}}}__{{/NamespacePrefix}}{{{Name}}}",l[j]="{{{ContentType}}}",c.attr(j)&&(m=c.attr(j)===a.constants.MIME_TYPES.ZIP),h.push(a.platform.builder.getStaticResourceProperty({id:i,valueTemplates:l,onChange:function(){c.attr(k)&&(c.removeAttr(k),b.save()),b.refresh().rebuildProps(),f&&f()}})),c.attr(i)&&m&&h.push(a.platform.builder.getNestedPathProperty({id:k,state:c,nameProperty:i,namespaceProperty:i,onChange:function(){b.refresh(),e&&e()}})),h},getSrc:function(a){var b,c,d=G.Deferred(),e=a.prefix||"",f=a.xmlDef.attr(e+"resource"),g=a.xmlDef.attr(e+"path"),h=a.context,i=a.mergeSettings;return g&&(g=H.mergeAsTextInContext(g,h,i)),f&&(f=H.mergeAsTextInContext(f,h,i))&&(c=f.split("__"),2===c.length&&(b=c[0],f=c[1])),f?d.resolve(H.getStaticResourceUrl(f,b,g)):d.reject("No Resource Provided"),d.promise()}}),d},getReferenceHandler:function(){return{getBaseReferenceProps:function(b){return[{id:"targetobjects",type:"sobject",label:"SObject Type",dataSourceName:a.dataSource.getDataSourceFromXML(b.state).name}]},getOverrideBatchProperties:function(){return[{type:"helptext",html:"Specify fields that will be added as related data. Any fields that are used in search or display templates will need to be added here."}]},getOverrideBatchNoItemsFunction:function(){return function(){return G("<div>").text("(Loading key field only.)")}},getOverrideBatchFieldChildrenFunction:function(a){return function(){return[{id:"batchfield",indent:1,linkedComponent:a,addtooltip:"Add New Batch Load Field",labelFunction:function(a){return a.attr("field")||"[No Field Selected]"},defaultStateFunction:function(){return L("<batchfield/>")},propsFunction:function(b){return[{id:"field",type:"field",label:"Field",sobject:a.state.attr("targetobjects"),dataSourceName:a.state.attr("datasource"),onChange:function(){b.refresh().rebuildProps()}}]}}]}},getMetadataHandler:function(b,c,d,e,f){var g,h=b.children("batchfields").first(),i=h.children("batchfield"),j=b.attr("keyfield")||"Id",k=b.attr("targetobjects"),l=b.attr("ogdisplaytype"),m=b.attr("rel")||e+"__r";if(c.keyField=j,c.originalDisplayType=l,k&&(g=k.split(","),c.isNamePointing=g.length>1,(f||l&&l!==y)&&(c.relationshipName=c.rel=m),c.referenceTo=G.map(g,function(a){return{accessible:!0,objectName:a}}),c.ref=k),!f&&l&&l!==y){var n=a.dataSource.getDataSourceFromXML(b),o=new a.model.Model({dataSource:n});o.id="_ReferenceLabelModel_"+(new Date).getTime()+m,i&&i.length?o.fields=G.map(i,function(a){return{id:G(a).attr("field")}}):o.fields=[{id:j}],o.doQuery=!0,o.doClone=!1,o.objectName=k,o.initialize();var p=new a.model.Condition;p.name="__reference_batch",p.operator="in",o.addCondition(p),d.batchLabelModels||(d.batchLabelModels={}),d.batchLabelModels[e]=o}},getReferenceValue:function(a,b){return a[b.keyField||"Id"]},getRowFromReferenceValue:function(a,b,c){var d=a.getRows([{field:c.keyField||"Id",value:b}]);return d&&d.length?d[0]:{}},processReferenceLookupModel:function(a,b,c){a.objectName=c,"OwnerId"===b.id&&"Group"===c&&a.addCondition({field:"Type",value:"Queue",inactive:!1}),"recordtype"==c.toLowerCase()&&(a.rTypeFor=b.model.objectName,a.addCondition({field:"SObjectType",value:a.rTypeFor,inactive:!1,type:"fieldvalue"}))}}},getUploadMethods:function(){function b(a,b,c,d,e,f){a.size<h?k(a,b,c,d,e,f):n(a,b,c,d,e,f)}function c(a,b,c,d){var e=a.model.objectName,f=a.row.Id,h=this.dataSource,i=a.model.getFieldValue(a.row,b),j={id:"objdelete",type:e},k={id:"imagedelete",deletes:{},type:"skuid__Image__c"},l=f;j.updates[l]={},j.updates[l][b]="",k.deletes[i]={},c(),g(h).save(JSON.stringify({operations:[j,k]})).then(function(){d()},function(a){d({message:a})})}function d(b,c,d,e,f){var g=b.row.Id,h=c.attr("id");return this.dataSource.name===z?(a.page.runningOnForceSite?a.page.currentSiteUrl:"/")+"apex/UploadImage?id="+g+(d?"&objfield="+d:"")+"&elid="+h+(e?"&desc="+e:"")+(f?"&filename="+f:""):""}function e(){return this.dataSource.name===z}var f,h=65e4,i={id:"autorefreshmodels",type:"boolean",label:"Auto-refresh related Models on successful upload",defaultValue:!0,helptext:"If true, then upon successful file upload, Skuid will automatically attempt to find related Models that are displaying File data, and Skuid will cancel changes in these Models and then re-query them."};return f={record:{label:"In Attachment to Record",relatedObjectName:"Attachment",needsRecordContext:!0,forceStoreAsFileName:!0,upload:b,getSrc:l,deleteFile:c,supportsIframeUpload:e,getIframeSrc:d},chatterfeed:{label:"In Chatter Feed Item",relatedObjectName:"ContentVersion",needsRecordContext:!0,upload:n,builderProps:[{id:"feedtext",type:"text",label:"Feed Text"}]},field:{label:"In Field on Record",needsRecordContext:!0,needsFieldContext:!0,upload:b,getSrc:l,deleteFile:c,supportsIframeUpload:e,getIframeSrc:d,getFileIdField:function(a){return a.substr(0,a.length-1)+"r.skuid__AttachmentId__c"},getFileNameField:function(a){return a.substr(0,a.length-1)+"r.Name"}},chatterfiles:{label:"In Chatter Files",relatedObjectName:"ContentVersion",upload:n},contentdocument:{label:"In Content Document",relatedObjectName:"ContentVersion",upload:n},staticresource:{label:"In Static Resource",canRunPostUploadSnippet:!0,upload:o,hideInBuilder:!0}},G.each(f,function(a,b){if(b.relatedObjectName){var c=b.builderProps;c||(c=b.builderProps=[]),c.push(i)}}),f},getModelProperties:function(b,c){var d=a.builder.core,e=b.state,f=function(){return(e.attr("datasource")||e.attr("service")||z)===z},g=d.getUnsavedChangesWarningProperty({component:b}),h=d.getCoreModelBasicProperties({component:b,propViewer:c}),i=[];return h.push({id:"sobject",type:"sobject",dataSourceTypeName:this.name,dataSourceName:e.attr("datasource")||e.attr("service"),label:"Salesforce Object Name",onChange:function(){b.refresh(),a.mobile&&a.mobile.processResponsiveElements()}},{id:"type",type:"picklist",label:"Model Behavior",picklistEntries:[{label:"Basic",value:""},{label:"Aggregate",value:"aggregate"}],defaultValue:"",onChange:function(){e.children("fields, groupby").empty(),b.save().refresh()}},d.getModelQueryOnPageLoadProperty({component:b,propViewer:c}),d.getModelLimitProperty(),d.getModelOrderByProperty(),d.getCreateDefaultRowProperty()),f()&&"aggregate"!==e.attr("type")&&i.push({id:"doclone",type:"picklist",label:"Clone data returned by Model query",helptext:"Should all data returned by querying this Model be 'cloned', meaning that data in the Model will be marked as 'New' so that when the Model is saved, new records will be created, rather than updates made to existing records?",picklistEntries:[{label:"Yes, always",value:"yes"},{label:"Yes, if 'clone' and 'id' parameters are present in URL",value:""},{label:"No",value:"no"}],defaultValue:""}),i.push({id:"queryallrows",type:"boolean",label:"Query Deleted / Archived records",helptext:'For developers: adds the SOQL "ALL ROWS" clause to your query. If true, then deleted records and/or archived Tasks will be included in your Model\'s query --- by default, they are not.'},{id:"forview",type:"boolean",label:'Update Salesforce "Recently Viewed" info',helptext:"For developers: adds the SOQL \"FOR VIEW\" clause to your query. Use this if you want this Model to feed into Salesforce's tracking of Recently Viewed Items. When this Model's query is run, the LastViewedDate for all records in this Model will be updated, and new records will be added to the RecentlyViewed object. "}),f()&&i.push({id:"processonclient",type:"boolean",defaultValue:d.pageModel.getFieldValue(d.pageRow,"skuid__MasterPage__c")&&"true"===d.getMasterPageXML().attr("cachepage"),label:"Process Model client-side",helptext:"If this page, or its master page, has Page Caching enabled, this is HIGHLY RECOMMENDED, unless you expect this Model's data to rarely change. Causes Skuid to construct this Model client-side in JavaScript rather than server-side, which prevents your Model metadata and data from being cached, which could result in stale / inaccurate metadata/data being presented to your users."}),g&&i.push(g),[{name:"Basic",props:h},{name:"Advanced",props:i}]},processModelXMLExtensions:function(a,b){a.extensions={salesforce:{objectName:b.attr("sobject"),type:b.attr("type"),queryAllRows:"true"===b.attr("queryallrows"),forView:"true"===b.attr("forview")}}},initialize:d,properties:{composer:{supports:{childRelationships:!0},canFieldsBeSelected:function(a){return!!a.breadcrumb.endsobject||"Select an SObject for this Model"}},canAutoGenerateConditionsFromFields:!0,validConditionTypes:["fieldvalue","multiple","param","userinfo","blank","modelmerge","join"],canConditionsBeGrouped:!0,hasGlobalSearchEntities:!0}})}(skuid);